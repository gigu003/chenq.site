<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>普癌新声</title>
<link>https://www.chenq.site/qsight/index.html</link>
<atom:link href="https://www.chenq.site/qsight/index.xml" rel="self" type="application/rss+xml"/>
<description>一个公共卫生医师的个人网站</description>
<generator>quarto-1.3.238</generator>
<lastBuildDate>Tue, 23 May 2023 00:00:00 GMT</lastBuildDate>
<item>
  <title>肿瘤登记数据上报经验分享：R语言批量导入导出excel数据</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-05-23-import-all/index.html</link>
  <description><![CDATA[ 




<section id="随访数据上报要求" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="随访数据上报要求"><span class="header-section-number">1</span> 随访数据上报要求</h2>
<p>随访数据要求上报两部分资料，第一部分是<em>随访资料</em>，第二部分是<em>寿命表资料</em>，并分别以FB和LT为表单名称保存到Excel中。</p>
<section id="随访资料" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="随访资料"><span class="header-section-number">1.1</span> 随访资料</h3>
<p>要求上报建立登记处以来的所有癌症病例并随访至上一年末。</p>
<p>具体上报变量如下：</p>
<ul>
<li>Registr：登记编号</li>
<li>ID: 身份识别号码</li>
<li>Sex: 性别</li>
<li>Age: 年龄</li>
<li>Birthda: 出生日期</li>
<li>Inciden: 出生日期</li>
<li>ICDO3: ICDO3解剖学部位</li>
<li>Morp: ICDO3形态学编码</li>
<li>Beha: ICDO3行为编码</li>
<li>Grad: ICDO3分级编码</li>
<li>Icd10: ICD10编码</li>
<li>Deathda: 死亡日期</li>
<li>Basi: 诊断依据</li>
<li>Trib: 民族</li>
<li>Marri: 婚姻状态</li>
<li>Mult: 是否多原发</li>
<li>Lastcontact: 最后接触日期</li>
<li>Status: 生存状态</li>
<li>Caus: 死亡原因</li>
</ul>
</section>
<section id="寿命表数据" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="寿命表数据"><span class="header-section-number">1.2</span> 寿命表数据</h3>
<p>要求上报与随访资料同年份的寿命表资料。具体变量如下：</p>
<ul>
<li>年份(Year):与随访数据库覆盖年份相同</li>
<li>性别(Sex):合计=0，男性=1，女性=2</li>
<li>年龄组(Age): 0, 1-, 5-, …, 80-, 85及以上， 用组段下限年龄值表示</li>
<li>死亡数(Death):覆盖人群中的全死亡数</li>
<li>人口数(Popu):户籍人口</li>
</ul>
</section>
</section>
<section id="当年发病死亡数据上报" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="当年发病死亡数据上报"><span class="header-section-number">2</span> 当年发病死亡数据上报</h2>
<p>当年发病死亡数据上报的内容要求与随访资料要求上报的变量是一样的，只不过要分为三部分：</p>
<ul>
<li>发病资料：发病日期为上报年份的所有癌症病例资料；</li>
<li>死亡资料：死亡日期为要求上报年份的所有癌症病例资料；</li>
<li>人口数据：要求上报年份登记处所有在地分年龄分性别户籍人口数。</li>
</ul>
</section>
<section id="存在问题及解决方法" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="存在问题及解决方法"><span class="header-section-number">3</span> 存在问题及解决方法</h2>
<p>河南省肿瘤登记采用网络直报信息管理系统进行日常数据的收集和管理，在进行数据上报的时候，我们需要把最新的数据分登记处按照上报格式导出就可以了，这个过程中也涉及了变量名的更改等。</p>
<p>首先加载相关R语言包</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(openxlsx)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(Hmisc)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(haven)</span></code></pre></div>
</div>
<p>我们在code.mdb数据库的registry表中存储了相关登记处的信息，report2019这个变量标记了哪些登记处入选了河南省肿瘤登记年报。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 从code字典里筛选出2019年年报纳入的登记处</span></span>
<span id="cb2-2">registrys <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">mdb.get</span>(<span class="st" style="color: #20794D;">"code.mdb"</span>,<span class="at" style="color: #657422;">tables =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"registry"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;">filter</span>(report2019<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;">select</span>(areacode,city,county)</span>
<span id="cb2-5">registrys<span class="sc" style="color: #5E5E5E;">$</span>areacode <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.character</span>(registrys<span class="sc" style="color: #5E5E5E;">$</span>areacode)</span></code></pre></div>
</div>
<p>通下面的程序，我们把选择需要上报的变量以及把上报变量更改为上报模板要求的变量名称。</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy"><code class="sourceCode r"><span id="annotated-cell-3-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 读取肿瘤登记数据</span></span>
<span id="annotated-cell-3-2">canreg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_sas</span>(<span class="st" style="color: #20794D;">"tumorinfo.sas7bdat.zip"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-3" class="code-annotation-target">  <span class="fu" style="color: #4758AB;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-4" class="code-annotation-target">  <span class="fu" style="color: #4758AB;">select</span>(registr,indno,sex,age,birthda,inciden,topo,morp,beha,grad,autoicd10,deathda,basi,state,caus,dlc,areacode) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-5" class="code-annotation-target">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">id=</span>indno,<span class="at" style="color: #657422;">icdo3=</span>topo,<span class="at" style="color: #657422;">icd10=</span>autoicd10,<span class="at" style="color: #657422;">status=</span>state,<span class="at" style="color: #657422;">lastcontact=</span>dlc)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-3" data-code-annotation="1">把所有变量名改为小写字母</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-3" data-code-annotation="2">选择需要上报的变量</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-3" data-code-annotation="3">把变量名改成上报模板要求的变量名</span>
</dd>
</dl>
</div>
</div>
<p>我们通过下面的程序把寿命表数据转换成上报格式要求的形式。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 整理寿命表数据</span></span>
<span id="cb3-2">lifetable <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_sas</span>(<span class="st" style="color: #20794D;">"population.sas7bdat.zip"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">areacode =</span> <span class="fu" style="color: #4758AB;">substr</span>(addcode,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">6</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">filter</span>(areacode <span class="sc" style="color: #5E5E5E;">%in%</span> areacodes, year <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">2008</span>, year <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">2021</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">select</span>(areacode,year,sex,type,p0<span class="sc" style="color: #5E5E5E;">:</span>p85) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="at" style="color: #657422;">cols =</span> p0<span class="sc" style="color: #5E5E5E;">:</span>p85, <span class="at" style="color: #657422;">names_to =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"agegrp"</span>), <span class="at" style="color: #657422;">values_to =</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"count"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">type=</span><span class="fu" style="color: #4758AB;">ifelse</span>(type<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>,<span class="st" style="color: #20794D;">"pop"</span>,<span class="st" style="color: #20794D;">"death"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;">pivot_wider</span>(<span class="at" style="color: #657422;">names_from =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"type"</span>), <span class="at" style="color: #657422;">values_from =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"count"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">agegrp =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"[^0-9</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">.]"</span>, <span class="st" style="color: #20794D;">""</span>, agegrp)),</span>
<span id="cb3-11">         <span class="at" style="color: #657422;">sex=</span><span class="fu" style="color: #4758AB;">as.numeric</span>(sex)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;">arrange</span>(areacode,year,sex,agegrp)</span></code></pre></div>
</div>
<p>下面的程序把随访资料和寿命表数据按照登记处的行政区划和名称保存成excel，虽然for显式循环运行效率有点低，但是对于几十个登记处的数据来说，运行速度还可以。如果数据量大的时候可以考虑使用lapply来批量导出。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="cf" style="color: #003B4F;">for</span> (areas <span class="cf" style="color: #003B4F;">in</span> registrys<span class="sc" style="color: #5E5E5E;">$</span>areacode){</span>
<span id="cb4-2">  fb <span class="ot" style="color: #003B4F;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(areacode<span class="sc" style="color: #5E5E5E;">==</span>areas)</span>
<span id="cb4-3">  lt <span class="ot" style="color: #003B4F;">&lt;-</span> lifetable <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(areacode<span class="sc" style="color: #5E5E5E;">==</span>areas)</span>
<span id="cb4-4">  county <span class="ot" style="color: #003B4F;">&lt;-</span> registrys[registrys<span class="sc" style="color: #5E5E5E;">$</span>areacode<span class="sc" style="color: #5E5E5E;">==</span>areas,<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"county"</span>)]</span>
<span id="cb4-5">  res <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">FB=</span>fb, <span class="at" style="color: #657422;">LT=</span>lt)</span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;">write.xlsx</span>(res,<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"report/"</span>,areas,county,<span class="st" style="color: #20794D;">".xlsx"</span>),<span class="at" style="color: #657422;">colNames =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb4-7">}</span></code></pre></div>
</div>
<p>以上程序运行的结果见图 Figure&nbsp;1 。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-export" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-05-23-import-all/files.jpg" class="img-fluid figure-img" width="879"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: 导出excel结果</figcaption><p></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>数据处理</category>
  <category>R</category>
  <category>肿瘤登记</category>
  <guid>https://www.chenq.site/qsight/2023-05-23-import-all/index.html</guid>
  <pubDate>Tue, 23 May 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-05-23-import-all/files.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>基于”periodR”包利用现时生存分析法计算人群癌症5年相对生存率</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-04-09-relativesurvival/index.html</link>
  <description><![CDATA[ 




<blockquote class="blockquote">
<p>人群癌症5年生存率是评估包括癌症筛查、诊断、治疗以及管理等癌症综合防治效果的关键指标，是制定和优化癌症防控政策和措施的重要参考数据，它与一个地区的基础医疗水平、诊断设备的可及性等多种因素相关<span class="citation" data-cites="李卓颖2021">(1)</span>。 本篇博文将介绍如何利用人群肿瘤登记数据进行估计人群癌症5年相对生存率。</p>
</blockquote>
<section id="基本概念" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="基本概念"><span class="header-section-number">1</span> 基本概念</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
什么是5年生存率
</div>
</div>
<div class="callout-body-container callout-body">
<p>通俗的讲，5年生存率是就是诊断癌症后，生存期满5年的病人所占的比例。</p>
</div>
</div>
<section id="相对生存率" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="相对生存率"><span class="header-section-number">1.1</span> 相对生存率</h3>
<p>根据死因竞争风险分析理论，癌症病人的死亡危险分别来自两个相互独立的方面:病人所患疾病(癌症)和除此之外的其它方面。后者指不同性别、年龄、种族和年代的人群本身所存在的基础死亡危险。它们分别可由研究人群的<strong>观察生存率</strong>和相应的一般人群的<strong>期望生存率</strong>来反映。</p>
<p><strong>相对生存率</strong>定义为研究人群的<strong>观察生存率</strong>与假定其为一般人群时的<strong>期望生存率</strong>之比,校正了诸如性别、年龄、种族和年代等因素对病人生存情况的影响。因而用<strong>相对生存率</strong>作为地区或人群间生存率水平的比较指标,比观察生存率能更好地说明问题。</p>
<p><strong>观察生存率</strong>反映的是研究人群的总的死亡危险,而<strong>相对生存率</strong>反映的是肿瘤的超额死亡危险。如果相对生存率越接近于 100%,则表明研究人群的预后越好,反之越差。所以它既可以象观察生存率一样用于描述研究人群的生存水平或预后优劣,也可以作为观察生存率的标化指标。</p>
</section>
<section id="感兴趣时期" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="感兴趣时期"><span class="header-section-number">1.2</span> 感兴趣时期</h3>
<p>我们在分析癌症生存率之前，首先要确定一段时间范围作为<em>“感兴趣时期”</em>，本篇博文的分析将把<em>“2017-2019年”</em>作为感兴趣时期，我们要计算这个时期癌症病例的5年生存率，最真实准确的方法是将<em>2017-2019年</em>的确诊的癌症病例分别随访至<em>2022-2024年</em>，然后计算活满5年的人数所占的比例。在当前的时间（2023年），很显然无法得到全部癌症病例的5年随访数据来计算真实生存率，我们就需要采用其他方法进行估算。</p>
</section>
<section id="完全数据" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="完全数据"><span class="header-section-number">1.3</span> 完全数据</h3>
<p>在癌症病例的随访过程中，能够明确观察记录到病例的生存时间，或者发生终点事件的具体时间，这样的数据为完全数据。生存时间是指从规定的起始观察事件到发生特定的终点事件之间的经历的时间跨度。在人群肿瘤登记数据的生存分析中，起始事件一般为明确诊断为癌症，而终止事件一般为因癌症死亡。</p>
</section>
<section id="不完全数据" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="不完全数据"><span class="header-section-number">1.4</span> 不完全数据</h3>
<p>与完全数据相反，研究结束时，研究对象发生了研究设定的终点事件之外的其他事件，从而导致无法明确记录从起始观察到发生终点事件之间的生存时间，这类数据称之为不完全数据。</p>
<p>在人群肿瘤登记数据中，在癌症病例随访过程的截止不是由”癌症死亡”引起的，而是由其他原因引起。</p>
<p>不完全数据分为：删失数据和截尾数据。</p>
<p>不完全数据的主要原因有：</p>
<ul>
<li>失访： 失去联系</li>
<li>退出： 死于非研究因素或非处理因素而退出研究。对于人群肿瘤登记数据来说，如果癌症患者死于癌症以外的其他原因，如意外、交通事故等，也是退出。</li>
<li>终止： 因为已经到研究设定的<strong>随访截止日期</strong>而终止随访观察，但是研究对象仍然存活。</li>
</ul>
</section>
<section id="删失和截尾" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="删失和截尾"><span class="header-section-number">1.5</span> 删失和截尾</h3>
<p><strong>删失的分类</strong></p>
<ul>
<li><em>左删失：</em>研究对象在某一时刻开始接受观察，但是在该时间点之前，研究所感兴趣的事件已经发生，无法明确具体时间。</li>
<li><em>右删失：</em>在进行随访观察中，研究对象观察的起始时间已知，但终点事件发生的时间未知，无法获取具体的生存时间，只知道生存时间大于观察时间。</li>
</ul>
<p>截尾是所有样本的综合特性，指的是观察的总体是有偏的，只有当事件的失效时间出现在观测区间内，我们才能知道这个事件及其观测数据的存在。</p>
<ul>
<li>左截尾（left truncation）：只能观测到一个时间点之后发生的失效事件。左截尾时间点之前发生的失效事件不知情/不关心（如样本来自退休中心，都是&gt;60岁的老人）。</li>
<li>右截尾（right truncation）：只能观测到一个时间点之前发生的失效事件。右截尾时间点之后发生的失效事件不知情/不关心</li>
</ul>
</section>
</section>
<section id="现时生存分析方法介绍" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="现时生存分析方法介绍"><span class="header-section-number">2</span> 现时生存分析方法介绍</h2>
<section id="不同生存率估计方法比较" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="不同生存率估计方法比较"><span class="header-section-number">2.1</span> 不同生存率估计方法比较</h3>
<p><strong>相对生存率</strong>的估计方法有<em>队列法</em>（cohort method）、<em>完全法</em>（complete method）、<em>现时生存分析法</em>（period survival analysis）、<em>混合法</em>（hybrid method）和<em>预测法</em>（projection method），不同的生存率估计方法纳入的确诊病例和随访时间有所不同，具体不同可以见下图<span class="citation" data-cites="张华2014">(2)</span>。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2023-04-09-relativesurvival/followup.jpg" class="img-fluid" width="756"></p>
</div>
</div>
<p>以上不同的方法具有不同的优缺点，传统的队列法和完全法由于纳入的病例中均包含了感兴趣时期之前确诊的病例，因此不能反映最新最及时的生存情况。</p>
</section>
<section id="现时生存分析" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="现时生存分析"><span class="header-section-number">2.2</span> 现时生存分析</h3>
<p>现时生存分析由德国流行病学家 Hermann Brenner于1996年首先提出，至2002年逐渐发展成熟<span class="citation" data-cites="brenner2002 brenner2004 holleczek2013b 李卓颖2021">(1,3–5)</span>。</p>
<p>现时生存分析（period survival analysis）纳入的研究对象分为两部分，一部分是感兴趣时期新确诊的所有病例，另一部分是感兴趣时期之前确诊而且在感兴趣时期仍然存活的病例。本研究的感兴趣时期设定为<em>2017-2019年</em>，那研究对象就需要纳入2017-2019年期间所有新确诊癌症病例以及2017-2019年之前确诊并在2017-2019年期间仍存活的癌症病例<span class="citation" data-cites="jansen2013">(6)</span>。</p>
<p>现时生存分析在感兴趣时期纳入了新确诊癌症病例数据和随访数据，因此该方法更接近真实生存率。</p>
</section>
<section id="现时生存分析的估计精度" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="现时生存分析的估计精度"><span class="header-section-number">2.3</span> 现时生存分析的估计精度</h3>
<p>由于现时生存分析方法纳入的病例数相对于<em>完全法</em>来说要少，因此，该方法估计生存率的精确度和稳健度比其他方法偏低，估计生存率的方差也偏大一些，因此，我们在利用该方法估计生存率的时候应注意把握估计精确度和时效性之间的平衡。</p>
<p>但是对于省级人群肿瘤登记数据来说，数据样本量较大，生存率估计的精度能够得到保证，因此，评估的时效性成为优先考虑的问题，现时生存分析成为评估人群癌症生存率的优先选项<span class="citation" data-cites="张华2014 张华2016">(2,7)</span>。</p>
</section>
</section>
<section id="统计软件包的安装" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="统计软件包的安装"><span class="header-section-number">3</span> 统计软件包的安装</h2>
<p>本篇博文介绍利用现时法统计模型估计癌症5年生存率，这种方法能够提高生存率估计的时效性。我们将使用Brenner等编写的R包”periodR”进行相对生存率的估计，你可以<a href="https://krebsregister.saarland.de/daten-auswertungen-veroeffentlichungen/software/periodr-english/">在这里下载R包</a>，并安装使用<span class="citation" data-cites="holleczek2009 holleczek2013b">(5,8)</span>。</p>
<p>点开链接之后，可以根据自己使用的操作系统和R语言版本选择相应的安装包。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2023-04-09-relativesurvival/periodR.jpg" class="img-fluid" width="692"></p>
</div>
</div>
<p>下载之后，我们可以看到一个名为<strong>periodR_1.0-6.tar.gz</strong>的压缩包，使用下面的R语言安装所下载的R包。</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">'periodR_1.0-6.tar.gz'</span>, <span class="at" style="color: #657422;">repos=</span><span class="cn" style="color: #8f5902;">NULL</span>, <span class="at" style="color: #657422;">type=</span><span class="st" style="color: #20794D;">'source'</span>)</span></code></pre></div>
</section>
<section id="数据准备" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="数据准备"><span class="header-section-number">4</span> 数据准备</h2>
<section id="数据来源" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="数据来源"><span class="header-section-number">4.1</span> 数据来源</h3>
<p>本篇博文拟分析河南省肿瘤登记处覆盖地区的癌症患者5年相对生存率，数据来源分为两部分，第一部分为肿瘤登记地区癌症患者生存信息用于计算观察生存率，另一部分来源于各肿瘤登记处上报的<strong>寿命表数据</strong>用于计算一般人群的期望生存率。</p>
</section>
<section id="肿瘤登记处的筛选" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="肿瘤登记处的筛选"><span class="header-section-number">4.2</span> 肿瘤登记处的筛选</h3>
<p>我们要使用河南省肿瘤登记数据估计河南省癌症5年相对生存率，首先要做的是选择使用哪些登记处的数据进行生存分析，河南省肿瘤登记已经覆盖全省人口的90%以上，但是数据质量差异很大。</p>
<p>为了使生存分析的结果能够真实反映河南省癌症人群的真实生存情况，我们选择纳入分析的登记处必须满足下面的条件，即其2014年肿瘤登记数据被纳入《河南省肿瘤登记年报》，这样纳入的癌症病例能够基本反映登记地区的癌症病人总体的发病、死亡及生存情况。</p>
<p>提前加载数据分析相关的R包</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;">library</span>(haven)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;">library</span>(Hmisc)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;">library</span>(canregtools)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;">library</span>(lubridate)</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;">library</span>(periodR)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;">library</span>(flextable)</span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;">library</span>(kableExtra)</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;">library</span>(gtsummary)</span></code></pre></div>
<p>筛选入选河南省肿瘤登记年报的登记处数据。</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 从code字典里筛选出2014年年报纳入的登记处</span></span>
<span id="cb3-2">registrys <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">mdb.get</span>(<span class="st" style="color: #20794D;">"code.mdb"</span>,<span class="at" style="color: #657422;">tables =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"registry"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">filter</span>(report2014<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">select</span>(areacode,city,county)</span>
<span id="cb3-5">areacodes <span class="ot" style="color: #003B4F;">&lt;-</span> registrys<span class="sc" style="color: #5E5E5E;">$</span>areacode</span>
<span id="cb3-6"></span>
<span id="cb3-7">registrys<span class="sc" style="color: #5E5E5E;">$</span>areacode <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.character</span>(registrys<span class="sc" style="color: #5E5E5E;">$</span>areacode)</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 读取肿瘤登记数据</span></span>
<span id="cb3-10">canreg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_sas</span>(<span class="st" style="color: #20794D;">"tumorinfo.sas7bdat.zip"</span>)</span>
<span id="cb3-11">canreg <span class="ot" style="color: #003B4F;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-12">  <span class="co" style="color: #5E5E5E;">#把入选2014年年报的登记处筛选出来</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;">filter</span>(areacode <span class="sc" style="color: #5E5E5E;">%in%</span> areacodes)</span></code></pre></div>
</details>
</div>
</section>
<section id="按照现时生存分析筛选病例" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="按照现时生存分析筛选病例"><span class="header-section-number">4.3</span> 按照现时生存分析筛选病例</h3>
<p>考虑到我们设定的”感兴趣时期”为2017-2019年，按照<strong>现时生存分析</strong>方法纳入病例的原则，我们需要纳入2017-2019年期间新诊断的所有癌症患者以及在这个时期之前诊断且在2017-2019年期间内仍存活的癌症病例<span class="citation" data-cites="ellison2006">(9)</span>。</p>
<p>按照上面的筛选标准，继续对上一步输出的数据进行范围筛查。</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1">canreg <span class="ot" style="color: #003B4F;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">dy =</span> <span class="fu" style="color: #4758AB;">year</span>(inciden),</span>
<span id="cb4-4">    <span class="at" style="color: #657422;">dm =</span> <span class="fu" style="color: #4758AB;">month</span>(inciden),</span>
<span id="cb4-5">    <span class="at" style="color: #657422;">dyear =</span> <span class="fu" style="color: #4758AB;">year</span>(deathda)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;">filter</span>((dy<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">2014</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> dy<span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">2019</span>)<span class="sc" style="color: #5E5E5E;">|</span>(dy<span class="sc" style="color: #5E5E5E;">&lt;</span><span class="dv" style="color: #AD0000;">2014</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> (<span class="fu" style="color: #4758AB;">is.na</span>(dyear)<span class="sc" style="color: #5E5E5E;">|</span>dyear<span class="sc" style="color: #5E5E5E;">&gt;</span><span class="dv" style="color: #AD0000;">2019</span>)),dy<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">2010</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="限制生存分析的癌种范围" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="限制生存分析的癌种范围"><span class="header-section-number">4.4</span> 限制生存分析的癌种范围</h3>
<p>我们选择分析的癌种范围与《国家肿瘤登记年报》报告的癌种范围一致，即所有恶性肿瘤和中枢神经系统良性肿瘤。</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 把数据限制在上报C00-C98,D32-33,D42-43,D45-47范围之内</span></span>
<span id="cb5-2">analysis <span class="ot" style="color: #003B4F;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">autoicd10=</span><span class="fu" style="color: #4758AB;">toupper</span>(autoicd10),</span>
<span id="cb5-4">         <span class="at" style="color: #657422;">type=</span><span class="fu" style="color: #4758AB;">substr</span>(autoicd10,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">icd_number =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"[^0-9</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">.]"</span>, <span class="st" style="color: #20794D;">""</span>, autoicd10))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;">filter</span>((type<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"C"</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="fu" style="color: #4758AB;">between</span>(icd_number,<span class="dv" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">98.9</span>))<span class="sc" style="color: #5E5E5E;">|</span></span>
<span id="cb5-7">        (type<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"D"</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="fu" style="color: #4758AB;">between</span>(icd_number,<span class="dv" style="color: #AD0000;">32</span>,<span class="fl" style="color: #AD0000;">33.9</span>))<span class="sc" style="color: #5E5E5E;">|</span></span>
<span id="cb5-8">        (type<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"D"</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="fu" style="color: #4758AB;">between</span>(icd_number,<span class="dv" style="color: #AD0000;">42</span>,<span class="fl" style="color: #AD0000;">43.9</span>))<span class="sc" style="color: #5E5E5E;">|</span></span>
<span id="cb5-9">        (type<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"D"</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="fu" style="color: #4758AB;">between</span>(icd_number,<span class="dv" style="color: #AD0000;">45</span>,<span class="fl" style="color: #AD0000;">47.9</span>))) </span></code></pre></div>
</details>
</div>
</section>
<section id="对删失数据进行处理" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="对删失数据进行处理"><span class="header-section-number">4.5</span> 对删失数据进行处理</h3>
<p>本研究的随访截止日期设定为2019年12月31日，我们按照这个截止日期进行结尾数据的手工处理。</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1">analysis <span class="ot" style="color: #003B4F;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">diagage =</span> <span class="fu" style="color: #4758AB;">trunc</span>((birthda <span class="sc" style="color: #5E5E5E;">%--%</span> inciden) <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">years</span>(<span class="dv" style="color: #AD0000;">1</span>)),</span>
<span id="cb6-3">         <span class="at" style="color: #657422;">icdd=</span> <span class="fu" style="color: #4758AB;">classify_icd10</span>(autoicd10),</span>
<span id="cb6-4">         <span class="at" style="color: #657422;">follow =</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb6-5">           <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">2019</span> <span class="sc" style="color: #5E5E5E;">~</span> deathda,</span>
<span id="cb6-6">           <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="dv" style="color: #AD0000;">2019</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">ymd</span>(<span class="st" style="color: #20794D;">"2019-12-31"</span>),</span>
<span id="cb6-7">           <span class="fu" style="color: #4758AB;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">ymd</span>(<span class="st" style="color: #20794D;">"2019-12-31"</span>)),</span>
<span id="cb6-8">         <span class="at" style="color: #657422;">vitstat =</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb6-9">           <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">2019</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb6-10">           <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="dv" style="color: #AD0000;">2019</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb6-11">           <span class="fu" style="color: #4758AB;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;">~</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb6-12">         <span class="at" style="color: #657422;">fm =</span> <span class="fu" style="color: #4758AB;">month</span>(follow),</span>
<span id="cb6-13">         <span class="at" style="color: #657422;">fy =</span> <span class="fu" style="color: #4758AB;">year</span>(follow))</span></code></pre></div>
</details>
</div>
</section>
<section id="对待分析的分组变量进行处理" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="对待分析的分组变量进行处理"><span class="header-section-number">4.6</span> 对待分析的分组变量进行处理</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1">analysis <span class="ot" style="color: #003B4F;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb7-3">         <span class="at" style="color: #657422;">area_type =</span><span class="fu" style="color: #4758AB;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"410302"</span>,<span class="st" style="color: #20794D;">"410303"</span>,<span class="st" style="color: #20794D;">"410304"</span>,<span class="st" style="color: #20794D;">"410305"</span>,</span>
<span id="cb7-4">                                           <span class="st" style="color: #20794D;">"410602"</span>,<span class="st" style="color: #20794D;">"410603"</span>,<span class="st" style="color: #20794D;">"410611"</span>,</span>
<span id="cb7-5">                                           <span class="st" style="color: #20794D;">"411102"</span>,<span class="st" style="color: #20794D;">"411103"</span>,<span class="st" style="color: #20794D;">"411104"</span>,</span>
<span id="cb7-6">                                           <span class="st" style="color: #20794D;">"411202"</span>,<span class="st" style="color: #20794D;">"411303"</span>),<span class="st" style="color: #20794D;">"Urban"</span>,<span class="st" style="color: #20794D;">"Rural"</span>),</span>
<span id="cb7-7">         <span class="at" style="color: #657422;">agegrp =</span> <span class="fu" style="color: #4758AB;">cut</span>(diagage, </span>
<span id="cb7-8">                      <span class="at" style="color: #657422;">breaks =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">15</span>, <span class="dv" style="color: #AD0000;">40</span>, <span class="dv" style="color: #AD0000;">65</span>, <span class="dv" style="color: #AD0000;">85</span>, <span class="cn" style="color: #8f5902;">Inf</span>),</span>
<span id="cb7-9">                      <span class="at" style="color: #657422;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"0-14 岁"</span>,<span class="st" style="color: #20794D;">"15-39 岁"</span>,</span>
<span id="cb7-10">                                 <span class="st" style="color: #20794D;">"40-64 岁"</span>,<span class="st" style="color: #20794D;">"65-84 岁"</span>,</span>
<span id="cb7-11">                                 <span class="st" style="color: #20794D;">"&gt;84 岁"</span>),</span>
<span id="cb7-12">                      <span class="at" style="color: #657422;">right =</span> <span class="cn" style="color: #8f5902;">FALSE</span>),</span>
<span id="cb7-13">         <span class="at" style="color: #657422;">agegrp2 =</span> <span class="fu" style="color: #4758AB;">findInterval</span>(diagage,<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">15</span>,<span class="dv" style="color: #AD0000;">40</span>,<span class="dv" style="color: #AD0000;">65</span>,<span class="dv" style="color: #AD0000;">85</span>)),</span>
<span id="cb7-14">         <span class="at" style="color: #657422;">period =</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb7-15">           dy <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">2010</span>,<span class="dv" style="color: #AD0000;">2011</span>,<span class="dv" style="color: #AD0000;">2012</span>,<span class="dv" style="color: #AD0000;">2013</span>)<span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"2010-2013"</span>,</span>
<span id="cb7-16">           dy <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">2014</span>,<span class="dv" style="color: #AD0000;">2015</span>,<span class="dv" style="color: #AD0000;">2016</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"2014-2016"</span>,</span>
<span id="cb7-17">           dy <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">2017</span>,<span class="dv" style="color: #AD0000;">2018</span>,<span class="dv" style="color: #AD0000;">2019</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"2017-2019"</span>)</span>
<span id="cb7-18">         ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-19">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span>(sex<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"1"</span><span class="sc" style="color: #5E5E5E;">&amp;</span>icdd<span class="sc" style="color: #5E5E5E;">%in%</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"子宫体"</span>,<span class="st" style="color: #20794D;">"子宫颈"</span>,<span class="st" style="color: #20794D;">"乳房"</span>,<span class="st" style="color: #20794D;">"卵巢"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-20">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span>(sex<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"2"</span><span class="sc" style="color: #5E5E5E;">&amp;</span>icdd<span class="sc" style="color: #5E5E5E;">%in%</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"前列腺"</span>,<span class="st" style="color: #20794D;">"睾丸"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-21">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">areacode2 =</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb7-22">    areacode <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"410302"</span>,<span class="st" style="color: #20794D;">"410303"</span>,<span class="st" style="color: #20794D;">"410304"</span>,<span class="st" style="color: #20794D;">"410305"</span>)<span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"410300"</span>,</span>
<span id="cb7-23">    areacode <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"410602"</span>,<span class="st" style="color: #20794D;">"410603"</span>,<span class="st" style="color: #20794D;">"410611"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"410600"</span>,</span>
<span id="cb7-24">    areacode <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"411102"</span>,<span class="st" style="color: #20794D;">"411103"</span>,<span class="st" style="color: #20794D;">"411104"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"411100"</span>,</span>
<span id="cb7-25">    <span class="at" style="color: #657422;">.default =</span> areacode )) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-26">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">basi2=</span><span class="fu" style="color: #4758AB;">ifelse</span>(inciden<span class="sc" style="color: #5E5E5E;">==</span>deathda<span class="sc" style="color: #5E5E5E;">&amp;!</span><span class="fu" style="color: #4758AB;">is.na</span>(deathda),<span class="dv" style="color: #AD0000;">0</span>,basi)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-27">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">state=</span><span class="fu" style="color: #4758AB;">ifelse</span>(areacode2<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"410300"</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> state<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"9"</span>, <span class="st" style="color: #20794D;">"1"</span>, state))</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="质量控制" class="level2 page-columns page-full" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="质量控制"><span class="header-section-number">5</span> 质量控制</h2>
<p>在进行5年相对生存率的计算之前，我们需要先评估一下各个登记处的随访的质量情况，包括DCO数据的比例、失访的情况、最终纳入分析数据的病理诊断比例等来对数据质量进行评估。</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1">submit <span class="ot" style="color: #003B4F;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count</span>(areacode2)</span>
<span id="cb8-2">dco <span class="ot" style="color: #003B4F;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">filter</span>(basi2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;">count</span>(areacode2)</span>
<span id="cb8-5"></span>
<span id="cb8-6">status <span class="ot" style="color: #003B4F;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span>basi2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">0</span>,<span class="sc" style="color: #5E5E5E;">!</span>(state <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"1"</span>,<span class="st" style="color: #20794D;">"2"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;">count</span>(areacode2) </span>
<span id="cb8-9"></span>
<span id="cb8-10">final <span class="ot" style="color: #003B4F;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span>basi2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-12">  <span class="fu" style="color: #4758AB;">filter</span>((state <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"1"</span>,<span class="st" style="color: #20794D;">"2"</span>)))</span>
<span id="cb8-13"></span>
<span id="cb8-14">selected <span class="ot" style="color: #003B4F;">&lt;-</span> final <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count</span>(areacode2)</span>
<span id="cb8-15"></span>
<span id="cb8-16">mv <span class="ot" style="color: #003B4F;">&lt;-</span> final <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(basi <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"5"</span>,<span class="st" style="color: #20794D;">"6"</span>,<span class="st" style="color: #20794D;">"7"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count</span>(areacode2)</span>
<span id="cb8-17">mp <span class="ot" style="color: #003B4F;">&lt;-</span> final <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(reco <span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"3"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count</span>(areacode2)</span>
<span id="cb8-18">result <span class="ot" style="color: #003B4F;">&lt;-</span> submit <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-19">  <span class="fu" style="color: #4758AB;">left_join</span>(dco,<span class="at" style="color: #657422;">by=</span><span class="st" style="color: #20794D;">"areacode2"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-20">  <span class="fu" style="color: #4758AB;">left_join</span>(status,<span class="at" style="color: #657422;">by=</span><span class="st" style="color: #20794D;">"areacode2"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-21">  <span class="fu" style="color: #4758AB;">left_join</span>(selected,<span class="at" style="color: #657422;">by=</span><span class="st" style="color: #20794D;">"areacode2"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-22">  <span class="fu" style="color: #4758AB;">left_join</span>(mv,<span class="at" style="color: #657422;">by=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"areacode2"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-23">  <span class="fu" style="color: #4758AB;">left_join</span>(mp,<span class="at" style="color: #657422;">by=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"areacode2"</span>)) </span>
<span id="cb8-24"><span class="fu" style="color: #4758AB;">colnames</span>(result) <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>( <span class="st" style="color: #20794D;">"areacode"</span>,<span class="st" style="color: #20794D;">"submit"</span>,<span class="st" style="color: #20794D;">"dco"</span>,<span class="st" style="color: #20794D;">"missfol"</span>,<span class="st" style="color: #20794D;">"analysis"</span>,<span class="st" style="color: #20794D;">"mv"</span>,<span class="st" style="color: #20794D;">"mp"</span>)</span>
<span id="cb8-25"></span>
<span id="cb8-26">result <span class="ot" style="color: #003B4F;">&lt;-</span> result <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-27">  <span class="fu" style="color: #4758AB;">replace_na</span>(<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">missfol=</span><span class="dv" style="color: #AD0000;">0</span>,<span class="at" style="color: #657422;">mp=</span><span class="dv" style="color: #AD0000;">0</span>))</span>
<span id="cb8-28">result1 <span class="ot" style="color: #003B4F;">&lt;-</span> result <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-29">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="fu" style="color: #4758AB;">c</span>(submit,dco,missfol,analysis,mv,mp),sum)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-30">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">areacode=</span><span class="st" style="color: #20794D;">"合计"</span>)</span>
<span id="cb8-31"></span>
<span id="cb8-32">result <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">rbind</span>(result,result1) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-33">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">dco_p=</span><span class="fu" style="color: #4758AB;">round</span>(dco<span class="sc" style="color: #5E5E5E;">/</span>submit<span class="sc" style="color: #5E5E5E;">*</span><span class="dv" style="color: #AD0000;">100</span>,<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb8-34">         <span class="at" style="color: #657422;">missfol_p=</span><span class="fu" style="color: #4758AB;">round</span>(missfol<span class="sc" style="color: #5E5E5E;">/</span>submit<span class="sc" style="color: #5E5E5E;">*</span><span class="dv" style="color: #AD0000;">100</span>,<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb8-35">         <span class="at" style="color: #657422;">mv_p=</span><span class="fu" style="color: #4758AB;">round</span>(mv<span class="sc" style="color: #5E5E5E;">/</span>analysis<span class="sc" style="color: #5E5E5E;">*</span><span class="dv" style="color: #AD0000;">100</span>,<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb8-36">         <span class="at" style="color: #657422;">mp_p=</span><span class="fu" style="color: #4758AB;">round</span>(mp<span class="sc" style="color: #5E5E5E;">/</span>analysis<span class="sc" style="color: #5E5E5E;">*</span><span class="dv" style="color: #AD0000;">100</span>,<span class="dv" style="color: #AD0000;">1</span>))</span>
<span id="cb8-37">urban <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"410300"</span>,<span class="st" style="color: #20794D;">"410600"</span>,<span class="st" style="color: #20794D;">"411100"</span>,<span class="st" style="color: #20794D;">"411202"</span>,<span class="st" style="color: #20794D;">"411303"</span>)</span></code></pre></div>
</details>
</div>
<p>把上面计算的结果绘制成可以展现的表格，从下面 表&nbsp;1 中可以看出入选登记处的数据质量情况，包括DCO、失访情况、以及最终纳入分析的病例数、多原发比例、以病理诊断比例等。</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1">t1 <span class="ot" style="color: #003B4F;">&lt;-</span> result <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">a=</span><span class="fu" style="color: #4758AB;">paste0</span>(dco,<span class="st" style="color: #20794D;">"("</span>,dco_p,<span class="st" style="color: #20794D;">"%)"</span>),</span>
<span id="cb9-3">         <span class="at" style="color: #657422;">b=</span><span class="fu" style="color: #4758AB;">paste0</span>(missfol,<span class="st" style="color: #20794D;">"("</span>,missfol_p,<span class="st" style="color: #20794D;">"%)"</span>),</span>
<span id="cb9-4">         <span class="at" style="color: #657422;">c=</span><span class="fu" style="color: #4758AB;">paste0</span>(mp,<span class="st" style="color: #20794D;">"("</span>,mp_p,<span class="st" style="color: #20794D;">"%)"</span>),</span>
<span id="cb9-5">         <span class="at" style="color: #657422;">d=</span><span class="fu" style="color: #4758AB;">paste0</span>(mv,<span class="st" style="color: #20794D;">"("</span>,mv_p,<span class="st" style="color: #20794D;">"%)"</span>),</span>
<span id="cb9-6">         <span class="at" style="color: #657422;">type=</span><span class="fu" style="color: #4758AB;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;">%in%</span> urban,<span class="st" style="color: #20794D;">"城市"</span>,<span class="st" style="color: #20794D;">"农村"</span>),</span>
<span id="cb9-7">         <span class="at" style="color: #657422;">type=</span><span class="fu" style="color: #4758AB;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"合计"</span>,<span class="st" style="color: #20794D;">"--"</span>,type)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;">left_join</span>(registrys,<span class="at" style="color: #657422;">by=</span><span class="st" style="color: #20794D;">"areacode"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">county=</span><span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb9-10">    areacode<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"410300"</span><span class="sc" style="color: #5E5E5E;">~</span><span class="st" style="color: #20794D;">"洛阳市"</span>,</span>
<span id="cb9-11">    areacode<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"410600"</span><span class="sc" style="color: #5E5E5E;">~</span><span class="st" style="color: #20794D;">"鹤壁市"</span>,</span>
<span id="cb9-12">    areacode<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"411100"</span><span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"漯河市"</span>,</span>
<span id="cb9-13">    areacode<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"合计"</span><span class="sc" style="color: #5E5E5E;">~</span><span class="st" style="color: #20794D;">"合计"</span>,</span>
<span id="cb9-14">    <span class="at" style="color: #657422;">.default =</span> county</span>
<span id="cb9-15">  )) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;">select</span>(county,type,submit,a,b,analysis,c,d) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-17">  <span class="fu" style="color: #4758AB;">kbl</span>(<span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"登记处"</span>,<span class="st" style="color: #20794D;">"类型"</span>,<span class="st" style="color: #20794D;">"病例数"</span>,<span class="st" style="color: #20794D;">"DCO,n(%)"</span>,<span class="st" style="color: #20794D;">"失访,n(%)"</span>,</span>
<span id="cb9-18">                    <span class="st" style="color: #20794D;">"病例数"</span>,<span class="st" style="color: #20794D;">"多原发,n(%)"</span>,<span class="st" style="color: #20794D;">"病理诊断,n(%)"</span>),</span>
<span id="cb9-19">      <span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"c"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-20">  <span class="fu" style="color: #4758AB;">kable_styling</span>(<span class="at" style="color: #657422;">font_size =</span> <span class="dv" style="color: #AD0000;">7</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-21">  <span class="fu" style="color: #4758AB;">kable_classic</span>(<span class="at" style="color: #657422;">full_width =</span> T, <span class="at" style="color: #657422;">html_font =</span> <span class="st" style="color: #20794D;">"Cambria"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-22">  <span class="fu" style="color: #4758AB;">add_header_above</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">" "</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">3</span>, <span class="st" style="color: #20794D;">"剔除"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">"纳入分析"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">3</span>),</span>
<span id="cb9-23">                   <span class="at" style="color: #657422;">bold =</span> T,<span class="at" style="color: #657422;">border_left =</span> T) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-24">  <span class="fu" style="color: #4758AB;">row_spec</span>(<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="at" style="color: #657422;">bold=</span>T,<span class="at" style="color: #657422;">italic=</span>T) </span></code></pre></div>
</details>
</div>
<div class="cell page-columns page-full">
<div class="cell-output-display column-page">
<div id="tbl-t1" class="anchored">
<table class="table lightable-classic table-sm table-striped" data-quarto-postprocess="true">
<caption>表&nbsp;1: 纳入分析肿瘤登记处随访质量情况</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; empty-cells: hide;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
剔除
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
纳入分析
</div></th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">登记处</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">类型</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">病例数</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">DCO,n(%)</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">失访,n(%)</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">病例数</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">多原发,n(%)</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">病理诊断,n(%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">洛阳市</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">23750</td>
<td style="text-align: center;">1079(4.5%)</td>
<td style="text-align: center;">1993(8.4%)</td>
<td style="text-align: center;">20678</td>
<td style="text-align: center;">182(0.9%)</td>
<td style="text-align: center;">15901(76.9%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">孟津县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">9688</td>
<td style="text-align: center;">337(3.5%)</td>
<td style="text-align: center;">311(3.2%)</td>
<td style="text-align: center;">9040</td>
<td style="text-align: center;">23(0.3%)</td>
<td style="text-align: center;">6168(68.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">新安县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">8815</td>
<td style="text-align: center;">170(1.9%)</td>
<td style="text-align: center;">67(0.8%)</td>
<td style="text-align: center;">8578</td>
<td style="text-align: center;">15(0.2%)</td>
<td style="text-align: center;">5587(65.1%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">栾川县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">5766</td>
<td style="text-align: center;">206(3.6%)</td>
<td style="text-align: center;">257(4.5%)</td>
<td style="text-align: center;">5303</td>
<td style="text-align: center;">8(0.2%)</td>
<td style="text-align: center;">3969(74.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">嵩县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">10091</td>
<td style="text-align: center;">219(2.2%)</td>
<td style="text-align: center;">56(0.6%)</td>
<td style="text-align: center;">9816</td>
<td style="text-align: center;">7(0.1%)</td>
<td style="text-align: center;">7092(72.2%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">汝阳县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">7771</td>
<td style="text-align: center;">275(3.5%)</td>
<td style="text-align: center;">6(0.1%)</td>
<td style="text-align: center;">7490</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">5786(77.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">宜阳县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">11723</td>
<td style="text-align: center;">206(1.8%)</td>
<td style="text-align: center;">115(1%)</td>
<td style="text-align: center;">11402</td>
<td style="text-align: center;">19(0.2%)</td>
<td style="text-align: center;">8147(71.5%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">偃师市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">11615</td>
<td style="text-align: center;">211(1.8%)</td>
<td style="text-align: center;">157(1.4%)</td>
<td style="text-align: center;">11247</td>
<td style="text-align: center;">213(1.9%)</td>
<td style="text-align: center;">8350(74.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">鲁山县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">16226</td>
<td style="text-align: center;">439(2.7%)</td>
<td style="text-align: center;">17(0.1%)</td>
<td style="text-align: center;">15770</td>
<td style="text-align: center;">212(1.3%)</td>
<td style="text-align: center;">12528(79.4%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">林州市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">25727</td>
<td style="text-align: center;">259(1%)</td>
<td style="text-align: center;">1(0%)</td>
<td style="text-align: center;">25467</td>
<td style="text-align: center;">475(1.9%)</td>
<td style="text-align: center;">20861(81.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">鹤壁市</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">11707</td>
<td style="text-align: center;">251(2.1%)</td>
<td style="text-align: center;">267(2.3%)</td>
<td style="text-align: center;">11189</td>
<td style="text-align: center;">119(1.1%)</td>
<td style="text-align: center;">7706(68.9%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">辉县市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">16596</td>
<td style="text-align: center;">90(0.5%)</td>
<td style="text-align: center;">792(4.8%)</td>
<td style="text-align: center;">15714</td>
<td style="text-align: center;">24(0.2%)</td>
<td style="text-align: center;">11220(71.4%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">禹州市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">18484</td>
<td style="text-align: center;">654(3.5%)</td>
<td style="text-align: center;">23(0.1%)</td>
<td style="text-align: center;">17807</td>
<td style="text-align: center;">18(0.1%)</td>
<td style="text-align: center;">13155(73.9%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">漯河市</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">23074</td>
<td style="text-align: center;">905(3.9%)</td>
<td style="text-align: center;">558(2.4%)</td>
<td style="text-align: center;">21611</td>
<td style="text-align: center;">46(0.2%)</td>
<td style="text-align: center;">15431(71.4%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">三门峡市湖滨区</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">5945</td>
<td style="text-align: center;">73(1.2%)</td>
<td style="text-align: center;">224(3.8%)</td>
<td style="text-align: center;">5648</td>
<td style="text-align: center;">5(0.1%)</td>
<td style="text-align: center;">4498(79.6%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">南阳市卧龙区</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">15196</td>
<td style="text-align: center;">1575(10.4%)</td>
<td style="text-align: center;">66(0.4%)</td>
<td style="text-align: center;">13555</td>
<td style="text-align: center;">66(0.5%)</td>
<td style="text-align: center;">9895(73%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">方城县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">16024</td>
<td style="text-align: center;">423(2.6%)</td>
<td style="text-align: center;">70(0.4%)</td>
<td style="text-align: center;">15531</td>
<td style="text-align: center;">41(0.3%)</td>
<td style="text-align: center;">11534(74.3%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">内乡县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">12722</td>
<td style="text-align: center;">155(1.2%)</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">12567</td>
<td style="text-align: center;">84(0.7%)</td>
<td style="text-align: center;">9372(74.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">睢县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">14534</td>
<td style="text-align: center;">98(0.7%)</td>
<td style="text-align: center;">510(3.5%)</td>
<td style="text-align: center;">13926</td>
<td style="text-align: center;">22(0.2%)</td>
<td style="text-align: center;">9818(70.5%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">虞城县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">15607</td>
<td style="text-align: center;">106(0.7%)</td>
<td style="text-align: center;">3(0%)</td>
<td style="text-align: center;">15498</td>
<td style="text-align: center;">42(0.3%)</td>
<td style="text-align: center;">11036(71.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">罗山县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">13046</td>
<td style="text-align: center;">161(1.2%)</td>
<td style="text-align: center;">5(0%)</td>
<td style="text-align: center;">12880</td>
<td style="text-align: center;">191(1.5%)</td>
<td style="text-align: center;">8716(67.7%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">沈丘县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">22220</td>
<td style="text-align: center;">628(2.8%)</td>
<td style="text-align: center;">139(0.6%)</td>
<td style="text-align: center;">21453</td>
<td style="text-align: center;">12(0.1%)</td>
<td style="text-align: center;">14877(69.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">郸城县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">23826</td>
<td style="text-align: center;">597(2.5%)</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">23229</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">16073(69.2%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">西平县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">14952</td>
<td style="text-align: center;">361(2.4%)</td>
<td style="text-align: center;">134(0.9%)</td>
<td style="text-align: center;">14457</td>
<td style="text-align: center;">41(0.3%)</td>
<td style="text-align: center;">10808(74.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">济源市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">13396</td>
<td style="text-align: center;">423(3.2%)</td>
<td style="text-align: center;">593(4.4%)</td>
<td style="text-align: center;">12380</td>
<td style="text-align: center;">13(0.1%)</td>
<td style="text-align: center;">8716(70.4%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">合计</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">368501</td>
<td style="text-align: center;">9901(2.7%)</td>
<td style="text-align: center;">6364(1.7%)</td>
<td style="text-align: center;">352236</td>
<td style="text-align: center;">1878(0.5%)</td>
<td style="text-align: center;">257244(73%)</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="计算一般人群期望生存概率" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="计算一般人群期望生存概率"><span class="header-section-number">6</span> 计算一般人群期望生存概率</h2>
<p>普通人群期望生存概率是计算癌症相对生存率的基础，我们可以通过肿瘤登记处上报的分性别、年龄组的全因死亡数来计算简略寿命表，然后通过一些方法把简略寿命表扩展为完全寿命表。</p>
<p>下面我们介绍如何使用stata软件计算简略寿命表，并把简略寿命表扩充为完全寿命表的过程。（图&nbsp;1）</p>
<div class="cell" data-eval="true" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-lifetable" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>

<pre class="mermaid mermaid-js" data-label="fig-lifetable">flowchart TD
 A[(全死因数据)] --&gt; B[分性别年龄组全因死亡数]
 B --&gt; C[编制简略寿命表]
 C --&gt; D[寿命表的质量控制]
 D --&gt; E[平滑方法]
 E --&gt; F[完全寿命表]
</pre>
</div>
<p></p><figcaption class="figure-caption">图&nbsp;1: 简略寿命表扩充完全寿命表</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="统计整理全死因数据" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="统计整理全死因数据"><span class="header-section-number">6.1</span> 统计整理全死因数据</h3>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1">lifetable <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_sas</span>(<span class="st" style="color: #20794D;">"population.sas7bdat.zip"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="co" style="color: #5E5E5E;"># mutate(areacode = substr(addcode,1,6)) %&gt;% </span></span>
<span id="cb10-4">  <span class="co" style="color: #5E5E5E;"># filter(areacode =="410302",type==4,year==2013)</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">areacode =</span> <span class="fu" style="color: #4758AB;">substr</span>(addcode,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">6</span>),</span>
<span id="cb10-6">         <span class="at" style="color: #657422;">area_type =</span></span>
<span id="cb10-7">          <span class="fu" style="color: #4758AB;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"410302"</span>,<span class="st" style="color: #20794D;">"410303"</span>,<span class="st" style="color: #20794D;">"410304"</span>,<span class="st" style="color: #20794D;">"410305"</span>,</span>
<span id="cb10-8">                                  <span class="st" style="color: #20794D;">"410602"</span>,<span class="st" style="color: #20794D;">"410603"</span>,<span class="st" style="color: #20794D;">"410611"</span>,</span>
<span id="cb10-9">                                 <span class="st" style="color: #20794D;">"411102"</span>,<span class="st" style="color: #20794D;">"411103"</span>,<span class="st" style="color: #20794D;">"411104"</span>,</span>
<span id="cb10-10">                                  <span class="st" style="color: #20794D;">"411202"</span>,<span class="st" style="color: #20794D;">"411303"</span>),<span class="st" style="color: #20794D;">"Urban"</span>,<span class="st" style="color: #20794D;">"Rural"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;">filter</span>(areacode <span class="sc" style="color: #5E5E5E;">%in%</span> areacodes, year <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">2014</span>,year <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">2020</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span>(areacode <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"410602"</span>,<span class="st" style="color: #20794D;">"410603"</span>,<span class="st" style="color: #20794D;">"410611"</span>,<span class="st" style="color: #20794D;">"410303"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;">select</span>(areacode,area_type,year,sex,type,p0<span class="sc" style="color: #5E5E5E;">:</span>p85) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="at" style="color: #657422;">cols =</span> p0<span class="sc" style="color: #5E5E5E;">:</span>p85, <span class="at" style="color: #657422;">names_to =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"agegrp"</span>), <span class="at" style="color: #657422;">values_to =</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"count"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">type=</span><span class="fu" style="color: #4758AB;">ifelse</span>(type<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>,<span class="st" style="color: #20794D;">"pop"</span>,<span class="st" style="color: #20794D;">"death"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-16">  <span class="fu" style="color: #4758AB;">pivot_wider</span>(<span class="at" style="color: #657422;">names_from =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"type"</span>), <span class="at" style="color: #657422;">values_from =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"count"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">agegrp =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"[^0-9</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">.]"</span>, <span class="st" style="color: #20794D;">""</span>, agegrp)),</span>
<span id="cb10-18">         <span class="at" style="color: #657422;">sex=</span><span class="fu" style="color: #4758AB;">as.numeric</span>(sex))  </span></code></pre></div>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 按照地区分类计算各年龄生存概率</span></span>
<span id="cb11-2">area_type <span class="ot" style="color: #003B4F;">&lt;-</span> lifetable <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(death),<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(pop)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;">group_by</span>(area_type,sex, year, agegrp) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">deaths=</span><span class="fu" style="color: #4758AB;">sum</span>(death),</span>
<span id="cb11-6">         <span class="at" style="color: #657422;">pop =</span> <span class="fu" style="color: #4758AB;">sum</span>(pop),</span>
<span id="cb11-7">         <span class="at" style="color: #657422;">rate =</span> deaths<span class="sc" style="color: #5E5E5E;">/</span>pop<span class="sc" style="color: #5E5E5E;">*</span><span class="dv" style="color: #AD0000;">1000</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;">distinct</span>(area_type,sex,year,agegrp,pop,deaths,rate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">agegroup2=</span>agegrp,</span>
<span id="cb11-11">         <span class="at" style="color: #657422;">code=</span>area_type) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb11-12">  <span class="fu" style="color: #4758AB;">arrange</span>(area_type,year,sex,agegrp)</span>
<span id="cb11-13"><span class="fu" style="color: #4758AB;">write_dta</span>(area_type,<span class="st" style="color: #20794D;">"pop.dta"</span>)</span></code></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
    sex  year agegrp    pop deaths  rate agegroup2 code 
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;
1     1  2014      0 118519    596 5.03          0 Henan
2     1  2014      1 593146    304 0.513         1 Henan
3     1  2014      5 743825    181 0.243         5 Henan
4     1  2014     10 694528    177 0.255        10 Henan
5     1  2014     15 692646    290 0.419        15 Henan
6     1  2014     20 829811    537 0.647        20 Henan</code></pre>
</div>
</div>
</section>
<section id="stata数据准备" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="stata数据准备"><span class="header-section-number">6.2</span> stata数据准备</h3>
<p>我们在扩展简略寿命表的过程中使用了ej-hm的方法，这个方法需要用到ej系数和ej-hm方法的do程序，大家可以点击下面的按钮下载使用。</p>
<p><button class="btn btn-info downloadthis  " id="dnldts9323"><i class="bi bi-database-fill-down"></i> 下载ej系数 </button></p>
<p><button class="btn btn-info downloadthis  " id="dnldts29082"><i class="bi bi-database-fill-down"></i> 下载ej-hm.do </button></p>
</section>
<section id="计算简略寿命表" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="计算简略寿命表"><span class="header-section-number">6.3</span> 计算简略寿命表</h3>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb13-1">cd <span class="st" style="color: #20794D;">"/Users/qc0824/manuscripts/period-survival"</span></span>
<span id="cb13-2">************step 2 简略寿命表准备</span>
<span id="cb13-3"><span class="kw" style="color: #003B4F;">use</span> pop.dta,<span class="kw" style="color: #003B4F;">clear</span></span>
<span id="cb13-4">browse</span>
<span id="cb13-5"><span class="kw" style="color: #003B4F;">gen</span> n=5 <span class="co" style="color: #5E5E5E;">//生成组距</span></span>
<span id="cb13-6"><span class="kw" style="color: #003B4F;">replace</span> n=1 <span class="kw" style="color: #003B4F;">if</span> agegroup2==0</span>
<span id="cb13-7"><span class="kw" style="color: #003B4F;">replace</span> n=4 <span class="kw" style="color: #003B4F;">if</span> agegroup2==1</span>
<span id="cb13-8"><span class="kw" style="color: #003B4F;">replace</span> n=15 <span class="kw" style="color: #003B4F;">if</span> agegroup2==85</span>
<span id="cb13-9"></span>
<span id="cb13-10"><span class="kw" style="color: #003B4F;">tab</span> n</span>
<span id="cb13-11"><span class="kw" style="color: #003B4F;">gen</span> mx= deaths/pop <span class="co" style="color: #5E5E5E;">// 计算年龄组死亡率</span></span>
<span id="cb13-12"><span class="kw" style="color: #003B4F;">gen</span> qx=1-<span class="fu" style="color: #4758AB;">exp</span>(-n*mx) <span class="co" style="color: #5E5E5E;">// 计算年龄组死亡概率</span></span>
<span id="cb13-13"><span class="kw" style="color: #003B4F;">egen</span> ageblock1=<span class="fu" style="color: #4758AB;">seq</span>(),block(19)</span>
<span id="cb13-14"><span class="kw" style="color: #003B4F;">bysort</span> ageblock1: <span class="kw" style="color: #003B4F;">gen</span> ageblock2=<span class="dt" style="color: #AD0000;">_n</span></span>
<span id="cb13-15"></span>
<span id="cb13-16"><span class="kw" style="color: #003B4F;">gen</span> lx=.</span>
<span id="cb13-17"><span class="kw" style="color: #003B4F;">replace</span> lx=100000 <span class="kw" style="color: #003B4F;">if</span> agegroup2==0</span>
<span id="cb13-18"><span class="kw" style="color: #003B4F;">gen</span> dx=.</span>
<span id="cb13-19"><span class="kw" style="color: #003B4F;">replace</span> dx=qx*lx </span>
<span id="cb13-20"></span>
<span id="cb13-21"><span class="kw" style="color: #003B4F;">foreach</span> n <span class="kw" style="color: #003B4F;">of</span> numlist 2/19 {</span>
<span id="cb13-22">   <span class="kw" style="color: #003B4F;">bysort</span> code <span class="fu" style="color: #4758AB;">year</span> sex ageblock1: <span class="kw" style="color: #003B4F;">replace</span> lx=lx[<span class="dt" style="color: #AD0000;">_n</span>-1]-dx[<span class="dt" style="color: #AD0000;">_n</span>-1] <span class="kw" style="color: #003B4F;">if</span>  ageblock2==<span class="ot" style="color: #003B4F;">`n'</span></span>
<span id="cb13-23">   <span class="kw" style="color: #003B4F;">replace</span> dx=qx[<span class="dt" style="color: #AD0000;">_n</span>]*lx[<span class="dt" style="color: #AD0000;">_n</span>] <span class="kw" style="color: #003B4F;">if</span> ageblock2==<span class="ot" style="color: #003B4F;">`n'</span></span>
<span id="cb13-24">    } <span class="co" style="color: #5E5E5E;">// 计算尚存活人数lx，和死亡人数dx</span></span>
<span id="cb13-25"><span class="kw" style="color: #003B4F;">gen</span> Lx=n*(2*lx-dx)/2    <span class="co" style="color: #5E5E5E;">//计算个年龄组生存人年数</span></span>
<span id="cb13-26"></span>
<span id="cb13-27"><span class="kw" style="color: #003B4F;">gsort</span> code <span class="fu" style="color: #4758AB;">year</span> sex -ageblock2 <span class="co" style="color: #5E5E5E;">// 利用sum函数从上往下累计的原理，将年龄组倒序排列，反向累加</span></span>
<span id="cb13-28"><span class="kw" style="color: #003B4F;">bysort</span> ageblock1: <span class="kw" style="color: #003B4F;">gen</span> Tx=<span class="kw" style="color: #003B4F;">sum</span>(Lx) <span class="co" style="color: #5E5E5E;">// 计算生存总人年数</span></span>
<span id="cb13-29"><span class="kw" style="color: #003B4F;">gsort</span> code <span class="fu" style="color: #4758AB;">year</span> sex ageblock2</span>
<span id="cb13-30"><span class="kw" style="color: #003B4F;">gen</span> ex=Tx/lx <span class="co" style="color: #5E5E5E;">// 计算期望寿命=生存总人年数/年龄组尚存活人数</span></span></code></pre></div>
</section>
<section id="寿命表的质量审核" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="寿命表的质量审核"><span class="header-section-number">6.4</span> 寿命表的质量审核</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><span class="kw" style="color: #003B4F;">twoway</span>(connected ex <span class="fu" style="color: #4758AB;">year</span> <span class="kw" style="color: #003B4F;">if</span> agegroup2==0),<span class="kw" style="color: #003B4F;">by</span>(code sex) xla(2014(2)2020) <span class="co" style="color: #5E5E5E;">// #根据期望寿命判断寿命表的数据质量（修改分析年份）</span></span></code></pre></div>
</section>
<section id="扩充完全寿命表结构" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="扩充完全寿命表结构"><span class="header-section-number">6.5</span> 扩充完全寿命表结构</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb15-1">*******************step3 将19个年龄组expand为0到99岁完整年龄寿命表结构</span>
<span id="cb15-2"><span class="kw" style="color: #003B4F;">drop</span> ageblock1 ageblock2 <span class="co" style="color: #5E5E5E;">// 删除年龄区组中间变量</span></span>
<span id="cb15-3"><span class="kw" style="color: #003B4F;">gen</span> num=<span class="dt" style="color: #AD0000;">_n</span> <span class="co" style="color: #5E5E5E;">// 生成序号</span></span>
<span id="cb15-4">expand=n   <span class="co" style="color: #5E5E5E;">// 根据n的数量扩充数据库</span></span>
<span id="cb15-5"><span class="kw" style="color: #003B4F;">sort</span> num <span class="co" style="color: #5E5E5E;">// 根据序号排序</span></span>
<span id="cb15-6"><span class="kw" style="color: #003B4F;">bysort</span> code <span class="fu" style="color: #4758AB;">year</span> sex : <span class="kw" style="color: #003B4F;">egen</span> age=<span class="fu" style="color: #4758AB;">seq</span>(),f(0) t(99) <span class="co" style="color: #5E5E5E;">// 生成0-99岁单岁组</span></span>
<span id="cb15-7"><span class="kw" style="color: #003B4F;">bysort</span> code <span class="fu" style="color: #4758AB;">year</span> sex num :<span class="kw" style="color: #003B4F;">egen</span> block=<span class="fu" style="color: #4758AB;">seq</span>(),f(1) t()  <span class="co" style="color: #5E5E5E;">// 为19个年组内扩充的单岁组排序</span></span>
<span id="cb15-8"><span class="kw" style="color: #003B4F;">order</span> age,after(sex) <span class="co" style="color: #5E5E5E;">// 年龄变量移位至sex后面</span></span>
<span id="cb15-9"><span class="kw" style="color: #003B4F;">foreach</span> <span class="kw" style="color: #003B4F;">var</span> <span class="kw" style="color: #003B4F;">of</span> <span class="kw" style="color: #003B4F;">varlist</span> mx-ex {</span>
<span id="cb15-10">    <span class="kw" style="color: #003B4F;">replace</span> <span class="ot" style="color: #003B4F;">`var'</span>=. <span class="kw" style="color: #003B4F;">if</span> block~=1</span>
<span id="cb15-11">    } <span class="co" style="color: #5E5E5E;">// 清除扩充出的单岁组的对应的死亡率mx，死亡概率qx，尚存活人数lx，死亡人数dx，生存人年数Lx，生存总人年数Tx，平均期望寿命ex</span></span>
<span id="cb15-12">    </span>
<span id="cb15-13"><span class="kw" style="color: #003B4F;">save</span> lt0-99,<span class="kw" style="color: #003B4F;">replace</span></span></code></pre></div>
</section>
<section id="合并ej推算系数" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="合并ej推算系数"><span class="header-section-number">6.6</span> 合并EJ推算系数</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb16-1">************step 4 EJ推算系数合并</span>
<span id="cb16-2"><span class="kw" style="color: #003B4F;">use</span> ej系数,<span class="kw" style="color: #003B4F;">clear</span></span>
<span id="cb16-3"><span class="kw" style="color: #003B4F;">sort</span> age</span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;">save</span> ej系数,<span class="kw" style="color: #003B4F;">replace</span></span>
<span id="cb16-5"></span>
<span id="cb16-6"><span class="kw" style="color: #003B4F;">use</span> lt0-99,<span class="kw" style="color: #003B4F;">clear</span></span>
<span id="cb16-7"><span class="kw" style="color: #003B4F;">sort</span> age</span>
<span id="cb16-8"></span>
<span id="cb16-9"><span class="kw" style="color: #003B4F;">merge</span> <span class="fu" style="color: #4758AB;">m</span>:1 age <span class="kw" style="color: #003B4F;">using</span> <span class="st" style="color: #20794D;">"ej系数"</span> <span class="co" style="color: #5E5E5E;">// 注意查看合并结果和note文件</span></span></code></pre></div>
</section>
<section id="利用ej-hm方法建模估计完全寿命表" class="level3" data-number="6.7">
<h3 data-number="6.7" class="anchored" data-anchor-id="利用ej-hm方法建模估计完全寿命表"><span class="header-section-number">6.7</span> 利用EJ-hm方法建模估计完全寿命表</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb17-1">************step 5 EJ建模估算</span>
<span id="cb17-2"><span class="kw" style="color: #003B4F;">ren</span> (code pop deaths)(site population deaths) <span class="co" style="color: #5E5E5E;">// 重新命名变量与EJ-hm.do内保持一致</span></span>
<span id="cb17-3"><span class="kw" style="color: #003B4F;">describe</span></span>
<span id="cb17-4"><span class="kw" style="color: #003B4F;">sort</span> site <span class="fu" style="color: #4758AB;">year</span> sex age</span>
<span id="cb17-5"><span class="kw" style="color: #003B4F;">replace</span> lx=lx/100000 <span class="co" style="color: #5E5E5E;">//必须将lx转化，除以100000，否则结果出错</span></span>
<span id="cb17-6"><span class="kw" style="color: #003B4F;">do</span> <span class="st" style="color: #20794D;">"EJ-hm.do"</span></span>
<span id="cb17-7">* Generate <span class="kw" style="color: #003B4F;">fitted</span> mortality rate from 0 to 98 years</span>
<span id="cb17-8"><span class="kw" style="color: #003B4F;">sort</span> site sex <span class="fu" style="color: #4758AB;">year</span> age </span>
<span id="cb17-9"><span class="kw" style="color: #003B4F;">gen</span> fitmx=-<span class="fu" style="color: #4758AB;">ln</span>(fitlx[<span class="dt" style="color: #AD0000;">_n</span>+1]/fitlx) <span class="kw" style="color: #003B4F;">if</span> age!=99 <span class="co" style="color: #5E5E5E;">// 根据qx=1-exp(-n*mx)公式反向推导而来，即px=exp(-mx)</span></span>
<span id="cb17-10"><span class="kw" style="color: #003B4F;">replace</span> fitmx=-<span class="fu" style="color: #4758AB;">ln</span>(fitlx/fitlx[<span class="dt" style="color: #AD0000;">_n</span>-1]) <span class="kw" style="color: #003B4F;">if</span> age==99 <span class="co" style="color: #5E5E5E;">// 99岁组fitmx单独计算,等于98岁组的死亡率（疑问？）</span></span>
<span id="cb17-11">* Save results</span>
<span id="cb17-12"><span class="kw" style="color: #003B4F;">save</span> complete_lifetable_js, <span class="kw" style="color: #003B4F;">replace</span></span></code></pre></div>
</section>
</section>
<section id="利用periodr包计算相对生存率" class="level2 page-columns page-full" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="利用periodr包计算相对生存率"><span class="header-section-number">7</span> 利用periodR包计算相对生存率</h2>
<section id="periodr基本语法" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="periodr基本语法"><span class="header-section-number">7.1</span> periodR基本语法</h3>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;">period</span>(data, k, surv.m, surv.f, perbeg, perend, <span class="at" style="color: #657422;">method=</span><span class="st" style="color: #20794D;">"EdereII"</span>, <span class="at" style="color: #657422;">agedist=</span><span class="cn" style="color: #8f5902;">NULL</span>)</span></code></pre></div>
<p>程序参数如下：</p>
<blockquote class="blockquote">
<ul>
<li>data：生存数据</li>
<li>k：随访时间</li>
<li>surv.m：0-99岁条件一年生存概率（男性）</li>
<li>surv.f：0-99岁条件一年生存概率（女性）</li>
<li>perbeg：纳入分析的起始年份</li>
<li>perend：纳入分析的终止年份</li>
<li>method：相对生存率的计算方法</li>
<li>agedist: 标准年龄构成</li>
</ul>
</blockquote>
<p>生存数据所须的一些强制性变量</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
periodR生存分析的强制性变量
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>sex: 1-男性，2-女性</li>
<li>dm: 诊断时间月份(数值：1-12)</li>
<li>dy: 诊断时间年份(数值：2002)</li>
<li>diagage: 诊断时年龄(数值：66)</li>
<li>fm: 随访终止时间月份(数值：1-12)</li>
<li>fy: 随访终止时间年份(数值：2019)</li>
<li>vitstat: 随访终止时生存状态(1：存活，2：死亡)</li>
</ul>
</div>
</div>
</section>
<section id="sec-macro" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="sec-macro"><span class="header-section-number">7.2</span> 构建批量生存分析函数</h3>
<p>period函数对不同数据子集进行生存分析时，需要在data参数中制定不同的数据子集，如果子集很多的时候，数据分析起来就会很麻烦，比如对不同部位癌种进行生存分析，所以，我们可以在period函数的基础上，编制一个批量生存分析的函数，来方面我们的计算过程。</p>
<p>下面这个函数在period的基础上进行了一些整合，可以批量分析不同亚组的生存分析，并把主要结果整理成数据集。</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1">tperiod <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(data,cat) {</span>
<span id="cb19-2">  cats <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">unique</span>(data[[cat]])</span>
<span id="cb19-3">  ress <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>()</span>
<span id="cb19-4">  <span class="cf" style="color: #003B4F;">for</span> (x <span class="cf" style="color: #003B4F;">in</span> cats) {</span>
<span id="cb19-5">    std.pop <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">icss_choose</span>(x)</span>
<span id="cb19-6">    ress_ <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">period</span>(<span class="fu" style="color: #4758AB;">subset</span>(data,data[[cat]]<span class="sc" style="color: #5E5E5E;">==</span>x), <span class="dv" style="color: #AD0000;">5</span>, surv.m, surv.f, <span class="dv" style="color: #AD0000;">2017</span>, <span class="dv" style="color: #AD0000;">2019</span>)</span>
<span id="cb19-7">    res_ <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">period</span>(<span class="fu" style="color: #4758AB;">subset</span>(data,data[[cat]]<span class="sc" style="color: #5E5E5E;">==</span>x), <span class="dv" style="color: #AD0000;">5</span>, surv.m, surv.f, </span>
<span id="cb19-8">                   <span class="dv" style="color: #AD0000;">2017</span>, <span class="dv" style="color: #AD0000;">2019</span>, <span class="at" style="color: #657422;">agedist =</span> std.pop)</span>
<span id="cb19-9">    res <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">cate=</span>x,</span>
<span id="cb19-10">                      <span class="at" style="color: #657422;">crs=</span><span class="fu" style="color: #4758AB;">round</span>(ress_<span class="sc" style="color: #5E5E5E;">$</span>rel.surv[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb19-11">                      <span class="at" style="color: #657422;">cse=</span><span class="fu" style="color: #4758AB;">round</span>(ress_<span class="sc" style="color: #5E5E5E;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb19-12">                      <span class="at" style="color: #657422;">rs=</span><span class="fu" style="color: #4758AB;">round</span>(res_<span class="sc" style="color: #5E5E5E;">$</span>rel.surv[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb19-13">                      <span class="at" style="color: #657422;">se=</span><span class="fu" style="color: #4758AB;">round</span>(res_<span class="sc" style="color: #5E5E5E;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>))</span>
<span id="cb19-14">    ress <span class="ot" style="color: #003B4F;">&lt;-</span><span class="fu" style="color: #4758AB;">rbind</span>(ress,res)</span>
<span id="cb19-15">  }</span>
<span id="cb19-16">  total_ <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">period</span>(data, <span class="dv" style="color: #AD0000;">5</span>, surv.m, surv.f, <span class="dv" style="color: #AD0000;">2017</span>, <span class="dv" style="color: #AD0000;">2019</span>)</span>
<span id="cb19-17">  total <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">period</span>(data, <span class="dv" style="color: #AD0000;">5</span>, surv.m, surv.f, <span class="dv" style="color: #AD0000;">2017</span>, <span class="dv" style="color: #AD0000;">2019</span>, <span class="at" style="color: #657422;">agedist =</span> icss1)</span>
<span id="cb19-18">  total <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">cate=</span><span class="st" style="color: #20794D;">"合计"</span>,</span>
<span id="cb19-19">                      <span class="at" style="color: #657422;">crs=</span><span class="fu" style="color: #4758AB;">round</span>(total_<span class="sc" style="color: #5E5E5E;">$</span>rel.surv[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb19-20">                      <span class="at" style="color: #657422;">cse=</span><span class="fu" style="color: #4758AB;">round</span>(total_<span class="sc" style="color: #5E5E5E;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb19-21">                      <span class="at" style="color: #657422;">rs=</span><span class="fu" style="color: #4758AB;">round</span>(total<span class="sc" style="color: #5E5E5E;">$</span>rel.surv[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb19-22">                      <span class="at" style="color: #657422;">se=</span><span class="fu" style="color: #4758AB;">round</span>(total<span class="sc" style="color: #5E5E5E;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;">5</span>],<span class="dv" style="color: #AD0000;">1</span>))</span>
<span id="cb19-23">  ress <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">rbind</span>(ress,total) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">arrange</span>(cate)</span>
<span id="cb19-24">  <span class="fu" style="color: #4758AB;">return</span>(ress)</span>
<span id="cb19-25">}</span></code></pre></div>
</section>
<section id="年龄标化生存率的计算" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="年龄标化生存率的计算"><span class="header-section-number">7.3</span> 年龄标化生存率的计算</h3>
<p>在进行生存率的年龄标化时，WHO推荐了三个标准年龄构成，不同的癌种在进行年龄标化时应该选择不同的标准年龄构成。我把这个过程跟上面的函数整合到一起，可以实现根据不同癌症选择不同的标准年龄构成，这样就不用手动选择标准年龄结构了<span class="citation" data-cites="corazziari2004a">(10)</span>。</p>
<section id="标准年龄构成" class="level4" data-number="7.3.1">
<h4 data-number="7.3.1" class="anchored" data-anchor-id="标准年龄构成"><span class="header-section-number">7.3.1</span> 标准年龄构成</h4>
<p>标准年龄构成分为两种，一种是每5岁一组的年龄构成(表&nbsp;2)；另外一种是20岁一组的年龄构成(表&nbsp;3)。</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-std1" class="anchored">
<table class="table table-sm table-striped">
<caption>表&nbsp;2: 5岁年龄组的标准年龄构成</caption>
<thead>
<tr class="header">
<th style="text-align: center;">年龄组</th>
<th style="text-align: center;">ICSS1</th>
<th style="text-align: center;">ICSS2</th>
<th style="text-align: center;">ICSS3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">15-19 岁</td>
<td style="text-align: center;">164</td>
<td style="text-align: center;">1128</td>
<td style="text-align: center;">6938</td>
</tr>
<tr class="even">
<td style="text-align: center;">20-24 岁</td>
<td style="text-align: center;">215</td>
<td style="text-align: center;">2011</td>
<td style="text-align: center;">11183</td>
</tr>
<tr class="odd">
<td style="text-align: center;">25-29 岁</td>
<td style="text-align: center;">416</td>
<td style="text-align: center;">3745</td>
<td style="text-align: center;">12964</td>
</tr>
<tr class="even">
<td style="text-align: center;">30-34 岁</td>
<td style="text-align: center;">842</td>
<td style="text-align: center;">5755</td>
<td style="text-align: center;">11630</td>
</tr>
<tr class="odd">
<td style="text-align: center;">35-39 岁</td>
<td style="text-align: center;">1874</td>
<td style="text-align: center;">7538</td>
<td style="text-align: center;">9635</td>
</tr>
<tr class="even">
<td style="text-align: center;">40-44 岁</td>
<td style="text-align: center;">3489</td>
<td style="text-align: center;">7823</td>
<td style="text-align: center;">7650</td>
</tr>
<tr class="odd">
<td style="text-align: center;">45-49 岁</td>
<td style="text-align: center;">4906</td>
<td style="text-align: center;">8283</td>
<td style="text-align: center;">5324</td>
</tr>
<tr class="even">
<td style="text-align: center;">50-54 岁</td>
<td style="text-align: center;">7094</td>
<td style="text-align: center;">8717</td>
<td style="text-align: center;">4676</td>
</tr>
<tr class="odd">
<td style="text-align: center;">55-59 岁</td>
<td style="text-align: center;">9641</td>
<td style="text-align: center;">9894</td>
<td style="text-align: center;">5224</td>
</tr>
<tr class="even">
<td style="text-align: center;">60-64 岁</td>
<td style="text-align: center;">13359</td>
<td style="text-align: center;">11106</td>
<td style="text-align: center;">4776</td>
</tr>
<tr class="odd">
<td style="text-align: center;">65-69 岁</td>
<td style="text-align: center;">14234</td>
<td style="text-align: center;">10992</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: center;">70-74 岁</td>
<td style="text-align: center;">14766</td>
<td style="text-align: center;">9008</td>
<td style="text-align: center;">4933</td>
</tr>
<tr class="odd">
<td style="text-align: center;">75-79 岁</td>
<td style="text-align: center;">14131</td>
<td style="text-align: center;">7254</td>
<td style="text-align: center;">5179</td>
</tr>
<tr class="even">
<td style="text-align: center;">80-84 岁</td>
<td style="text-align: center;">9347</td>
<td style="text-align: center;">4116</td>
<td style="text-align: center;">3247</td>
</tr>
<tr class="odd">
<td style="text-align: center;">85+ 岁</td>
<td style="text-align: center;">5522</td>
<td style="text-align: center;">2630</td>
<td style="text-align: center;">1574</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-std2" class="anchored">
<table class="table table-sm table-striped">
<caption>表&nbsp;3: 20岁年龄组的标准年龄构成</caption>
<thead>
<tr class="header">
<th style="text-align: center;">年龄组</th>
<th style="text-align: center;">ICSS1</th>
<th style="text-align: center;">ICSS2</th>
<th style="text-align: center;">ICSS3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">15-44岁</td>
<td style="text-align: center;">7000</td>
<td style="text-align: center;">28000</td>
<td style="text-align: center;">60000</td>
</tr>
<tr class="even">
<td style="text-align: center;">45-54岁</td>
<td style="text-align: center;">12000</td>
<td style="text-align: center;">17000</td>
<td style="text-align: center;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">55-64岁</td>
<td style="text-align: center;">23000</td>
<td style="text-align: center;">21000</td>
<td style="text-align: center;">10000</td>
</tr>
<tr class="even">
<td style="text-align: center;">65-74岁</td>
<td style="text-align: center;">29000</td>
<td style="text-align: center;">20000</td>
<td style="text-align: center;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">75+岁</td>
<td style="text-align: center;">29000</td>
<td style="text-align: center;">14000</td>
<td style="text-align: center;">10000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="不同癌种对应的标准人口构成" class="level4" data-number="7.3.2">
<h4 data-number="7.3.2" class="anchored" data-anchor-id="不同癌种对应的标准人口构成"><span class="header-section-number">7.3.2</span> 不同癌种对应的标准人口构成</h4>
<p>不同的癌种对应了不同的标准人口构成，(表&nbsp;4)列出了不同的癌种的想对应的癌种，在计算所有癌种合计的标化生存率时，应选择ICSS1。</p>
<p>我们在计算不同癌种的标化相对生存率时可以参考(表&nbsp;4)选择标准人口构成。</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-icss" class="anchored">
<table class="table table-sm table-striped">
<caption>表&nbsp;4: 不同癌种对应的标准人口构成<span class="citation" data-cites="corazziari2004a">(10)</span></caption>
<colgroup>
<col style="width: 1%">
<col style="width: 98%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">ICSS</th>
<th style="text-align: left;">癌症部位</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">ICSS1</td>
<td style="text-align: left;">Lip, tongue, salivary glands, oral cavity, oropharynx, hypopharynx, head &amp; neck, oesophagus, stomach, small intestine, colon, rectum, liver, biliary tract, pancreas, nasal cavities, larynx, lung, pleura, breast, corpus uteri, ovary, vagina &amp; vulva, penis, bladder, kidney, choroid melanoma, non-Hodgkin lymphomas, multiple myeloma, chronic lymphatic leukaemia, acute myeloid leukaemia, chronic myeloid leukaemia, leukaemia, all cancers, prostate</td>
</tr>
<tr class="even">
<td style="text-align: center;">ICSS2</td>
<td style="text-align: left;">Nasopharynx, soft tissues, melanoma, cervix uteri, brain, thyroid gland, bone</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ICSS3</td>
<td style="text-align: left;">Testis, Hodgkins disease, acute lymphatic leukaemia</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="标准人口选择r程序" class="level4" data-number="7.3.3">
<h4 data-number="7.3.3" class="anchored" data-anchor-id="标准人口选择r程序"><span class="header-section-number">7.3.3</span> 标准人口选择R程序</h4>
<p>我们在计算标化率时选择的标准人口是(表&nbsp;3)对应的标准人口，同时也写了R程序自动选择不同癌种对应的标准人口，并把程序嵌入到(Section&nbsp;7.2)对应的R函数中，这样就可以使用程序批量输出标化相对生存率的计算结果。</p>
<p>程序如下：</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;">#生成生存分析标准人口结构</span></span>
<span id="cb20-2">s <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">7</span>,<span class="dv" style="color: #AD0000;">12</span>,<span class="dv" style="color: #AD0000;">23</span>,<span class="dv" style="color: #AD0000;">29</span>,<span class="dv" style="color: #AD0000;">29</span>)</span>
<span id="cb20-3">icss1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">cbind</span>(cancer.pop[,<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">2</span>],s)</span>
<span id="cb20-4">s<span class="ot" style="color: #003B4F;">=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">28</span>,<span class="dv" style="color: #AD0000;">17</span>,<span class="dv" style="color: #AD0000;">21</span>,<span class="dv" style="color: #AD0000;">20</span>,<span class="dv" style="color: #AD0000;">14</span>)</span>
<span id="cb20-5">icss2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">cbind</span>(icss1[,<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">2</span>],s)</span>
<span id="cb20-6">s<span class="ot" style="color: #003B4F;">=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">60</span>,<span class="dv" style="color: #AD0000;">10</span>,<span class="dv" style="color: #AD0000;">10</span>,<span class="dv" style="color: #AD0000;">10</span>,<span class="dv" style="color: #AD0000;">10</span>)</span>
<span id="cb20-7">icss3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">cbind</span>(icss1[,<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">2</span>],s)</span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;">#根据癌种不同选择不同的标准人口结构</span></span>
<span id="cb20-9">icss_choose <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x) {</span>
<span id="cb20-10">  <span class="cf" style="color: #003B4F;">if</span> (x <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"鼻咽"</span>,<span class="st" style="color: #20794D;">"皮肤黑色素瘤"</span>,<span class="st" style="color: #20794D;">"子宫颈"</span>,<span class="st" style="color: #20794D;">"脑"</span>,<span class="st" style="color: #20794D;">"甲状腺"</span>,<span class="st" style="color: #20794D;">"骨"</span>)) {</span>
<span id="cb20-11">    std.pop <span class="ot" style="color: #003B4F;">&lt;-</span> icss2</span>
<span id="cb20-12">  } <span class="cf" style="color: #003B4F;">else</span> <span class="cf" style="color: #003B4F;">if</span> (x <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"睾丸"</span>)) {</span>
<span id="cb20-13">    std.pop <span class="ot" style="color: #003B4F;">&lt;-</span> icss3 </span>
<span id="cb20-14">  } <span class="cf" style="color: #003B4F;">else</span> { </span>
<span id="cb20-15">    std.pop <span class="ot" style="color: #003B4F;">&lt;-</span> icss1 </span>
<span id="cb20-16">  }</span>
<span id="cb20-17">  <span class="fu" style="color: #4758AB;">return</span>(std.pop)</span>
<span id="cb20-18">}</span></code></pre></div>
</section>
</section>
<section id="sec-rs" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="sec-rs"><span class="header-section-number">7.4</span> 计数分性别不同部位的5年相对生存率</h3>
<p>首先，截取需要用的数据子集，然后利用tperiod函数计算不同癌种的5年相对生存率</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">##合计成人5年生存率</span></span>
<span id="cb21-2">total <span class="ot" style="color: #003B4F;">&lt;-</span> ana <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(diagage<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">15</span>) </span>
<span id="cb21-3">ress_total <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tperiod</span>(<span class="at" style="color: #657422;">data=</span>total,<span class="at" style="color: #657422;">cat=</span><span class="st" style="color: #20794D;">"icdd"</span>)</span></code></pre></div>
<p>计算男性成人5年相对生存率</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">##男性成人5年生存率</span></span>
<span id="cb22-2">male <span class="ot" style="color: #003B4F;">&lt;-</span> ana <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(sex<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"1"</span>,diagage<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">15</span>)</span>
<span id="cb22-3">ress_male <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tperiod</span>(<span class="at" style="color: #657422;">data=</span>male,<span class="at" style="color: #657422;">cat=</span><span class="st" style="color: #20794D;">"icdd"</span>)</span></code></pre></div>
<p>计算女性成人5年相对生存率</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">##女性成人5年生存率</span></span>
<span id="cb23-2">female <span class="ot" style="color: #003B4F;">&lt;-</span> ana <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(sex<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"2"</span>,diagage<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">15</span>)</span>
<span id="cb23-3">ress_female <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tperiod</span>(<span class="at" style="color: #657422;">data=</span>female,<span class="at" style="color: #657422;">cat=</span><span class="st" style="color: #20794D;">"icdd"</span>)</span></code></pre></div>
</section>
<section id="组间相对生存率的统计学检验" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="组间相对生存率的统计学检验"><span class="header-section-number">7.5</span> 组间相对生存率的统计学检验</h3>
<p>periodR能够输出估计的相对生存率和标准差，其实有这两个参数可以直接推出95%可信区间，但是为了能够更直观的两组间相对生存率点估计值的统计学差异，可以对两组的相对生存率进行统计学检验。</p>
<p>我们采用Z检验比较组间5年相对生存率的统计学差异（Equation&nbsp;1），其中<img src="https://latex.codecogs.com/png.latex?P_1">表示组1的相对生存率，<img src="https://latex.codecogs.com/png.latex?P_2">表示组2的相对生存率，<img src="https://latex.codecogs.com/png.latex?s.e.(P_1)">表示<img src="https://latex.codecogs.com/png.latex?P_1">的标准误，<img src="https://latex.codecogs.com/png.latex?s.e.(P_2)">表示<img src="https://latex.codecogs.com/png.latex?P_2">的标准误癌，如果Z&gt;1.96，则<em>P</em>&lt;0.05；如果Z&gt;2.56，则<em>P</em>&lt;0.01。<span class="citation" data-cites="xiangyongbing1999a">(<strong>xiangyongbing1999a?</strong>)</span></p>
<p><span id="eq-z"><img src="https://latex.codecogs.com/png.latex?%0AZ=%5Cfrac%7B%7CP_1-P_2%7C%7D%7B%5Csqrt%7Bs.e.(P_1)%5E2+s.e.(P_2)%5E2%7D%7D%0A%5Ctag%7B1%7D"></span></p>
</section>
<section id="结果表格整理" class="level3 page-columns page-full" data-number="7.6">
<h3 data-number="7.6" class="anchored" data-anchor-id="结果表格整理"><span class="header-section-number">7.6</span> 结果表格整理</h3>
<p>(Section&nbsp;7.4)已经计算出了不同癌种、不同性别癌症人群的5年相对生存率，这一部分，我们将根据计算结果以及(Equation&nbsp;1)计算男性和女性之间估计5年相对生存率的统计学差异。</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;">options</span>(<span class="at" style="color: #657422;">NA.print =</span> <span class="st" style="color: #20794D;">"--"</span>)</span>
<span id="cb24-2">ress_site <span class="ot" style="color: #003B4F;">&lt;-</span> ress_total <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;">left_join</span>(ress_male,<span class="at" style="color: #657422;">by=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"cate"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;">left_join</span>(ress_female,<span class="at" style="color: #657422;">by=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"cate"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;">arrange</span>(<span class="sc" style="color: #5E5E5E;">-</span>rs.x) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">z=</span><span class="fu" style="color: #4758AB;">round</span>(<span class="fu" style="color: #4758AB;">abs</span>(rs.y<span class="sc" style="color: #5E5E5E;">-</span>rs)<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">sqrt</span>(se.y<span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">+</span>se<span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">2</span>),<span class="dv" style="color: #AD0000;">2</span>),</span>
<span id="cb24-7">         <span class="at" style="color: #657422;">p=</span><span class="fu" style="color: #4758AB;">ifelse</span>(z<span class="sc" style="color: #5E5E5E;">&lt;</span><span class="fl" style="color: #AD0000;">1.96</span>,<span class="st" style="color: #20794D;">"&gt;0.05"</span>,</span>
<span id="cb24-8">                  <span class="fu" style="color: #4758AB;">ifelse</span>(z<span class="sc" style="color: #5E5E5E;">&lt;</span><span class="fl" style="color: #AD0000;">2.56</span>,<span class="st" style="color: #20794D;">"&lt;0.05"</span>,<span class="st" style="color: #20794D;">"&lt;0.01"</span>))) </span></code></pre></div>
<p>最后，我们利用kableExtra包把所有的结果输出到表格。</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1">  ress_site <span class="ot" style="color: #003B4F;">&lt;-</span> ress_site <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">a=</span><span class="fu" style="color: #4758AB;">paste0</span>(crs.x,<span class="st" style="color: #20794D;">"("</span>,cse.x,<span class="st" style="color: #20794D;">")"</span>),</span>
<span id="cb25-3">         <span class="at" style="color: #657422;">b=</span><span class="fu" style="color: #4758AB;">paste0</span>(rs.x,<span class="st" style="color: #20794D;">"("</span>,se.x,<span class="st" style="color: #20794D;">")"</span>),</span>
<span id="cb25-4">         <span class="at" style="color: #657422;">c=</span><span class="fu" style="color: #4758AB;">paste0</span>(crs.y,<span class="st" style="color: #20794D;">"("</span>,cse.y,<span class="st" style="color: #20794D;">")"</span>),</span>
<span id="cb25-5">         <span class="at" style="color: #657422;">d=</span><span class="fu" style="color: #4758AB;">paste0</span>(rs.y,<span class="st" style="color: #20794D;">"("</span>,se.y,<span class="st" style="color: #20794D;">")"</span>),</span>
<span id="cb25-6">         <span class="at" style="color: #657422;">e=</span><span class="fu" style="color: #4758AB;">paste0</span>(crs,<span class="st" style="color: #20794D;">"("</span>,cse,<span class="st" style="color: #20794D;">")"</span>),</span>
<span id="cb25-7">         <span class="at" style="color: #657422;">f=</span><span class="fu" style="color: #4758AB;">paste0</span>(rs,<span class="st" style="color: #20794D;">"("</span>,se,<span class="st" style="color: #20794D;">")"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;">select</span>(cate,a,b,c,d,e,f,z,p) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(a<span class="sc" style="color: #5E5E5E;">:</span>f, <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">ifelse</span>(. <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"NA(NA)"</span>, <span class="st" style="color: #20794D;">"--"</span>, .))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;">kbl</span>(<span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"部位"</span>,<span class="fu" style="color: #4758AB;">rep</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"CRS"</span>,<span class="st" style="color: #20794D;">"ARS"</span>),<span class="dv" style="color: #AD0000;">3</span>),<span class="st" style="color: #20794D;">"Z"</span>,<span class="st" style="color: #20794D;">"P"</span>),<span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"c"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;">kable_classic</span>(<span class="at" style="color: #657422;">full_width =</span> T, <span class="at" style="color: #657422;">html_font =</span> <span class="st" style="color: #20794D;">"Cambria"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-12">  <span class="fu" style="color: #4758AB;">add_header_above</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">" "</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"合计"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">"男性"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">"女性"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">" "</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>),</span>
<span id="cb25-13">                   <span class="at" style="color: #657422;">bold =</span> T,<span class="at" style="color: #657422;">border_left =</span> T) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb25-14">  <span class="fu" style="color: #4758AB;">row_spec</span>(<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="at" style="color: #657422;">bold=</span>T,<span class="at" style="color: #657422;">italic=</span>T) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-15">  <span class="fu" style="color: #4758AB;">footnote</span>(<span class="at" style="color: #657422;">general =</span> <span class="st" style="color: #20794D;">"结果以5年相对生存率(标准误)的形式展示. CRS: 5年相对生存率. ARS: 年龄调整5年相对生存率."</span>,</span>
<span id="cb25-16">           <span class="at" style="color: #657422;">general_title =</span> <span class="st" style="color: #20794D;">"注:"</span>,<span class="at" style="color: #657422;">footnote_as_chunk =</span> <span class="cn" style="color: #8f5902;">TRUE</span>,<span class="at" style="color: #657422;">escape =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span></code></pre></div>
<div class="cell page-columns page-full">
<div class="cell-output-display column-page">
<div id="tbl-t2" class="anchored">
<table class="lightable-classic table table-sm table-striped" data-quarto-postprocess="true">
<caption>表&nbsp;5: 15岁以上不同性别、不同部位癌症患者5年相对生存率</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; empty-cells: hide;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
合计
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
男性
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
女性
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; empty-cells: hide;"></th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">部位</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">CRS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">ARS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">CRS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">ARS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">CRS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">ARS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">Z</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">甲状腺</td>
<td style="text-align: center;">91.8(0.6)</td>
<td style="text-align: center;">86.4(1.2)</td>
<td style="text-align: center;">87.8(1.6)</td>
<td style="text-align: center;">83.4(2.3)</td>
<td style="text-align: center;">92.9(0.6)</td>
<td style="text-align: center;">87.3(1.4)</td>
<td style="text-align: center;">1.45</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">睾丸</td>
<td style="text-align: center;">72.8(5.4)</td>
<td style="text-align: center;">74.4(4.9)</td>
<td style="text-align: center;">72.8(5.4)</td>
<td style="text-align: center;">74.4(4.9)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">乳房</td>
<td style="text-align: center;">79.7(0.4)</td>
<td style="text-align: center;">73.1(1)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">79.7(0.4)</td>
<td style="text-align: center;">73.1(1)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">子宫颈</td>
<td style="text-align: center;">72.4(0.7)</td>
<td style="text-align: center;">68.3(0.8)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">72.4(0.7)</td>
<td style="text-align: center;">68.3(0.8)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">皮肤黑色素瘤</td>
<td style="text-align: center;">68.4(4.5)</td>
<td style="text-align: center;">67.6(4.5)</td>
<td style="text-align: center;">64.9(6.3)</td>
<td style="text-align: center;">63.7(6.2)</td>
<td style="text-align: center;">72.4(6.3)</td>
<td style="text-align: center;">72.2(6)</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">膀胱</td>
<td style="text-align: center;">66.1(1.4)</td>
<td style="text-align: center;">66.2(1.4)</td>
<td style="text-align: center;">68.5(1.7)</td>
<td style="text-align: center;">68.7(1.6)</td>
<td style="text-align: center;">58.5(2.7)</td>
<td style="text-align: center;">58.7(2.6)</td>
<td style="text-align: center;">3.28</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">子宫体</td>
<td style="text-align: center;">79.5(0.8)</td>
<td style="text-align: center;">64.2(1.8)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">79.5(0.8)</td>
<td style="text-align: center;">64.2(1.8)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">口腔</td>
<td style="text-align: center;">63.4(1.5)</td>
<td style="text-align: center;">60.2(1.7)</td>
<td style="text-align: center;">58.2(2)</td>
<td style="text-align: center;">55.3(2.3)</td>
<td style="text-align: center;">70.3(2.1)</td>
<td style="text-align: center;">66.7(2.6)</td>
<td style="text-align: center;">3.28</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">肾</td>
<td style="text-align: center;">64.8(1.4)</td>
<td style="text-align: center;">60.2(1.7)</td>
<td style="text-align: center;">61.1(1.9)</td>
<td style="text-align: center;">56.5(2.3)</td>
<td style="text-align: center;">70.2(2)</td>
<td style="text-align: center;">66(2.5)</td>
<td style="text-align: center;">2.80</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">鼻咽</td>
<td style="text-align: center;">59.2(2.3)</td>
<td style="text-align: center;">59.2(2.3)</td>
<td style="text-align: center;">57.5(2.8)</td>
<td style="text-align: center;">57.5(3)</td>
<td style="text-align: center;">62.2(3.7)</td>
<td style="text-align: center;">62.7(3.7)</td>
<td style="text-align: center;">1.09</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">结直肠</td>
<td style="text-align: center;">58.5(0.6)</td>
<td style="text-align: center;">56.9(0.6)</td>
<td style="text-align: center;">58.5(0.8)</td>
<td style="text-align: center;">57(0.9)</td>
<td style="text-align: center;">58.5(0.8)</td>
<td style="text-align: center;">56.8(0.9)</td>
<td style="text-align: center;">0.16</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">其他</td>
<td style="text-align: center;">58.3(0.8)</td>
<td style="text-align: center;">55.1(0.9)</td>
<td style="text-align: center;">53.9(1.1)</td>
<td style="text-align: center;">51.7(1.3)</td>
<td style="text-align: center;">62.7(1.1)</td>
<td style="text-align: center;">58.2(1.3)</td>
<td style="text-align: center;">3.54</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">前列腺</td>
<td style="text-align: center;">58.7(2.1)</td>
<td style="text-align: center;">55.1(2.7)</td>
<td style="text-align: center;">58.7(2.1)</td>
<td style="text-align: center;">55.1(2.7)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">骨</td>
<td style="text-align: center;">50.5(1.6)</td>
<td style="text-align: center;">51.4(1.5)</td>
<td style="text-align: center;">49.3(2.2)</td>
<td style="text-align: center;">50.1(2.1)</td>
<td style="text-align: center;">51.9(2.4)</td>
<td style="text-align: center;">53.1(2.3)</td>
<td style="text-align: center;">0.96</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">其他胸腔器官</td>
<td style="text-align: center;">54.4(2.8)</td>
<td style="text-align: center;">51.1(3.3)</td>
<td style="text-align: center;">48.5(3.7)</td>
<td style="text-align: center;">42.6(4.1)</td>
<td style="text-align: center;">61.7(4.1)</td>
<td style="text-align: center;">62.8(4.7)</td>
<td style="text-align: center;">3.24</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">喉</td>
<td style="text-align: center;">52.4(2.2)</td>
<td style="text-align: center;">49.8(2.4)</td>
<td style="text-align: center;">53.7(2.5)</td>
<td style="text-align: center;">50.5(2.6)</td>
<td style="text-align: center;">46.2(5.4)</td>
<td style="text-align: center;">42.4(5.6)</td>
<td style="text-align: center;">1.31</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">卵巢</td>
<td style="text-align: center;">57.7(1.3)</td>
<td style="text-align: center;">47.5(1.8)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">57.7(1.3)</td>
<td style="text-align: center;">47.5(1.8)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">脑</td>
<td style="text-align: center;">45.7(0.9)</td>
<td style="text-align: center;">45.8(0.9)</td>
<td style="text-align: center;">38(1.2)</td>
<td style="text-align: center;">38.3(1.2)</td>
<td style="text-align: center;">53.1(1.2)</td>
<td style="text-align: center;">53.2(1.2)</td>
<td style="text-align: center;">8.78</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">淋巴瘤</td>
<td style="text-align: center;">47.2(1.2)</td>
<td style="text-align: center;">43.1(1.4)</td>
<td style="text-align: center;">47.1(1.7)</td>
<td style="text-align: center;">43.1(1.9)</td>
<td style="text-align: center;">47.4(1.8)</td>
<td style="text-align: center;">43.1(1.9)</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">白血病</td>
<td style="text-align: center;">44.4(1.1)</td>
<td style="text-align: center;">41.6(1.3)</td>
<td style="text-align: center;">43.4(1.4)</td>
<td style="text-align: center;">42.3(1.8)</td>
<td style="text-align: center;">45.7(1.6)</td>
<td style="text-align: center;">40.5(2)</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">合计</td>
<td style="text-align: center;">44.2(0.1)</td>
<td style="text-align: center;">40.7(0.2)</td>
<td style="text-align: center;">35.2(0.2)</td>
<td style="text-align: center;">34.4(0.2)</td>
<td style="text-align: center;">54(0.2)</td>
<td style="text-align: center;">47.1(0.2)</td>
<td style="text-align: center;">44.90</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">食管</td>
<td style="text-align: center;">36.7(0.4)</td>
<td style="text-align: center;">36.9(0.4)</td>
<td style="text-align: center;">35.9(0.5)</td>
<td style="text-align: center;">35.6(0.5)</td>
<td style="text-align: center;">37.9(0.6)</td>
<td style="text-align: center;">39(0.6)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">胃</td>
<td style="text-align: center;">34.3(0.4)</td>
<td style="text-align: center;">33.5(0.4)</td>
<td style="text-align: center;">34.2(0.4)</td>
<td style="text-align: center;">33.2(0.5)</td>
<td style="text-align: center;">34.7(0.7)</td>
<td style="text-align: center;">34.4(0.7)</td>
<td style="text-align: center;">1.39</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">胆囊</td>
<td style="text-align: center;">27.5(1.1)</td>
<td style="text-align: center;">28(1.2)</td>
<td style="text-align: center;">25.4(1.7)</td>
<td style="text-align: center;">25.6(1.7)</td>
<td style="text-align: center;">29(1.5)</td>
<td style="text-align: center;">29.6(1.6)</td>
<td style="text-align: center;">1.71</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">肺</td>
<td style="text-align: center;">24.1(0.3)</td>
<td style="text-align: center;">24.3(0.3)</td>
<td style="text-align: center;">22.2(0.4)</td>
<td style="text-align: center;">22.5(0.4)</td>
<td style="text-align: center;">28.1(0.6)</td>
<td style="text-align: center;">27.8(0.6)</td>
<td style="text-align: center;">7.35</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">胰腺</td>
<td style="text-align: center;">20.8(0.9)</td>
<td style="text-align: center;">20.5(0.9)</td>
<td style="text-align: center;">18.7(1.2)</td>
<td style="text-align: center;">18.1(1.2)</td>
<td style="text-align: center;">23.4(1.5)</td>
<td style="text-align: center;">23.2(1.5)</td>
<td style="text-align: center;">2.65</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">肝</td>
<td style="text-align: center;">19.9(0.4)</td>
<td style="text-align: center;">19.1(0.4)</td>
<td style="text-align: center;">19.9(0.5)</td>
<td style="text-align: center;">19.1(0.5)</td>
<td style="text-align: center;">20(0.7)</td>
<td style="text-align: center;">19.7(0.7)</td>
<td style="text-align: center;">0.70</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: center; padding: 0;"><span style="font-style: italic;">注:</span> <sup></sup> 结果以5年相对生存率(标准误)的形式展示. CRS: 5年相对生存率. ARS: 年龄调整5年相对生存率.</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
</div>


</div>
</div>
</section>
</section>
<section id="参考文献" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="参考文献">参考文献</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-李卓颖2021" class="csl-entry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">李卓颖, 蒋宇飞, 谭玉婷, et al. <span>现时法统计模型在全人群肿瘤登记生存分析中的应用</span>. <em>复旦学报(医学版)</em>. 2021;48(3): 376-382+397+383-387. </div>
</div>
<div id="ref-张华2014" class="csl-entry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">张华, 曹志刚, 柳光宇, et al. <span>队列法、完全法和现时生存分析方法在乳腺癌随访研究中的应用</span>. <em>肿瘤</em>. 2014;34(6): 550–556. </div>
</div>
<div id="ref-brenner2002" class="csl-entry">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Brenner H, Söderman B, Hakulinen T. Use of period analysis for providing more up-to-date estimates of long-term survival rates: Empirical evaluation among 370 000 cancer patients in <span>Finland</span>. <em>International Journal of Epidemiology</em>. 2002;31(2): 456–462. <a href="https://doi.org/10.1093/ije/31.2.456">https://doi.org/10.1093/ije/31.2.456.</a></div>
</div>
<div id="ref-brenner2004" class="csl-entry">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Brenner H, Gefeller O, Hakulinen T. Period analysis for <span>“up-to-date”</span> cancer survival data. <em>European Journal of Cancer</em>. 2004;40(3): 326–335. <a href="https://doi.org/10.1016/j.ejca.2003.10.013">https://doi.org/10.1016/j.ejca.2003.10.013.</a></div>
</div>
<div id="ref-holleczek2013b" class="csl-entry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Holleczek B, Brenner H. Model based period analysis of absolute and relative survival with <span>R</span>: Data preparation, model fitting and derivation of survival estimates. <em>Comput Methods Programs Biomed</em>. 2013;110(2): 192–202. <a href="https://doi.org/10.1016/j.cmpb.2012.10.004">https://doi.org/10.1016/j.cmpb.2012.10.004.</a></div>
</div>
<div id="ref-jansen2013" class="csl-entry">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Jansen L, Hakulinen T, Brenner H. Study populations for period analyses of cancer survival. <em>Br J Cancer</em>. 2013;108(3): 699–707. <a href="https://doi.org/10.1038/bjc.2013.14">https://doi.org/10.1038/bjc.2013.14.</a></div>
</div>
<div id="ref-张华2016" class="csl-entry">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">张华, 曹志刚, 莫淼, et al. <span>肿瘤监测数据的生存分析方法比较</span>. <em>中国卫生统计</em>. 2016;33(5): 908–913. </div>
</div>
<div id="ref-holleczek2009" class="csl-entry">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Holleczek B, Gondos A, Brenner H. <span class="nocase">periodR</span> - an <span>R</span> package to calculate long-term cancer survival estimates using period analysis. <em>Methods Inf Med</em>. 2009;48(2): 123–128. <a href="https://doi.org/10.3414/ME0563">https://doi.org/10.3414/ME0563.</a></div>
</div>
<div id="ref-ellison2006" class="csl-entry">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Ellison LF. An <span>Empirical Evaluation</span> of <span>Period Survival Analysis Using Data</span> from the <span>Canadian Cancer Registry</span>. <em>Annals of Epidemiology</em>. 2006;16(3): 191–196. <a href="https://doi.org/10.1016/j.annepidem.2005.02.017">https://doi.org/10.1016/j.annepidem.2005.02.017.</a></div>
</div>
<div id="ref-corazziari2004a" class="csl-entry">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Corazziari I, Quinn M, Capocaccia R. Standard cancer patient population for age standardising survival ratios. <em>European Journal of Cancer</em>. 2004;40(15): 2307–2316. <a href="https://doi.org/10.1016/j.ejca.2004.07.002">https://doi.org/10.1016/j.ejca.2004.07.002.</a></div>
</div>
</div>


</section>

 ]]></description>
  <category>肿瘤登记</category>
  <category>数据分析</category>
  <category>R</category>
  <guid>https://www.chenq.site/qsight/2023-04-09-relativesurvival/index.html</guid>
  <pubDate>Sun, 09 Apr 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-04-09-relativesurvival/periodR.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Quarto支持多格式同时输出</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-04-04-quartomultiformat/index.html</link>
  <description><![CDATA[ 




<section id="功能介绍" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="功能介绍"><span class="header-section-number">1</span> 功能介绍</h2>
<p>Quarto自1.3版本之后，quartoHTML页面（独立或网站中）可以支持自动包含元数据中指定 的其他输出格式的链接。例如，如果在quarto文档中指定下面的元数据：</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
元数据设置
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">---</span>
<span id="cb1-2">title: "Quarto支持多格式同时输出"</span>
<span id="cb1-3">subtitle: "多种输出格式，网页中自动加入其他格式链接"</span>
<span id="cb1-4">description: |</span>
<span id="cb1-5">  Quarto自1.3以后的版本中将支持网页输出中包含其他输出格式（PDF、MS Word等）的链接，这对于多种格式的内容分享很重要。</span>
<span id="cb1-6">categories:</span>
<span id="cb1-7">  - quarto</span>
<span id="cb1-8">  - 个人网站</span>
<span id="cb1-9">date: 2023-04-04</span>
<span id="cb1-10">date-modified: last-modified</span>
<span id="cb1-11">draft: false</span>
<span id="cb1-12">toc: true</span>
<span id="cb1-13">mainfont: "Hiragino Sans GB"</span>
<span id="cb1-14">format:</span>
<span id="cb1-15">  html: default</span>
<span id="cb1-16">  docx: default</span>
<span id="cb1-17">  pdf:</span>
<span id="cb1-18">    documentclass: scrartcl</span>
<span id="cb1-19">---</span></code></pre></div>
</div>
</div>
</div>
<p>在网页的输出结果中会包含一个链接指向指定的除HTML以外的其他格式输出结果，这个链接会放在网页的右边栏中，放在边栏目录内容下面。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_27d30fa0cbafcf5e9224f26c364fa1f3">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2023-04-04-quartomultiformat/formats.jpg" class="img-fluid" width="793"></p>
</div>
</div>
</section>
<section id="指定显示链接的格式" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="指定显示链接的格式"><span class="header-section-number">2</span> 指定显示链接的格式</h2>
<p>显示<strong>链接到其他格式</strong>是默认的，但是我们可以通过在YAML里设置<strong>format-links</strong>来控制它是否显示，甚至可以指定哪种具体的格式可以显示出来。</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">format:</span>
<span id="cb2-2">  html: default</span>
<span id="cb2-3">  docx: default</span>
<span id="cb2-4">  pdf:</span>
<span id="cb2-5">    documentclass: scrartcl</span>
<span id="cb2-6">format-links: [docx]</span></code></pre></div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_d7fd0b95e752cdf27359149c00d77f79">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2023-04-04-quartomultiformat/formats2.jpg" class="img-fluid" width="980"></p>
</div>
</div>
</section>
<section id="隐藏所有链接" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="隐藏所有链接"><span class="header-section-number">3</span> 隐藏所有链接</h2>
<p>如果我们只想输出多种格式，但是不想在右侧边栏中显示他们的链接，可以通过下面的设定来实现。</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;">fomat-links</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="ch" style="color: #20794D;">false</span></span></code></pre></div>
</section>
<section id="在项目水平上控制显示格式" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="在项目水平上控制显示格式"><span class="header-section-number">4</span> 在项目水平上控制显示格式</h2>
<p>在一个Quarto项目中，为了控制其中一个文件夹内所有quarto文档的显示格式，我们可以在这个文件夹的根目录下的_metadata.yml文件中设置format或format-links选项，如果该文件夹中没有_metadata.yml文件，我们可以新建一个该名称的文件。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
_metadata.yml
</div>
</div>
<div class="callout-body-container callout-body">
<pre><code>format:
  html:
    toc: true
  docx: default
  pdf: default</code></pre>
</div>
</div>
<p>如果你想在整个Quarto项目中设置统一的显示格式，那么我们就可以在Quarto项目的根目录下的_quarto.yml文件中设置format和format-links选项，从而在项目水平上设置输出格式以及链接的格式内容。如果你选择在_quarto.yml文件中设置输出格式，那么也意味着这个Quarto项目内的所有quarto文档均输出你所指定的格式。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
_quarto.yml
</div>
</div>
<div class="callout-body-container callout-body">
<pre><code>format:
  html:
    toc: true
  docx: default
  pdf: default</code></pre>
</div>
</div>
</section>
<section id="预览版本的quarto" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="预览版本的quarto"><span class="header-section-number">5</span> 预览版本的Quarto</h2>
<p>预览版本的Quarto可以在下面的链接中进行下载使用<a href="https://quarto.org/docs/download/">https://quarto.org/docs/download/</a>，这个链接中也列出了最新版本Quarto的一些新的特性，如果你想试试最新Quarto支持的功能，可以尝试下载使用哈。</p>


</section>

 ]]></description>
  <category>quarto</category>
  <category>个人网站</category>
  <guid>https://www.chenq.site/qsight/2023-04-04-quartomultiformat/index.html</guid>
  <pubDate>Tue, 04 Apr 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-04-04-quartomultiformat/formats.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>提高Rstudio和Quarto使用效率的一些方法和配置</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/index.html</link>
  <description><![CDATA[ 




<section id="提高quarto效率的常见配置" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="提高quarto效率的常见配置"><span class="header-section-number">1</span> 提高Quarto效率的常见配置</h2>
<p>Quarto是基于Pandoc的开源科技出版系统，我们可以利用Quarto把常规文本以及基于不同语言的数据分析过程（R、Python等）混合格式转化为静态网页、PDF、WORD文档、网站以及其他更多的格式。我也写过一篇博文介绍了<a href="https://www.chenq.site/qsight/2023-3-25-quarto-writing/">如何利用Quarto提高科技论文效率</a>，今天在这个段落介绍一下提高Quarto撰写效率的方法。</p>
<section id="利用snippets自动插入divs和spans" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="利用snippets自动插入divs和spans"><span class="header-section-number">1.1</span> 利用snippets自动插入Divs和Spans</h3>
<p>Quarto支持利用Divs和Spans来给特定的内容增加一些属性。比如，我们可以给一段话增加边框，语句如下：</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">::: {.border}</span>
<span id="cb1-2">这是具有边框样式的一段话。</span>
<span id="cb1-3">:::</span></code></pre></div>
<p>具体显示效果如下：</p>
<div class="border">
<p>这是具有边框样式的一段话。</p>
</div>
<p>我们也可以使用一些内置的callout样式，语法如下：</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">::: {.callout-warning}</span>
<span id="cb2-2">这是一段warning类型callout段落。</span>
<span id="cb2-3">:::</span></code></pre></div>
<p>具体显示效果如下：</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>这是一段warning类型callout段落的显示效果。</p>
</div>
</div>
<p>但是我们在实际使用的时候，每次录入3个”:“开头，然后紧接着是”{}“内表明具体的属性名称，最后以3个”:“结尾，这么多的字符输入很浪费时间，但是我们可以通过在Rstudio里设置snippets片段的方式来提高输入效率，snippets是自动插入代码比较好的一种方式，使我们能够比较快地在quarto文档里插入相应的代码片段。</p>
<p>下面是一些quarto文本中常用的一些snippet片段，我们可以在Rstudio里通过依次点击Tools &gt; Global Options &gt; Code &gt; Edit Code Snippets，在出现的界面中选择Markdown选项卡，然后把下面的代码片段插入到最后。</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1">snippet fragment</span>
<span id="cb3-2">    [${1:text}]{.${2:type}}</span>
<span id="cb3-3">    </span>
<span id="cb3-4">snippet aside</span>
<span id="cb3-5">    [${1:text}]{.aside}</span>
<span id="cb3-6">    </span>
<span id="cb3-7">snippet fence</span>
<span id="cb3-8">    :::{.${1:type}}</span>
<span id="cb3-9">        ${2:body}</span>
<span id="cb3-10">    :::</span>
<span id="cb3-11"></span>
<span id="cb3-12">snippet panel</span>
<span id="cb3-13">    ::: {.panel-tabset}</span>
<span id="cb3-14">        ${1:body}</span>
<span id="cb3-15">    :::</span>
<span id="cb3-16">    </span>
<span id="cb3-17">snippet column</span>
<span id="cb3-18">    :::: {.columns}</span>
<span id="cb3-19">    ::: {.column width="50%"}</span>
<span id="cb3-20">    Left column</span>
<span id="cb3-21">    :::</span>
<span id="cb3-22"></span>
<span id="cb3-23">    ::: {.column width="50%"}</span>
<span id="cb3-24">    Right column</span>
<span id="cb3-25">    :::</span>
<span id="cb3-26">    ::::</span></code></pre></div>
<p>我们在在使用的时候，在Quarto文档里输入snippet名称，然后按Shift+Tab键就可以按照设定的片段录入代码了。比如，我们可以将将内容进行分栏，可以录入column，然后按Shift+Tab键，然后相应的代码块会自动填充。</p>
</section>
<section id="善于使用echo-fenced选项" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="善于使用echo-fenced选项"><span class="header-section-number">1.2</span> 善于使用echo: fenced选项</h3>
<p>Quarto支持插入代码块从而实现一些相应的功能，而我们在利用Quarto进行写作时，有时需要把代码显示出来，从而让其他人知道相应的部分的内容的原始代码是什么样的，而在代码块的echo选项设定为fenced之后，可以把包括选项部分的设置一块显示出来。</p>
<p>在没有这是 echo: fenced时，代码块的显示是下面这样的。</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1">data <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">kable</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">kable_stylling</span>()</span></code></pre></div>
<p>设置echo: fenced之后，代码块的显示是这样的：</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;">#| label: tbl-t1</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;">#| tbl-cap: "不同地区恶性肿瘤5年相对生存率"</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;">#| tbl-location: top</span></span>
<span id="cb5-4"></span>
<span id="cb5-5">data <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;">kable</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;">kable_stylling</span>()</span></code></pre></div>
</section>
<section id="利用shortcode方便地插入内容" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="利用shortcode方便地插入内容"><span class="header-section-number">1.3</span> 利用shortcode方便地插入内容</h3>
<p>通常我们可以在quarto文档中添加HTML内容，比如通过添加视频内容等，shortcode可以使我们很方便地插入我们想插入的内容。Quarto原生支持一些shortcode，比如运行下面的代码。</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1">这篇博客的标题是`提高Rstudio和Quarto使用效率的一些方法和配置`。</span></code></pre></div>
<p>显示的内容如下：</p>
<p>这篇博客的标题是提高Rstudio和Quarto使用效率的一些方法和配置。</p>
</section>
<section id="在不同文档间重复利用内容" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="在不同文档间重复利用内容"><span class="header-section-number">1.4</span> 在不同文档间重复利用内容</h3>
<p><code>{{&lt; include &gt;}}</code>是一个quarto的shortcode使我们能够重复利用不同quarto文档的内容，而不用复制和粘贴。在你想插入内容的地方，添加shortcode <code>{{&lt; include &gt;}}</code> include后面放入想添加的文档名称，记得在名称前添加下划线。</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1">{{&lt; incldue _content.qmd &gt;}}</span></code></pre></div>
<p>也可以按照一定的条件纳入内容，比如，只在渲染为特定格式时显示内容，用.content-visible 或者 .content-hidden</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1">::: {.content-visible when-format="html"}</span>
<span id="cb8-2">这部分文字只在渲染为HTML时显示</span>
<span id="cb8-3">:::</span></code></pre></div>
</section>
</section>
<section id="善于使用快捷键" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="善于使用快捷键"><span class="header-section-number">2</span> 善于使用快捷键</h2>
<p>我们在使用Rstudio在进行统计分析时，有些使用频率非常高的操作，比如添加或者取消注释、赋值号、管道操作符、运行当前行代码、运行有所代码，从代码界面切换到Console界面，切换到Terminal界面等等，如果记住一些键盘快捷键将会大大提高操作效率，就不用在写着代码的时候到桌面上找鼠标了。下面的表格中列出了我比较常用的键盘快捷键，我们在使用的时候可以参考借鉴。</p>
<p>我们在数据分析的过程中也要保持良好的习惯，比如记得<strong>添加代码注释</strong>，通过添加注释可以使我们的代码具有更高的可读性，使代码更易于维护，帮助我们更好的理解代码的含义。</p>
<table class="table">
<caption>不同操作系统Rstudio常用快捷键</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 31%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>编号</th>
<th>操作</th>
<th>MAC OS</th>
<th>Linux 或者Windows</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>添加或者取消代码注释</td>
<td>Command + Shift + C</td>
<td>Control + Shift + C</td>
</tr>
<tr class="even">
<td>2</td>
<td>插入赋值号 &lt;-</td>
<td>Option + -</td>
<td>Alt + -</td>
</tr>
<tr class="odd">
<td>3</td>
<td>插入管道操作符 %&gt;%</td>
<td>Command + Shift + M</td>
<td>Ctrl + Shift + M</td>
</tr>
<tr class="even">
<td>4</td>
<td>运行目前行代码</td>
<td>Command + Enter</td>
<td>Control + Enter</td>
</tr>
<tr class="odd">
<td>5</td>
<td>运行所有代码</td>
<td>Command + A + Enter</td>
<td>Control + A + Enter</td>
</tr>
<tr class="even">
<td>6</td>
<td>查看Rstudio快捷键</td>
<td>Option + Shift + K</td>
<td>Alt + Shift + K</td>
</tr>
<tr class="odd">
<td>7</td>
<td>切换到代码编辑界面</td>
<td>Ctrl + 1</td>
<td>Ctrl + 1</td>
</tr>
<tr class="even">
<td>8</td>
<td>切换到Console界面</td>
<td>Ctrl + 2</td>
<td>Ctrl + 2</td>
</tr>
<tr class="odd">
<td>9</td>
<td>切换到Terminal界面</td>
<td>Option + Shift + M</td>
<td>Alt + Shift + M</td>
</tr>
<tr class="even">
<td>10</td>
<td>quarto文档插入代码块</td>
<td>Option + Comman + I</td>
<td></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
记住快捷键的小技巧
</div>
</div>
<div class="callout-body-container callout-body">
<p>一下子记住所有的快捷键肯定是有困难的，但是，我们在日常使用的时候一定要想着使用快捷键，这样即使使用的当时没有记住，但是我们通过每次的查询和使用，不出几天肯定都能熟练的记住了。</p>
</div>
</div>
</section>
<section id="不要保存工作环境变量" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="不要保存工作环境变量"><span class="header-section-number">3</span> 不要保存工作环境变量</h2>
<p>尽量不要保存Rstudio工作环境，如果您创建了值得保存的 R 对象，请将生成该对象的 R 代码保存到一个 R 脚本文件中。保存 R 脚本，但不要保存对象生成时的环境或工作空间。</p>
<p>为防止 RStudio 保存您的工作空间，请打开”首选项 &gt; 通用”并取消选择将 .RData 在启动时恢复到工作空间的选项。请确保指定您永不想保存工作空间，如下所示：</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_01473a4c653b20f076eb8f3d4b3d2968">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/global.jpg" class="img-fluid" width="527"></p>
</div>
</div>
</section>
<section id="用项目projects组织管理工作" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="用项目projects组织管理工作"><span class="header-section-number">4</span> 用项目(Projects)组织管理工作</h2>
<p>如果我们使用Rstudio进行数据分析时，一定要有<strong>项目</strong>的概念，当我们处理多个分析时，时常需要在多个分析之间来回切换，使用了项目的概念之后，我们各个分析会更有组织性。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rstudio项目
</div>
</div>
<div class="callout-body-container callout-body">
<p>RStudio Project是一个以特定目录作为根目录的工作环境，其中包含R代码、数据、图片、说明文件、结果输出等多个文件。这个根目录还包括一个用于管理项目的.Rproj文件。</p>
</div>
</div>
<p>通过创建RStudio Project，您可以将所有相关文件组织在一个目录中，使得在进行多个分析或项目时更加方便、清晰和高效。此外，RStudio Project还提供了许多其他有用的功能，例如：</p>
<ul>
<li>能够在项目之间快速切换，而无需重新打开各个文件</li>
<li>为每个项目分配单独的工作空间，从而避免命名空间冲突</li>
<li>将项目文件和支持文件打包，便于与他人共享和合作</li>
<li>可以使用renv等工具来管理项目依赖项，以确保在不同计算机上运行项目时的一致性。</li>
</ul>
<p>通过导航到 RStudio 中的”文件”选项卡并选择”新建项目”来创建新项目。您可以选择在新目录或现有目录中创建新项目。</p>
<p>但是，如果您想实现无缝协作，可能需要将软件包管理引入工作流程。幸运的是，RStudio 提供了一个有用的软件包管理工具 renv，现在与 RStudio Projects 兼容。</p>
</section>
<section id="利用renv管理r包的版本" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="利用renv管理r包的版本"><span class="header-section-number">5</span> 利用renv管理R包的版本</h2>
<p>因为R语言的开源使用，越来越多的数据科学家使用R语言来进行了数据分析和数据管理，近年来有大量的R包被上传到CRAN上，这大大方便了我们使用R语言进行数据分析，同时也加大了我们R包管理的难度。</p>
<p>使用renv来管理R包版本是一种有效的方式，以确保在不同计算机上运行R代码时的一致性和可重复性。以下是使用renv管理R包版本的步骤：</p>
<ol type="1">
<li><p>在RStudio中打开您的项目，并在终端中安装renv包。可以使用以下命令：install.packages(“renv”)</p></li>
<li><p>在RStudio的控制台或终端中，输入以下命令，以初始化renv项目：renv::init()</p></li>
<li><p>在项目的根目录中创建一个名为”renv.lock”的文件，该文件用于跟踪项目的包依赖项。可以使用以下命令创建该文件：renv::snapshot()</p></li>
<li><p>在R代码中使用renv来管理R包版本。例如，使用以下命令安装特定版本的tidyverse包：renv::install(“tidyverse@1.3.1”)</p></li>
<li><p>在renv项目中更新或添加新的R包时，使用以下命令将这些更改保存到”renv.lock”文件中：renv::snapshot()</p></li>
<li><p>当您要在另一个计算机上运行该项目时，只需将整个项目目录复制到该计算机上，并使用以下命令恢复项目的环境：renv::restore()</p></li>
</ol>
<p>通过使用renv管理R包版本，您可以确保您的项目在不同计算机上具有相同的R包版本，从而使得您的分析结果更加可靠和可重复。<i class="fa-solid fa-thumbs-up" aria-label="thumbs-up"></i></p>
</section>
<section id="配置r和rstudio启动文件" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="配置r和rstudio启动文件"><span class="header-section-number">6</span> 配置R和Rstudio启动文件</h2>
<p>在启动Rstudio和R时，软件会自动寻找几个文件，这些文件分别为.Rprofile, .Renviron, Rprofile.site, Renviron.site, rsession.conf 和 repos.conf，可以通过这些文件设置一些选项和环境变量。这一部分将介绍如何在R启动时设置特定选项。</p>
<p>下面一个表格总结了如何在启动时控制R选项和环境变量。</p>
<table class="table">
<caption>R启动文件列表</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Id</th>
<th>文件</th>
<th>需要权限</th>
<th>级别</th>
<th>限制</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>.Rprofile</td>
<td>用户或管理员</td>
<td>用户或项目</td>
<td>没有，运行R代码</td>
</tr>
<tr class="even">
<td>2</td>
<td>.Renviron</td>
<td>用户或管理员</td>
<td>用户或项目</td>
<td>只能设置环境变量</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Rprofile.site</td>
<td>管理员</td>
<td>R版本</td>
<td>没有，运行R代码</td>
</tr>
<tr class="even">
<td>4</td>
<td>Renviron.site</td>
<td>管理员</td>
<td>R版本</td>
<td>只能设置环境变量</td>
</tr>
<tr class="odd">
<td>5</td>
<td>rsession.conf</td>
<td>管理员</td>
<td>服务器</td>
<td>只能配置Rstudio设置，只能设置一个存储库</td>
</tr>
<tr class="even">
<td>6</td>
<td><code>repos.conf</code></td>
<td>管理员</td>
<td>服务器</td>
<td>只能设置存储库</td>
</tr>
</tbody>
</table>
<section id="rprofile" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="rprofile"><span class="header-section-number">6.1</span> .Rprofile</h3>
<p>.Rprofile文件是用户可控的文件，用于设置选项和环境变量。.Rprofile文件可以是用户级别或项目级别。用户级别的.Rprofile文件位于用户主目录的根目录中，项目级别的.Rprofile文件位于项目目录的根目录中。</p>
<p>R只会使用一个.Rprofile文件。因此，如果您既有一个特定于项目的.Rprofile文件，又有一个用户.Rprofile文件需要使用，则必须在项目级.Rprofile的顶部显式调用用户级.Rprofile，使用source(“~/.Rprofile”)。</p>
<p>.Rprofile文件作为常规的R代码进行调用，因此设置环境变量必须在Sys.setenv(key = “value”)调用内完成。</p>
<p>编辑.Rprofile文件的一种简单方法是在R会话中使用usethis::edit_r_profile()函数。您可以指定要编辑的用户或项目级.Rprofile。</p>
</section>
<section id="renviron" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="renviron"><span class="header-section-number">6.2</span> .Renviron</h3>
<p>.Renviron是一个可由用户控制的文件，可用于创建环境变量。这对于避免在R脚本中包含凭据（如API密钥）特别有用。该文件采用键值格式编写，因此环境变量的创建格式为：</p>
<p>Key1=value1 Key2=value2 ... 然后，在R会话中使用Sys.getenv(“Key1”)将返回”value1”。</p>
<p>与.Rprofile文件一样，.Renviron文件可以是用户级别或项目级别。如果有项目级别的.Renviron文件，则不会加载用户级别的文件。usethis包中包含一个帮助函数，可以使用usethis::edit_r_environ()从R会话中编辑.Renviron文件。</p>
</section>
<section id="rprofile.site-和renviron.site" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="rprofile.site-和renviron.site"><span class="header-section-number">6.3</span> Rprofile.site 和Renviron.site</h3>
<p>.Rprofile和.Renviron文件都有服务器范围内的等效文件。Rprofile.site和Renviron.site（没有前导点）文件由RStudio Workbench或RStudio Server上的管理员管理，并且特定于特定版本的R。这些文件的最常见设置涉及对软件包存储库的访问。例如，通常使用共享基线软件包管理策略是从Rprofile.site中完成的。</p>
<p>用户可以使用其个人.Rprofile文件覆盖这些文件中的设置。</p>
<p>这些文件针对每个版本的R进行设置，应位于R_HOME / etc /中。您可以通过在该版本的R会话中运行命令R.home（component =“home”）来找到R_HOME。因此，例如，如果您发现R_HOME是/opt/R/3.6.2/lib/R，则R 3.6.2的Rprofile.site将位于/opt/R/3.6.2/lib/R/etc/Rprofile.site中。</p>
</section>
<section id="rsession.conf和repos.conf" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="rsession.conf和repos.conf"><span class="header-section-number">6.4</span> rsession.conf和repos.conf</h3>
<p>RStudio Workbench和RStudio Server允许服务器管理员通过rsession.conf和repos.conf文件配置特定的服务器范围内的R包存储库。rsession.conf中只能配置一个存储库。如果需要多个存储库，应该使用repos.conf。</p>


</section>
</section>

 ]]></description>
  <category>quarto</category>
  <category>rstudio</category>
  <category>R</category>
  <guid>https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/index.html</guid>
  <pubDate>Fri, 31 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/shortcuts.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>论文写作效率神器：Quarto出版系统</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-3-25-quarto-writing/index.html</link>
  <description><![CDATA[ 




<section id="传统论文写作中的常见问题" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="传统论文写作中的常见问题"><span class="header-section-number">1</span> 传统论文写作中的常见问题</h2>
<p>我相信除了不需要进行统计分析的综述类文章类型之外，大部分论文类型的论文写作流程是下面 Figure&nbsp;1 这个样子的：</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>
<pre class="mermaid mermaid-js" data-label="fig-1">flowchart TD
  A[(数据清洗)] --&gt; B(统计分析)
  B --&gt; C{结果初步评估}
  C --&gt; B
  C --&gt; D(统计制表)
  D --&gt; E[论文撰写]
  E -- 发现不合理结果 --&gt; B
  E --&gt; F[论文投稿]
  F --&gt; G[专家意见]
  G -- 建议重新统计 --&gt; B
  G -- 不需要重新统计 --&gt; E
  G --&gt; H[发表见刊]
</pre>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: 论文写作流程</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
什么是传统科技论文写作？
</div>
</div>
<div class="callout-body-container callout-body">
<p>我想你在进行科技论文写作的过程中，数据分析和结果展现是割裂的过程，需要在不同的文字编辑软件里手动调整格式(比如参考文献的标注和更新、图表的交叉引用和更新、段落格式的设定等)，那么我觉这些都属于传统科技论文的写作。</p>
</div>
</div>
<p>在执行上面流程的过程中可能在论文写作及发表过程中出现很多问题，我们在各个环节都可能发现我们论文结果中存在或这或那的问题，这个是非常正常的，也是一个必然的过程，我们需要在这个过程中不断打磨数据的统计结果，使之更有说服力，更能真实展现研究的主要结果。</p>
<p>但是如果<em>需要重新进行统计分析</em>的问题在论文撰写的时候被发现或者在专家审稿的时候被发现，那意味着后面统计制表、论文撰写中相关的数据均需要更新，如果你还是在word里以复制粘贴的方式从统计软件里往word进行结果输出的话，可以想像，这个过程必定的非常痛苦的。</p>
<ul>
<li>需要付出大量时间进行复制粘贴这样没有意义的事</li>
<li>重复操作的过程中可能会出现偶尔的数据错误</li>
</ul>
</section>
<section id="quarto开源科学技术出版系统介绍" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="quarto开源科学技术出版系统介绍"><span class="header-section-number">2</span> Quarto开源科学技术出版系统介绍</h2>
<p><a href="https://quarto.org">Quarto</a>可以解决上面出现的问题，能把数据分析的过程融合进论文写作的过程中来，以<a href="https://www.markdown.xyz/basic-syntax/"><em>markdown</em></a>的格式进行文字编辑和创作，通过插入<a href="https://quarto.org/docs/reference/cells/cells-knitr.html"><em>代码段</em></a>的形式进行统计分析相关的输出，同时它可以实现参考文献的插入和应用、图表的交叉引用；在报告输出方面，它可以输出成PDF、WORD、PPT、HTML、ePub等多种格式，可以用来制作网页、书籍、科技论文、幻灯片等内容。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quarto
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://quarto.org">Quarto</a>是一个基于Pandoc的开源科学和技术出版系统，是下一代的R markdown，它以.qmd为文件后缀，quarto把内容通过knitr转化为markdown，再通过Pandoc转化为各种指定的格式。</p>
<p><img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/https:/quarto.org/docs/get-started/hello/images/rstudio-qmd-how-it-works.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="quarto的主要特点" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="quarto的主要特点"><span class="header-section-number">3</span> Quarto的主要特点</h2>
<ul>
<li>它主要用来生成不同格式的报告</li>
<li>能把R、Python、Julia和Observable等代码与文本报告整合起来，生成基于不同代码运行结果的动态报告</li>
<li>它基于markdown和pandoc进行内容的转换</li>
<li>它使用.qmd文件后缀，相对于Rmd在进行内容创作生成不同格式输出时具有统一的语法</li>
<li>它可以不依赖上面所说的软件独立运行，当你的内容创作不涉及的上面的软件时，那你只需要单独安装Quarto环境即可</li>
<li>可以与不同的代码编辑软件结合使用，<a href="https://quarto.org/docs/get-started/">Rstudio、Terminal、Vscode</a>等</li>
</ul>
</section>
<section id="quarto安装" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="quarto安装"><span class="header-section-number">4</span> Quarto安装</h2>
<p>如果你使用Rstudio的话，<a href="https://posit.co/download/rstudio-desktop/">下载最新的版本</a>，该版本内置有quarto。</p>
<p>如果你需要在R 代码进行文档渲染的话，可以安装R quarto包</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"quarto"</span>)</span>
<span id="cb1-2">quarto<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">quarto_render</span>(<span class="st" style="color: #20794D;">"hello.qmd"</span>)</span></code></pre></div>
<p>如果你需要在Vscode或者终端中使用quarto的话，可以参考<a href="https://quarto.org/docs/get-started/">不同运行环境quarto的安装与配置</a>，进行相应的配置，本篇博客将使用Rstudio进行相应的操作和介绍。</p>
</section>
<section id="新建quarto文件" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="新建quarto文件"><span class="header-section-number">5</span> 新建quarto文件</h2>
<p>在Rstudio里，点击 <em>File</em> –&gt; New Files –&gt; Quarto Document 新建一个quarto文件，该文件以.qmd为文件后缀</p>
<div class="quarto-figure quarto-figure-center aside">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/newfile.jpg" class="aside img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="quarto语法介绍" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="quarto语法介绍"><span class="header-section-number">6</span> Quarto语法介绍</h2>
<section id="yaml-信息设置" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="yaml-信息设置"><span class="header-section-number">6.1</span> YAML 信息设置</h3>
<p>Quarto通过yaml设置一些变量信息，比如作者、日期、标题等，YAML以”---“单独一行开头，然后以”---“单独一行结尾，中间可以设置一些变量信息。</p>
<p>变量设定格式：</p>
<p>变量名: 变量值</p>
<p>输出格式也在YAML里面设置，设定输出格式的变量名为：format，变量值为：html、pdf、word等。</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><span class="pp" style="color: #AD0000;">---</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;">title</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="st" style="color: #20794D;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;">author</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> 陈琼</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;">date</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> 2022-03-28</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;">categories</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb2-6"><span class="at" style="color: #657422;">  </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> 论文</span></span>
<span id="cb2-7"><span class="at" style="color: #657422;">  </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> 生存分析</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;">keywords</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb2-9"><span class="at" style="color: #657422;">  </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> 河南省</span></span>
<span id="cb2-10"><span class="at" style="color: #657422;">  </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> 恶性肿瘤</span></span>
<span id="cb2-11"><span class="at" style="color: #657422;">  </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> 现时生存分析</span></span>
<span id="cb2-12"><span class="at" style="color: #657422;">  </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> 相对生存率</span></span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;">format</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb2-14"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">html</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> default</span></span>
<span id="cb2-15"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">docx</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> default</span></span>
<span id="cb2-16"><span class="pp" style="color: #AD0000;">---</span></span></code></pre></div>
</section>
<section id="代码块" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="代码块"><span class="header-section-number">6.2</span> 代码块</h3>
<p>quarto文档中可以插入代码块，在代码块中可以进行编写相应语言的代码，进行统计分析或结果展现。目前quarto支持的代码块包括R语言、Python等，下面的R语言代码块，利用gtsummary包制作了论文中常用的表1，结果可见 Table&nbsp;1 。</p>
<div class="cell tbl-cap-location-top" data-hash="index_cache/html/tbl-table1_6b02c3f223d2d5cbfda1ad46238e90e6">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;">#| label: tbl-table1</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;">#| tbl-cap-location: top</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;">#| tbl-cap: "接受不同药物治疗人群基本特征分析"</span></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;">#| warning: false</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;">#| message: false</span></span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;">library</span>(gtsummary)</span>
<span id="cb3-9"></span>
<span id="cb3-10">trial <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">select</span>(age, grade, response, trt) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;">tbl_summary</span>(<span class="at" style="color: #657422;">by=</span>trt) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;">add_p</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;">add_overall</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;">add_n</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;">bold_labels</span>() </span>
<span id="cb3-16"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
<div class="cell-output-display">

<div id="pjntvbatiy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pjntvbatiy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pjntvbatiy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjntvbatiy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pjntvbatiy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pjntvbatiy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pjntvbatiy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjntvbatiy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjntvbatiy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pjntvbatiy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pjntvbatiy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pjntvbatiy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pjntvbatiy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pjntvbatiy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pjntvbatiy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pjntvbatiy .gt_from_md > :first-child {
  margin-top: 0;
}

#pjntvbatiy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pjntvbatiy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pjntvbatiy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pjntvbatiy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pjntvbatiy .gt_row_group_first td {
  border-top-width: 2px;
}

#pjntvbatiy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjntvbatiy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pjntvbatiy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pjntvbatiy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjntvbatiy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjntvbatiy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pjntvbatiy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pjntvbatiy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjntvbatiy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjntvbatiy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjntvbatiy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjntvbatiy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjntvbatiy .gt_left {
  text-align: left;
}

#pjntvbatiy .gt_center {
  text-align: center;
}

#pjntvbatiy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pjntvbatiy .gt_font_normal {
  font-weight: normal;
}

#pjntvbatiy .gt_font_bold {
  font-weight: bold;
}

#pjntvbatiy .gt_font_italic {
  font-style: italic;
}

#pjntvbatiy .gt_super {
  font-size: 65%;
}

#pjntvbatiy .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#pjntvbatiy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pjntvbatiy .gt_indent_1 {
  text-indent: 5px;
}

#pjntvbatiy .gt_indent_2 {
  text-indent: 10px;
}

#pjntvbatiy .gt_indent_3 {
  text-indent: 15px;
}

#pjntvbatiy .gt_indent_4 {
  text-indent: 20px;
}

#pjntvbatiy .gt_indent_5 {
  text-indent: 25px;
}
</style>

<div id="tbl-table1" class="anchored">
<table class="gt_table table table-sm table-striped" data-quarto-postprocess="true">
<caption>Table&nbsp;1: 接受不同药物治疗人群基本特征分析</caption>
<thead class="gt_col_headings">
<tr class="header">
<th id="<strong>Characteristic</strong>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="<strong>N</strong>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>N</strong></th>
<th id="<strong>Overall</strong>, N = 200<sup class=&quot;gt_footnote_marks&quot;>1</sup>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Overall</strong>, N = 200<sup>1</sup></th>
<th id="<strong>Drug A</strong>, N = 98<sup class=&quot;gt_footnote_marks&quot;>1</sup>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Drug A</strong>, N = 98<sup>1</sup></th>
<th id="<strong>Drug B</strong>, N = 102<sup class=&quot;gt_footnote_marks&quot;>1</sup>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Drug B</strong>, N = 102<sup>1</sup></th>
<th id="<strong>p-value</strong><sup class=&quot;gt_footnote_marks&quot;>2</sup>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong><sup>2</sup></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Age</td>
<td class="gt_row gt_center" headers="n">189</td>
<td class="gt_row gt_center" headers="stat_0">47 (38, 57)</td>
<td class="gt_row gt_center" headers="stat_1">46 (37, 59)</td>
<td class="gt_row gt_center" headers="stat_2">48 (39, 56)</td>
<td class="gt_row gt_center" headers="p.value">0.7</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="n"></td>
<td class="gt_row gt_center" headers="stat_0">11</td>
<td class="gt_row gt_center" headers="stat_1">7</td>
<td class="gt_row gt_center" headers="stat_2">4</td>
<td class="gt_row gt_center" headers="p.value"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Grade</td>
<td class="gt_row gt_center" headers="n">200</td>
<td class="gt_row gt_center" headers="stat_0"></td>
<td class="gt_row gt_center" headers="stat_1"></td>
<td class="gt_row gt_center" headers="stat_2"></td>
<td class="gt_row gt_center" headers="p.value">0.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;I</td>
<td class="gt_row gt_center" headers="n"></td>
<td class="gt_row gt_center" headers="stat_0">68 (34%)</td>
<td class="gt_row gt_center" headers="stat_1">35 (36%)</td>
<td class="gt_row gt_center" headers="stat_2">33 (32%)</td>
<td class="gt_row gt_center" headers="p.value"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;II</td>
<td class="gt_row gt_center" headers="n"></td>
<td class="gt_row gt_center" headers="stat_0">68 (34%)</td>
<td class="gt_row gt_center" headers="stat_1">32 (33%)</td>
<td class="gt_row gt_center" headers="stat_2">36 (35%)</td>
<td class="gt_row gt_center" headers="p.value"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;III</td>
<td class="gt_row gt_center" headers="n"></td>
<td class="gt_row gt_center" headers="stat_0">64 (32%)</td>
<td class="gt_row gt_center" headers="stat_1">31 (32%)</td>
<td class="gt_row gt_center" headers="stat_2">33 (32%)</td>
<td class="gt_row gt_center" headers="p.value"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Tumor Response</td>
<td class="gt_row gt_center" headers="n">193</td>
<td class="gt_row gt_center" headers="stat_0">61 (32%)</td>
<td class="gt_row gt_center" headers="stat_1">28 (29%)</td>
<td class="gt_row gt_center" headers="stat_2">33 (34%)</td>
<td class="gt_row gt_center" headers="p.value">0.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="n"></td>
<td class="gt_row gt_center" headers="stat_0">7</td>
<td class="gt_row gt_center" headers="stat_1">3</td>
<td class="gt_row gt_center" headers="stat_2">4</td>
<td class="gt_row gt_center" headers="p.value"></td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="6" class="gt_footnote"><sup>1</sup> Median (IQR); n (%)</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><sup>2</sup> Wilcoxon rank sum test; Pearson's Chi-squared test</td>
</tr>
</tfoot>

</table>
</div>

</div>
</div>
</div>
</section>
<section id="markdown文本" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="markdown文本"><span class="header-section-number">6.3</span> Markdown文本</h3>
<p>Rstudio提供两种模式进行文本编辑，一种是source模式，quarto参考使用markdown的基本语法，比如一级标题使用”#“，二级标题使用”##“等，具体可见<a href="https://www.markdown.xyz/basic-syntax/">markdown基本语法</a>。另一种是Visual模式，可见模式下，你不用学习许多markdown的基本语法，可以使用菜单或者快捷键进行添加标题、加粗文本、添加表格、添加图片等操作。</p>
<p>在Rstudio打开的qmd文档中，左上角可以选择source或者visual模式。</p>
<p><em>Source模式下是这样的</em> <img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/source.jpg" class="img-fluid"></p>
<p><em>Visual模式下是这样的</em> <img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/visual.jpg" class="img-fluid"></p>
</section>
</section>
<section id="输出word格式" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="输出word格式"><span class="header-section-number">7</span> 输出Word格式</h2>
<p>虽然quarto支持的输出格式很多，比如html格式、pdf格式以及word格式，你现在所浏览的网页就是用quarto来生成的。</p>
<p>回到我们今天讲的主题是“<em>科技论文的写作效率</em>”，我们撰写完成论文初稿后是需要进入投稿流程的，目前不同期刊所接受的投稿格式还是以word为多，下面就展开来讲一下quarto如何输出word格式。</p>
<section id="利用word模板文件" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="利用word模板文件"><span class="header-section-number">7.1</span> 利用word模板文件</h3>
<p>在quarto文档的YAML部分，通过format设置为输出word格式，还可以设置word模板文件，输出结果会按照word模板的格式对各个部分进行设置。</p>
<p>YAML设置部分代码如下：</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="pp" style="color: #AD0000;">---</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;">title</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="st" style="color: #20794D;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;">format</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span></span>
<span id="cb4-4"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">docx</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;">  #reference-doc制定word模板文件</span></span>
<span id="cb4-6"><span class="at" style="color: #657422;">    </span><span class="fu" style="color: #4758AB;">reference-doc</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> chinese.docx</span></span>
<span id="cb4-7"><span class="pp" style="color: #AD0000;">---</span></span></code></pre></div>
</section>
<section id="图表交叉引用的相关设置" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="图表交叉引用的相关设置"><span class="header-section-number">7.2</span> 图表交叉引用的相关设置</h3>
<p>通过crossref设置交叉引用图表的格式，fig-title设置的是图标题前显示字符，tbl-title设置表格标题前的显示字符，title-delim设置图表序号和显示字符之间的连接符号。</p>
<p>tbl-frefix设置在文本中引用时的显示格式：如表1、表2，图1、图2</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><span class="pp" style="color: #AD0000;">---</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">title</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="st" style="color: #20794D;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;">crossref</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb5-4"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">fig-title</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> 图     </span></span>
<span id="cb5-5"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">tbl-title</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> 表     </span></span>
<span id="cb5-6"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">title-delim</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> —  </span></span>
<span id="cb5-7"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">tbl-prefix</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> 表</span></span>
<span id="cb5-8"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">fig-prefix</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> 图</span></span>
<span id="cb5-9"><span class="pp" style="color: #AD0000;">---</span></span></code></pre></div>
</section>
<section id="设置参考文献引用格式" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="设置参考文献引用格式"><span class="header-section-number">7.3</span> 设置参考文献引用格式</h3>
<p>参考文献的引用时论文写作时候的一个大问题，我们在使用quarto进行科技论文写作的时候，需要在YAML里进行两个设置才能进行参考文献的引用和格式的设置。</p>
<ul>
<li>通过 bibliography: 指定bibtex格式文献的存放位置</li>
<li>通过csl: 指定参考文献的引用格式</li>
</ul>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><span class="pp" style="color: #AD0000;">---</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">title</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="st" style="color: #20794D;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;">bibliography</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> survival17-19.bib</span></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;">csl</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="st" style="color: #20794D;">"/Users/qc0824/zotero/styles/chinese-gb7714-2005-numeric.csl"</span></span>
<span id="cb6-5"><span class="pp" style="color: #AD0000;">---</span></span></code></pre></div>
<p>在文本编辑时，通过[“<span class="citation" data-cites="refid">@refid</span>”]的形式进行参考文献的文内引用，如果同一位置引用多篇文献，[“<span class="citation" data-cites="refid1">@refid1</span>;<span class="citation" data-cites="refid2">@refid2</span>”]，可以在文献之间添加”;“。</p>
</section>
<section id="设置作者列表和单位信息" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="设置作者列表和单位信息"><span class="header-section-number">7.4</span> 设置作者列表和单位信息</h3>
<p>在论文投稿时，需要在标题下方列出各位作者的信息，包括姓名，作者单位，通讯作者等，姓名上标标注作者的单位信息。</p>
<p>quarto里可以通过安装一个<strong>authors-block</strong>插件来实现。</p>
<section id="安装方法" class="level5" data-number="7.4.0.1">
<h5 data-number="7.4.0.1" class="anchored" data-anchor-id="安装方法"><span class="header-section-number">7.4.0.1</span> 安装方法</h5>
<p>在qmd文档所在的quarto项目之下，在terminal运行如下命令：</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1">quarto add kapsner/authors-block</span></code></pre></div>
</section>
<section id="authors-block使用方法" class="level5" data-number="7.4.0.2">
<h5 data-number="7.4.0.2" class="anchored" data-anchor-id="authors-block使用方法"><span class="header-section-number">7.4.0.2</span> authors-block使用方法</h5>
<p>安装好authos-block插件之后，需要在YAML里设置相应的元数据，具体如下。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
authors-block设置方法
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1">---</span>
<span id="cb8-2">title: "河南省恶性肿瘤2017-2019年5年相对生存率"</span>
<span id="cb8-3">authors:</span>
<span id="cb8-4">  - name: 陈琼</span>
<span id="cb8-5">    affiliations:</span>
<span id="cb8-6">      - ref: zlyy</span>
<span id="cb8-7">    email: chenqiong@hnccr.org.cn</span>
<span id="cb8-8">  - name: 张明霞</span>
<span id="cb8-9">    affiliations:</span>
<span id="cb8-10">      - ref: lzu</span>
<span id="cb8-11">  - name: 郭兰伟</span>
<span id="cb8-12">    affiliaitons:</span>
<span id="cb8-13">      - ref: zlyy</span>
<span id="cb8-14">  - name: 刘纯亚</span>
<span id="cb8-15">    affiliations:</span>
<span id="cb8-16">      - ref: zlyy</span>
<span id="cb8-17">  - name: 刘茵</span>
<span id="cb8-18">    affiliations:</span>
<span id="cb8-19">      - ref: zlyy</span>
<span id="cb8-20">  - name: 徐慧芳</span>
<span id="cb8-21">    affiliations:</span>
<span id="cb8-22">      - ref: zlyy</span>
<span id="cb8-23">  - name: 王潇杨</span>
<span id="cb8-24">    affiliations:</span>
<span id="cb8-25">      - ref: zlyy</span>
<span id="cb8-26">  - name: 刘曙正</span>
<span id="cb8-27">    affiliations:</span>
<span id="cb8-28">      - ref: zlyy</span>
<span id="cb8-29">  - name: 张韶凯</span>
<span id="cb8-30">    affiliations:</span>
<span id="cb8-31">      - ref: zlyy</span>
<span id="cb8-32">    coresponding: true</span>
<span id="cb8-33">affiliations:</span>
<span id="cb8-34">  - id: zlyy</span>
<span id="cb8-35">    name: 郑州大学附属肿瘤医院(河南省肿瘤医院)，疾病预防控制科</span>
<span id="cb8-36">  - id: lzu</span>
<span id="cb8-37">    name: 兰州大学公共卫生学院</span>
<span id="cb8-38">filters:</span>
<span id="cb8-39">  - authors-block</span>
<span id="cb8-40">---</span></code></pre></div>
</div>
</div>
</div>
<p><img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/authors-block.jpg" class="img-fluid"></p>
</section>
</section>
</section>
<section id="渲染输出格式" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="渲染输出格式"><span class="header-section-number">8</span> 渲染输出格式</h2>
<p><img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/render.jpg" class="img-fluid"></p>
<p>在完成以上步骤之后，只需要点击上图标注的render按钮即可，然后一篇word格式的，随时可以进行投稿论文初稿就完成了。</p>
<p>如果你在撰写讨论部分的时候，发现统计的某个指标可能存在异常，那么我们只需要在相应的代码块里更新相应的统计代码，更新完成之后，再次点击render，那么你的统计表格就会跟着更新，再次生成基于新结果的论文初稿。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
什么是render？
</div>
</div>
<div class="callout-body-container callout-body">
<p>其实就是quarto运行的过程，通过kintr包把qmd转化为普通的markdown，在通过pandoc转化为word格式的过程。</p>
</div>
</div>
<p>如果你看完以上内容，有没有想试一试Quarto系统的冲动？本篇博客只是介绍了Quarto应用于论文写作方面，它还有其他很多的应用方式，比如做幻灯、写书稿等等，如果你还有一些闲暇时间，不妨来试试！</p>


</section>

 ]]></description>
  <category>quarto</category>
  <category>论文写作</category>
  <guid>https://www.chenq.site/qsight/2023-3-25-quarto-writing/index.html</guid>
  <pubDate>Sat, 25 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-3-25-quarto-writing/writing.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>肿瘤临床预后影响因素分析应该注意哪些因素?</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-03-21-肿瘤临床预后影响因素分析应该注意哪些因素/index.html</link>
  <description><![CDATA[ 




<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
肿瘤预后影响因素分析，下面这些问题你考虑过吗？
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>怎样才能确定因素是否为预后独立影响因素？</li>
<li>如何筛选潜在的混杂因素？</li>
<li>如何判断模型拟合效果？</li>
<li>需要使用哪个统计模型？</li>
<li>结果数据该如何展现？</li>
</ul>
</div>
</div>
</div>
<p>今天我所审读的这篇论文题目是“淋巴瘤临床流行病学特点及利妥昔单抗和BTK抑制剂应用对预后影响”的文章，由于该文章正处于投稿阶段，不能把文章展示出来，但是这篇文章存在的一些问题是目前肿瘤预后分析时一些常见的问题，也是一些共性的问题，今天在这里分享一下我的一些观点和看法，如果刚好你也在进行相关的研究或者数据分析，不妨停下来看一看，说不定对你有所帮助。</p>
<p>临床上肿瘤预后影响因素分析的文章有很多，大多为分析治疗因素对预后的影响，预后的指标多为总体生存和无进展生存。我看过一些临床的论文，得出的最后结论提示某某因素是某癌症预后的<strong>独立</strong>影响因素，那你有没有想过什么是独立的预后影响因素？达到什么样的条件才能成为独立的预后影响因素？</p>
<p>我们先把这个问题放到一边，先从临床的角度想一想，癌症的预后可能与哪些因素有关系？除了治疗因素之外，癌症诊断时的临床分期、病理类型、患者的基础状态以及其他的一些流行病学因素可能均与癌症的预后有关系，这些因素可能在一定程度上影响着患者的总体生存（OS）或者无进展生存（PFS），但是它们对预后影响的效应可能大小不一。</p>
<p>当我们把焦点聚焦到某一个因素上时，比如治疗因素时，我们想通过收集的数据分析一下治疗因素对预后影响的效应大小，那么我们就需要把其他可能影响因素效应排除在外，即把治疗因素以外因素的效应调整之后，才能显示出来治疗因素对预后影响的真实效应。</p>
<p>那从流行病学的角度来讲的话，上面所说的过程就是<strong>去除混杂因素</strong>的过程，简单的说，所研究因素之外，可能对研究结局产生影响的因素就是混杂因素。那在实际数据分析的过程中，怎么判断哪些因素是混杂因素需要调整，而哪些因素不是混杂因素而不需要调整呢？</p>
<p>我觉得可以从两个方面来判断，首先是从专业方面，我们可以通过阅读文献来了解目前证据所支持的所研究结局的影响因素有哪些？这些可能都是<strong>潜在</strong>的混杂因素。我们知道了这些因素之后，在数据收集阶段应该尽可能的把这些因素收集上来，以备后面的分析来用；第二个方面，就是利用自己研究所收集的数据来探索分析，通常按照<em>研究因素分层</em>来看其他不同的因素在不同层间是否分布均衡，如果不均衡的话，那么就需要这些层间不均衡分布的因素，也列入潜在的混杂因素清单，需要纳入调整模型进行校正。</p>
<p>那我们再从统计的角度来说，临床上常用的预后影响因素分析的统计学方法为Cox比例风险回归模型。这个阶段已经数据分析的最后阶段了，我们把所研究因素（治疗方法）作为自变量，把潜在的混杂因素作为协变量，把结局因素（生存状态，生存时间）作为因变量纳入Cox比例风险回归模型进行模型的拟合。调整了协变量的影响之后，研究因素与结局之间的关系，通常用HR来表示，才是真正的研究因素对研究结局的效应大小。</p>
<p>当然在这一步骤里，有人会问：“所有这些潜在的混杂因素最终都要放入模型吗，有没有一些潜在的混杂因素会剔除出模型？”</p>
<p>答案是会的，有一些潜在混杂因素会剔除出模型，主要还是要看模型拟合的情况。如果研究样本量不大，而潜在的混杂因素又很多的时候，我们就需要评估纳入哪些变量以使模型的拟合效果更好(<img src="https://latex.codecogs.com/png.latex?R%5E2">)。或者通过把这个变量纳入和剔除模型前后对研究因素对结局变量效应值的影响大小来判断，如果变化超过10%，那么我们可以考虑纳入模型，反之则剔除出模型。</p>
<p>现在再回到前面第二段的问题，什么样的因素才是癌症预后独立的影响因素呢？</p>
<p>如果你认真看完了上面的几段，我想答案应该显而易见了，所谓癌症预后的独立影响因素应该是排除了研究因素与研究结局之间除了研究因素以外的所有干扰因素之后，研究因素仍然对结局有影响，那么我们可以成为这个研究因素是结局的独立影响因素。</p>
<p>以上的过程是我所理解的肿瘤临床预后影响因素分析的大概过程，这个过程虽然听起来挺简单的，但是总会有各种各样的问题出现。比如统计方法的使用是否合适、该展示的数据没有展示出来等等。</p>
<p>数据分析完成之后，我们就需要以论文或者报告的形式把分析的结果展示出来。我们都知道任何一项研究都不可能做到非常完美，但是我们所能做的就是尽可能得调整混杂因素，去伪存真，展示真实的结局。</p>
<p>在论文撰写的时候，我们要向读者展示出来，所有可能影响结果的地方，我都已经考虑了，而且进行了调整，而有些内容确实没有办法做，我们可以把它列入研究存在的不足和限制方面。如果能做到这一点，我相信你的论文应该是一篇质量很高的论文，还愁发表吗？</p>
<p>这就是我对临床肿瘤预后分析的一点理解，如果你有不同的见解请告诉我，将不胜感激！</p>



 ]]></description>
  <category>数据分析</category>
  <guid>https://www.chenq.site/qsight/2023-03-21-肿瘤临床预后影响因素分析应该注意哪些因素/index.html</guid>
  <pubDate>Tue, 21 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-03-21-肿瘤临床预后影响因素分析应该注意哪些因素/preview.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>开发R包一定要有一个高逼格logo</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-02-27-create-logo/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-02-27-create-logo/canregtools.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">canregtools</figcaption><p></p>
</figure>
</div>
<p>自从我参加工作以来，一直使用SAS统计软件协助分析肿瘤登记数据。在这段时间内，我积累了大量的SAS宏和程序，对我的工作产生了很大的帮助。比如说，肿瘤数据的逻辑核查功能、报告数据生成功能、制作肿瘤登记年报等，这些程序在很大程度上提高了工作效率。但是，与R语言或Stata软件不同，SAS公司没有以包的形式分享相关的函数或功能，这也带来了很多不便。跟同事分享SAS分享程序时，可能因为系统环境或者其他因素的不同，造成程序不能执行。R包的制作有严格的流程和要求，能够很大程度上避免这种情况的发生。</p>
<p>今年年初定下的目标就是利用休息时间把这个包付出实践，最近这几天制作了其中的一个函数classify_icd10()，以后有时间再逐步完善相关的功能。虽然现在只有这一个函数，但是麻雀虽小五脏俱全。包的名字从cnCanreg到PBCRtools，再到canregtools，已经换了三次了，最终采用canregtools。<a href="https://github.com/gigu003/canregtools">canregtools</a>的代码托管到了<a href="https://github.com/gigu003">github</a>上，以方便代码管理。制作了<a href="https://gigu003.github.io/canregtools/">canregtools网站</a>，方便使用者查找并使用相关功能。</p>
<p>为了提高逼格，还制作了canregtools的logo，把一个癌细胞的图片和河南省癌症的年龄别发病率曲线整合到一块，最后制作成了六角的logo。</p>
<p>下面跟大家分享一下制作这个logo的代码。</p>
<section id="制作癌症年龄别发病率折线图" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="制作癌症年龄别发病率折线图"><span class="header-section-number">1</span> 制作癌症年龄别发病率折线图</h2>
<p>首先，读入年龄别发病率的数据，然后，利用ggplot2制作折线图，重点是要把图片背景设置成透明。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># 加载tidyverse包 </span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;"># 读取年龄别发病率数据</span></span>
<span id="cb1-4">data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read.csv</span>(<span class="st" style="color: #20794D;">"data.csv"</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   sex agegrp incidence
1 Male      0     15.06
2 Male      1     11.78
3 Male      5     11.51
4 Male     10     11.56
5 Male     15     14.92
6 Male     20     15.37</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;">#绘制癌症年龄别发病率折线图</span></span>
<span id="cb3-2">pic <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb3-3">  data <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>agegrp,<span class="at" style="color: #657422;">y=</span>incidence,<span class="at" style="color: #657422;">color=</span>sex))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">size=</span><span class="fl" style="color: #AD0000;">0.2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"Cancer Incidence"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"Age groups (years)"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;">theme_void</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>,</span>
<span id="cb3-10">        <span class="at" style="color: #657422;">plot.background =</span> <span class="fu" style="color: #4758AB;">element_blank</span>()</span>
<span id="cb3-11">        )</span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="fu" style="color: #4758AB;">plot</span>(pic)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2023-02-27-create-logo/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="把肿瘤细胞图片读入r中" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="把肿瘤细胞图片读入r中"><span class="header-section-number">2</span> 把肿瘤细胞图片读入R中</h2>
<p>我从google上搜索了一张癌细胞的图片，并利用在线工具把这张图片的背景去除。然后，利用magick包读取图片进入R环境中，转化成ggplot2可识别的元素，最后，以注释的方式加入前面生成折线图中。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">library</span>(magick)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to ImageMagick 6.9.12.3
Enabled features: cairo, fontconfig, freetype, heic, lcms, pango, raw, rsvg, webp
Disabled features: fftw, ghostscript, x11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;"># 读取肿瘤细胞的图片</span></span>
<span id="cb6-2">pcs <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">image_read</span>(<span class="st" style="color: #20794D;">"cancer-cell.png"</span>)</span>
<span id="cb6-3">image <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">image_fill</span>(pcs,<span class="st" style="color: #20794D;">"none"</span>)</span>
<span id="cb6-4">raster <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.raster</span>(image)</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;"># 把肿瘤细胞的图片添加到ggplot2绘制的折线图上</span></span>
<span id="cb6-7">myplot <span class="ot" style="color: #003B4F;">&lt;-</span> pic <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;">annotation_raster</span>(<span class="at" style="color: #657422;">raster =</span> raster, <span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">30</span>, <span class="dv" style="color: #AD0000;">100</span>, <span class="dv" style="color: #AD0000;">700</span>)</span>
<span id="cb6-9">myplot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2023-02-27-create-logo/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="制作六角r包logo" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="制作六角r包logo"><span class="header-section-number">3</span> 制作六角R包logo</h2>
<p>最后利用hexSticker包制作logo，具体语句如下。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;">library</span>(hexSticker)</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;">sticker</span>(</span>
<span id="cb7-4">  pic,</span>
<span id="cb7-5">  <span class="at" style="color: #657422;">s_x =</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb7-6">  <span class="at" style="color: #657422;">s_y =</span> <span class="fl" style="color: #AD0000;">0.8</span>,</span>
<span id="cb7-7">  <span class="at" style="color: #657422;">s_width =</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb7-8">  <span class="at" style="color: #657422;">s_height =</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb7-9">  <span class="at" style="color: #657422;">package =</span> <span class="st" style="color: #20794D;">"canregtools"</span>,</span>
<span id="cb7-10">  <span class="at" style="color: #657422;">p_size =</span> <span class="dv" style="color: #AD0000;">23</span>,</span>
<span id="cb7-11">  <span class="at" style="color: #657422;">p_color =</span> <span class="st" style="color: #20794D;">"#f5f5f5"</span>,</span>
<span id="cb7-12">  <span class="at" style="color: #657422;">p_fontface =</span> <span class="st" style="color: #20794D;">"bold"</span>,</span>
<span id="cb7-13">  <span class="at" style="color: #657422;">p_family =</span> <span class="st" style="color: #20794D;">"STKaiti"</span>,</span>
<span id="cb7-14">  <span class="at" style="color: #657422;">h_fill =</span> <span class="st" style="color: #20794D;">"#3fc1c9"</span>,</span>
<span id="cb7-15">  <span class="at" style="color: #657422;">h_color =</span> <span class="st" style="color: #20794D;">"#364f6b"</span>,</span>
<span id="cb7-16">  <span class="at" style="color: #657422;">h_size =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb7-17">  <span class="at" style="color: #657422;">url =</span> <span class="st" style="color: #20794D;">"packages.chenq.site/canregtools"</span>,</span>
<span id="cb7-18">  <span class="at" style="color: #657422;">u_size =</span> <span class="dv" style="color: #AD0000;">5</span>,</span>
<span id="cb7-19">  <span class="at" style="color: #657422;">u_color =</span> <span class="st" style="color: #20794D;">"#fc5185"</span>,</span>
<span id="cb7-20">  <span class="at" style="color: #657422;">spotlight =</span> T,</span>
<span id="cb7-21">  <span class="at" style="color: #657422;">l_y =</span> <span class="fl" style="color: #AD0000;">1.8</span>,</span>
<span id="cb7-22">  <span class="at" style="color: #657422;">l_x =</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb7-23">  <span class="at" style="color: #657422;">l_width =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb7-24">  <span class="at" style="color: #657422;">l_height =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb7-25">  <span class="at" style="color: #657422;">l_alpha =</span> .<span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb7-26">  <span class="at" style="color: #657422;">filename =</span><span class="st" style="color: #20794D;">"dddd.png"</span>,</span>
<span id="cb7-27">  <span class="at" style="color: #657422;">dpi =</span><span class="st" style="color: #20794D;">"retina"</span>)</span>
<span id="cb7-28"><span class="fu" style="color: #4758AB;">getwd</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/Users/qc0824/Website/chenq.site/qsight/2023-02-27-create-logo"</code></pre>
</div>
</div>
<p>效果怎么样？对于审美感不足的我来说， 还算可以吧！</p>


</section>

 ]]></description>
  <category>个人网站</category>
  <guid>https://www.chenq.site/qsight/2023-02-27-create-logo/index.html</guid>
  <pubDate>Mon, 27 Feb 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-02-27-create-logo/00005b.png" medium="image" type="image/png" height="89" width="144"/>
</item>
<item>
  <title>2023年给我的开年惊喜</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2023-02-08-paper-award/index.html</link>
  <description><![CDATA[ 




<p>多舛的2022年<strong>终于</strong>过去了，2023年也伴随着一次全民的新冠感染重磅出场。本想着2023年还是像以往一样，单调、乏味，但是生活还是给了我一个小惊喜。</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-02-08-paper-award/images/award.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><strong>2012-2021年中国肿瘤杂志-卓越论文奖励证书</strong></figcaption><p></p>
</figure>
</div>
</div></div><p>2023年1月12日我收到了《中国肿瘤》发来的email，说我得到了杂志社颁发的“卓越论文奖”的奖项。收到这个email心里还是非常高兴的，比以往获得的任何奖励都高兴。</p>
<p>首先，高兴来自于“未知”，以往也得到过一些小小的荣誉，比如什么”肿瘤防控先进个人”、“全国肿瘤登记先进个人” 等，但是这些荣誉都是通过申请得来的，也就是说需要向颁发单位申请，说明你做了哪些工作，取得了哪些成绩等等，得到了这个荣誉之后也没有了太多的兴奋和高兴。但是这次不一样，这个奖项没有经过这些<strong>申报</strong>程序，得到这个消息时，还是感到意外和惊喜。</p>
<p>其次，高兴来自于”用心“，这个将项的评审杂志社还是挺用心的。首先，通过“论文引用量”这个定量指标对论文进行初步的定量评价，然后再通过专家对论文盲审从而进行定性评价，最后评选出各级别的奖项，所以杂志社是在用心组织评选论文的，收到这个将项还是很有满足感的。</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-02-08-paper-award/images/email.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><strong>中国肿瘤杂志编辑部来信</strong></figcaption><p></p>
</figure>
</div>
</div></div><p>同时，高兴还来自于“回忆”，这个篇论文是我刚参加工作的第二年写的，是我参加国家肿瘤防治研究办公室的一项工作的产出，这项工作是编写全国2003-2007年恶性肿瘤发病死亡报告，这项目工作是全国第一次5年合计的恶性肿瘤发病死亡报告，所以还是有非常重要的意义的。</p>
<p>当我打开Email看到是关于这项工作的内容时，思绪也一下回到了10年前。那时，我刚参加工作，对未来充满憧憬，也对一切都很感兴趣，希望学习新东西。打开Email使我回忆起了10年前的失落和美好，也回忆起了那时的一些人和事儿。这些突然来的一些记忆就变得很美好。</p>
<p>高兴劲儿过去之后，沉下心来想想为什么能得到这个奖项。其实并不是这篇论文写的有多么的好，而是论文提供的数据是当时研究者们比较关注的内容。10年前是中国生活方式相关的肿瘤发病率抬头开始上升的阶段，研究者们也非常希望获取相关的信息。</p>
<p>能够得到这个奖励，我还是要感谢一下国家肿瘤防办的老师能让我参与这个项目，感谢孙主任对论文写作的指导，感谢杂志社的鼓励，今后要戒骄戒躁，沉下心来，继续努力。</p>



 ]]></description>
  <category>生活</category>
  <category>论文写作</category>
  <guid>https://www.chenq.site/qsight/2023-02-08-paper-award/index.html</guid>
  <pubDate>Wed, 08 Feb 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-02-08-paper-award/images/award.png" medium="image" type="image/png" height="101" width="144"/>
</item>
<item>
  <title>可重复式研究报告:从blogdown,bookdown,pagedown到Quarto</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-12-05-rmd-to-quarto/index.html</link>
  <description><![CDATA[ 




<section id="传统写作的困境" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="传统写作的困境"><span class="header-section-number">1</span> 传统写作的困境</h2>
<p>研究项目立项–&gt;&gt;收集数据–&gt;&gt;整理数据–&gt;&gt;分析数据–&gt;&gt;撰写论文/报告</p>
<p>这应该是很多研究者的开展研究工作的基本流程，但是研究工作并不总是一帆顺利地沿着这个方向进行。 我们可能已经撰写完成研究报告，但是收集的数据有了更新，或者需要纳入更多的研究对象，再或者原先某些缺失的数据通过其它渠道进行了补充，那么我们就<strong>需要更新研究报告/论</strong>，再重新分析数据，各种统计过程必须要重新来过，然后再把统计结果一点一点粘贴到word里，是不是想想这个过程就很头疼。</p>
<p>这是我们在用office套件，比如word、excel、powerpoint等软件在撰写报告时非常常见的情形。</p>
</section>
<section id="可重复性报告" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="可重复性报告"><span class="header-section-number">2</span> 可重复性报告</h2>
<p>但是Rmd/rmarkown文档及<a href="https://yihui.org/knitr/">knitr</a>的出现解决了这一问题，Rmd格式文档通过把通用的markdown和嵌入的R语言代码块结合起来，通过knitr包把rmd文档编译成统一的md文档，然后再通过pandoc转成各种格式，如html、PDF、Word、slides等。</p>
<p><img src="https://www.chenq.site/qsight/2022-12-05-rmd-to-quarto/rmd-pipeline-pandoc.png" class="img-fluid" alt="rmd-pipeline-pandoc"></p>
<p>这样我们在写研究报告的时候，就可以利用rmd把统计过程整合到统计报告的撰写中来，如果原始数据有变化，只需要重新执行一次编译过程就能更新整个研究报告了。 其实这个过程也就是我们所说的可重复性数据分析或者可重复性报告。</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
可重复性报告/可重复性数据分析
</div>
</div>
<div class="callout-body-container callout-body">
<p>我们所说的可重复性报告是指利用代码把数据分析过程串起来，最终生成可重复性的报告。其实说到可重复性报告，应该首先说下<strong>文学编程</strong>，它是一种理念，强调以自然语言呈现计算逻辑，文本和代码相互混合的方式，并且从计算机代码的执行逻辑过渡到人的思维逻辑。我们现在使用的R Sweave，R markdown，以及J’upyter都是实现<strong>文学编程</strong>的具体方式。</p>
</div>
</div>
</section>
<section id="r-markdown" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="r-markdown"><span class="header-section-number">3</span> R markdown</h2>
<p>R markdown 是R实现可重复性数据分析/报告的主要生产力工具，自诞生以来，在Rstudio的加持下，其周边生态越来越完善，实现的功能也越来越多。比如做网站、博客、制作幻灯片、写书、写论文等。</p>
<p><img src="https://www.chenq.site/qsight/2022-12-05-rmd-to-quarto/rmd-packages.png" class="img-fluid" alt="rmd-packages"></p>
<p>blogdown包可以结合hugo生成比较漂亮的网站或博客网站，bookdown可以生成各种形式的书籍包括word,pdf,epub,html等，xaringan可以做出容易在网络分享的漂亮幻灯片。</p>
<p>但是R markdown也存在一些缺点，虽然这些包能够实现非常强大的功能，但是各种包之间缺乏统一的语法，实现同一功能的语法各有不同，对于使用者来说，需要付出很大的时间成本在各种包之间切换并记住不同的语法去实现不同的功能。</p>
</section>
<section id="从r-markdown到quarto" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="从r-markdown到quarto"><span class="header-section-number">4</span> 从R markdown到Quarto</h2>
<p>估计是看到文学编程的巨大潜力，在Rstudio的支持下，<strong>Quarto</strong>应运而生，官网给它的定义是：“基于pandoc的开源科学与技术出版系统”。</p>
<blockquote class="blockquote">
<p>Quarto® is an open-source scientific and technical publishing system built on Pandoc</p>
</blockquote>
<p><img src="https://www.chenq.site/qsight/2022-12-05-rmd-to-quarto/quarto.jpg" class="img-fluid" alt="quarto"></p>
<p><strong>Quarto</strong>相比于R markdown具有如下特点：</p>
<ul>
<li>它<em>可以</em>独立于R、Rstudio或者其他软件如python等编程或统计软件，支持在Macos、Linux、Windows系统运行；</li>
<li>Quarto继承了一些Rmd包的特点、如blogdown、bookdown、xaringan等；</li>
<li>在生成website、blog、book、slides等各种格式中有了统一的语法，缩小了使用者的学习成本；</li>
<li>支持的语言包括R、Python、Julia和Observable；</li>
<li>quarto有了新的文档格式，文档扩展名为“.qmd”, 代码块选项的形式有了变化。</li>
<li>支持科技写作的特征，如公式、引用、交叉引用、图、表等。</li>
</ul>
<p>对于本人来说，促使我从R markdown转换到Quarto的最主要的因素是<strong>统一的语法</strong>，在我使用Quarto进行内容创作输出website的时候，不必再学习一遍新的语法去生成幻灯片，这就大大缩小了使用的时间成本。</p>
<p>首先，我把自己的个人网站从原来的Blogdown+Hugo的生成方式转换到单独利用Quarto的生成方式，这样我就可以利用上面所说的各种quarto的优点和新的特性了。但是相比与原来的blogdown+hugo的方式，quarto渲染网页的速度比hugo慢了不少，但是对于我来说，完全可以接受。</p>
<p>Quarto 有一点比较好，就是对R markdown格式文档的支持，这样你就不必把以前编写的Rmd文档全部改写成.qmd文档。</p>
<p>今天的总结到此为止吧，后面我会逐步把利用quarto进行科技写作或生成幻灯片中遇到的问题分享给大家。</p>


</section>

 ]]></description>
  <category>quarto</category>
  <guid>https://www.chenq.site/qsight/2022-12-05-rmd-to-quarto/index.html</guid>
  <pubDate>Mon, 05 Dec 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-12-05-rmd-to-quarto/quarto.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>如何安装quarto运行环境，并通过命令行建立简单的网站</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-12-02-quarto-install/index.html</link>
  <description><![CDATA[ 




<p>Quarto考虑了各种运行环境，你可以直接用各类文本编辑器配合终端命令行直接运行quarto命令，可以用Rstudio运行，当然也可以用比较流行的vscode来运行。</p>
<p>点击下面的链接，根据自己的系统环境下载相应的quarto版本。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://quarto.org/docs/get-started/index.html"><img src="https://www.chenq.site/qsight/2022-12-02-quarto-install/quarto.jpg" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>安装完成后，测试一下，是否成功安装。</p>
<p>如果是MacOS，打开终端，输入如下命令：quarto -v 显示quarto的版本号，如果在命令行下面显示相应的版本号，则证明正确安装。</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">quarto -v </span></code></pre></div>
<p>如果是windows操作系统，打开CMD，输入如下命令: quarto -v ，同样如果显示版本号，则证明已正确安装。</p>
<p>可以用<code>quarto -h</code>命令来查看常见的quarto命令。</p>
<p><img src="https://www.chenq.site/qsight/2022-12-02-quarto-install/help.jpg" class="img-fluid" alt="常见quarto命令"> Quarto融合了Blogdown、Bookdown、xaringan等基于rmd包的优势，可以不用基于这些包，直接建立网站，博客，或者幻灯片。</p>
<p>下面我们直接以网站为例，利用 create-project 命令建立一个website project。</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">quarto create-project chen --type website</span></code></pre></div>
<p>上面的命令在文件夹chen下面建立了一个类型为website的quarto project</p>
<p>会生成如下几个文件：</p>
<ul>
<li>quarto.yaml</li>
<li>about.qmd</li>
<li>index.qmd</li>
<li>styles.css</li>
</ul>
<p>我们可以用以下命令来看看这些文件是否已经生成:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource terminal number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1">cd chen</span>
<span id="cb3-2">ls</span></code></pre></div>
<p>如果已经正常生成，则可以用preview 命令来预览一下，quarto建立的默认的网站的样子。</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1">quarto preview</span></code></pre></div>
<p><img src="https://www.chenq.site/qsight/2022-12-02-quarto-install/preview.jpg" class="img-fluid" alt="quarto preview"></p>
<p>从上面的结果可以看出，preview把生成的网页配置到http://localhost:3070/,把该地址粘贴到浏览器地址栏中就可以看到，网页的样子了。 <img src="https://www.chenq.site/qsight/2022-12-02-quarto-install/website.jpg" class="img-fluid" alt="preview website"></p>
<p>通过上面的简单的命令，就通过命令行建立的一个简单的网站，你还可以通过设置_quarto.yml 来配置更为附在的网站。</p>
<p>通过纯命令行只是建立quarto website的一种方式，还可以通过Rstudio的菜单，VScode来建立网站。</p>



 ]]></description>
  <category>quarto</category>
  <guid>https://www.chenq.site/qsight/2022-12-02-quarto-install/index.html</guid>
  <pubDate>Fri, 02 Dec 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-12-02-quarto-install/quarto.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>git 如何设置忽略文件.gitignore</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-12-01-gitignore/index.html</link>
  <description><![CDATA[ 




<section id="忽略.ds_store" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="忽略.ds_store"><span class="header-section-number">1</span> 忽略.DS_Store</h2>
<p>git按照工作环境里的.gitignore文件设置去忽略相应的文件，如果你的git环境里还没有创建.gitignore文件,则需要首先创建该文件。</p>
<p>在terminal里创建.gitignore文件，并用vim添加两行。</p>
<ul>
<li>.DS_Store</li>
<li>*/.DS_Store</li>
</ul>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource git number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">touch .gitignore</span>
<span id="cb1-2">vim .gitignore</span></code></pre></div>
<p>如果发现修改中仍然有.DS_Store文件，则可能原因是在早期的提交中就已将.DS_Store文件提交到repository了。如果一个文件已经被提交，那么就算这个文件已经被写到gitignor文件中，它的修改仍然会被追踪到。 所以我们需要手动将repository中的.DS_Store文件移除，可以使用以下命令移除：</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource git number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">git rm --cached .DS_Store </span>
<span id="cb2-2">#移除当前文件夹下的.DS_Store</span>
<span id="cb2-3">find . -name .DS_Store -print0 | xargs -0 git rm --ignore-unmatch</span>
<span id="cb2-4">#移除文件夹下的所有.DS_Store文件</span></code></pre></div>


</section>

 ]]></description>
  <category>quarto</category>
  <category>git</category>
  <guid>https://www.chenq.site/qsight/2022-12-01-gitignore/index.html</guid>
  <pubDate>Thu, 01 Dec 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-12-01-gitignore/ignore.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Mermaid 绘制流程图</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-11-24-mindmap/index.html</link>
  <description><![CDATA[ 




<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource mermaid number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">flowchart TD</span>
<span id="cb1-2">    A[(职工居民医保)] --&gt;B(肿瘤登记处)</span>
<span id="cb1-3">    C[各医疗机构数据] --&gt;B</span>
<span id="cb1-4">    D[(公安统计人口)] --&gt;B</span>
<span id="cb1-5">    E[(新农合)]--&gt;B</span>
<span id="cb1-6">    B--&gt;G(建卡及编码)</span>
<span id="cb1-7">    G--&gt;H(建立数据库)</span>
<span id="cb1-8">    H--&gt;I(省级肿瘤登记中心)</span>
<span id="cb1-9">    I--&gt;J(全国肿瘤登记中心)</span>
<span id="cb1-10">    G--&gt;K{{是否重卡}}</span>
<span id="cb1-11">    K--&gt;|重复| L(剔除重卡)</span>
<span id="cb1-12">    K--&gt;|不重复| H</span>
<span id="cb1-13">    R[(死因监测)]--&gt;B</span>
<span id="cb1-14">    R--&gt;Q[发病遗漏]</span>
<span id="cb1-15">    Q--&gt;G</span>
<span id="cb1-16">    Q--&gt;W[死亡补发病]</span>
<span id="cb1-17">    W--&gt;H</span>
<span id="cb1-18">    W--&gt;G</span></code></pre></div>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[(职工居民医保)] --&gt;B(肿瘤登记处)
    C[各医疗机构数据] --&gt;B
    D[(公安统计人口)] --&gt;B
    E[(新农合)]--&gt;B
    B--&gt;G(建卡及编码)
    G--&gt;H(建立数据库)
    H--&gt;I(省级肿瘤登记中心)
    I--&gt;J(全国肿瘤登记中心)
    G--&gt;K{{是否重卡}}
    K--&gt;|重复| L(剔除重卡)
    K--&gt;|不重复| H
    R[(死因监测)]--&gt;B
    R--&gt;Q[发病遗漏]
    Q--&gt;G
    Q--&gt;W[死亡补发病]
    W--&gt;H
    W--&gt;G
</pre>
</div>
</div>
</div>
</div>



 ]]></description>
  <category>quarto</category>
  <guid>https://www.chenq.site/qsight/2022-11-24-mindmap/index.html</guid>
  <pubDate>Thu, 24 Nov 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-11-24-mindmap/preview.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>R语言gganimate包和ggplot2包绘制进度线图(progressive line plot)</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-05-07-progressive-line-plot/index.html</link>
  <description><![CDATA[ 




<p>在利用R语言gganimate包绘制动态的进度线图之前，你需要先理解在R里利用ggplot2包绘制线图的过程。点击了解ggplot2绘制线图</p>
<p>在理解了如何利用ggplot2包绘制线图之后，你可以利用gganimate包增加一个绘图函数transition_…()，从而绘制动态变化图形。给transition_…()函数提供一个frame变量，这个变量的值每变化一次，就会在图上绘制一次，从而实现图的动态变化。</p>
<p>我们今天使用gganimate包的transition_reveal()函数，实现线图的动态显示过程。</p>
<section id="准备数据" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="准备数据"><span class="header-section-number">1</span> 准备数据</h2>
<p>我们还是利用制作<a href="https://chenq.site/tech/2022-ggplot2-lineplot/">普通线图</a>的年龄别癌症发病率数据，<a href="age_incidence.csv">点击链接，下载数据</a>。</p>
<p>对数据进行简单的处理，把合计性别的数据剔除，只显示男性和女性的癌症发病率随年龄变化的趋势即可，这样图里的内容不至于过多而显得杂乱。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_85c4779ed999b9258499a1e521894100">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;">#加载dplyr包</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;"># 读取年龄别发病率数据</span></span>
<span id="cb1-4">data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read.csv</span>(<span class="st" style="color: #20794D;">"age_incidence.csv"</span>)</span>
<span id="cb1-5">data <span class="ot" style="color: #003B4F;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-6">  <span class="co" style="color: #5E5E5E;"># 剔除合计性别数据</span></span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;">filter</span>(area<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>,<span class="sc" style="color: #5E5E5E;">!</span>(sex<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"合计"</span>))</span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;">#查看前6条数据结构情况</span></span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  area  sex variable agegrp
1    1 男性     9.42      0
2    1 男性    10.75      1
3    1 男性     9.53      5
4    1 男性    10.75     10
5    1 男性    10.67     15
6    1 男性    11.78     20</code></pre>
</div>
</div>
</section>
<section id="绘制进度线图progressive-line-plot" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="绘制进度线图progressive-line-plot"><span class="header-section-number">2</span> 绘制进度线图(progressive line plot)</h2>
<p>我们利用线图(line plot)展示了河南省年龄别癌症发病率数据，而我们想让年龄别发病率数据随着年龄的增加而逐渐显示出来，从而让线图动起来，这样，年龄别发病率数据随着年龄变化的特点就能更直观的显示出来。</p>
<p>想要达到这种效果，其实就是在利用ggplot2制作普通线图的基础上，再利用gganimate包的transition_reveal()函数，从而让线图按照某个变量逐步显示，我们这个例子就是按照x轴变量agegrp逐步显示，transition_reveal(agegrp)。</p>
<p>为了让线图更文艺或者更美观，我们可以使用ggthemes包里面绘图的主题来进行图的美化。Figure&nbsp;1</p>
<p><strong>绘图代码如下：</strong></p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/fig-plot2_365577a65750bd33da5643b4bc04bdc4">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;">#加载包</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;">library</span>(gganimate)</span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;"># 绘制动图</span></span>
<span id="cb3-5">data <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span><span class="fu" style="color: #4758AB;">factor</span>(agegrp), <span class="at" style="color: #657422;">y=</span>variable, <span class="at" style="color: #657422;">group=</span>sex, <span class="at" style="color: #657422;">color=</span>sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">linewidth=</span><span class="fl" style="color: #AD0000;">1.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">linewidth=</span><span class="dv" style="color: #AD0000;">3</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-9">  <span class="co" style="color: #5E5E5E;"># 增加图标题</span></span>
<span id="cb3-10">  <span class="co" style="color: #5E5E5E;"># 23rgvf ggrbthggtitle("河南省肿瘤登记地区癌症年龄别发病率") +</span></span>
<span id="cb3-11">  <span class="co" style="color: #5E5E5E;">#annotate("text", x = 18, y = 0, label = "普癌新声")+</span></span>
<span id="cb3-12">  <span class="co" style="color: #5E5E5E;"># 使用ggthemes包fivethirtyeight主题设置线图颜色</span></span>
<span id="cb3-13">  <span class="co" style="color: #5E5E5E;">#scale_color_fivethirtyeight()+ </span></span>
<span id="cb3-14">  <span class="co" style="color: #5E5E5E;"># 应用fivethirtyeight主题</span></span>
<span id="cb3-15">  <span class="co" style="color: #5E5E5E;">#theme_fivethirtyeight()+</span></span>
<span id="cb3-16">  <span class="co" style="color: #5E5E5E;"># 不显示图例标题</span></span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;">theme</span>(</span>
<span id="cb3-19">    <span class="at" style="color: #657422;">legend.position =</span> <span class="fu" style="color: #4758AB;">c</span>(.<span class="dv" style="color: #AD0000;">1</span>,.<span class="dv" style="color: #AD0000;">9</span>),</span>
<span id="cb3-20">    <span class="at" style="color: #657422;">legend.title =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb3-21">    <span class="at" style="color: #657422;">legend.text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">20</span>),</span>
<span id="cb3-22">    <span class="at" style="color: #657422;">text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">family=</span><span class="st" style="color: #20794D;">'Kai'</span>))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-23">  <span class="co" style="color: #5E5E5E;"># 让线图按照agegrp变量逐步显示</span></span>
<span id="cb3-24">    <span class="fu" style="color: #4758AB;">transition_reveal</span>(agegrp)</span>
<span id="cb3-25"></span>
<span id="cb3-26"><span class="fu" style="color: #4758AB;">anim_save</span>(<span class="st" style="color: #20794D;">"px.gif"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-plot2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2022-05-07-progressive-line-plot/index_files/figure-html/fig-plot2-1.gif" class="img-fluid figure-img" alt="进度线图 progressive line plot"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: 河南省肿瘤登记地区癌症年龄别发病率</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2022-05-07-progressive-line-plot/px.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">进度线图</figcaption><p></p>
</figure>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>科研作图</category>
  <guid>https://www.chenq.site/qsight/2022-05-07-progressive-line-plot/index.html</guid>
  <pubDate>Sat, 07 May 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-05-07-progressive-line-plot/px.gif" medium="image" type="image/gif"/>
</item>
<item>
  <title>R语言wordcloud2包绘制词云图</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-05-06-r-wordcloud2/index.html</link>
  <description><![CDATA[ 




<section id="什么是词云图" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="什么是词云图"><span class="header-section-number">1</span> 什么是词云图？</h2>
<p>词云图，也叫文字云，是对网络文本中出现频率较高的“关键词”予以视觉上的突出，出现越多，显示的字体越大，越突出，这个关键词也就越重要。让浏览者通过词云图一眼就可以快速感知最突出的文字，迅速抓住重点，了解主旨。 <img src="https://www.chenq.site/qsight/2022-05-06-r-wordcloud2/cover.png" class="img-fluid" alt="词云图"></p>
</section>
<section id="安装wordcloud2包以及主要参数介绍" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="安装wordcloud2包以及主要参数介绍"><span class="header-section-number">2</span> 安装wordcloud2包，以及主要参数介绍</h2>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"wordcloud2"</span>)</span></code></pre></div>
<p>wordcloud2包里绘制词云图的函数是wordcloud2(),而它常用的参数有以下几种：</p>
<ul>
<li>data：词云生成数据，包含具体词语以及频率；</li>
<li>size：字体大小，默认为1，一般来说该值越小，生成的形状轮廓越明显；</li>
<li>fontFamily：字体，如‘微软雅黑’；</li>
<li>fontWeight：字体粗细，包含‘normal’，‘bold’以及‘600’；；</li>
<li>color：字体颜色，可以选择‘random-dark’以及‘random-light’，其实就是颜色色系；</li>
<li>backgroundColor：背景颜色，支持R语言中的常用颜色，如‘gray’，‘blcak’，但是还支持不了更加具体的颜色选择，如‘gray20’；</li>
<li>minRontatin与maxRontatin：字体旋转角度范围的最小值以及最大值，选定后，字体会在该范围内随机旋转；</li>
<li>rotationRation：字体旋转比例，如设定为1，则全部词语都会发生旋转；</li>
<li>shape：词云形状选择，默认是‘circle’，即圆形。还可以选择‘cardioid’（苹果形或心形），‘star’（星形），‘diamond’（钻石），‘triangle-forward’（三角形），‘triangle’（三角形），‘pentagon’（五边形）；</li>
</ul>
</section>
<section id="准备数据" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="准备数据"><span class="header-section-number">3</span> 准备数据</h2>
<p>wordcloud2包默认自带了一个<strong>英文词频</strong>数据框，包含了两个变量 word:字符，freq：字符的出现频率，我们可以利用这个数据来做词云图的示例。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_bb4b3c7c3764602352dc6a2921f51131">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">library</span>(wordcloud2)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;">head</span>(demoFreq)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         word freq
oil       oil   85
said     said   73
prices prices   48
opec     opec   42
mln       mln   31
the       the   26</code></pre>
</div>
</div>
<p>还有一个中文词频数据框，包含两个变量 V2 词汇，V1词汇频率。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_318cb6582357bea463a77a67bb79d5a3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">head</span>(demoFreqC)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        V2   V1
1     数据 2304
3     统计 1413
4     用户  855
5     模型  846
7     分析  773
8 数据分析  750</code></pre>
</div>
</div>
</section>
<section id="绘制词云图" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="绘制词云图"><span class="header-section-number">4</span> 绘制词云图</h2>
<p>绘制星形词云图，字体大小设置为1</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-3_801953077d13424063bb7fa2f31f5585">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">wordcloud2</span>(demoFreq, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>,<span class="at" style="color: #657422;">shape =</span> <span class="st" style="color: #20794D;">"star"</span>)  </span></code></pre></div>
<div class="cell-output-display">

<div class="wordcloud2 html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9f208622810505ce001b" style="width:100%;height:650px;"></div>
<script type="application/json" data-for="htmlwidget-9f208622810505ce001b">{"x":{"word":["oil","said","prices","opec","mln","the","last","bpd","dlrs","crude","market","reuter","saudi","will","one","barrel","kuwait","new","official","pct","price","barrels","government","production","sheikh","industry","meeting","minister","world","also","billion","futures","month","output","petroleum","quota","sources","accord","analysts","but","group","gulf","january","markets","report","today","december","demand","economic","economy","energy","help","international","may","nazer","nymex","posted","present","they","traders","158","ability","agreement","ali","april","arabia","budget","emergency","exchange","hold","imports","members","recent","riyals","says","sell","years","abdulaziz","agency","arab","ceiling","company","contract","daily","emirates","expected","expenditure","exports","growth","now","opecs","plans","qatar","quoted","research","reserve","reserves","states","study","united","way","week","west","year","150","according","added","among","asked","brings","buyers","can","change","corp","cut","day","development","effective","exploration","fall","february","fell","free","higher","increase","levels","meet","must","never","per","policy","power","problem","producing","protect","pumping","reduced","revenue","revenues","rise","saying","set","since","spa","strategic","texas","this","total","transaction","weak","yesterday","13nation","1985","198586","1986","1987","198788","address","agreed","alkhalifa","alqabas","alsabah","announced","appears","arabian","arabias","around","average","back","bank","bbl","boost","called","commitment","companies","compared","countrys","current","decrease","denied","dollars","domestic","due","efp","estimate","estimates","export","fixed","foreign","four","future","grade","guard","high","hisham","however","inc","indonesia","indonesias","intermediate","kingdoms","kuwaits","local","low","lower","lowered","made","main","march","mckiernan","measures","mizrahi","moves","much","named","next","officials","plant","position","president","pressure","producer","projected","published","real","refinery","reiterated","remain","rule","say","sector","several","sharp","ship","six","slightly","smaller","spokeswoman","state","sweet","texaco","three","trading","two","weeks","york","1518","198687","20s","285000","500","725","750","948000","activity","adhering","agriculture","along","apparently","appeared","approved","architect","areas","aspen","bankers","based","benchmark","benefits","canada","canadian","cash","changed","changes","circumstance","clearly","closed","coast","come","committee","commodity","consumption","countries","country","crossroads","crucial","cubic","currently","customers","deal","decembers","decline","deficit","deposits","deputy","diamond","differentials","difficulties","direction","discounted","dlr","early","ecuador","effect","embargo","embassy","entering","even","falling","feb","first","fiscal","fiscales","forced","fully","gcc","general","given","grades","halt","hit","hope","humanistic","impact","import","increased","increasing","instead","institute","interview","investment","jersey","june","keep","late","light","limit","limits","line","lost","louisiana","lowest","major","marketing","member","mid","million","ministers","mitigate","months","nearing","net","neutral","none","nuclear","organisation","organization","outlook","overseas","pact","pay","petroliferos","planned","port","positive","postings","predicted","press","pricing","private","probably","problems","pronounced","protected","public","put","quotes","raise","rate","reduction","referring","remarks","reports","return","review","risks","riyal","selfimposed","selling","share","shortfall","spot","steady","stick","strongly","studies","support","take","taken","techniques","throughput","trade","trust","trying","uncertainty","union","value","wam","wanted","weakness","winter","yacimientos","yanbu","zero","zone","100000","108","111","115","12217","1232","1381","13member","156","1600","1635","1650","1667","168","1685","1752","180000","200000","200foot","2226","24hour","2766","300","3749598","3750003","4133","534","5472","614","658","6745","678","718","738","able","abroad","accept","across","add","addressed","adherence","advantage","advisers","after","agricultural","aground","allocated","allocations","allow","almost","already","althani","although","alvite","amidst","analysis","analyst","annual","anything","apparent","aramco","argentine","arrangement","asia","asian","assesses","assign","assigned","associates","attract","available","averaging","aware","bahrain","bahrains","balance","baseless","basic","basis","because","beginning","bijan","bin","bit","bodys","briefly","broadened","brothers","buildings","burden","buy","buyer","calendar","cambridge","capacity","capozza","carrying","center","century","cera","certain","cftc","chairman","challenge","characterized","charging","cheap","cheating","chevron","chv","cited","citing","clever","close","closer","closes","coming","commission","communications","companys","completed","complex","condition","conditions","considered","construction","contacts","continuation","continue","continued","continues","contracted","contributed","control","cooperation","coordination","copany","corps","council","counter","coupled","covered","creek","critical","cts","currency","custom","cuts","cutting","cypriot","daniel","david","days","debtburdened","debut","decided","declared","declines","deemed","defence","delaware","delivered","delivering","departments","deregulate","deregulation","determination","devalue","device","differential","difficulty","dillard","director","discuss","discussing","distribution","distributions","divided","doha","dollar","drawbacks","drop","dropped","earlier","earnings","eastern","easy","ecuadors","editor","edmontonswann","education","eight","either","elaborate","elections","electricity","end","engineers","entitlements","environment","equally","estimated","european","exceed","exceeding","excess","excesses","excessive","exerted","exist","expanded","expansion","expartners","expectations","expects","explained","exporting","exxon","face","faced","faces","facilities","facing","failed","fallen","favours","fee","fernando","figure","figures","finance","firmer","floating","followed","for","forces","foremost","fourth","frank","full","fundamentals","gas","generally","geneva","get","globalization","glut","guaranteed","halting","harvard","heads","health","hedge","hedged","helped","hemisphere","highly","hills","hitting","hoped","housing","houston","immediately","implementation","improve","improvement","include","including","independent","indications","initiate","initiative","institutions","interbank","interest","investments","issue","jamaica","jan","juaymah","jubail","jump","just","khalifa","lack","largest","later","latest","launched","lead","leading","learn","least","lending","less","lesson","level","liberalised","lift","liftings","like","lines","liquidity","little","loan","lodged","longterm","ltd","lukman","lull","maintain","make","manager","manipulate","many","marathon","marathons","marker","mcfadden","means","mercantile","metrers","metres","mid1960s","mid1986","mideast","minus","mlotok","mob","mobil","momentum","money","monopolies","monthend","moussavarrahmani","movement","nation","natural","need","needs","negative","negotiate","neither","network","news","newspaper","nigerian","nine","nonoil","northern","notes","offset","onetwelfth","oneweek","open","opens","operations","opposite","optimism","optimistic","option","order","organiaation","our","outlining","outside","overproducing","part","parties","partly","party","past","paths","paul","paulsboro","payments","pegged","performance","period","pertains","pessimistic","philadelphia","physical","placed","plastics","platinum","point","policies","political","population","positions","postponed","pressures","previous","primarily","primary","principal","procedure","produce","produced","producers","product","products","program","projection","projects","prompted","proposed","proved","providing","provision","publish","purposes","quarter","quiet","quietly","quotas","rallied","ran","ranging","ras","rates","rationalise","readdress","reaffirmed","reasonable","recommending","recovering","recurrent","reference","refineries","refining","reflect","refloat","reform","reforms","regain","regard","regarding","region","regional","reiterate","relaxation","relieve","reluctant","remainder","remained","reported","request","resistance","resisting","resources","respectively","responsibilites","restored","restraint","restrictions","result","reuters","revealed","reviews","right","rilwanu","rising","river","rocks","rosemary","rumour","rushing","sales","salomon","santos","satisfied","saw","scheduled","scheme","seapride","season","secretary","security","seeing","seek","september","series","serve","services","session","sets","seven","severely","shamrock","sharply","shoulder","show","showed","shown","signed","signs","situation","sixmonth","slackens","slide","slump","social","sold","soon","sort","sour","south","southeast","spend","spill","spoke","spokesman","spotnext","spriggs","stabilise","stabilize","stable","start","statement","steel","steering","steps","stiff","storage","strong","subsequently","substitution","succeed","suffer","suffering","suhartos","sunday","sundays","supply","supporting","suppose","surrounding","swift","talks","tanker","tanurah","tapers","teach","telephone","terminals","test","there","third","thomas","though","thought","threemonth","tide","together","told","totalled","tower","trader","trades","traditional","traditionally","transacted","transmission","transport","trends","trusts","try","turmoil","twofold","uae","uncertain","unchanged","under","unions","unitholders","universitys","unlikely","unocal","unusually","urged","use","virtual","wants","water","wealth","wednesday","weekend","welcomed","when","whether","wishes","worldwide","xon","yergin","yesterdays"],"freq":[85,73,48,42,31,26,24,23,23,21,20,20,18,18,17,15,14,14,14,14,13,11,11,11,11,10,10,10,10,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":2.11764705882353,"backgroundColor":"white","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"star","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
</div>
<p>利用demoFreqC数据绘制中文词云图，设定字体为微软雅黑，设定颜色为random-light，背景色设为灰色。</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-4_b105bf53c57736bcba6b77d2e37ba3eb">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;">wordcloud2</span>(demoFreqC,<span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>,<span class="at" style="color: #657422;">fontFamily =</span> <span class="st" style="color: #20794D;">"微软雅黑"</span>,<span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"random-light"</span>, <span class="at" style="color: #657422;">backgroundColor =</span> <span class="st" style="color: #20794D;">"grey"</span>)  </span></code></pre></div>
<div class="cell-output-display">
<div class="wordcloud2 html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3e2a2925e750a06a6ff2" style="width:100%;height:650px;"></div>
<script type="application/json" data-for="htmlwidget-3e2a2925e750a06a6ff2">{"x":{"word":["数据","统计","用户","模型","分析","数据分析","大数据","研究","信息","大学","语言","方法","问题","会议","数据科学","学习","可能","中国","科学","计算","网络","公司","预测","应用","变量","时间","选择","广告","主要","行业","关键","系统","影响","估计","北京","品牌","学院","城市","误差","处理","产品","分布","过程","相关","搜索","训练","方面","重要","函数","行为","技术","有限","户的","市场","提供","关系","工作","非常","利用","机器","可视","联网","COS","本文","业务","文本","比较","得到","推荐","样的","演讲","介绍","微博","计之","统计之都","实际","工具","现在","用户的","可视化","报告","关注","器学习","方式","样本","能够","情况","机器学习","沙龙","data","学家","已经","音乐","有限公司","中心","发展","算法","老师","表示","型的","概率","互联","管理","言会","互联网","语言会","客户","特征","结构","语言会议","一种","企业","喜欢","大的","的是","的分","社交","金融","到了","用的","先生","量的","参数","学生","具体","发现","实现","教授","包括","指标","分类","平均","mathbf","之间","博士","是一个","建模","聚类","领域","兴趣","这种","本次","回归","要的","告主","购买","会场","上的","广告主","的研","代码","矩阵","科技","销量","间的","的问","两个","的问题","天气","每个","内容","定义","的统","模型的","的研究","frac","作者","到的","并不","有一","的用","的统计","解决","面的","之后","平台","标签","简单","这一","多的","手机","是我","销售","文章","消费","软件","信用","开发","更多","http","一步","描述","是否","最后","的方法","认为","高端","同的","存在","的用户","评论","基础","深度","的信","代表","复杂","我的","获得","也是","挖掘","的工","程中","纪要","一定","主题","单位","广州","们可","来的","科学家","了解","展示","随机","效果","数学","线性","参会","学的","报名","行了","支持","有效","直接","mathcal","在这","对应","当时","的模","价值","基本","新的","目前","营销","论文","不同的","交易","我们可","指数","方向","获取","记录","都是","定的","每一","过程中","们可以","出现","数据科学家","知道","第二","策略","美国","考虑","这样的","业的","传统","希望","的时候","相对","程度","自己的","说明","进行了","采用","应的","时代","社交网","网站","这是","人员","在一","届中国","的预","目标","社交网络","是不","服务","的应","者的","觉得","评价","变化","建立","我们可以","更加","的应用","的模型","看到","风险","应该","的结","知识","竞争","结合","贝叶斯","产生","帮助","测试","理解","组织","经济","他的","具有","出了","容易","成为","用于","准确","的一个","能力","趋势","银行","性的","的基","商业","讨论","一下","世界","之间的","人的","包含","数的","最大","系数","是在","里面","专业","成本","计算机","财经","驾驶","一次","了一个","工程","我们的","理论","生成","的信息","的重","研究中","简历","项目","三个","上海","也可","分享","成功","有很","的关键","其实","医疗","快速","投资","最近","渠道","的大","规模","进一","违约","不能","优化","后的","影响力","推断","生物","的预测","预测误差","业界","以看","几个","嘉宾","程序","角度","训练集","进一步","需求","假设","可以看","深度学习","的时间","设计","功能","推广","案例","模型选","的可","的概","节点","行的","个数","之前","因素","模型选择","环境","的影","解释","起来","高端车","model","text","东西","以下","另一","形式","智能","的文","重要的","参考","增加","的发","的影响","背景","车险","分词","化的","学术","布的","核心","的变","经大","通常","介绍了","原因","可能也","控制","机构","法的","王小宁","生的","的相","自然","论坛","财经大学","车辆","验证","为一","导致","征信","析的","的主","的实","而不","速度","也喜欢","人群","分析的","大量","实验","年的","找到","抽样","统的","编辑","联系","cdot","spark","中山","例子","北京大","司机","就可","得分","提出","效率","数据挖","方差","无觅","是对","真实","下来","个问","北京大学","历史","图形","就可以","带来","您可能也喜欢","提高","数据挖掘","显示","本的","趣的","事情","地区","建议","成了","提升","数据可","数据时","日期","朋友","社会","观测","评估","量化","个问题","也可以","人民","保险","判断","对数","工业","文件","标准","的学","的工作","研究中心","神经","系列","让我","xgboost","下面","不会","体的","所示","提供了","汽车","的广","的特","经验","驱动","err","hat","医学","媒体","据中","的分析","的推","的最","ggtree","不断","个体","也不","人民大学","位置","出的","基金","大数据的","来越","消费者","爆发","的机","的高","益辉","编程","表现","alpha","下载","中文","们将","会有","商务","国人","学研究","完成","度的","数据中","每周","特别","的过","神经网络","第三","计分","词的","阶段","驶行为","做一","做的","分的","埃博拉","多个","是有","来源","现了","的关键词","越来越","驾驶行为","高的","中国人","会者","兴趣的","好友","我们将","挑战","数据进","有很多","气象","注意","统计分","语言的","超过","金额","一点","一起","下的","中国人民","举办","交流","他们的","向量","在的","大小","学统计","山大","总结","意义","数据进行","数量","未来","比例","沙龙第","的个","的发展","的情","的方式","的过程","示了","科技有","计的","资料","中国人民大学","中山大学","分为","参会者","发布","国内","家的","展现","感兴趣","扩展","抓取","损失","排名","最终","每周精选","游戏","生活","科技有限公司","质量","题的","也就","今天","基因","收集","改进","数据可视化","是这","模式","的不","的估","的广告","的标","目的","相应","类别","统计分析","谢益辉","CV","们在","力的","华南","引擎","新闻","是最","概念","欢迎","点击","的交","的概率","的重要","监测","给出","综合","规则","距离","autoplot","不可","了这","你的","做了","关的","制造","同样","增长","完全","接口","操作","数据时代","更多的","次会议","电子","的优","的行","移动","调整","酒精性饮料","重复","一方","一致","习的","似然","健康","准则","单的","博文","合理","大数据时","实践","对应的","属性","年龄","很大","很好","接下","提取","现的","百度","的东","的关系","的理","的结果","空间","线性模型","要求","达到","app","上面","个用","了很","值的","分布的","国际","在大","在线","地方","域的","基础上","大数据时代","学习的","忠诚","思考","接下来","效的","是很","曲线","条件","用了","界的","的目","的解","议的","识别","资源","UBI","个性","为我","国家","它的","性化","正态","毕业","流程","的东西","的估计","的第","种方","究的","重点","问题的","python","主办","也有","创意","发生","思路","整个","更好","有一个","有可","本科","来看","死亡","流行","理学","的各","相关的","研究的","红包","组合","结构化","网络中","自动","行业的","表明","这就","bootstrap","一直","个用户","了数","交通","以用","会议的","作用","做出","合作","天津","学科","对数据","就会","广东","拟合","整体","方面的","本次会议","每一个","注册","点的","疫情","的事","的内","的地","简单的","观察","访谈","这两","进行分","阅读","BIC","个性化","个方","交叉","吸引","完整","层面","巨大","态分布","投放","是什么","最小","本数","极大","涉及","深圳","的基础","真正","类似","编码","让我们","QQ","也就是","保证","保费","创业","前的","区域","国的","在中","对用户","感觉","所有的","拥有","探索","是因","最好","机会","正态分布","水平","独立","理的","的思","的成","的计","的语","研究院","类型"],"freq":[2304,1413,855,846,773,750,650,547,543,497,430,428,426,411,401,385,373,366,359,359,350,341,314,306,280,277,255,254,239,238,232,228,226,222,220,217,214,213,213,210,209,209,208,200,199,196,193,189,187,187,180,180,179,178,178,177,176,174,171,171,170,169,168,168,167,167,167,163,163,162,162,159,159,159,157,156,156,156,156,154,153,151,151,150,150,150,149,148,148,147,147,147,147,145,143,143,142,142,142,141,140,139,138,138,137,137,136,135,135,135,134,134,134,134,134,132,132,132,131,131,130,130,129,129,128,128,128,128,127,127,126,126,125,125,124,124,123,123,123,122,122,121,120,120,119,119,118,117,117,117,116,116,116,116,116,115,114,114,113,113,112,112,112,111,111,110,110,110,110,110,110,110,110,110,109,108,108,108,108,107,107,107,107,106,106,106,105,105,105,104,104,104,104,104,104,104,104,103,103,103,103,102,102,102,101,101,101,101,100,100,100,100,100,99,98,98,98,97,97,97,96,96,96,95,95,95,94,94,94,94,93,93,93,92,92,92,92,92,91,91,91,91,91,91,90,90,90,90,90,90,90,90,89,89,89,88,88,88,88,88,88,88,88,88,87,87,87,87,87,87,87,87,87,87,86,86,86,86,86,85,85,85,85,85,85,84,84,84,84,84,84,83,83,83,83,83,83,83,83,82,82,82,82,82,82,81,81,81,81,81,81,80,80,80,80,80,80,79,79,79,79,79,78,78,77,77,76,76,76,76,76,76,76,76,75,75,74,74,74,74,74,73,73,73,73,73,73,73,73,73,73,73,72,72,72,72,72,72,72,71,71,71,71,71,71,71,71,71,71,70,70,70,70,70,70,70,70,69,69,69,69,69,69,69,69,69,68,68,68,68,68,67,67,67,67,67,67,67,67,66,66,66,66,66,66,66,66,66,65,65,65,65,65,65,65,65,65,64,64,64,64,64,64,63,63,63,63,63,63,63,63,62,62,62,62,62,62,62,62,62,62,62,62,62,62,61,61,61,61,61,61,61,61,60,60,60,60,60,60,60,60,60,60,60,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,58,58,58,58,58,58,58,58,58,58,58,58,58,57,57,57,57,57,57,57,57,57,57,57,57,57,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,55,55,55,55,55,55,55,55,55,55,55,54,54,54,54,54,54,54,54,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,51,51,51,51,51,51,51,51,51,51,51,51,50,50,50,50,50,50,50,50,50,50,50,50,50,50,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38],"fontFamily":"微软雅黑","fontWeight":"bold","color":"random-light","minSize":0,"weightFactor":0.15625,"backgroundColor":"grey","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
</div>
<p>绘制默认词云图，字体大小设置为2，字体旋转最小和最大均设置为-pi/2。</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-5_93317aa5faf6f79a90ab2bb1d498599d">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;">wordcloud2</span>(demoFreq, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">minRotation =</span> <span class="sc" style="color: #5E5E5E;">-</span>pi<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">maxRotation =</span> <span class="sc" style="color: #5E5E5E;">-</span>pi<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">2</span>) </span></code></pre></div>
<div class="cell-output-display">

<div class="wordcloud2 html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-dc797f6c77cb86ab9f52" style="width:100%;height:650px;"></div>
<script type="application/json" data-for="htmlwidget-dc797f6c77cb86ab9f52">{"x":{"word":["oil","said","prices","opec","mln","the","last","bpd","dlrs","crude","market","reuter","saudi","will","one","barrel","kuwait","new","official","pct","price","barrels","government","production","sheikh","industry","meeting","minister","world","also","billion","futures","month","output","petroleum","quota","sources","accord","analysts","but","group","gulf","january","markets","report","today","december","demand","economic","economy","energy","help","international","may","nazer","nymex","posted","present","they","traders","158","ability","agreement","ali","april","arabia","budget","emergency","exchange","hold","imports","members","recent","riyals","says","sell","years","abdulaziz","agency","arab","ceiling","company","contract","daily","emirates","expected","expenditure","exports","growth","now","opecs","plans","qatar","quoted","research","reserve","reserves","states","study","united","way","week","west","year","150","according","added","among","asked","brings","buyers","can","change","corp","cut","day","development","effective","exploration","fall","february","fell","free","higher","increase","levels","meet","must","never","per","policy","power","problem","producing","protect","pumping","reduced","revenue","revenues","rise","saying","set","since","spa","strategic","texas","this","total","transaction","weak","yesterday","13nation","1985","198586","1986","1987","198788","address","agreed","alkhalifa","alqabas","alsabah","announced","appears","arabian","arabias","around","average","back","bank","bbl","boost","called","commitment","companies","compared","countrys","current","decrease","denied","dollars","domestic","due","efp","estimate","estimates","export","fixed","foreign","four","future","grade","guard","high","hisham","however","inc","indonesia","indonesias","intermediate","kingdoms","kuwaits","local","low","lower","lowered","made","main","march","mckiernan","measures","mizrahi","moves","much","named","next","officials","plant","position","president","pressure","producer","projected","published","real","refinery","reiterated","remain","rule","say","sector","several","sharp","ship","six","slightly","smaller","spokeswoman","state","sweet","texaco","three","trading","two","weeks","york","1518","198687","20s","285000","500","725","750","948000","activity","adhering","agriculture","along","apparently","appeared","approved","architect","areas","aspen","bankers","based","benchmark","benefits","canada","canadian","cash","changed","changes","circumstance","clearly","closed","coast","come","committee","commodity","consumption","countries","country","crossroads","crucial","cubic","currently","customers","deal","decembers","decline","deficit","deposits","deputy","diamond","differentials","difficulties","direction","discounted","dlr","early","ecuador","effect","embargo","embassy","entering","even","falling","feb","first","fiscal","fiscales","forced","fully","gcc","general","given","grades","halt","hit","hope","humanistic","impact","import","increased","increasing","instead","institute","interview","investment","jersey","june","keep","late","light","limit","limits","line","lost","louisiana","lowest","major","marketing","member","mid","million","ministers","mitigate","months","nearing","net","neutral","none","nuclear","organisation","organization","outlook","overseas","pact","pay","petroliferos","planned","port","positive","postings","predicted","press","pricing","private","probably","problems","pronounced","protected","public","put","quotes","raise","rate","reduction","referring","remarks","reports","return","review","risks","riyal","selfimposed","selling","share","shortfall","spot","steady","stick","strongly","studies","support","take","taken","techniques","throughput","trade","trust","trying","uncertainty","union","value","wam","wanted","weakness","winter","yacimientos","yanbu","zero","zone","100000","108","111","115","12217","1232","1381","13member","156","1600","1635","1650","1667","168","1685","1752","180000","200000","200foot","2226","24hour","2766","300","3749598","3750003","4133","534","5472","614","658","6745","678","718","738","able","abroad","accept","across","add","addressed","adherence","advantage","advisers","after","agricultural","aground","allocated","allocations","allow","almost","already","althani","although","alvite","amidst","analysis","analyst","annual","anything","apparent","aramco","argentine","arrangement","asia","asian","assesses","assign","assigned","associates","attract","available","averaging","aware","bahrain","bahrains","balance","baseless","basic","basis","because","beginning","bijan","bin","bit","bodys","briefly","broadened","brothers","buildings","burden","buy","buyer","calendar","cambridge","capacity","capozza","carrying","center","century","cera","certain","cftc","chairman","challenge","characterized","charging","cheap","cheating","chevron","chv","cited","citing","clever","close","closer","closes","coming","commission","communications","companys","completed","complex","condition","conditions","considered","construction","contacts","continuation","continue","continued","continues","contracted","contributed","control","cooperation","coordination","copany","corps","council","counter","coupled","covered","creek","critical","cts","currency","custom","cuts","cutting","cypriot","daniel","david","days","debtburdened","debut","decided","declared","declines","deemed","defence","delaware","delivered","delivering","departments","deregulate","deregulation","determination","devalue","device","differential","difficulty","dillard","director","discuss","discussing","distribution","distributions","divided","doha","dollar","drawbacks","drop","dropped","earlier","earnings","eastern","easy","ecuadors","editor","edmontonswann","education","eight","either","elaborate","elections","electricity","end","engineers","entitlements","environment","equally","estimated","european","exceed","exceeding","excess","excesses","excessive","exerted","exist","expanded","expansion","expartners","expectations","expects","explained","exporting","exxon","face","faced","faces","facilities","facing","failed","fallen","favours","fee","fernando","figure","figures","finance","firmer","floating","followed","for","forces","foremost","fourth","frank","full","fundamentals","gas","generally","geneva","get","globalization","glut","guaranteed","halting","harvard","heads","health","hedge","hedged","helped","hemisphere","highly","hills","hitting","hoped","housing","houston","immediately","implementation","improve","improvement","include","including","independent","indications","initiate","initiative","institutions","interbank","interest","investments","issue","jamaica","jan","juaymah","jubail","jump","just","khalifa","lack","largest","later","latest","launched","lead","leading","learn","least","lending","less","lesson","level","liberalised","lift","liftings","like","lines","liquidity","little","loan","lodged","longterm","ltd","lukman","lull","maintain","make","manager","manipulate","many","marathon","marathons","marker","mcfadden","means","mercantile","metrers","metres","mid1960s","mid1986","mideast","minus","mlotok","mob","mobil","momentum","money","monopolies","monthend","moussavarrahmani","movement","nation","natural","need","needs","negative","negotiate","neither","network","news","newspaper","nigerian","nine","nonoil","northern","notes","offset","onetwelfth","oneweek","open","opens","operations","opposite","optimism","optimistic","option","order","organiaation","our","outlining","outside","overproducing","part","parties","partly","party","past","paths","paul","paulsboro","payments","pegged","performance","period","pertains","pessimistic","philadelphia","physical","placed","plastics","platinum","point","policies","political","population","positions","postponed","pressures","previous","primarily","primary","principal","procedure","produce","produced","producers","product","products","program","projection","projects","prompted","proposed","proved","providing","provision","publish","purposes","quarter","quiet","quietly","quotas","rallied","ran","ranging","ras","rates","rationalise","readdress","reaffirmed","reasonable","recommending","recovering","recurrent","reference","refineries","refining","reflect","refloat","reform","reforms","regain","regard","regarding","region","regional","reiterate","relaxation","relieve","reluctant","remainder","remained","reported","request","resistance","resisting","resources","respectively","responsibilites","restored","restraint","restrictions","result","reuters","revealed","reviews","right","rilwanu","rising","river","rocks","rosemary","rumour","rushing","sales","salomon","santos","satisfied","saw","scheduled","scheme","seapride","season","secretary","security","seeing","seek","september","series","serve","services","session","sets","seven","severely","shamrock","sharply","shoulder","show","showed","shown","signed","signs","situation","sixmonth","slackens","slide","slump","social","sold","soon","sort","sour","south","southeast","spend","spill","spoke","spokesman","spotnext","spriggs","stabilise","stabilize","stable","start","statement","steel","steering","steps","stiff","storage","strong","subsequently","substitution","succeed","suffer","suffering","suhartos","sunday","sundays","supply","supporting","suppose","surrounding","swift","talks","tanker","tanurah","tapers","teach","telephone","terminals","test","there","third","thomas","though","thought","threemonth","tide","together","told","totalled","tower","trader","trades","traditional","traditionally","transacted","transmission","transport","trends","trusts","try","turmoil","twofold","uae","uncertain","unchanged","under","unions","unitholders","universitys","unlikely","unocal","unusually","urged","use","virtual","wants","water","wealth","wednesday","weekend","welcomed","when","whether","wishes","worldwide","xon","yergin","yesterdays"],"freq":[85,73,48,42,31,26,24,23,23,21,20,20,18,18,17,15,14,14,14,14,13,11,11,11,11,10,10,10,10,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":4.23529411764706,"backgroundColor":"white","gridSize":0,"minRotation":-1.5707963267949,"maxRotation":-1.5707963267949,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
</div>
<p>绘制词云图，字体大小设置为2，字体旋转最大和最小角度均为-pi/6，旋转比例设置为0.5，一半的字体会旋转。</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-6_54a23a85a17611270ea253518ea2d40f">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;">wordcloud2</span>(demoFreq, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">minRotation =</span> <span class="sc" style="color: #5E5E5E;">-</span>pi<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">6</span>, <span class="at" style="color: #657422;">maxRotation =</span> <span class="sc" style="color: #5E5E5E;">-</span>pi<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">6</span>,<span class="at" style="color: #657422;">rotateRatio =</span> <span class="fl" style="color: #AD0000;">0.5</span>)</span></code></pre></div>
<div class="cell-output-display">

<div class="wordcloud2 html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-75297a78d2f56ba115ca" style="width:100%;height:650px;"></div>
<script type="application/json" data-for="htmlwidget-75297a78d2f56ba115ca">{"x":{"word":["oil","said","prices","opec","mln","the","last","bpd","dlrs","crude","market","reuter","saudi","will","one","barrel","kuwait","new","official","pct","price","barrels","government","production","sheikh","industry","meeting","minister","world","also","billion","futures","month","output","petroleum","quota","sources","accord","analysts","but","group","gulf","january","markets","report","today","december","demand","economic","economy","energy","help","international","may","nazer","nymex","posted","present","they","traders","158","ability","agreement","ali","april","arabia","budget","emergency","exchange","hold","imports","members","recent","riyals","says","sell","years","abdulaziz","agency","arab","ceiling","company","contract","daily","emirates","expected","expenditure","exports","growth","now","opecs","plans","qatar","quoted","research","reserve","reserves","states","study","united","way","week","west","year","150","according","added","among","asked","brings","buyers","can","change","corp","cut","day","development","effective","exploration","fall","february","fell","free","higher","increase","levels","meet","must","never","per","policy","power","problem","producing","protect","pumping","reduced","revenue","revenues","rise","saying","set","since","spa","strategic","texas","this","total","transaction","weak","yesterday","13nation","1985","198586","1986","1987","198788","address","agreed","alkhalifa","alqabas","alsabah","announced","appears","arabian","arabias","around","average","back","bank","bbl","boost","called","commitment","companies","compared","countrys","current","decrease","denied","dollars","domestic","due","efp","estimate","estimates","export","fixed","foreign","four","future","grade","guard","high","hisham","however","inc","indonesia","indonesias","intermediate","kingdoms","kuwaits","local","low","lower","lowered","made","main","march","mckiernan","measures","mizrahi","moves","much","named","next","officials","plant","position","president","pressure","producer","projected","published","real","refinery","reiterated","remain","rule","say","sector","several","sharp","ship","six","slightly","smaller","spokeswoman","state","sweet","texaco","three","trading","two","weeks","york","1518","198687","20s","285000","500","725","750","948000","activity","adhering","agriculture","along","apparently","appeared","approved","architect","areas","aspen","bankers","based","benchmark","benefits","canada","canadian","cash","changed","changes","circumstance","clearly","closed","coast","come","committee","commodity","consumption","countries","country","crossroads","crucial","cubic","currently","customers","deal","decembers","decline","deficit","deposits","deputy","diamond","differentials","difficulties","direction","discounted","dlr","early","ecuador","effect","embargo","embassy","entering","even","falling","feb","first","fiscal","fiscales","forced","fully","gcc","general","given","grades","halt","hit","hope","humanistic","impact","import","increased","increasing","instead","institute","interview","investment","jersey","june","keep","late","light","limit","limits","line","lost","louisiana","lowest","major","marketing","member","mid","million","ministers","mitigate","months","nearing","net","neutral","none","nuclear","organisation","organization","outlook","overseas","pact","pay","petroliferos","planned","port","positive","postings","predicted","press","pricing","private","probably","problems","pronounced","protected","public","put","quotes","raise","rate","reduction","referring","remarks","reports","return","review","risks","riyal","selfimposed","selling","share","shortfall","spot","steady","stick","strongly","studies","support","take","taken","techniques","throughput","trade","trust","trying","uncertainty","union","value","wam","wanted","weakness","winter","yacimientos","yanbu","zero","zone","100000","108","111","115","12217","1232","1381","13member","156","1600","1635","1650","1667","168","1685","1752","180000","200000","200foot","2226","24hour","2766","300","3749598","3750003","4133","534","5472","614","658","6745","678","718","738","able","abroad","accept","across","add","addressed","adherence","advantage","advisers","after","agricultural","aground","allocated","allocations","allow","almost","already","althani","although","alvite","amidst","analysis","analyst","annual","anything","apparent","aramco","argentine","arrangement","asia","asian","assesses","assign","assigned","associates","attract","available","averaging","aware","bahrain","bahrains","balance","baseless","basic","basis","because","beginning","bijan","bin","bit","bodys","briefly","broadened","brothers","buildings","burden","buy","buyer","calendar","cambridge","capacity","capozza","carrying","center","century","cera","certain","cftc","chairman","challenge","characterized","charging","cheap","cheating","chevron","chv","cited","citing","clever","close","closer","closes","coming","commission","communications","companys","completed","complex","condition","conditions","considered","construction","contacts","continuation","continue","continued","continues","contracted","contributed","control","cooperation","coordination","copany","corps","council","counter","coupled","covered","creek","critical","cts","currency","custom","cuts","cutting","cypriot","daniel","david","days","debtburdened","debut","decided","declared","declines","deemed","defence","delaware","delivered","delivering","departments","deregulate","deregulation","determination","devalue","device","differential","difficulty","dillard","director","discuss","discussing","distribution","distributions","divided","doha","dollar","drawbacks","drop","dropped","earlier","earnings","eastern","easy","ecuadors","editor","edmontonswann","education","eight","either","elaborate","elections","electricity","end","engineers","entitlements","environment","equally","estimated","european","exceed","exceeding","excess","excesses","excessive","exerted","exist","expanded","expansion","expartners","expectations","expects","explained","exporting","exxon","face","faced","faces","facilities","facing","failed","fallen","favours","fee","fernando","figure","figures","finance","firmer","floating","followed","for","forces","foremost","fourth","frank","full","fundamentals","gas","generally","geneva","get","globalization","glut","guaranteed","halting","harvard","heads","health","hedge","hedged","helped","hemisphere","highly","hills","hitting","hoped","housing","houston","immediately","implementation","improve","improvement","include","including","independent","indications","initiate","initiative","institutions","interbank","interest","investments","issue","jamaica","jan","juaymah","jubail","jump","just","khalifa","lack","largest","later","latest","launched","lead","leading","learn","least","lending","less","lesson","level","liberalised","lift","liftings","like","lines","liquidity","little","loan","lodged","longterm","ltd","lukman","lull","maintain","make","manager","manipulate","many","marathon","marathons","marker","mcfadden","means","mercantile","metrers","metres","mid1960s","mid1986","mideast","minus","mlotok","mob","mobil","momentum","money","monopolies","monthend","moussavarrahmani","movement","nation","natural","need","needs","negative","negotiate","neither","network","news","newspaper","nigerian","nine","nonoil","northern","notes","offset","onetwelfth","oneweek","open","opens","operations","opposite","optimism","optimistic","option","order","organiaation","our","outlining","outside","overproducing","part","parties","partly","party","past","paths","paul","paulsboro","payments","pegged","performance","period","pertains","pessimistic","philadelphia","physical","placed","plastics","platinum","point","policies","political","population","positions","postponed","pressures","previous","primarily","primary","principal","procedure","produce","produced","producers","product","products","program","projection","projects","prompted","proposed","proved","providing","provision","publish","purposes","quarter","quiet","quietly","quotas","rallied","ran","ranging","ras","rates","rationalise","readdress","reaffirmed","reasonable","recommending","recovering","recurrent","reference","refineries","refining","reflect","refloat","reform","reforms","regain","regard","regarding","region","regional","reiterate","relaxation","relieve","reluctant","remainder","remained","reported","request","resistance","resisting","resources","respectively","responsibilites","restored","restraint","restrictions","result","reuters","revealed","reviews","right","rilwanu","rising","river","rocks","rosemary","rumour","rushing","sales","salomon","santos","satisfied","saw","scheduled","scheme","seapride","season","secretary","security","seeing","seek","september","series","serve","services","session","sets","seven","severely","shamrock","sharply","shoulder","show","showed","shown","signed","signs","situation","sixmonth","slackens","slide","slump","social","sold","soon","sort","sour","south","southeast","spend","spill","spoke","spokesman","spotnext","spriggs","stabilise","stabilize","stable","start","statement","steel","steering","steps","stiff","storage","strong","subsequently","substitution","succeed","suffer","suffering","suhartos","sunday","sundays","supply","supporting","suppose","surrounding","swift","talks","tanker","tanurah","tapers","teach","telephone","terminals","test","there","third","thomas","though","thought","threemonth","tide","together","told","totalled","tower","trader","trades","traditional","traditionally","transacted","transmission","transport","trends","trusts","try","turmoil","twofold","uae","uncertain","unchanged","under","unions","unitholders","universitys","unlikely","unocal","unusually","urged","use","virtual","wants","water","wealth","wednesday","weekend","welcomed","when","whether","wishes","worldwide","xon","yergin","yesterdays"],"freq":[85,73,48,42,31,26,24,23,23,21,20,20,18,18,17,15,14,14,14,14,13,11,11,11,11,10,10,10,10,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":4.23529411764706,"backgroundColor":"white","gridSize":0,"minRotation":-0.523598775598299,"maxRotation":-0.523598775598299,"shuffle":true,"rotateRatio":0.5,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>科研作图</category>
  <guid>https://www.chenq.site/qsight/2022-05-06-r-wordcloud2/index.html</guid>
  <pubDate>Fri, 06 May 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-05-06-r-wordcloud2/cover.png" medium="image" type="image/png" height="131" width="144"/>
</item>
<item>
  <title>R语言ggplot2包和gganimate包绘制动态追逐条形图(chasing barchart)</title>
  <dc:creator> 陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-05-04-chasing-barchart/index.html</link>
  <description><![CDATA[ 




<p>最近动态条形图或者称之为追逐条形图在社交媒体上比较火，最常见的是世界各个国家的GDP排名随着时间（以年为单位）变化的情况，通过它可以明显的看到中国的GDP排名从前10名开外逐渐上升到全球第二名的位置。热爱数据可视化的小伙伴们也在想着如何制作这样酷炫的图呢？今天这篇文章的目的就是介绍如何利用R语言绘制这样的动态条形图。</p>
<section id="用到哪些r包" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="用到哪些r包"><span class="header-section-number">1</span> 用到哪些R包？</h2>
<ul>
<li>ggplot2</li>
<li>gganimate</li>
</ul>
<p>ggplot2包和gganimate包是两个主要用到的包，但是我们在数据整理过程中还用到了tidyverse、janitor和scales包。</p>
</section>
<section id="数据准备" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="数据准备"><span class="header-section-number">2</span> 数据准备</h2>
<p>作者在互联网上收集了从1980年以来全球前10位国家的GDP数据，<a href="gdp.csv">数据，点击下载</a>以CSV的形式保存。</p>
<p>我们把数据读入到R环境中，总共有4个变量，year年份、country国家、continent大洲、gdp，下面看下数据的结构，这个数据已经是ggplot2绘图所需要的<em>长数据</em>格式，所以不需要进行特别的转换了。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_51a7a47f9c7fe8805145c6ca77ffeccc">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;">#读入gdp数据</span></span>
<span id="cb1-3">data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read.csv</span>(<span class="st" style="color: #20794D;">"gdp.csv"</span>)</span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;">#显示头6条数据</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year  country continent         gdp
1 1984 澳大利亚    大洋洲 1.93594e+11
2 2019     巴西      美洲 1.87782e+12
3 2018     巴西      美洲 1.91693e+12
4 2017     巴西      美洲 2.06351e+12
5 2016     巴西      美洲 1.79569e+12
6 2015     巴西      美洲 1.80221e+12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1">data1<span class="ot" style="color: #003B4F;">&lt;-</span>data<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">group_by</span>(year)<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">arrange</span>(year,<span class="fu" style="color: #4758AB;">desc</span>(gdp))<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">ranking=</span><span class="fu" style="color: #4758AB;">row_number</span>())<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">filter</span>(ranking<span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">10</span>)</span></code></pre></div>
</div>
</section>
<section id="绘制动态条形图" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="绘制动态条形图"><span class="header-section-number">3</span> 绘制动态条形图</h2>
<p>绘制动态条形图实际需要两个部分，</p>
<ul>
<li>利用ggplot2绘制历年的静态图</li>
<li>利用gganimate包把静态图动起来</li>
</ul>
<p>前面我们已经准备好了绘图的数据，那么我们就先绘制动态条形图每个画面的静态图。我们准备基于GDP的排名展示位于全球前10位的国家，我们需要绘制每年的排名情况。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_fdcf37b103b85fbd82b1f4356b1d731b">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb4-2">plot <span class="ot" style="color: #003B4F;">&lt;-</span> data1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">geom_col</span>(<span class="fu" style="color: #4758AB;">aes</span>(ranking,gdp,<span class="at" style="color: #657422;">fill=</span>continent)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(ranking,gdp,<span class="at" style="color: #657422;">label=</span><span class="fu" style="color: #4758AB;">paste</span>(<span class="fu" style="color: #4758AB;">round</span>(gdp<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">1000000000000</span>,<span class="dv" style="color: #AD0000;">2</span>),<span class="st" style="color: #20794D;">"万亿"</span>)), <span class="at" style="color: #657422;">hjust=</span><span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(ranking,<span class="at" style="color: #657422;">y=</span><span class="dv" style="color: #AD0000;">0</span>,<span class="at" style="color: #657422;">label=</span>country), <span class="at" style="color: #657422;">hjust=</span><span class="fl" style="color: #AD0000;">1.1</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span><span class="dv" style="color: #AD0000;">10</span>, <span class="at" style="color: #657422;">y=</span><span class="fu" style="color: #4758AB;">max</span>(gdp) , <span class="at" style="color: #657422;">label =</span> <span class="fu" style="color: #4758AB;">as.factor</span>(year)), <span class="at" style="color: #657422;">vjust =</span> <span class="fl" style="color: #AD0000;">0.2</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>,  <span class="at" style="color: #657422;">col =</span> <span class="st" style="color: #20794D;">"gray"</span>, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">20</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">label=</span><span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">paste</span>(<span class="fu" style="color: #4758AB;">round</span>(x<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">1000000000000</span>,<span class="dv" style="color: #AD0000;">2</span>),<span class="st" style="color: #20794D;">"万亿"</span>))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;">coord_flip</span>(<span class="at" style="color: #657422;">clip =</span> <span class="st" style="color: #20794D;">"off"</span>, <span class="at" style="color: #657422;">expand =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">scale_x_reverse</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;">theme</span>(</span>
<span id="cb4-12">    <span class="at" style="color: #657422;">panel.grid =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(), </span>
<span id="cb4-13">    <span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>,</span>
<span id="cb4-14">    <span class="at" style="color: #657422;">legend.title=</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb4-15">    <span class="at" style="color: #657422;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb4-16">    <span class="at" style="color: #657422;">axis.title.y =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb4-17">    <span class="at" style="color: #657422;">axis.text.y =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb4-18">    <span class="at" style="color: #657422;">plot.margin =</span> <span class="fu" style="color: #4758AB;">margin</span>(<span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">4</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">3</span>, <span class="st" style="color: #20794D;">"cm"</span>),</span>
<span id="cb4-19">    <span class="at" style="color: #657422;">text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">family=</span><span class="st" style="color: #20794D;">'Kai'</span>)</span>
<span id="cb4-20">  ) </span></code></pre></div>
</div>
<p>上面的代码绘制了动态条形图的每一个画面，也就是每一年的全球GDP排名前10的国家的条形图。当然你也可以对上面的代码进行更改，从而使图更加美观。而进行动态化的关键步骤是使用gganimate包的transition_states()功能，下面的代码使绘制的图按照year这个变量动态变化。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_332f085c3ac46c3ca9722ac6168d850b">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">library</span>(gganimate)</span>
<span id="cb5-2">plot2<span class="ot" style="color: #003B4F;">&lt;-</span>plot<span class="sc" style="color: #5E5E5E;">+</span><span class="fu" style="color: #4758AB;">transition_states</span>(year, <span class="at" style="color: #657422;">state_length =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">transition_length =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">'全球不同国家近40年GDP排名变化情况(前10位)'</span>,  </span>
<span id="cb5-4">       <span class="at" style="color: #657422;">caption  =</span> <span class="st" style="color: #20794D;">"GDP in Billions USD | Data Source: World Bank Data"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">enter_fade</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;">exit_fade</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;">ease_aes</span>(<span class="st" style="color: #20794D;">'quadratic-in-out'</span>) </span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;">animate</span>(plot2, <span class="at" style="color: #657422;">width =</span> <span class="dv" style="color: #AD0000;">800</span>, <span class="at" style="color: #657422;">height =</span> <span class="dv" style="color: #AD0000;">500</span>, <span class="at" style="color: #657422;">fps =</span> <span class="dv" style="color: #AD0000;">25</span>, <span class="at" style="color: #657422;">duration =</span> <span class="dv" style="color: #AD0000;">15</span>, <span class="at" style="color: #657422;">rewind =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-05-04-chasing-barchart/index_files/figure-html/unnamed-chunk-3-1.gif" class="img-fluid"></p>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">anim_save</span>(<span class="st" style="color: #20794D;">"pp.gif"</span>)</span></code></pre></div>
</div>
<p><img src="https://www.chenq.site/qsight/2022-05-04-chasing-barchart/pp.gif" class="img-fluid" alt="追逐条形图"> ## 小结 我们已经成功的绘制了全球gdp前10的国家在过去40年里动态变化的过程，而只要按照我们前面的准备的数据格式整理自己的数据，那么也很容易地能套用这个代码，从而实现自己的动态条形图。</p>


</section>

 ]]></description>
  <category>R</category>
  <category>科研作图</category>
  <guid>https://www.chenq.site/qsight/2022-05-04-chasing-barchart/index.html</guid>
  <pubDate>Wed, 04 May 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-05-04-chasing-barchart/pp.gif" medium="image" type="image/gif"/>
</item>
<item>
  <title>利用ggplot2包绘制barplot简单条形图</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index.html</link>
  <description><![CDATA[ 




<section id="什么是条形图" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="什么是条形图"><span class="header-section-number">1</span> 什么是条形图？</h2>
<p>条形图（bar chart）是用宽度相同的条形的高度或长短来表示数据多少的图形。条形图可以横置或纵置，纵置时也称为柱形图（column chart）。此外，条形图有简单条形图、复式条形图等形式。</p>
</section>
<section id="条形图有哪些类型" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="条形图有哪些类型"><span class="header-section-number">2</span> 条形图有哪些类型</h2>
<ul>
<li>简单条形图：</li>
<li>簇状条形图和三维簇状条形图：簇状条形图比较各个类别的值。在簇状条形图中，通常沿垂直轴组织类别，而沿水平轴组织数值。三维簇状条形图以三维格式显示水平矩形，而不以三维格式显示数据。</li>
<li>堆积条形图和三维堆积条形图：堆积条形图显示单个项目与整体之间的关系。三维堆积条形图以三维格式显示水平矩形，而不以三维格式显示数据。</li>
<li>百分比堆积条形图和三维百分比堆积条形图：此类型的图表比较各个类别的每一数值所占总数值的百分比大小。三维百分比堆积条形图表以三维格式显示水平矩形，而不以三维格式显示数据。</li>
</ul>
</section>
<section id="如何绘制barplot条形图" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="如何绘制barplot条形图"><span class="header-section-number">3</span> 如何绘制barplot条形图？</h2>
<section id="绘制简单barplot条形图" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="绘制简单barplot条形图"><span class="header-section-number">3.1</span> 绘制简单barplot条形图</h3>
<p>如果你还没有安装ggplot2包，那么请先安装此包，如果已经安装，请忽略此步骤。</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"ggplot2"</span>)</span></code></pre></div>
<p>首先，准备一下绘制barplot条形图所需的数据，我们就拿<a href="https://chenq.site/report/2020/">河南省前10位癌症发病率数据</a>来举例。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_d96433adea24f9b699e8910203fe381b">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1">data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(</span>
<span id="cb2-2">  <span class="at" style="color: #657422;">site=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"肺癌"</span>,<span class="st" style="color: #20794D;">"乳腺癌"</span>,<span class="st" style="color: #20794D;">"胃癌"</span>,<span class="st" style="color: #20794D;">"食管癌"</span>,<span class="st" style="color: #20794D;">"肝癌"</span>,<span class="st" style="color: #20794D;">"宫颈癌"</span>,<span class="st" style="color: #20794D;">"结直肠癌"</span>,<span class="st" style="color: #20794D;">"子宫体癌"</span>,<span class="st" style="color: #20794D;">"甲状腺癌"</span>,<span class="st" style="color: #20794D;">"卵巢癌"</span>),</span>
<span id="cb2-3">  <span class="at" style="color: #657422;">incid=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">53.35</span>,<span class="fl" style="color: #AD0000;">39.25</span>,<span class="fl" style="color: #AD0000;">35.74</span>,<span class="fl" style="color: #AD0000;">31.11</span>,<span class="fl" style="color: #AD0000;">29.15</span>,<span class="fl" style="color: #AD0000;">19.24</span>,<span class="fl" style="color: #AD0000;">18.15</span>,<span class="fl" style="color: #AD0000;">9.99</span>,<span class="fl" style="color: #AD0000;">7.92</span>,<span class="fl" style="color: #AD0000;">7.04</span>))</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    site incid
1   肺癌 53.35
2 乳腺癌 39.25
3   胃癌 35.74
4 食管癌 31.11
5   肝癌 29.15
6 宫颈癌 19.24</code></pre>
</div>
</div>
<p>利用ggplot2包的geom_bar()函数绘制简单条形图</p>
<div class="cell" data-hash="index_cache/html/feature_c8774708685bd9499de906fde8e62ea9">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb4-3">plot <span class="ot" style="color: #003B4F;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-4">  <span class="co" style="color: #5E5E5E;"># 通过reorder(site,-incid)来改变条形的顺序，按照incid值的大小排列条形</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span><span class="fu" style="color: #4758AB;">reorder</span>(site,incid), <span class="at" style="color: #657422;">y=</span>incid)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-6">  <span class="co" style="color: #5E5E5E;"># 输出条形图，并把条形填充为蓝色</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">stat=</span><span class="st" style="color: #20794D;">"identity"</span>,<span class="at" style="color: #657422;">fill=</span><span class="st" style="color: #20794D;">"steelblue"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">text=</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">family=</span><span class="st" style="color: #20794D;">"STKaiti"</span>,<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">14</span>))</span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;">ggsave</span>(<span class="st" style="color: #20794D;">"plot.png"</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/plot.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">条形图</figcaption><p></p>
</figure>
</div>
<p>把垂直条形图转换为水平条形图，通过coord_fip()坐标轴转换函数实现。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_1e4b0c6888d0094b7f677a2c29afab50">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1">plot <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb5-2">  <span class="co" style="color: #5E5E5E;"># 转置坐标轴</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">coord_flip</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" alt="简单条形图" width="672"></p>
<p></p><figcaption class="figure-caption">条形图：坐标轴转置</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ggplot2包里有一些自带的主题，我们可以应用这些主题来快速的调整图的样式。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_485d194a5fa5511272263e7de722f548">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1">plot<span class="sc" style="color: #5E5E5E;">+</span><span class="fu" style="color: #4758AB;">coord_flip</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-2">  <span class="co" style="color: #5E5E5E;"># 使用classic主题</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-4">    <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">text=</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">family=</span><span class="st" style="color: #20794D;">"STKaiti"</span>,<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">14</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>然后我们进一步对条形图进行修饰，比如更改坐标轴标题、把x轴由底部调整至顶部显示、添加条形图数据标签等等。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_5594bd68b8451d2d64b4017775abe1a9">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1">plot<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-2">  <span class="co" style="color: #5E5E5E;"># 对坐标轴进行转置</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">coord_flip</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-4">  <span class="co" style="color: #5E5E5E;"># 使用经典的科研作图主题</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-6">  <span class="co" style="color: #5E5E5E;"># 设置x轴标题</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"癌种"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-8">  <span class="co" style="color: #5E5E5E;"># 设置y轴标题</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"发病率(1/10万)"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-10">  <span class="co" style="color: #5E5E5E;"># 把转置后的x轴位置调整到顶部显示</span></span>
<span id="cb7-11">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">position=</span><span class="st" style="color: #20794D;">"right"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-12">  <span class="co" style="color: #5E5E5E;"># 添加数据标签</span></span>
<span id="cb7-13">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label=</span>incid), <span class="at" style="color: #657422;">size=</span><span class="fl" style="color: #AD0000;">3.5</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-14"> <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">text=</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">family=</span><span class="st" style="color: #20794D;">"STKaiti"</span>,<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">14</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="绘制分组barplot条形图" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="绘制分组barplot条形图"><span class="header-section-number">3.2</span> 绘制分组barplot条形图</h3>
<p>准备绘制分组条形图的数据，我们可以添加不同癌种的死亡率数据，分为两组：发病率和死亡率。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_b742624af3756c2316cf8fe67755ee21">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1">data2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(</span>
<span id="cb8-2">  <span class="at" style="color: #657422;">site=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"肺癌"</span>,<span class="st" style="color: #20794D;">"乳腺癌"</span>,<span class="st" style="color: #20794D;">"胃癌"</span>,<span class="st" style="color: #20794D;">"食管癌"</span>,<span class="st" style="color: #20794D;">"肝癌"</span>,<span class="st" style="color: #20794D;">"宫颈癌"</span>,<span class="st" style="color: #20794D;">"结直肠癌"</span>,<span class="st" style="color: #20794D;">"子宫体癌"</span>,<span class="st" style="color: #20794D;">"甲状腺癌"</span>,<span class="st" style="color: #20794D;">"卵巢癌"</span>,<span class="st" style="color: #20794D;">"肺癌"</span>,<span class="st" style="color: #20794D;">"乳腺癌"</span>,<span class="st" style="color: #20794D;">"胃癌"</span>,<span class="st" style="color: #20794D;">"食管癌"</span>,<span class="st" style="color: #20794D;">"肝癌"</span>,<span class="st" style="color: #20794D;">"宫颈癌"</span>,<span class="st" style="color: #20794D;">"结直肠癌"</span>,<span class="st" style="color: #20794D;">"子宫体癌"</span>,<span class="st" style="color: #20794D;">"甲状腺癌"</span>,<span class="st" style="color: #20794D;">"卵巢癌"</span>),</span>
<span id="cb8-3">  <span class="at" style="color: #657422;">type=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">rep</span>(<span class="st" style="color: #20794D;">"发病率"</span>,<span class="dv" style="color: #AD0000;">10</span>),<span class="fu" style="color: #4758AB;">rep</span>(<span class="st" style="color: #20794D;">"死亡率"</span>,<span class="dv" style="color: #AD0000;">10</span>)),</span>
<span id="cb8-4">  <span class="at" style="color: #657422;">value=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">53.35</span>,<span class="fl" style="color: #AD0000;">39.25</span>,<span class="fl" style="color: #AD0000;">35.74</span>,<span class="fl" style="color: #AD0000;">31.11</span>,<span class="fl" style="color: #AD0000;">29.15</span>,<span class="fl" style="color: #AD0000;">19.24</span>,<span class="fl" style="color: #AD0000;">18.15</span>,<span class="fl" style="color: #AD0000;">9.99</span>,<span class="fl" style="color: #AD0000;">7.92</span>,<span class="fl" style="color: #AD0000;">7.04</span>,<span class="fl" style="color: #AD0000;">41.22</span>,<span class="fl" style="color: #AD0000;">9.92</span>,<span class="fl" style="color: #AD0000;">27.87</span>,<span class="fl" style="color: #AD0000;">23.36</span>,<span class="fl" style="color: #AD0000;">24.46</span>,<span class="fl" style="color: #AD0000;">6.05</span>,<span class="fl" style="color: #AD0000;">8.85</span>,<span class="fl" style="color: #AD0000;">2.16</span>,<span class="fl" style="color: #AD0000;">0.76</span>,<span class="fl" style="color: #AD0000;">3.00</span>))</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    site incid
1   肺癌 53.35
2 乳腺癌 39.25
3   胃癌 35.74
4 食管癌 31.11
5   肝癌 29.15
6 宫颈癌 19.24</code></pre>
</div>
</div>
<p>ggplot2在使用fill添加分组选项时，会默认绘制堆积条形图，我们可以使用position_dodge() 函数来改变默认情况，绘制分组条形图。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_0d3aa959a912e46f76095838610b5e2c">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1">data2<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span><span class="fu" style="color: #4758AB;">reorder</span>(site,value), <span class="at" style="color: #657422;">y=</span>value, <span class="at" style="color: #657422;">fill=</span>type)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-3">  <span class="co" style="color: #5E5E5E;"># 使用position=position_dodge()改变堆积条图为分组条图</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">stat=</span><span class="st" style="color: #20794D;">"identity"</span>,<span class="at" style="color: #657422;">position=</span><span class="fu" style="color: #4758AB;">position_dodge</span>())<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">coord_flip</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">position =</span> <span class="st" style="color: #20794D;">"right"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"癌种"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"率(1/10万)"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label=</span>value),<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">2</span>,<span class="at" style="color: #657422;">position=</span><span class="fu" style="color: #4758AB;">position_dodge</span>(<span class="fl" style="color: #AD0000;">0.9</span>))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-11">    <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">text=</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">family=</span><span class="st" style="color: #20794D;">"STKaiti"</span>,<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">14</span>))<span class="ot" style="color: #003B4F;">-&gt;</span>plot2</span>
<span id="cb10-12">plot2</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>我们可以改变条形图条的颜色，也可以修改图例的位置、标题等等。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_607fb131b15483838c7464180a5d5396">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1">plot2<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-2">  <span class="co" style="color: #5E5E5E;"># 修改条的颜色为以下两个色号</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">'#999999'</span>,<span class="st" style="color: #20794D;">'#E69F00'</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;"># 我们也可以使用color palettes改变分组条图的颜色</span></span>
<span id="cb12-2">plot2<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;">scale_fill_brewer</span>(<span class="at" style="color: #657422;">palette=</span><span class="st" style="color: #20794D;">"Blues"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;"># 我们可以利用theme()对图例进行修改</span></span>
<span id="cb13-2">plot2<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">theme</span>(</span>
<span id="cb13-4">    <span class="co" style="color: #5E5E5E;"># 修改图例的位置</span></span>
<span id="cb13-5">    <span class="at" style="color: #657422;">legend.position =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">0.8</span>,<span class="fl" style="color: #AD0000;">0.2</span>),</span>
<span id="cb13-6">    <span class="co" style="color: #5E5E5E;"># 取消图例的标题</span></span>
<span id="cb13-7">    <span class="at" style="color: #657422;">legend.title=</span><span class="fu" style="color: #4758AB;">element_blank</span>()</span>
<span id="cb13-8">  )</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>科研作图</category>
  <guid>https://www.chenq.site/qsight/2022-04-29-ggplot2-barplot/index.html</guid>
  <pubDate>Fri, 29 Apr 2022 00:00:00 GMT</pubDate>
</item>
<item>
  <title>利用阿里云DataV可视化平台数据以及ggplot2包的geom_sf函数绘制统计地图</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-04-29-datav/index.html</link>
  <description><![CDATA[ 




<section id="什么是统计地图" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="什么是统计地图"><span class="header-section-number">1</span> 什么是统计地图？</h2>
<p>统计地图是以地图为背景，运用各种线纹、色彩、几何图形或实物形象来显示被研究现象的指标数值的大小及其在各地区的分布状况的一种统计图形。又称空间数列图和地理数列图。主要用于说明某些现象在地域上的分布，进行不同地区间的比较，反映现象所处的地理位置，以及它们的密集和分散程度。</p>
</section>
<section id="制作统计地图的难点有哪些" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="制作统计地图的难点有哪些"><span class="header-section-number">2</span> 制作统计地图的难点有哪些？</h2>
<p>在流行病学研究中，往往需要通过以统计地图的形式来展示数据的空间分布情况。然而，我们一般很难找到合适的用于绘制统计地图的地图边界数据。要么找到的地图行政区划边界数据太旧，实际的行政区划边界已经发生了改变，要么就是找不到相应的数据。</p>
<p>目前还有一些制作统计地图的网站，可以提供绘制简单的统计地图的功能，但是基本上这些服务都是以收费为目的地，不符合互联网上开源自由的精神，但是如果同学不缺钱，那就可以去试试哈！</p>
</section>
<section id="如何利用阿里云datav可视化平台地图数据" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="如何利用阿里云datav可视化平台地图数据"><span class="header-section-number">3</span> 如何利用阿里云DataV可视化平台地图数据?</h2>
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/preview.png" class="img-fluid"></p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_5b195a6e6b025514837cea829491c303">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/preview.png" class="img-fluid" width="1086"></p>
</div>
</div>
<p>利用<strong>sf包</strong>读取阿里云DataV可视化平台的提供的json格式的区划边界数据，读取数据之后，可以利用统计地图相关包如ggplot2、leaflet等包来绘制相应的统计地图。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_5151299f5cc0bad1a368dc27a1bfe8d6">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;">#加载sf包</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(sf)</span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;">#加载ggplot2包</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;">rm</span>(<span class="at" style="color: #657422;">list =</span> <span class="fu" style="color: #4758AB;">ls</span>())</span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;">#利用read_sf函数读取json格式边界数据</span></span>
<span id="cb1-8">china1 <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">read_sf</span>(<span class="st" style="color: #20794D;">"https://geo.datav.aliyun.com/areas_v2/bound/100000_full.json"</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;">#利用ggplot2包geom_sf()函数绘制地图</span></span>
<span id="cb1-11">china1<span class="sc" style="color: #5E5E5E;">%&gt;%</span><span class="fu" style="color: #4758AB;">ggplot</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;">geom_sf</span>(<span class="at" style="color: #657422;">fill=</span><span class="cn" style="color: #8f5902;">NA</span>,<span class="at" style="color: #657422;">color=</span><span class="st" style="color: #20794D;">"black"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>也可以利用<strong>geojsonio包</strong>读取数据，然后利用st_as_sf()函数转换为sf数据，就可以再利用ggplot2包的geom_sf()函数绘制地图了。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_ae1cd812a76126ab626d9377e50fc81c">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;">#加载geojsonio包</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;">library</span>(geojsonio)</span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;">#利用geojsonio包读取json格式数据为sp数据</span></span>
<span id="cb2-4">states <span class="ot" style="color: #003B4F;">&lt;-</span> geojsonio<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">geojson_read</span>(<span class="st" style="color: #20794D;">"https://geo.datav.aliyun.com/areas_v3/bound/410000_full.json"</span>, <span class="at" style="color: #657422;">what =</span> <span class="st" style="color: #20794D;">"sp"</span>)</span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;">#将地理空间数据转换为sf数据</span></span>
<span id="cb2-6">states2<span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">st_as_sf</span>(states)</span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;">#利用ggplot2包geom_sf()函数绘制地图</span></span>
<span id="cb2-8">states2<span class="sc" style="color: #5E5E5E;">%&gt;%</span><span class="fu" style="color: #4758AB;">ggplot</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;">geom_sf</span>(<span class="at" style="color: #657422;">fill=</span><span class="cn" style="color: #8f5902;">NA</span>,<span class="at" style="color: #657422;">color=</span><span class="st" style="color: #20794D;">"black"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>可以根据行政区划编码直接读取个别省份或市区的区划边界数据，比如，河南省的区划边界数据存放在<a href="https://geo.datav.aliyun.com/areas_v3/bound/410000.json">https://geo.datav.aliyun.com/areas_v3/bound/410000.json</a>，这个边界数据仅包含省界，不包含下一级的市区的边界数据；而包含市区边界数据存放在<a href="https://geo.datav.aliyun.com/areas_v3/bound/410000_full.json">https://geo.datav.aliyun.com/areas_v3/bound/410000_full.json</a>。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_f46fb8ec6b13f84dda620aabf11352ed">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;">#读取仅有河南省省界的json数据</span></span>
<span id="cb3-2">hn1 <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">read_sf</span>(<span class="st" style="color: #20794D;">"https://geo.datav.aliyun.com/areas_v3/bound/410000.json"</span>)</span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;">#读取具有河南省各市区边界的json数据</span></span>
<span id="cb3-4">hn2 <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">read_sf</span>(<span class="st" style="color: #20794D;">"https://geo.datav.aliyun.com/areas_v3/bound/410000_full.json"</span>)</span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;">#利用ggplot2包geom_sf函数绘制河南省省界</span></span>
<span id="cb3-6">hn1<span class="sc" style="color: #5E5E5E;">%&gt;%</span><span class="fu" style="color: #4758AB;">ggplot</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">geom_sf</span>(<span class="at" style="color: #657422;">fill=</span><span class="cn" style="color: #8f5902;">NA</span>,<span class="at" style="color: #657422;">color=</span><span class="st" style="color: #20794D;">"black"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;">#利用geom_sf函数绘制河南省省界及各市区边界</span></span>
<span id="cb4-2">hn2<span class="sc" style="color: #5E5E5E;">%&gt;%</span><span class="fu" style="color: #4758AB;">ggplot</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">geom_sf</span>(<span class="at" style="color: #657422;">fill=</span><span class="cn" style="color: #8f5902;">NA</span>,<span class="at" style="color: #657422;">color=</span><span class="st" style="color: #20794D;">"black"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;">#读取洛阳市各区县边界数据，并绘制地图</span></span>
<span id="cb5-2">ly <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">read_sf</span>(<span class="st" style="color: #20794D;">"https://geo.datav.aliyun.com/areas_v3/bound/410300_full.json"</span>)</span>
<span id="cb5-3">ly<span class="sc" style="color: #5E5E5E;">%&gt;%</span><span class="fu" style="color: #4758AB;">ggplot</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;">geom_sf</span>(<span class="at" style="color: #657422;">fill=</span><span class="cn" style="color: #8f5902;">NA</span>,<span class="at" style="color: #657422;">color=</span><span class="st" style="color: #20794D;">"black"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/index_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="如何绘制统计地图" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="如何绘制统计地图"><span class="header-section-number">4</span> 如何绘制统计地图？</h2>
<p>可以拿中国各省的疫情数据来回绘制疫情分布地图，首先要准备各省的疫情流行数据,生成一个数据框，addcode存放各省的行政区划编码，此变量的值要与地图数据里的行政区划编码一致；num变量存放各省的现存新冠病人数量,然后把该变量转为因子型变量。</p>
<p>实现代码如下：</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_2ec9d7c7c20d81652ad0a03c60e35509">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">library</span>(RColorBrewer)</span>
<span id="cb6-2">data<span class="ot" style="color: #003B4F;">&lt;-</span><span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">adcode=</span><span class="fu" style="color: #4758AB;">c</span>( <span class="st" style="color: #20794D;">"110000"</span>, <span class="st" style="color: #20794D;">"120000"</span> ,<span class="st" style="color: #20794D;">"130000"</span> ,<span class="st" style="color: #20794D;">"140000"</span>, <span class="st" style="color: #20794D;">"150000"</span> ,<span class="st" style="color: #20794D;">"210000"</span>, <span class="st" style="color: #20794D;">"220000"</span> ,<span class="st" style="color: #20794D;">"230000"</span>, <span class="st" style="color: #20794D;">"310000"</span> ,<span class="st" style="color: #20794D;">"320000"</span>, <span class="st" style="color: #20794D;">"330000"</span> ,<span class="st" style="color: #20794D;">"340000"</span> ,<span class="st" style="color: #20794D;">"350000"</span> ,<span class="st" style="color: #20794D;">"360000"</span>, <span class="st" style="color: #20794D;">"370000"</span>, <span class="st" style="color: #20794D;">"410000"</span>, <span class="st" style="color: #20794D;">"420000"</span>, <span class="st" style="color: #20794D;">"430000"</span> ,<span class="st" style="color: #20794D;">"440000"</span> ,<span class="st" style="color: #20794D;">"450000"</span> ,<span class="st" style="color: #20794D;">"460000"</span>, <span class="st" style="color: #20794D;">"500000"</span> ,<span class="st" style="color: #20794D;">"510000"</span> ,<span class="st" style="color: #20794D;">"520000"</span> ,<span class="st" style="color: #20794D;">"530000"</span> ,<span class="st" style="color: #20794D;">"540000"</span> ,<span class="st" style="color: #20794D;">"610000"</span>, <span class="st" style="color: #20794D;">"620000"</span>, <span class="st" style="color: #20794D;">"630000"</span>, <span class="st" style="color: #20794D;">"640000"</span>, <span class="st" style="color: #20794D;">"650000"</span> ,<span class="st" style="color: #20794D;">"710000"</span> ,<span class="st" style="color: #20794D;">"810000"</span>, <span class="st" style="color: #20794D;">"820000"</span> ,<span class="st" style="color: #20794D;">"100000"</span>),</span>
<span id="cb6-3">                 <span class="at" style="color: #657422;">num=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">391</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">13</span>,<span class="dv" style="color: #AD0000;">28</span>,<span class="dv" style="color: #AD0000;">60</span>,<span class="dv" style="color: #AD0000;">40</span>,<span class="dv" style="color: #AD0000;">884</span>,<span class="dv" style="color: #AD0000;">230</span>,<span class="dv" style="color: #AD0000;">12988</span>,<span class="dv" style="color: #AD0000;">30</span>,<span class="dv" style="color: #AD0000;">609</span>,<span class="dv" style="color: #AD0000;">7</span>,<span class="dv" style="color: #AD0000;">50</span>,<span class="dv" style="color: #AD0000;">220</span>,<span class="dv" style="color: #AD0000;">70</span>,<span class="dv" style="color: #AD0000;">36</span>,<span class="dv" style="color: #AD0000;">4</span>,<span class="dv" style="color: #AD0000;">26</span>,<span class="dv" style="color: #AD0000;">169</span>,<span class="dv" style="color: #AD0000;">23</span>,<span class="dv" style="color: #AD0000;">15</span>,<span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">74</span>,<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">27</span>,<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">20</span>,<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">8</span>,<span class="dv" style="color: #AD0000;">13742</span>,<span class="dv" style="color: #AD0000;">59661</span>,<span class="dv" style="color: #AD0000;">500</span>,<span class="dv" style="color: #AD0000;">0</span>))</span>
<span id="cb6-4">data<span class="sc" style="color: #5E5E5E;">$</span>num[<span class="dv" style="color: #AD0000;">35</span>] <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">sum</span>(data<span class="sc" style="color: #5E5E5E;">$</span>num[<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">34</span>])</span>
<span id="cb6-5"></span>
<span id="cb6-6">china2<span class="ot" style="color: #003B4F;">&lt;-</span>china1<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;">left_join</span>(data,<span class="at" style="color: #657422;">by=</span><span class="st" style="color: #20794D;">"adcode"</span>)<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">case=</span><span class="fu" style="color: #4758AB;">cut</span>(num,<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">10</span>,<span class="dv" style="color: #AD0000;">100</span>,<span class="dv" style="color: #AD0000;">500</span>,<span class="dv" style="color: #AD0000;">1000</span>,<span class="dv" style="color: #AD0000;">10000</span>,<span class="dv" style="color: #AD0000;">50000</span>),<span class="at" style="color: #657422;">include.lowest=</span>T,<span class="at" style="color: #657422;">right=</span>F))</span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;">ggplot</span>(china2)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;">geom_sf</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;">theme_void</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;">geom_sf</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">fill=</span>case))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(</span>
<span id="cb6-15">    <span class="at" style="color: #657422;">name=</span><span class="st" style="color: #20794D;">"现存病例数"</span>,</span>
<span id="cb6-16">    <span class="at" style="color: #657422;">values =</span> <span class="fu" style="color: #4758AB;">brewer.pal</span>(<span class="dv" style="color: #AD0000;">7</span>,<span class="st" style="color: #20794D;">"Reds"</span>),</span>
<span id="cb6-17">    <span class="at" style="color: #657422;">labels=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"0-10"</span>,<span class="st" style="color: #20794D;">"10-100"</span>,<span class="st" style="color: #20794D;">"100-500"</span>, <span class="st" style="color: #20794D;">"500-1000"</span>,<span class="st" style="color: #20794D;">"1000-10000"</span>,<span class="st" style="color: #20794D;">"10000-50000"</span>,<span class="st" style="color: #20794D;">"&gt;50000"</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-29-datav/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>科研作图</category>
  <guid>https://www.chenq.site/qsight/2022-04-29-datav/index.html</guid>
  <pubDate>Fri, 29 Apr 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-04-29-datav/preview.png" medium="image" type="image/png" height="83" width="144"/>
</item>
<item>
  <title>利用R语言Rmd文档+blogdown包制作个人网站</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-04-26-website/index.html</link>
  <description><![CDATA[ 




<p>本篇文章将介绍如何利用R语言blogdown包生成一个静态网站，从而用来展示个人信息、撰写博客、或者分享其他信息。</p>
<blockquote class="blockquote">
<p>静态页面实际上说的是相对于相对于动态网页而言，它没有后台数据库、不含程序，是不能交互的网页。代码编的是什么它显示的就是什么、不会有任何改变。</p>
</blockquote>
<p>Blogdown生成静态网页的过程实际只是由Blogdown包把Rmd转化成普通的markdown文本，然后由Hugo把markdown文本生成静态网页。</p>
<section id="准备环境" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="准备环境"><span class="header-section-number">1</span> 准备环境</h2>
<p>本文将介绍如何在windows环境下，利用Blogdown生成静态网页。在介绍具体步骤之前，需要提前准备好相应的软件和环境。</p>
<section id="安装r和r-studio" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="安装r和r-studio"><span class="header-section-number">1.1</span> 安装R和R studio</h3>
<ul>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/CRAN/bin/windows/base/R-4.2.0-win.exe">下载</a>并安装R语言和<a href="https://download1.rstudio.org/desktop/windows/RStudio-2022.02.1-461.exe">R studio</a></li>
</ul>
</section>
<section id="安装blogdown包" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="安装blogdown包"><span class="header-section-number">1.2</span> 安装blogdown包</h3>
<p>安装稳定版本的blogdown</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"blogdown"</span>)</span></code></pre></div>
<p>或者安装开发版本的blogdown</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1">remotes<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">install_github</span>(<span class="st" style="color: #20794D;">'rstudio/blogdown'</span>)</span></code></pre></div>
</section>
<section id="安装hugo" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="安装hugo"><span class="header-section-number">1.3</span> 安装HUGO</h3>
<p>Hugo 是一个用 Go 编写的静态网站生成器，一般只需几秒钟就能生成一个网站（每页少于 1 毫秒），被称为“世界上最快的网站构建框架”，也使 Hugo大受欢迎，成为最热门的静态网站生成器之一，被广泛采用。你可以在这里<a href="https://github.com/gohugoio/hugo/releases">下载不同版本的HUGO</a></p>
<p>在Windows环境下，你可以通过以下几种方式安装hugo，在上面的链接中找出对应的Windows版本下载到本地，然后解压缩。</p>
<ol type="1">
<li>第一种方式：直接双击 hugo.exe 可执行文件进行安装，自动安装就可以了。</li>
<li>第二种方式：把解压后的hugo.exe的路径添加到系统环境变量中。</li>
<li>第二种方式：在通过blogdown建立新的project的时候，勾选安装hugo选项，但是国内不建议采用这种方式，因为速度很慢，而且常常安装不成功，但是如果你在墙外，可以使用这种方法。</li>
</ol>
</section>
</section>
<section id="使用blogdown建立一个网站" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="使用blogdown建立一个网站"><span class="header-section-number">2</span> 使用blogdown建立一个网站</h2>
<section id="选择一个hugo网站模板" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="选择一个hugo网站模板"><span class="header-section-number">2.1</span> 选择一个Hugo网站模板</h3>
<p>使用hugo建立静态网站的优势不仅是速度快，而且因为它有着丰富的模板，模板的源代码都存储在github上，你可以<a href="https://themes.gohugo.io/">点击这里</a>选择一个适合自己的网站模板，然后把它在github上的地址复制下来。</p>
<p>如果你喜欢<a href="https://themes.gohugo.io/themes/mainroad/">MainRoad</a>的模板， 可以点击<strong>Download</strong>，会进入模板在github的存储页面，然后把模板的路径复制下来<strong>Vimux/Mainroad</strong>，后面会用到。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2022-04-26-website/theme.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Hugo 主题</figcaption><p></p>
</figure>
</div>
</section>
<section id="使用blogdown生成一个新的网站项目" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="使用blogdown生成一个新的网站项目"><span class="header-section-number">2.2</span> 使用blogdown生成一个新的网站项目</h3>
<ul>
<li>在R studio里点击 File–New Project，选择 <strong>New Directory</strong></li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_fa1af5079eea91e47a141f45b6872211">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-26-website/first.png" class="img-fluid" width="533"></p>
</div>
</div>
<ul>
<li>然后，选择Website using blogdown</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_2ce758f5e2f657b518002eda70a7af76">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-26-website/second.png" class="img-fluid" width="532"></p>
</div>
</div>
<ul>
<li>最后，在blogdown建立新项目的选项面板中，按照下面的选项填写完整，然后点击 Create Project 创建项目</li>
</ul>
<ol type="1">
<li>Directory name: 填入你新建项目所在文件夹名称；</li>
<li>Create project as subdirectory of：</li>
<li>hugo theme： 填入前面步骤中复制的网站模板的github路径，以 “github账户名/仓库名称”的格式填入，我们想要创建网站的模板的存放路径为：Vimux/Mainroad</li>
<li>最下面的复选框可以按照默认的选项选择，但是如果已经安装hugo的话，记得把Install Hugo if not installed前面的复选框取消掉。</li>
</ol>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_2a037534cce41db5b2655beed070a74d">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-26-website/third.png" class="img-fluid" width="536"></p>
</div>
</div>
<ul>
<li>完成后，在 R studio 中，点击 Addins – Serve site 可以在本地渲染网站，可以在 R studio 的右下栏中可以看到渲染的网站的样子。</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_282657f09e3ae83f94bad6850451ad09">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-26-website/preview.png" class="img-fluid" width="1128"></p>
</div>
</div>
</section>
<section id="新建一篇博文" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="新建一篇博文"><span class="header-section-number">2.3</span> 新建一篇博文</h3>
<p>点击 Addins – New Post ，填入题目，作者，标签或者分类，在Format 选项里可以选择使用普通的markdown(不能运行R程序)、.Rmd和.Rmarkdown(可以运行R程序)。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_376ddb90f1e1d9aab86dd1dc94438d3f">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-26-website/newpost.png" class="img-fluid" width="621"></p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>个人网站</category>
  <guid>https://www.chenq.site/qsight/2022-04-26-website/index.html</guid>
  <pubDate>Tue, 26 Apr 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-04-26-website/preview.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>利用Rmd代码选项输出动态金字塔图</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-04-25-rmd/index.html</link>
  <description><![CDATA[ 




<p><strong><em>人口金字塔图</em></strong>可以形象的展示人口结构，而动态人口金字塔则可以直观的展示历年人口结构的变化情况，从而可以直观的对人口数据进行质量控制，本篇博文讲介绍如何利用R语言Rmd文档输出动态人口金字塔图。</p>
<p>首先，我们先看一下需要准备的人口数据结构,数据集包含某个地区男性和女性每年的不同年龄组的人口数（5岁一组），年份变量为year，性别变量为sex，人口数据分别为r0、r1、r5、r10、… 、r85等。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_15a4ce92de0c3e32b3b078d870defe58">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1">data<span class="ot" style="color: #003B4F;">&lt;-</span><span class="fu" style="color: #4758AB;">read.csv</span>(<span class="st" style="color: #20794D;">"population.csv"</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year  sex   r0    r1    r5   r10   r15   r20   r25   r30   r35   r40   r45
1 2009 男性 5992 22345 25843 26164 43929 54912 58033 47602 54539 50224 40894
2 2009 女性 5857 22146 24908 25507 48444 47977 52270 46133 48743 44852 39429
3 2010 男性 6583 39619 42627 39820 45037 54131 34227 34382 42964 47668 38828
4 2010 女性 5484 30619 32323 31418 40701 56864 36506 34890 42224 48566 40392
5 2011 男性 5798 33931 40512 38334 47433 49693 33125 34833 47700 50181 42654
6 2011 女性 4983 29613 34439 33614 43799 51384 34154 35228 45182 47480 40500
    r50   r55   r60   r65   r70  r75  r80  r85
1 40855 29236 18125 13376 10564 6242 2369  577
2 39600 28104 18908 14984 11186 6425 3363 1408
3 28353 32932 24141 16239 11913 8333 4241 1970
4 28425 32685 23329 16139 12245 9821 5835 3879
5 33943 33498 22853 15307 12274 8428 4032 1694
6 32253 32249 22456 15207 12998 9966 5459 3507</code></pre>
</div>
</div>
<section id="作图思路" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="作图思路"><span class="header-section-number">1</span> 作图思路</h2>
<p>首先把现有的数据从<strong>宽数据</strong>转换为<strong>长数据</strong>，然后对数据进行简单处理，最后利用for循环和ggplot2输出多个年份的人口金字塔图，然后利用code chunk 选项输出动态图片。</p>
</section>
<section id="数据处理" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="数据处理"><span class="header-section-number">2</span> 数据处理</h2>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_6b76efc4d074030518966fce8130c338">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;">library</span>(tidyr)</span>
<span id="cb3-3">data <span class="ot" style="color: #003B4F;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-4">  <span class="do" style="color: #5E5E5E;
font-style: italic;">## 把宽数据转换为长数据</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">gather</span>(<span class="st" style="color: #20794D;">"agegrp"</span>,<span class="st" style="color: #20794D;">"rks"</span>,<span class="sc" style="color: #5E5E5E;">-</span>year,<span class="sc" style="color: #5E5E5E;">-</span>sex)<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-6">  <span class="do" style="color: #5E5E5E;
font-style: italic;">## 整理年龄组变量，添加标签转换显示格式</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">agegrp=</span><span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"[^0-9]"</span>, <span class="st" style="color: #20794D;">""</span>, agegrp)),</span>
<span id="cb3-8">         <span class="at" style="color: #657422;">agegrp=</span><span class="fu" style="color: #4758AB;">factor</span>(agegrp,<span class="at" style="color: #657422;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"0"</span>,<span class="st" style="color: #20794D;">"1-4"</span>,<span class="st" style="color: #20794D;">"5-9"</span>,<span class="st" style="color: #20794D;">"10-14"</span>,<span class="st" style="color: #20794D;">"15-19"</span>,<span class="st" style="color: #20794D;">"20-24"</span>,<span class="st" style="color: #20794D;">"25-29"</span>,<span class="st" style="color: #20794D;">"30-34"</span>,<span class="st" style="color: #20794D;">"35-39"</span>,<span class="st" style="color: #20794D;">"40-44"</span>,<span class="st" style="color: #20794D;">"45-49"</span>,<span class="st" style="color: #20794D;">"50-54"</span>,<span class="st" style="color: #20794D;">"55-59"</span>,<span class="st" style="color: #20794D;">"60-64"</span>,<span class="st" style="color: #20794D;">"65-69"</span>,<span class="st" style="color: #20794D;">"70-74"</span>,<span class="st" style="color: #20794D;">"75-79"</span>,<span class="st" style="color: #20794D;">"80-84"</span>,<span class="st" style="color: #20794D;">"85+"</span>)))<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;">group_by</span>(year)<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-10">  <span class="do" style="color: #5E5E5E;
font-style: italic;">## 把男性人口数转换为负值，以是条图显示在左侧</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rks=</span><span class="fu" style="color: #4758AB;">round</span>(rks<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">sum</span>(rks),<span class="dv" style="color: #AD0000;">4</span>),</span>
<span id="cb3-12">         <span class="at" style="color: #657422;">rks=</span><span class="fu" style="color: #4758AB;">ifelse</span>(sex<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"男性"</span>,<span class="sc" style="color: #5E5E5E;">-</span>rks,rks))</span></code></pre></div>
</div>
</section>
<section id="rmd-code-chunk-选项" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="rmd-code-chunk-选项"><span class="header-section-number">3</span> Rmd code chunk 选项</h2>
<p>利用Rmd文档可以输出成很多种格式的输出结果，比如word、ppt、网页、pdf等，本篇博文介绍的为输出到网页显示动态图片。</p>
<p>在Rmd文档中插入r语言代码块，代码块的选项设置为fig.show=‘animate’,animation.hook=‘gifski’，当代码块内的语句生成多个图片的时候，会自动设置为动画播放。</p>
</section>
<section id="利用for循环和ggplot2制作金字塔图" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="利用for循环和ggplot2制作金字塔图"><span class="header-section-number">4</span> 利用for循环和ggplot2制作金字塔图</h2>
<p>在代码块内部，使用for循环和ggplot2生成多个年份的人口金子塔图即可。</p>
<div class="cell" data-animation.hook="gifski" data-hash="index_cache/html/unnamed-chunk-3_51368b6ae7040c1e61808bd0beff0a0a">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 加载ggplot2包</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb4-3"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 建立for循环</span></span>
<span id="cb4-4"><span class="cf" style="color: #003B4F;">for</span> (i <span class="cf" style="color: #003B4F;">in</span> <span class="dv" style="color: #AD0000;">2011</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">2017</span>) {</span>
<span id="cb4-5"> data <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-6">    <span class="fu" style="color: #4758AB;">filter</span>(year<span class="sc" style="color: #5E5E5E;">==</span>i) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span><span class="fu" style="color: #4758AB;">factor</span>(agegrp),<span class="at" style="color: #657422;">y=</span>rks,<span class="at" style="color: #657422;">fill=</span>sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">stat =</span> <span class="st" style="color: #20794D;">"identity"</span>,<span class="at" style="color: #657422;">position =</span> <span class="st" style="color: #20794D;">"identity"</span>,<span class="at" style="color: #657422;">color=</span><span class="st" style="color: #20794D;">"black"</span>,<span class="at" style="color: #657422;">linewidth=</span><span class="fl" style="color: #AD0000;">0.25</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label=</span><span class="fu" style="color: #4758AB;">paste0</span>(<span class="fu" style="color: #4758AB;">abs</span>(rks) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">100</span>, <span class="st" style="color: #20794D;">'%'</span>)))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;">coord_flip</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">""</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">""</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">limits =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.08</span>,<span class="fl" style="color: #AD0000;">0.08</span>),<span class="at" style="color: #657422;">breaks=</span><span class="fu" style="color: #4758AB;">seq</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.08</span>,<span class="fl" style="color: #AD0000;">0.08</span>,<span class="fl" style="color: #AD0000;">0.02</span>),<span class="at" style="color: #657422;">labels =</span> <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">paste0</span>(<span class="fu" style="color: #4758AB;">abs</span>(x) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">100</span>, <span class="st" style="color: #20794D;">'%'</span>))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title=</span><span class="st" style="color: #20794D;">"历年人口金字塔变化情况"</span>,<span class="at" style="color: #657422;">subtitle=</span><span class="fu" style="color: #4758AB;">paste</span>(i))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">0.1</span>,<span class="fl" style="color: #AD0000;">0.9</span>),</span>
<span id="cb4-17">        <span class="at" style="color: #657422;">legend.title =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb4-18">        <span class="at" style="color: #657422;">strip.text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">10</span>, <span class="at" style="color: #657422;">face=</span><span class="st" style="color: #20794D;">"bold.italic"</span>),</span>
<span id="cb4-19">        <span class="at" style="color: #657422;">strip.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">color=</span><span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb4-20">        <span class="at" style="color: #657422;">axis.text=</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">10</span>),</span>
<span id="cb4-21">        <span class="at" style="color: #657422;">axis.title=</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">12</span>, <span class="at" style="color: #657422;">face=</span><span class="st" style="color: #20794D;">"bold"</span>),</span>
<span id="cb4-22">        <span class="at" style="color: #657422;">plot.title =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">face=</span><span class="st" style="color: #20794D;">"bold"</span>, <span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">14</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">0.5</span>),</span>
<span id="cb4-23">        <span class="at" style="color: #657422;">plot.subtitle=</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">face=</span><span class="st" style="color: #20794D;">"bold"</span>,<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">20</span>,<span class="at" style="color: #657422;">hjust=</span><span class="fl" style="color: #AD0000;">0.8</span>))<span class="ot" style="color: #003B4F;">-&gt;</span>p</span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;">plot</span>(p)</span>
<span id="cb4-25">}</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-25-rmd/index_files/figure-html/unnamed-chunk-3-.gif" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>科研作图</category>
  <guid>https://www.chenq.site/qsight/2022-04-25-rmd/index.html</guid>
  <pubDate>Mon, 25 Apr 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-04-25-rmd/cover.png" medium="image" type="image/png" height="89" width="144"/>
</item>
<item>
  <title>如何利用病理诊断比例（MV%）指标评价人群肿瘤登记数据质量？</title>
  <dc:creator>陈琼</dc:creator>
  <link>https://www.chenq.site/qsight/2022-04-17-mv/index.html</link>
  <description><![CDATA[ 




<p>肿瘤登记数据的质量控制对于产出高质量数据至关重要，以人群为基础的肿瘤登记数据一般从<a href="https://chenq.site/tech/2022-qualitycontrol/">四个方面</a>进行质量控制，具体包括可比性、完整性、有效性和时效性指标，而病理诊断比例(MV%)指标可以在完整性和有效性两个方面对肿瘤登记数据的质量进行评价。</p>
<p>病理诊断比例(MV%)是指收集的全部病例中，经过形态学诊断（组织下、细胞学、血液学）确认的病例数占全部病例数的百分比，<img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%E7%BB%8F%E7%97%85%E7%90%86%E5%AD%A6%E7%A1%AE%E8%AE%A4%E7%9A%84%E7%97%85%E4%BE%8B%E6%95%B0%7D%7B%E6%89%80%E6%9C%89%E7%97%85%E4%BE%8B%E6%95%B0%7D">，该指标的大小受到肿瘤的发病部位、肿瘤登记地区的病理诊断能力与水平、该地区的医疗服务能力与水平等因素的影响，因此，我们在利用该指标进行肿瘤登记数据质量评价时应该考虑这些因素。</p>
<p>在质量评价方面，MV%的绝对指标意义有限，通常利用它与适当的标准比较,比如与相似的区域的MV%指标比较，或者与国家的平均水平进行比较，从而判断该肿瘤登记地区的数据的有效性和完整性。</p>
<section id="与一定的区域标准mv值进行比较" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="与一定的区域标准mv值进行比较"><span class="header-section-number">1</span> 与一定的区域标准MV值%进行比较</h2>
<p>当肿瘤登记处的MV%值与区域标准（比如国家的平均水平）进行比较的时候，如果登记处MV%值与区域标准差距较大，并且该地区的医疗服务能力与水平以及病理诊断能力与区域平均水平没有很大差异的时候，则提示该登记处数据的有效性或者完整性可能存在问题。如果登记处MV%值小于区域标准值，并且差距较大，提示登记处收集的数据有效性较差；而如果登记处MV%值大于区域标准值，并且差距较大，则提示登记处数据的完整性可能存在问题。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2022-04-17-mv/namv.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">病理诊断比例</figcaption><p></p>
</figure>
</div>
</section>
<section id="与一定的区域标准mv值进行比较-1" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="与一定的区域标准mv值进行比较-1"><span class="header-section-number">2</span> 与一定的区域标准MV值%进行比较</h2>
<p>在多年的连续监测中，一个登记处的MV%应该是相对稳定的，不会出现大的波动，因为一个地区的医疗服务水平或者病理诊断能力是相对稳定的。如果多年份的MV%值出现跳跃性波动，则提示登记处数据的稳定性较差，相应存在波动年份的数据可能存在问题。</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_b871f9777f04c621f70da5275303c7e2">
<div class="cell-output-display">
<p><img src="https://www.chenq.site/qsight/2022-04-17-mv/yearmv.png" class="img-fluid" width="686"></p>
</div>
</div>


</section>

 ]]></description>
  <category>肿瘤登记</category>
  <category>质量控制</category>
  <guid>https://www.chenq.site/qsight/2022-04-17-mv/index.html</guid>
  <pubDate>Sun, 17 Apr 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2022-04-17-mv/namv.png" medium="image" type="image/png" height="104" width="144"/>
</item>
</channel>
</rss>
