<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.17">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="陈琼">
<meta name="keywords" content="R, 科研作图, ggforest">

<title>利用survminer包ggforest函数制作用森林图，直观化展示比值比数据！ – 普癌新声</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-da03d714c310c60cec1d83284c92da2c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-fc5e5330e66aef36d4b0318ede2ade7c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>


<link rel="stylesheet" href="../../_assets/css/qsight.css">
<meta property="og:title" content="利用survminer包ggforest函数制作用森林图，直观化展示比值比数据！ – 普癌新声">
<meta property="og:description" content="一个公共卫生医师的个人网站">
<meta property="og:image" content="https://www.chenq.site/qsight/2022-02-21-survminer-ggforest/forest.png">
<meta property="og:site_name" content="普癌新声">
<meta property="og:image:height" content="1499">
<meta property="og:image:width" content="2099">
<meta name="twitter:title" content="利用survminer包ggforest函数制作用森林图，直观化展示比值比数据！ – 普癌新声">
<meta name="twitter:description" content="一个公共卫生医师的个人网站">
<meta name="twitter:image" content="https://www.chenq.site/qsight/2022-02-21-survminer-ggforest/forest.png">
<meta name="twitter:image-height" content="1499">
<meta name="twitter:image-width" content="2099">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">普癌新声</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../qsight.html"> <i class="bi bi-tropical-storm" role="img">
</i> 
<span class="menu-text">Qsight博客</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://diary.chenq.site"> <i class="bi bi-pen" role="img">
</i> 
<span class="menu-text">随笔录</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../packages/"> <i class="bi bi-hexagon" role="img">
</i> 
<span class="menu-text">软件</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications/"> <i class="bi bi-journal-medical" role="img">
</i> 
<span class="menu-text">出版作品</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://slides.chenq.site"> <i class="bi bi-file-slides-fill" role="img">
</i> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">关于</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../qsight/index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://notes.chenq.site"> <i class="bi bi-pen" role="img">
</i> 
<span class="menu-text">学习笔记</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<!-- 微信公众号推广模块 -->
<div class="wechat-promotion">
  <h3>微信公众号</h3>
  <div class="qrcode-container">
    <img src="https://cdn.jsdelivr.net/gh/gigu003/db/images/qr.jpg" alt="微信公众号二维码" class="wechat-qrcode" width="258" height="258">
    <div class="callout-box">
      <p class="callout-text">扫码关注公众号</p>
      <div class="arrow"></div>
    </div>
  </div>
</div>

</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">主要内容</h2>
   
  <ul>
  <li><a href="#什么是森林图" id="toc-什么是森林图" class="nav-link active" data-scroll-target="#什么是森林图"><span class="header-section-number">1</span> 什么是森林图？</a></li>
  <li><a href="#实现森林图的方法有哪些" id="toc-实现森林图的方法有哪些" class="nav-link" data-scroll-target="#实现森林图的方法有哪些"><span class="header-section-number">2</span> 实现森林图的方法有哪些？</a></li>
  <li><a href="#如何安装survminer包" id="toc-如何安装survminer包" class="nav-link" data-scroll-target="#如何安装survminer包"><span class="header-section-number">3</span> 如何安装survminer包？</a></li>
  <li><a href="#准备数据" id="toc-准备数据" class="nav-link" data-scroll-target="#准备数据"><span class="header-section-number">4</span> 准备数据</a></li>
  <li><a href="#首先我们对colon数据预处理一下" id="toc-首先我们对colon数据预处理一下" class="nav-link" data-scroll-target="#首先我们对colon数据预处理一下"><span class="header-section-number">5</span> 首先我们对colon数据预处理一下</a></li>
  <li><a href="#利用colon数据来拟合预后风险" id="toc-利用colon数据来拟合预后风险" class="nav-link" data-scroll-target="#利用colon数据来拟合预后风险"><span class="header-section-number">6</span> 利用colon数据来拟合预后风险</a></li>
  <li><a href="#利用ggforest函数输出森林图" id="toc-利用ggforest函数输出森林图" class="nav-link" data-scroll-target="#利用ggforest函数输出森林图"><span class="header-section-number">7</span> 利用ggforest函数输出森林图</a></li>
  <li><a href="#小结" id="toc-小结" class="nav-link" data-scroll-target="#小结"><span class="header-section-number">8</span> 小结</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">利用survminer包ggforest函数制作用森林图，直观化展示比值比数据！</h1>
</div>


    <p>2022年2月21日</p>
  
    
  <div class="quarto-categories">
        <p class="quarto-category">R</p>
        <p class="quarto-category">科研作图</p>
      </div>

    
</header>




<section id="什么是森林图" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="什么是森林图"><span class="header-section-number">1</span> 什么是森林图？</h2>
<p>森林图是在平面直角坐标系中，以一条垂直的无效线（横坐标刻度为1或0）为中心，用平行于横轴的多条线段描述了每个被纳入研究的效应量和可信区间（confidence interval，CI），用一个棱形（或其它图形）描述了多个研究合并的效应量及可信区间。它非常简单和直观地描述了Meta分析的统计结果，是Meta分析中最常用的结果表达形式。</p>
</section>
<section id="实现森林图的方法有哪些" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="实现森林图的方法有哪些"><span class="header-section-number">2</span> 实现森林图的方法有哪些？</h2>
<p>在R语言里，实现森林图的方法有很多，比如forestplot包，ggforestplot包，以及survminer包等都可以，当然也可以利用ggplot2包实现更自由的绘制森林图。</p>
<p>今天我们主要讲讲利用survminer包的ggforest函数绘制森林图</p>
<p>这个包有个优势就是可以直接利用模型拟合输出的结果直接输出森林图，不用另外单独准备数据。比如我们可以用survival包来做预后的影响因素分析，然后利用survminer包里的ggforest函数读取survival包拟合的模型结果绘制森林图。</p>
</section>
<section id="如何安装survminer包" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="如何安装survminer包"><span class="header-section-number">3</span> 如何安装survminer包？</h2>
<p>照例两种方式，要么从R CRAN的不同镜像上安装，要么从github上安装。</p>
<p>第一种方式：从CRAN镜像上安装</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">install.packages</span>(<span class="st">"survminer"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>第二种方式：从github上安装</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># 首先判断运行环境里是否安装了devtools包，如果没有安装的话，需要先安装devtools包</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># 利用devtools从github上安装survminer包</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"kassambara/survminer"</span>, <span class="at">build_vignettes =</span> <span class="cn">FALSE</span>)<span class="er">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="准备数据" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="准备数据"><span class="header-section-number">4</span> 准备数据</h2>
<p>加载survival包时，自动加载了colon数据框，我们就可以利用这个数据来拟合预后风险。</p>
<p>首先加载survival包，并查看一下colon数据框的基本情况</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># 加载dplyr包进行数据处理</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(dplyr)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># 看下colon数据的结构</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">head</span>(colon)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id study      rx sex age obstruct perfor adhere nodes status differ extent
1  1     1 Lev+5FU   1  43        0      0      0     5      1      2      3
2  1     1 Lev+5FU   1  43        0      0      0     5      1      2      3
3  2     1 Lev+5FU   1  63        0      0      0     1      0      2      3
4  2     1 Lev+5FU   1  63        0      0      0     1      0      2      3
5  3     1     Obs   0  71        0      0      1     7      1      2      2
6  3     1     Obs   0  71        0      0      1     7      1      2      2
  surg node4 time etype
1    0     1 1521     2
2    0     1  968     1
3    0     0 3087     2
4    0     0 3087     1
5    0     1  963     2
6    0     1  542     1</code></pre>
</div>
</div>
</section>
<section id="首先我们对colon数据预处理一下" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="首先我们对colon数据预处理一下"><span class="header-section-number">5</span> 首先我们对colon数据预处理一下</h2>
<p>我们对sex变量和differ变量因子化，并增加中文值标签。</p>
<p>如果我们想在森林图里显示交互作用项，那么就需要提前处理数据，比如我们想看surg和nodes的交互作用，我们可以把两者的相乘项加入模型里。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># 预处理colon数据框</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>colon <span class="ot">&lt;-</span> colon<span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">mutate</span>(<span class="at">sex=</span><span class="fu">factor</span>(sex, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"女性"</span>, <span class="st">"男性"</span>)),</span>
<span id="cb9-4"><a href="#cb9-4"></a>         <span class="at">differ=</span><span class="fu">factor</span>(differ,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"高分化"</span>, <span class="st">"中分化"</span>, <span class="st">"低分化"</span>)),</span>
<span id="cb9-5"><a href="#cb9-5"></a>         <span class="co"># 为模型拟合准备交互项</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>         <span class="at">interaction=</span>surg<span class="sc">*</span>nodes,</span>
<span id="cb9-7"><a href="#cb9-7"></a>         <span class="at">surg=</span> <span class="fu">factor</span>(surg,<span class="at">label=</span><span class="fu">c</span>(<span class="st">"非手术组"</span>,<span class="st">"手术组"</span>))</span>
<span id="cb9-8"><a href="#cb9-8"></a>         )</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="利用colon数据来拟合预后风险" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="利用colon数据来拟合预后风险"><span class="header-section-number">6</span> 利用colon数据来拟合预后风险</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex <span class="sc">+</span>  differ <span class="sc">+</span> surg <span class="sc">+</span> nodes <span class="sc">+</span> interaction, <span class="at">data =</span> colon )</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">summary</span>(model)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status) ~ sex + differ + surg + nodes + 
    interaction, data = colon)

  n= 1776, number of events= 876 
   (82 observations deleted due to missingness)

                  coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
sex男性      -0.094440  0.909883  0.068029 -1.388   0.1651    
differ中分化 -0.030810  0.969660  0.116865 -0.264   0.7921    
differ低分化  0.257933  1.294252  0.136498  1.890   0.0588 .  
surg手术组    0.176022  1.192465  0.102487  1.718   0.0859 .  
nodes         0.081409  1.084814  0.007312 11.133   &lt;2e-16 ***
interaction   0.023728  1.024012  0.016809  1.412   0.1581    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

             exp(coef) exp(-coef) lower .95 upper .95
sex男性         0.9099     1.0990    0.7963     1.040
differ中分化    0.9697     1.0313    0.7712     1.219
differ低分化    1.2943     0.7726    0.9904     1.691
surg手术组      1.1925     0.8386    0.9755     1.458
nodes           1.0848     0.9218    1.0694     1.100
interaction     1.0240     0.9766    0.9908     1.058

Concordance= 0.633  (se = 0.009 )
Likelihood ratio test= 153.9  on 6 df,   p=&lt;2e-16
Wald test            = 210.2  on 6 df,   p=&lt;2e-16
Score (logrank) test = 214.7  on 6 df,   p=&lt;2e-16</code></pre>
</div>
</div>
</section>
<section id="利用ggforest函数输出森林图" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="利用ggforest函数输出森林图"><span class="header-section-number">7</span> 利用ggforest函数输出森林图</h2>
<p>ggforest函数可以自由定义的参数不多，主要有以下几个:</p>
<ol type="1">
<li>model= modeldata，指定ggforest函数读取的模型拟合数据</li>
<li>data= colon，指定输出模型的数据</li>
<li>cpositions= c(0.01,0.1,0.3)，指定森林图的前三列分别离最左侧有多远，0为最左侧，1为最右侧，大家可以根据放入模型的变量的值标签的长度来自行定义。</li>
<li>refLable=“参照组”，用来指定比值比指标参考组的显示标签，默认的为Reference，我们可以给它调整为参照组。</li>
<li>fontsize=0.7，调整图里的文字大小。</li>
<li>noDigits=2，设置小数点的位数，默认值为2。</li>
<li>main=“图标的标题”，设置图的标题。</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">library</span>(survminer)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggpubr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'survminer'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:survival':

    myeloma</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">ggforest</span>(<span class="at">model =</span> model,</span>
<span id="cb17-2"><a href="#cb17-2"></a>         <span class="at">data =</span> colon,</span>
<span id="cb17-3"><a href="#cb17-3"></a>         <span class="at">cpositions =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">0.3</span>),</span>
<span id="cb17-4"><a href="#cb17-4"></a>         <span class="at">refLabel =</span> <span class="st">"参照组"</span>,</span>
<span id="cb17-5"><a href="#cb17-5"></a>         <span class="at">fontsize=</span><span class="fl">0.7</span>,</span>
<span id="cb17-6"><a href="#cb17-6"></a>         <span class="at">noDigits=</span><span class="dv">2</span>,</span>
<span id="cb17-7"><a href="#cb17-7"></a>         <span class="at">main =</span> <span class="st">"预后因素回归分析"</span>)<span class="ot">-&gt;</span>pp</span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="fu">ggsave</span>(<span class="st">"forest.png"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
</div>
<p><img src="forest.png" class="img-fluid" alt="森林图"> 好了，森林图出来了，如果你想对输出的图进一步处理的话，可以用本站前面介绍的magick包或者其它包进行更加个性化的调整和处理。</p>
</section>
<section id="小结" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="小结"><span class="header-section-number">8</span> 小结</h2>
<p>利用survminer包ggforest函数制作森林图既有优势也有缺点，优势是可以利用前期拟合的模型输出结果，不用再专门整理数据，当然有优势也就有劣势，就是可以调整的参数较少，缺少更个性化的调整参数。</p>


</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="../author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.chenq\.site");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright@ 2025 Qiong Chen</p>
</div>   
    <div class="nav-footer-center">
<p>豫ICP备2021032022号</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/gigu003">
      <i class="bi bi-github" role="img" aria-label="Qiong@GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../qsight/index.xml">
      <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>






</body></html>