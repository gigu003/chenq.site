<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>普癌新声</title>
<link>https://www.chenq.site/qsight.html</link>
<atom:link href="https://www.chenq.site/qsight.xml" rel="self" type="application/rss+xml"/>
<description>一个公共卫生医师的个人网站</description>
<generator>quarto-1.7.17</generator>
<lastBuildDate>Wed, 26 Mar 2025 00:00:00 GMT</lastBuildDate>
<item>
  <title>基于 R 语言构建人群肿瘤登记数据分析工具：理念与实践</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>该文章介绍了一款专为人群肿瘤登记开发的 R 语言工具包（canregtools），用于内部一致性逻辑审核、统计分析、数据可视化和报告撰写。文章详细阐述了 R 包的开发背景、设计思路、功能验证、应用场景及未来规划，旨在提升肿瘤登记工作的效率，帮助工作者解决常见难题。我们希望该工具集能为肿瘤登记工作提供有力支持，并期待领域内专家的宝贵意见，以进一步优化和完善其功能。</p>
  </div>
</div><p></p>



<section id="开发背景" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="开发背景"><span class="header-section-number">1</span> 开发背景</h2>
<p>人群肿瘤登记（Population-Based Cancer Registration, PBCR）是国家癌症防控计划的重要组成部分，旨在提供癌症的发病率、死亡率和生存率等核心数据，为制定和评估国家癌症防控策略提供科学依据<span class="citation" data-cites="wei2020"><sup>1</sup></span>。自20世纪60年代中国建立第一个肿瘤登记处以来，肿瘤登记工作取得了显著进展，目前已建立覆盖全国所有县区的肿瘤监测体系。随着工作的不断推进，人群肿瘤登记处的数量迅速增加，同时也积累了大量的数据。因此，如何从多个层面深入分析并充分利用肿瘤登记数据，以支持科学决策并优化癌症防控措施，具有重要的现实意义<span class="citation" data-cites="wei2020"><sup>1</sup></span>。高质量的数据是促进其充分利用的前提，然而，随着PBCR数量的快速增加，数据质量却参差不齐，如何持续提升数据质量已经成为各级肿瘤登记处亟待解决的重大问题。个案记录和登记处层面的质量评估与控制是确保肿瘤登记数据质量的关键措施，并已成为肿瘤登记工作实践中的核心组成部分，仍是中国现有肿瘤登记工作中的重点和难点之一。除此之外，PBCR数据的可视化、输出各种类型的统计报告包括质量控制报告、工作报告和肿瘤登记年报也是一项十分重要并且非常耗费时间的工作内容，如何快速且高质量地输出各种类型的统计报告具有重要意义。</p>
<p>目前，可用于肿瘤登记的数据处理工具有多种，主要包括国际癌症研究中心/国际肿瘤登记处（IARC/IACR）发布的 IARCcrgTools<span class="citation" data-cites="ferlay2018"><sup>2</sup></span>（内部一致性逻辑审核和编码转换软件）、CanReg5<span class="citation" data-cites="morten2023"><sup>3</sup></span>（数据录入与管理软件），以及欧洲肿瘤登记协作网络（ENCR）发布的 JRC QCS（质量核查软件）<span class="citation" data-cites="giusti2023"><sup>4</sup></span>。此外，一些肿瘤登记处还开发了适用于自身需求的软件。这些软件各自针对特定目的而设计，例如 IARCcrgTools<span class="citation" data-cites="ferlay2005"><sup>5</sup></span>主要用于数据的一致性审核和编码转换，CanReg5 负责数据录入、管理，并具备部分统计分析和可视化功能，而 JRC QCS 则按照 ENCR 标准执行质量审核。</p>
<p>然而，使用这些软件处理和分析中国肿瘤登记数据时面临一些不足和限制。首先，它们的操作方式主要依赖鼠标手动执行，对于自动化处理需求支持有限，因此难以实现对多个肿瘤登记处数据的批量自动化操作。第二，这些软件的功能实现基于国际通用标准或欧洲标准执行，而中国肿瘤登记除了基于国际通用标准收集的变量（ICDO3、ICD10、诊断依据等）之外，部分变量则按照中国肿瘤登记数据集标准<span class="citation" data-cites="ZhongGuoWeiShengXinXiYuJianKangYiLiaoDaShuJuXueHui"><sup>6</sup></span>进行收集（如职业、婚姻、学历、身份识别信息等），这些软件无法对这些变量进行逻辑审核。第三，中国有数千个肿瘤登记处，这些软件无法实现对肿瘤登记数据分级整合和管理功能。</p>
<p>基于这一背景，我们开发了一个名为 <strong>canregtools</strong> 的 R 语言包，旨在 R 语言环境中实现 PBCR 的常规统计分析，提升数据分析效率和质量，同时简化数据一致性审核、可视化和统计报告等功能。</p>
</section>
<section id="为什么选择r语言" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="为什么选择r语言"><span class="header-section-number">2</span> 为什么选择R语言</h2>
<p>中国已有多位专家开发了用于肿瘤登记数据管理与统计分析的软件。早在 2012 年，天津医科大学附属肿瘤医院的王庆生教授开发了一款肿瘤登记数据管理与分析系统，集成了数据录入、管理及统计分析功能<span class="citation" data-cites="WangQingSheng2012"><sup>7</sup></span>，并在当年哈尔滨举办的全国肿瘤登记会议上进行了相关培训。我也有幸参与了此次会议。此外，国家癌症中心的郑荣寿教授编写了一套功能强大的 SAS 宏程序，该程序可调用 IARCcrgTools 软件，实现内部一致性逻辑审核、统计分析及统计报告的自动生成。而上海市疾控中心的吴春晓教授则基于微软 Access 软件开发了肿瘤登记数据统计分析系统，该系统能够生成多种预设统计表，进一步提升数据分析的便捷性和效率。</p>
<p>然而，这些高效的软件在推广和普及方面受到一定限制，主要原因在于权限要求和操作系统兼容性。例如，SAS 和 Access 软件均无法在 Mac  或 Linux  操作系统上运行，且它们的使用需要购买许可证，否则无法正常使用。这些因素限制了其在更广泛用户群体中的应用。</p>
<p>相比之下，R 语言是一款免费且开源的统计分析软件，不受权限限制，用户可以自由使用和共享。此外，R 语言的开发社区极为活跃，许多 R 语言包可以托管在 <a href="https://cran.r-project.org">CRAN</a>、<a href="https://github.com">GitHub</a> 等平台，用户能够方便地安装和使用。</p>
<p>我过去一直使用 SAS 作为主要的统计分析工具，特别是在肿瘤登记数据的分析工作中。然而，2021 年，我更换了一台  Mac 作为主力工作电脑，熟悉的 SAS 软件无法运行。其实，我也不想再到处寻找 SAS 的许可证，因此，我开始转向 R 语言，并将其作为主要的统计分析工具。这也是选择R语言作为开发软件的主要原因。</p>
</section>
<section id="开发思路" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="开发思路"><span class="header-section-number">3</span> 开发思路</h2>
<p>最初编写 canregtools R 包的构想是实现一整套针对肿瘤登记数据的处理和分析功能，包括数据读取、变量格式标准化、内部一致性逻辑审核、质量控制指标计算、常规统计分析、常用统计图生成以及按照模板输出报告等。</p>
<p>我们起初计划将所有功能整合到一个 canregtools 包中。然而，在实现了大部分常规统计分析和内部一致性逻辑核查功能后，我们发现该包已经包含了过多的函数和字典，这不仅增加了代码的复杂性，还不利于后续的升级和维护。因此，我们决定将其拆分为多个专门化的 R 包，以实现不同的功能。</p>
<ul>
<li><code>canregtools</code> 用于读取肿瘤登记数据、常规统计分析、按照肿瘤登记处属性进行数据的整合和转换、按照模板输出报告（图&nbsp;1）；</li>
<li><code>crcheck</code> 用于变量的内部一致性逻辑审核，帮助理解肿瘤登记逻辑审核规则（图&nbsp;2）；</li>
<li><code>ggcanreg</code> 专注于肿瘤登记数据的可视化，绘制金字塔图、条形图、折线图、统计地图等常见类型的统计图（图&nbsp;3）；</li>
<li><code>manuscript</code> 用于编写及生成各种类型的统计报告，如质量控制报告、数据分析报告、肿瘤登记年报等编写和管理维护（图&nbsp;4）。</li>
</ul>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-canregtools" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-canregtools-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/images/logo_canregtools.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-canregtools-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;1: 统计分析
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-crcheck" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-crcheck-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/images/logo_crcheck.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crcheck-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;2: 逻辑审核
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-ggcanreg" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ggcanreg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/images/logo_ggcanreg.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggcanreg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;3: 数据可视化
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-manuscript" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-manuscript-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/images/logo_manuscript.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-manuscript-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4: 报告撰写
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>通过这些 R 包的组合，可以完整覆盖从个案级别的数据质量审核到最终统计报告输出的整个流程。这种模块化的设计思路借鉴了 tidyverse 系列包的管理方式，使得各个功能模块既能独立运行，又能灵活组合，以适应不同的分析需求。</p>
</section>
<section id="s3类和泛函数" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="s3类和泛函数"><span class="header-section-number">4</span> S3类和泛函数</h2>
<p>R语言提供了三种主要的面向对象编程（OOP）系统：S3、S4和R6。在肿瘤登记数据分析场景中，我们选择基于S3类的泛型函数实现面向对象编程。相较于更复杂的S4和R6系统，S3以其简洁的语法和灵活的扩展性完全满足项目需求。具体实现中，我们通过为原始数据集、中间计算结果等对象定义不同的S3类，并针对这些类编写泛型函数（generic function），最终实现多态编程机制——即同名函数在不同类对象上能执行差异化操作。</p>
<p>在数据导入环节，我们设计了层级化的对象系统：通过read_canreg()函数，肿瘤登记数据可被加载为单登记处对象（canreg类，图&nbsp;5）或多登记处集合对象（canregs类）。这种类层级划分使后续分析具备多态扩展能力——基于这两个类实现的泛型函数count_canreg()会根据输入对象类型自动适配统计逻辑：当输入为canreg类时执行单数据集频数统计，输入canregs类时则进行跨数据集的合并统计。</p>
</section>
<section id="设计数据类型" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="设计数据类型"><span class="header-section-number">5</span> 设计数据类型</h2>
<p>在处理肿瘤登记数据之前，首先需要将其导入 R 语言环境。对于工具开发而言，确定一个统一的数据格式是关键，因为数据读取函数应基于这种格式进行编写。我们常规分析的肿瘤登记数据主要包括三部分：肿瘤发病数据、肿瘤死亡数据和对应的人口数据，这也是国家癌症中心要求上报的数据格式。原始数据通常以 Excel 文件的形式存储，其中包含三个表单：<code>FB</code>（发病数据）、<code>SW</code>（死亡数据）和 <code>POP</code>（人口数据）。其中，<code>FB</code> 和 <code>SW</code> 表单包含的主要变量包括：登记编号、性别、年龄、出生日期、发病日期、解剖学部位、形态学、行为、分级、诊断依据、ICD-10 代码以及死亡日期等，其变量定义符合中国肿瘤登记数据集标准。<code>POP</code> 表单则包含与 FB 和 SW 表单相同年份的、按性别和年龄组划分的人口数据。</p>
<p>我们引入了两个 S3 类数据类型（图&nbsp;5, 图&nbsp;6），以支持高效的肿瘤登记数据处理和分析。 “canreg”（图&nbsp;5） 类用于存储读入的原始数据，而 “fbswicd”（图&nbsp;6） 类基于 “canreg” 数据进行计数统计，保存分年份、性别、癌种及年龄别的发病数、死亡数等统计信息。通过 count_canreg 函数，用户可以轻松将 “canreg” 类数据转换为 “fbswicd” 类数据。针对数据量较大或登记机构数量较多的情况，直接对 “canreg” 类数据进行重组和合并可能会占用大量内存并影响运行效率，而通过将其转换为 “fbswicd” 类数据后进行操作，可显著优化内存使用并提高计算效率。</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-canreg" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-canreg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/images/canreg.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-canreg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;5: S3类：Canreg（读入原始数据）
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fbswicd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fbswicd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/images/fbswicd.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fbswicd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;6: S3类：FBSWICD （频数数据）
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="功能验证" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="功能验证"><span class="header-section-number">6</span> 功能验证</h2>
<p>在开发 canregtools 包的过程中，我们严格遵循相关的最佳实践和开发规范，以确保其质量和可信度。首先，我们使用 devtools 包的 check() 函数对 R 包的结构、依赖性及基本文档进行全面检查，确保其符合 R 包的基本要求。然后，借助 testthat 包对核心函数进行功能性测试，以验证其正确性。接着，利用 covr 包评估测试代码的覆盖率，以提高包的稳定性。同时，我们采用 roxygen2 包自动生成帮助文档，确保文档的完整性和准确性，并通过 devtools 包的 document() 函数重新生成文档，以确保示例代码的正确性。此外，我们还配置了 GitHub Actions 实现自动化测试，使代码每次提交后都能自动进行测试，并生成 R 包的网站。通过上述措施，我们对 canregtools 进行了全面验证，以提升其质量和可靠性。</p>
<p>为了进一步提高该工具集的可信度，我们计划将各个 R 包的开发过程和功能通过期刊论文的形式发表，以接受同行评审，并获得相关专家的反馈和建议，从而进一步优化 R 包的设计和功能。目前，canregtools 包已被 <code>《中华肿瘤杂志》</code>接收发表，其他 R 包的论文也在陆续投稿和发表过程中。</p>
</section>
<section id="部署安装与使用" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="部署安装与使用"><span class="header-section-number">7</span> 部署安装与使用</h2>
<p>目前，上述的四个 R 语言包均仍处于开发和优化阶段。我们已将 <code>canregtools</code> 和 <code>crcheck</code> 包托管在 GitHub 平台上，供用户试用并反馈意见，而 <code>ggcanreg</code> 和 <code>manuscript</code> 包仍有部分功能尚未完成，我们正积极推进开发工作，争取尽快发布。在 GitHub 上托管这些 R 包只是第一步，待功能稳定后，我们计划陆续将其提交至 CRAN，以便用户能够更加便捷地安装和使用。</p>
<ul>
<li><code>canregtools</code>: <a href="https://github.com/gigu003/canregtools">Github地址</a>， <a href="https://canregtools.chenq.stie">R包网站</a></li>
<li><code>crcheck</code>: <a href="https://github.com/gigu003/crcheck">Github地址</a></li>
</ul>
<p><strong>如何安装？</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 需要提前安装devtools包</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"devtools"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(devtools)</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 安装并加载canregtools包</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gigu003/canregtools"</span>)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(canregtools)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 安装并加载crcheck包</span></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gigu003/crcheck"</span>)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(crcheck)</span></code></pre></div>
</div>
</section>
<section id="后续规划" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="后续规划"><span class="header-section-number">8</span> 后续规划</h2>
<p>虽然我们已经尽可能地将肿瘤登记相关功能封装为函数，供大家使用，但对于不熟悉 R 语言的用户而言，仍然存在一定的使用门槛。因此，我们计划进一步利用 R Shiny 开发一个可视化界面，使这些常用功能能够通过图形界面进行操作。此外，为了用户能够方便的理解和学习使用R包，我们还需要为各个R包编写网站和详细的使用文档，尽管这将是一个耗时的过程，但却至关重要。另一项重要的工作是将这些 R 包与 R 语言本身以及 Shiny 界面整合，并打包成可独立安装的应用程序（App），这样用户无需单独安装 R 语言和 R 包，从而降低使用难度，使其对非 R 语言用户更加友好。</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
开发计划
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>基于 R Shiny 开发软件界面</li>
<li>封装成可独立安装的应用程序</li>
<li>编写R包网站和使用文档</li>
</ul>
</div>
</div>
</section>
<section id="小结" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="小结"><span class="header-section-number">9</span> 小结</h2>
<p>肿瘤登记是数据采集流程和质量控制最为复杂的监测工作之一。由于肿瘤诊断的复杂性，基层工作人员在实际工作中面临诸多挑战，例如：如何准确编码？如何有效进行数据审核，确保其有效性和内部一致性？如何判定多原发癌？</p>
<p>为了帮助肿瘤登记工作者应对这些关键问题，我们开发了一套 R 语言工具集，以提升数据处理的准确性和效率。尽管这一过程耗时且充满挑战，但我们认为这项工作极具价值，值得投入时间和精力。同时，我们也希望更多同行能够加入，共同完善和优化这一工具集，为肿瘤登记工作提供更强有力的技术支持。</p>
<div id="refs" class="references csl-bib-body">
<div id="ref-wei2020" class="csl-entry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Wei W, Zeng H, Zheng R, Zhang S, An L, Chen R, 等. <a href="https://doi.org/10/gkrcbt">Cancer Registration in <span>China</span> and Its Role in Cancer Prevention and Control</a>. Lancet Oncol. 2020年;21:e342–9. </div>
</div>
<div id="ref-ferlay2018" class="csl-entry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Ferlay J. <span>IARCcrgTools Version</span> 2.13 [网际网络]. Lyon (FR): Section of Cancer Surveillance, International Agency for Research on Cancer; 2018 [见引于 2024年12月21日]. 载于: <a href="http://www.iacr.com.fr/files/IARCcrgToolsSetup213.zip">http://www.iacr.com.fr/files/IARCcrgToolsSetup213.zip</a></div>
</div>
<div id="ref-morten2023" class="csl-entry">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Morten JE. <span>CanReg5</span> [网际网络]. Lyon (FR): International Agency for Research on Cancer; 2023 [见引于 2024年12月21日]. 载于: <a href="http://www.iacr.com.fr/CanReg5/CanReg5-Setup.zip">http://www.iacr.com.fr/CanReg5/CanReg5-Setup.zip</a></div>
</div>
<div id="ref-giusti2023" class="csl-entry">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Giusti F, Martos C, Adriani S, Flego M, Carvalho RN, Bettio M, 等. The <span>Joint Research Centre-European Network</span> of <span>Cancer Registries Quality Check Software</span> (<span>JRC-ENCR QCS</span>). Front Oncol [网际网络]. 2023年;13:1250195. 载于: <a href="https://www.ncbi.nlm.nih.gov/pubmed/37965471">https://www.ncbi.nlm.nih.gov/pubmed/37965471</a></div>
</div>
<div id="ref-ferlay2005" class="csl-entry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Ferlay J, Burkhard C, Whelan S, Parkin DM. Check <span>And Conversions Programs</span> for <span>Cancer Registeies</span> (<span>IARC</span>/<span>IACR Tools</span> for <span>Cancer Registries</span>). IARC Technical Report No 42. 2005年; </div>
</div>
<div id="ref-ZhongGuoWeiShengXinXiYuJianKangYiLiaoDaShuJuXueHui" class="csl-entry">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">中国卫生信息与健康医疗大数据学会. 中国肿瘤登记数据集标准. </div>
</div>
<div id="ref-WangQingSheng2012" class="csl-entry">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">王庆生, 陈万青, 张思维. 中国肿瘤登记数据管理与分析系统软件开发与实践. 中国肿瘤 [网际网络]. 2012年 [见引于 2025年3月28日];21. 载于: <a href="https://d.wanfangdata.com.cn/periodical/zgzl201202002">https://d.wanfangdata.com.cn/periodical/zgzl201202002</a></div>
</div>
</div>


</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>肿瘤登记</category>
  <category>R语言</category>
  <category>canregtools</category>
  <guid>https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/</guid>
  <pubDate>Wed, 26 Mar 2025 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/20250326_pbcr-data-analysis-thoughts/images/preview.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>基于quarto自动化编制肿瘤登记年报</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2024-09-25_write-cancer-report/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>近年来发布肿瘤登记年报已经成为各省级或着市级肿瘤登记处的主要工作内容之一，本篇文章将向大家介绍基于R语言和quarto的方法实现<em>自动化</em>编写肿瘤登记年报的思路，希望通过这样的方式提高登记处工作效率。</p>
  </div>
</div><p></p>



<p>肿瘤登记年报是肿瘤登记处发布肿瘤发病、死亡、生存等肿瘤监测流行病学数据的重要方式和途径。近年来，发布肿瘤登记年报也被纳入到健康中国行动-癌症防治行动实施方案中， 因此，这项工作也成为了各省级肿瘤登记处每年的重要工作内容，而如何高质量、高效率的完成此项工作也至关重要。</p>
<p><a href="https://cdn.jsdelivr.net/gh/gigu003/db/images/book/2022.jpg" class="lightbox" data-gallery="yearbook"><img src="https://cdn.jsdelivr.net/gh/gigu003/db/images/book/2022.jpg" class="img-fluid" style="width:20.0%"></a> <a href="https://cdn.jsdelivr.net/gh/gigu003/db/images/book/2021.jpg" class="lightbox" data-gallery="yearbook"><img src="https://cdn.jsdelivr.net/gh/gigu003/db/images/book/2021.jpg" class="img-fluid" style="width:20.0%"></a> <a href="https://cdn.jsdelivr.net/gh/gigu003/db/images/book/2020.jpg" class="lightbox" data-gallery="yearbook"><img src="https://cdn.jsdelivr.net/gh/gigu003/db/images/book/2020.jpg" class="img-fluid" style="width:20.0%"></a></p>
<section id="肿瘤登记年报的特点" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="肿瘤登记年报的特点"><span class="header-section-number">1</span> 肿瘤登记年报的特点</h2>
<ul>
<li><em>定期性和系统性</em>: 肿瘤登记年报通常按年度发布，具备明确的时间周期性。这种年鉴式的定期报告使得研究者、公共卫生从业者以及医疗管理人员能够持续追踪和监测肿瘤的发生趋势、变化和分布情况。</li>
<li><em>权威性和参考性</em>: 肿瘤登记年报一般由国家级或者省级卫生部门、肿瘤登记处等权威机构编制，具有较高的权威性，这也使年报成为卫生政策制定、科学研究、医疗服务优化的重要参考资料。对于年报发布者来说，保证数据真实有效至关重要。</li>
<li><em>以数据为主</em>: 肿瘤登记年报以发布数据为主，通过文字描述或图、表等形式展示肿瘤流行病学数据。</li>
</ul>
<p>基于肿瘤登记年报的这些特点，如果我们能以下面的这种状态完成年报编写工作就好了，一个人能独自在一天内无误地完成年报的编写工作，并且以完好的格式展示出来(标题、目录、页码、图和表的引用等均能完好展示)，当原始数据或基本统计数据有变化时，我们能够快速地（1分钟之内）更新最终结果。这就要求这个过程能够高效快速、具有可重复性、能够自动化。</p>
</section>
<section id="肿瘤登记年报发布流程" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="肿瘤登记年报发布流程"><span class="header-section-number">2</span> 肿瘤登记年报发布流程</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A[数据审核] --&gt; B[统计分析]
  B --&gt; C[年报撰写]
  C --&gt; D[正式出版]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>肿瘤登记年报的发布流程大致可以分为以上几个阶段，其中，统计分析和年报撰写这两个阶段是可以控制的，因此，提高这两个阶段的效率就能提高年报出版和发布的整体效率。</p>
</section>
<section id="编写思路" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="编写思路"><span class="header-section-number">3</span> 编写思路</h2>
<p>我以前曾经发过一篇<a href="https://chenq.site/qsight/2023-3-25-quarto-writing/">介绍利用quarto进行论文写作的博文</a>，其实我们也可以利用quarto进行书籍的编写，quarto系统内置了<em>book</em>的项目类型进行书籍的编写。</p>
<p>基本思路是利用可重复性报告的方法，利用qmd把文字描述和引用数据结合起来，从而形成综合的报告，通过knitr转换为md，再通过pandoc最终渲染为我们所需要的格式，比如docx、pdf或者html等。</p>


</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>肿瘤登记</category>
  <category>R语言</category>
  <guid>https://www.chenq.site/qsight/2024-09-25_write-cancer-report/</guid>
  <pubDate>Wed, 25 Sep 2024 00:00:00 GMT</pubDate>
  <media:content url="https://cdn.jsdelivr.net/gh/gigu003/db/images/book/2022.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>安徽泾县行</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2024-4-19-jingxian/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>李白乘舟将欲行，忽闻岸上踏歌声。桃花潭水深千尺，不及汪伦送我情。</p>
  </div>
</div><p></p>



<p>前几天有幸收到邀请来到安徽泾县分享肿瘤登记的质量控制和自动化报告。刚听到泾县时，对这里是没有概念的，在高铁上闲时对这个地方进行了初步的了解。泾县是个美丽的地方，有著名的桃花潭，李白曾在这里留下“桃花潭水深千尺，不及汪伦送我情。”的著名诗句。皖南事变也曾经发生在这片山区，国共合作抗日从这里开始彻底决裂。当我初下高铁，发现这里的空气很清新，从站台上望向远处的群山被云雾缭绕的水汽环绕，就像一副水墨山水画，很美的一个地方。</p>
<p>在来时的高铁上，我从泾县政府的官网上找到了他们的宣传片，下面是其中的几张，是不是很漂亮。</p>
<div class="quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><a href="https://cdn.jsdelivr.net/gh/gigu003/db/images/title-pic2.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://cdn.jsdelivr.net/gh/gigu003/db/images/title-pic2.jpg" class="img-fluid"></a></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><a href="https://cdn.jsdelivr.net/gh/gigu003/db/images/title-pic1.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="https://cdn.jsdelivr.net/gh/gigu003/db/images/title-pic1.jpg" class="img-fluid"></a></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><a href="https://cdn.jsdelivr.net/gh/gigu003/db/images/title-pic3.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="https://cdn.jsdelivr.net/gh/gigu003/db/images/title-pic3.jpg" class="img-fluid"></a></p>
</div>
</div>
</div>
<p>由于时间紧张，我没有机会去这些地方看一看，会议结束之后，当天下午我就又乘坐高铁匆匆离开了。但是这个地方在我心里埋下了一个种子，以后我一定要带着媳妇和孩子来这个地方游玩。</p>



<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>肿瘤登记</category>
  <guid>https://www.chenq.site/qsight/2024-4-19-jingxian/</guid>
  <pubDate>Fri, 19 Apr 2024 00:00:00 GMT</pubDate>
  <media:content url="https://cdn.jsdelivr.net/gh/gigu003/db/images/title-pic2.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>R包canregtools：肿瘤登记可视化和自动化报告</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2023-09-30-canregtools/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>为了使肿瘤登记数据分析和可视化更加容易，我写了一个R语言软件包“<em>canregtools</em>”，这篇博文将详细介绍这个R包的功能和使用。</p>
  </div>
</div><p></p>



<p>R语言包“<em>canregtools</em>”提供了肿瘤登记常规数据分析中常用的数据处理、可视化、自动化报告等功能，该包的主要目的是通过一系列R语言函数功能实现肿瘤登记数据常规数据分析和数据可视化功能，并通过整合不同函数功能从而实现应用于不同场景的肿瘤登记报告，在统一的R语言环境中让肿瘤登记数据分析更流畅。</p>
<p>目前<em>canregtools</em>包还处在开发阶段，新的功能会不断补充更新到该包中，大家可以登陆<a href="https://caregtools.chenq.site">canregtools包网站</a>了解开发进度和最新功能，如果您有关于该包的建议，请<a href="mailto:chenq08@126.com">发送邮件</a>给我。</p>
<section id="canregtools的安装" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="canregtools的安装"><span class="header-section-number">1</span> canregtools的安装</h2>
<p>该包还正处于开发阶段，暂时还没有准备将其提交至CRAN，我们会等其功能稳定之后再考虑将其正式提交。目前代码托管在github上，大家可以通过下面的代码进行安装。</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(devtools)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gigu003/canregtools"</span>)</span>
<span id="cb1-4"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<p>在开始介绍canregtools包之前，首先看看我们包的运行环境。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(devtools)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sessioninfo)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">session_info</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.2 (2024-10-31)
 os       macOS Sequoia 15.3.2
 system   aarch64, darwin20
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Asia/Shanghai
 date     2025-03-28
 pandoc   3.6.3 @ /opt/homebrew/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version date (UTC) lib source
 cachem        1.1.0   2024-05-16 [1] CRAN (R 4.4.0)
 cli           3.6.3   2024-06-21 [1] CRAN (R 4.4.0)
 devtools    * 2.4.5   2022-10-11 [1] CRAN (R 4.4.0)
 digest        0.6.37  2024-08-19 [1] CRAN (R 4.4.1)
 ellipsis      0.3.2   2021-04-29 [1] CRAN (R 4.2.0)
 evaluate      0.24.0  2024-06-10 [1] CRAN (R 4.4.0)
 fastmap       1.2.0   2024-05-15 [1] CRAN (R 4.4.0)
 fs            1.6.4   2024-04-25 [1] CRAN (R 4.4.0)
 glue          1.8.0   2024-09-30 [1] CRAN (R 4.4.1)
 htmltools     0.5.8.1 2024-04-04 [1] CRAN (R 4.4.0)
 htmlwidgets   1.6.4   2023-12-06 [1] CRAN (R 4.4.0)
 httpuv        1.6.15  2024-03-26 [1] CRAN (R 4.4.0)
 jsonlite      1.8.8   2023-12-04 [1] CRAN (R 4.3.1)
 knitr         1.48    2024-07-07 [1] CRAN (R 4.4.0)
 later         1.3.2   2023-12-06 [1] CRAN (R 4.4.0)
 lifecycle     1.0.4   2023-11-07 [1] CRAN (R 4.3.1)
 magrittr      2.0.3   2022-03-30 [1] CRAN (R 4.2.0)
 memoise       2.0.1   2021-11-26 [1] CRAN (R 4.3.0)
 mime          0.12    2021-09-28 [1] CRAN (R 4.2.0)
 miniUI        0.1.1.1 2018-05-18 [1] CRAN (R 4.2.2)
 pkgbuild      1.4.4   2024-03-17 [1] CRAN (R 4.4.0)
 pkgload       1.3.4   2024-01-16 [1] CRAN (R 4.4.0)
 profvis       0.3.8   2023-05-02 [1] CRAN (R 4.3.0)
 promises      1.3.0   2024-04-05 [1] CRAN (R 4.4.0)
 purrr         1.0.2   2023-08-10 [1] CRAN (R 4.4.0)
 R6            2.5.1   2021-08-19 [1] CRAN (R 4.2.0)
 Rcpp          1.0.13  2024-07-17 [1] CRAN (R 4.4.0)
 remotes       2.5.0   2024-03-17 [1] CRAN (R 4.4.0)
 rlang         1.1.4   2024-06-04 [1] CRAN (R 4.4.0)
 rmarkdown     2.29    2024-11-04 [1] CRAN (R 4.4.1)
 rstudioapi    0.16.0  2024-03-24 [1] CRAN (R 4.4.0)
 sessioninfo * 1.2.2   2021-12-06 [1] CRAN (R 4.2.0)
 shiny         1.8.1.1 2024-04-02 [1] CRAN (R 4.4.0)
 stringi       1.8.4   2024-05-06 [1] CRAN (R 4.4.0)
 stringr       1.5.1   2023-11-14 [1] CRAN (R 4.3.1)
 urlchecker    1.0.1   2021-11-30 [1] CRAN (R 4.2.0)
 usethis     * 2.2.3   2024-02-19 [1] CRAN (R 4.4.0)
 vctrs         0.6.5   2023-12-01 [1] CRAN (R 4.3.1)
 xfun          0.45    2024-06-16 [1] CRAN (R 4.4.0)
 xtable        1.8-4   2019-04-21 [1] CRAN (R 4.2.0)
 yaml          2.3.9   2024-07-05 [1] CRAN (R 4.4.0)

 [1] /Users/qc0824/Library/R
 [2] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</section>
<section id="主要功能介绍" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="主要功能介绍"><span class="header-section-number">2</span> 主要功能介绍</h2>
<p>该包的主要功能分为以下几类：数据读取、数据整理、指标计算、可视化、表单制作和生成报告等。</p>
</section>
<section id="数据读取" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="数据读取"><span class="header-section-number">3</span> 数据读取</h2>
<p>目前该包可以读取国家癌症中心发布的数据上报格式（call for data），包括以EXCEL格式保存的单年数据或生存数据，通过<em>read_canreg()</em>函数来实现。我们在包里内置了按照国家癌症中心数据上报格式准备的excel数据文档(“411721.xls”)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r code-overflow-scroll number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(canregtools)</span>
<span id="cb4-2">file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extdata"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411721.xlsx"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"canregtools"</span>)</span>
<span id="cb4-3">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_canreg</span>(file)</span></code></pre></div>
</div>
<p>我们给读入的原始数据定义一个类”canreg”， 我们可以通过class函数查看一下。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "canreg" "list"  </code></pre>
</div>
</div>
</section>
<section id="数据整理" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="数据整理"><span class="header-section-number">4</span> 数据整理</h2>
<p>数据整理函数主要为<em>count_canreg()</em>，它可以把读入的class类型为<em>canreg</em>的原始数据整理为各个变量的频数数据，我们给这个频数数据定义了一个类为‘fbswicd’。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1">fbsw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count_canreg</span>(data)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(fbsw)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "fbswicd" "list"   </code></pre>
</div>
</div>
<p>这个函数还可以指定一些参数值从而实现对<em>年龄</em>、<em>癌症分类</em>、<em>语言类型</em>使用不同的分类方法。</p>
<p>比如癌症分类方法，我们按照不同解剖学系统进行分类、大类或小类进行分类。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 指定癌症分类方法为system</span></span>
<span id="cb9-2">fbsw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count_canreg</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cancer_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 指定癌症分类方法为small，并指定输出语言为英语</span></span>
<span id="cb10-2">fbsw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count_canreg</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cancer_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"small"</span>)</span></code></pre></div>
</div>
</section>
<section id="统计指标计算" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="统计指标计算"><span class="header-section-number">5</span> 统计指标计算</h2>
<section id="年龄标化率" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="年龄标化率"><span class="header-section-number">5.1</span> 年龄标化率</h3>
<p>计算年龄标化率的函数为ageadjust()，可以基于不同标准人口计算年龄标化率，并基于不同方法估计可信区间。该函数主要有以下参数：</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb11-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| eval: false</span></span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ageadjust</span>(</span>
<span id="cb11-4">  count, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#不同年龄组病例数</span></span>
<span id="cb11-5">  pop, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#不同年龄组风险人口数</span></span>
<span id="cb11-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#不同年龄组发病率</span></span>
<span id="cb11-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stdpop =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#各年龄组标准人口数</span></span>
<span id="cb11-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#估计可信区间的方法，选项为'gamma', 'normal'，'lognormal'</span></span>
<span id="cb11-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf_level =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#设置可信区间水平, 范围为0-1， 0.95则输出95%可信区间</span></span>
<span id="cb11-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mp =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e+05</span></span>
<span id="cb11-11">)</span>
<span id="cb11-12"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<p>举个具体的例子：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1">cases <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>)</span>
<span id="cb12-2">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">900</span>)</span>
<span id="cb12-3">spop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">900</span>)</span>
<span id="cb12-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ageadjust</span>(cases, pop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stdpop =</span> spop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mp =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$cases
[1] 225

$cr
[1] 5357.143

$cr_var
[1] 1.27551e-05

$cr_lci
[1] 4679.972

$cr_uci
[1] 6104.765

$asr
[1] 5394.737

$asr_var
[1] 1.306556e-05

$asr_lci
[1] 4709.493

$asr_uci
[1] 6154.046</code></pre>
</div>
</div>
<p>这是一个向量化的函数，如果你使用tidyverse进行数据处理时，你可以把他放到<em>mutate</em>或<em>reframe</em>函数内使用。</p>
</section>
<section id="基于类canreg或fbswicd计算标化率" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="基于类canreg或fbswicd计算标化率"><span class="header-section-number">5.2</span> 基于类canreg或fbswicd计算标化率</h3>
<p>我们把数据读入R以后被转换为’canreg’类，我可以直接基于’canreg’数据计算标化率。函数为<em>create_asr()</em>，该函数的参数如下：</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb14-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| eval: false</span></span>
<span id="cb14-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(</span>
<span id="cb14-4">  x, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 类为canreg或fbswicd的数据</span></span>
<span id="cb14-5">  ..., <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#指定输出的分类: year,sex,icd_cat</span></span>
<span id="cb14-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> fbs, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#指定计算年龄率的变量</span></span>
<span id="cb14-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> rks, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 指定人口数变量</span></span>
<span id="cb14-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agegrp =</span> agegrp, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#指定年龄分组变量</span></span>
<span id="cb14-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">std =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(china, segi), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#指定标准人口</span></span>
<span id="cb14-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mp =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e+05</span>, </span>
<span id="cb14-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimal =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#输出小数位</span></span>
<span id="cb14-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_var =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#是否输出方差</span></span>
<span id="cb14-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_ci =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#是否输出可信区间</span></span>
<span id="cb14-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep_sex_specific =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#是否保留年龄别专属癌种值</span></span>
<span id="cb14-15">)</span>
<span id="cb14-16"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<p>基于<em>canreg</em>类数据计算标化率,同时也可以输出0-74岁累积率和35-64岁截缩率。 ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1">asr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(data, year, sex, cancer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_labels</span>()</span>
<span id="cb15-3">asr</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 13
    year sex   cancer site             icd10 no_cases    cr asr_cn2000 asr_wld85
   &lt;int&gt; &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;            &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1  2016 男性  101    口腔和咽（除外鼻咽）…… C00-…       13  2.85       2.46      2.73
 2  2016 男性  102    鼻咽             C11          7  1.54       1.37      1.16
 3  2016 男性  103    食管             C15        157 34.5       29.0      30.6 
 4  2016 男性  104    胃               C16        135 29.6       24.0      24.9 
 5  2016 男性  105    结直肠肛门       C18-…       72 15.8       12.4      12.6 
 6  2016 男性  106    肝脏             C22        180 39.5       31.7      31.8 
 7  2016 男性  107    胆囊及其他       C23-…       16  3.51       2.74      2.7 
 8  2016 男性  108    胰腺             C25         27  5.93       4.88      5.03
 9  2016 男性  109    喉               C32         11  2.41       1.89      1.78
10  2016 男性  110    气管、支气管、肺 C33-…      320 70.2       59.2      61.0 
# ℹ 46 more rows
# ℹ 4 more variables: truncr_cn2000 &lt;dbl&gt;, truncr_wld85 &lt;dbl&gt;, cumur &lt;dbl&gt;,
#   prop &lt;dbl&gt;</code></pre>
</div>
<p>:::</p>
<p>同样，也可以基于<em>fbswicd</em>类数据计算标化率。 ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1">asr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(fbsw, year, sex, cancer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_labels</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lang =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>)</span>
<span id="cb17-3">asr</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 110 × 13
    year sex   cancer site             icd10 no_cases    cr asr_cn2000 asr_wld85
   &lt;int&gt; &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;            &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1  2016 Male  1      Lip              C00          0  0          0         0   
 2  2016 Male  10     Esophagus        C15        157 34.5       29.0      30.6 
 3  2016 Male  11     Stomach          C16        135 29.6       24.0      24.9 
 4  2016 Male  12     Small Intestine  C17          3  0.66       0.51      0.55
 5  2016 Male  13     Colon            C18         33  7.24       5.79      6.1 
 6  2016 Male  14     Rectum           C19-…       38  8.34       6.43      6.36
 7  2016 Male  15     Anus             C21          1  0.22       0.18      0.16
 8  2016 Male  16     Liver            C22        180 39.5       31.7      31.8 
 9  2016 Male  17     Gallbladder and… C23-…       16  3.51       2.74      2.7 
10  2016 Male  18     Pancreas         C25         27  5.93       4.88      5.03
# ℹ 100 more rows
# ℹ 4 more variables: truncr_cn2000 &lt;dbl&gt;, truncr_wld85 &lt;dbl&gt;, cumur &lt;dbl&gt;,
#   prop &lt;dbl&gt;</code></pre>
</div>
<p>:::</p>
</section>
</section>
<section id="数据可视化" class="level2 page-columns page-full" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="数据可视化"><span class="header-section-number">6</span> 数据可视化</h2>
<section id="绘制人口金字塔图" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="绘制人口金字塔图"><span class="header-section-number">6.1</span> 绘制人口金字塔图</h3>
<p>绘图函数为draw_pyramid()，该函数的主要功能为绘制一个或多个人口金字塔，用于展示人口数据结构。该函数主要有以下参数：</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb19-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| eval: false</span></span>
<span id="cb19-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_pyramid</span>(</span>
<span id="cb19-4">  x, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 类为"canreg"或"fbswicd"的数据 </span></span>
<span id="cb19-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_value =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#是否在人口金字塔上显示人口数</span></span>
<span id="cb19-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_prop =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#是否在人口金字塔上显示人口比例</span></span>
<span id="cb19-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">left_axis =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#设置人口金字塔左侧坐标轴值</span></span>
<span id="cb19-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">right_axis =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#设置人口金字塔右侧坐标轴值</span></span>
<span id="cb19-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_fm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"g"</span>, </span>
<span id="cb19-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_bm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb19-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_bi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb19-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cgap =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 人口金字塔的中间间隔宽度</span></span>
<span id="cb19-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cstep =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 间隔1个条形显示人口金字塔</span></span>
<span id="cb19-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">csize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#设置字体大小，默认为1</span></span>
<span id="cb19-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Males"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ages"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Females"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 设置左中右坐标标签</span></span>
<span id="cb19-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gl =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 是否显示竖型背景条</span></span>
<span id="cb19-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cadj =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 调整标签位置</span></span>
<span id="cb19-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#006400"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#b32134"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 设置人口金字塔条颜色</span></span>
<span id="cb19-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dens =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb19-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 设置人口金字塔图的标题</span></span>
<span id="cb19-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#如果绘制多个图，设置显示方式，c(2,3) 设置为2行3列</span></span>
<span id="cb19-22">)</span>
<span id="cb19-23"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_pyramid</span>(fbsw,</span>
<span id="cb20-2">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">csize =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb20-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cgap =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,</span>
<span id="cb20-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>),</span>
<span id="cb20-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-09-30-canregtools/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>如果不想显示人口金字塔人口数字可以，设置<em>show_value = FALSE</em>，不显示这些数据。 ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_pyramid</span>(fbsw,</span>
<span id="cb21-2">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">csize =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb21-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cgap =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,</span>
<span id="cb21-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_value =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb21-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>),</span>
<span id="cb21-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-09-30-canregtools/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<p>:::</p>
</section>
<section id="绘制条形图" class="level3 page-columns page-full" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="绘制条形图"><span class="header-section-number">6.2</span> 绘制条形图</h3>
<p>肿瘤登记年报中经常会出现各种各样的条形图，该包通过<em>draw_barchart()</em>来绘制这种类型的图。该函数的参数如下：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb22-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb22-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span>
<span id="cb22-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb22-5">asr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> fbs, sex, cancer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(sex,cancer,asr_cn2000) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>cancer <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_labels</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lang=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abbr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> sex, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> asr_cn2000) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(M)</span>
<span id="cb22-11"></span>
<span id="cb22-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_bar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(asr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>M),</span>
<span id="cb22-13">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cates =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(asr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>site),</span>
<span id="cb22-14">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bar_side =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb22-15">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"男性"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"女性"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-09-30-canregtools/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb23-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb23-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| eval: false</span></span>
<span id="cb23-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_barchart</span>(</span>
<span id="cb23-4">  data, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#用于绘图的数据框</span></span>
<span id="cb23-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot_var =</span> cr, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#用于绘图的变量</span></span>
<span id="cb23-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cate_var =</span> icd_cat, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#分类变量</span></span>
<span id="cb23-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group_var =</span> year, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#分组变量</span></span>
<span id="cb23-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">side_var =</span> sex,</span>
<span id="cb23-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topn =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb23-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bar_side =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb23-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb23-12">  ...</span>
<span id="cb23-13">)</span>
<span id="cb23-14"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb24-4">asr1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> fbs, sex, cancer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> fbs, cancer)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(sex, cancer, asr_cn2000) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"发病率"</span>)</span>
<span id="cb24-8">asr2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> sws, sex, cancer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_asr</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> sws, cancer)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(sex, cancer, asr_cn2000) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"死亡率"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(asr1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_total</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_others</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_labels</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abbr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb24-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sex=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(sex))</span>
<span id="cb24-17"></span>
<span id="cb24-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_barchart</span>(asr2,</span>
<span id="cb24-19">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot_var =</span> asr_cn2000,</span>
<span id="cb24-20">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cate_var =</span> site,</span>
<span id="cb24-21">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group_var =</span> type,</span>
<span id="cb24-22">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">side_var =</span> sex,</span>
<span id="cb24-23">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bar_side =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb24-24">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="page-columns page-full">
<figure class="figure page-columns page-full">
<p class="page-columns page-full"><img src="https://www.chenq.site/qsight/2023-09-30-canregtools/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img column-screen-left" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1">asr2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"合计"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(type,sex,cancer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb25-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_barchart</span>(</span>
<span id="cb25-5">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot_var =</span> asr_cn2000,</span>
<span id="cb25-6">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cate_var =</span> site,</span>
<span id="cb25-7">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group_var =</span> type,</span>
<span id="cb25-8">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">side_var =</span> sex,</span>
<span id="cb25-9">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-09-30-canregtools/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>肿瘤登记</category>
  <category>R语言</category>
  <category>canregtools</category>
  <guid>https://www.chenq.site/qsight/2023-09-30-canregtools/</guid>
  <pubDate>Sat, 30 Sep 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-09-30-canregtools/preview.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>肿瘤登记数据上报经验分享：R语言批量导入导出excel数据</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2023-05-23-import-all/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>每年向国家肿瘤登记处上报当年肿瘤登记数据是每个省级肿瘤登记处的每年的工作内容，而当县区级登记处的数量很多的时候，数据整理工作变得很琐碎，这篇博文将向大家介绍如何处理肿瘤登记上报过程中的数据处理。</p>
  </div>
</div><p></p>



<section id="随访数据上报要求" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="随访数据上报要求"><span class="header-section-number">1</span> 随访数据上报要求</h2>
<p>随访数据要求上报两部分资料，第一部分是<em>随访资料</em>，第二部分是<em>寿命表资料</em>，并分别以FB和LT为表单名称保存到Excel中。</p>
<section id="随访资料" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="随访资料"><span class="header-section-number">1.1</span> 随访资料</h3>
<p>要求上报建立登记处以来的所有癌症病例并随访至上一年末。</p>
<p>具体上报变量如下：</p>
<ul>
<li>Registr：登记编号</li>
<li>ID: 身份识别号码</li>
<li>Sex: 性别</li>
<li>Age: 年龄</li>
<li>Birthda: 出生日期</li>
<li>Inciden: 出生日期</li>
<li>ICDO3: ICDO3解剖学部位</li>
<li>Morp: ICDO3形态学编码</li>
<li>Beha: ICDO3行为编码</li>
<li>Grad: ICDO3分级编码</li>
<li>Icd10: ICD10编码</li>
<li>Deathda: 死亡日期</li>
<li>Basi: 诊断依据</li>
<li>Trib: 民族</li>
<li>Marri: 婚姻状态</li>
<li>Mult: 是否多原发</li>
<li>Lastcontact: 最后接触日期</li>
<li>Status: 生存状态</li>
<li>Caus: 死亡原因</li>
</ul>
</section>
<section id="寿命表数据" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="寿命表数据"><span class="header-section-number">1.2</span> 寿命表数据</h3>
<p>要求上报与随访资料同年份的寿命表资料。具体变量如下：</p>
<ul>
<li>年份(Year):与随访数据库覆盖年份相同</li>
<li>性别(Sex):合计=0，男性=1，女性=2</li>
<li>年龄组(Age): 0, 1-, 5-, …, 80-, 85及以上， 用组段下限年龄值表示</li>
<li>死亡数(Death):覆盖人群中的全死亡数</li>
<li>人口数(Popu):户籍人口</li>
</ul>
</section>
</section>
<section id="当年发病死亡数据上报" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="当年发病死亡数据上报"><span class="header-section-number">2</span> 当年发病死亡数据上报</h2>
<p>当年发病死亡数据上报的内容要求与随访资料要求上报的变量是一样的，只不过要分为三部分：</p>
<ul>
<li>发病资料：发病日期为上报年份的所有癌症病例资料；</li>
<li>死亡资料：死亡日期为要求上报年份的所有癌症病例资料；</li>
<li>人口数据：要求上报年份登记处所有在地分年龄分性别户籍人口数。</li>
</ul>
</section>
<section id="存在问题及解决方法" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="存在问题及解决方法"><span class="header-section-number">3</span> 存在问题及解决方法</h2>
<p>河南省肿瘤登记采用网络直报信息管理系统进行日常数据的收集和管理，在进行数据上报的时候，我们需要把最新的数据分登记处按照上报格式导出就可以了，这个过程中也涉及了变量名的更改等。</p>
<p>首先加载相关R语言包</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(openxlsx)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(Hmisc)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(haven)</span></code></pre></div>
</div>
<p>我们在code.mdb数据库的registry表中存储了相关登记处的信息，report2019这个变量标记了哪些登记处入选了河南省肿瘤登记年报。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## 从code字典里筛选出2019年年报纳入的登记处</span></span>
<span id="cb2-2">registrys <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdb.get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code.mdb"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tables =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"registry"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(report2019<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(areacode,city,county)</span>
<span id="cb2-5">registrys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>areacode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(registrys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>areacode)</span></code></pre></div>
</div>
<p>通下面的程序，我们把选择需要上报的变量以及把上报变量更改为上报模板要求的变量名称。</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## 读取肿瘤登记数据</span></span>
<span id="annotated-cell-3-2">canreg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sas</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tumorinfo.sas7bdat.zip"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-3" class="code-annotation-target">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-4" class="code-annotation-target">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(registr,indno,sex,age,birthda,inciden,topo,morp,beha,grad,autoicd10,deathda,basi,state,caus,dlc,areacode) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-5" class="code-annotation-target">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span>indno,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">icdo3=</span>topo,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">icd10=</span>autoicd10,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">status=</span>state,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lastcontact=</span>dlc)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="1">把所有变量名改为小写字母</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="2">选择需要上报的变量</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="5" data-code-annotation="3">把变量名改成上报模板要求的变量名</span>
</dd>
</dl>
</div>
</div>
<p>我们通过下面的程序把寿命表数据转换成上报格式要求的形式。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## 整理寿命表数据</span></span>
<span id="cb3-2">lifetable <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sas</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"population.sas7bdat.zip"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">areacode =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(addcode,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> areacodes, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(areacode,year,sex,type,p0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>p85) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> p0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>p85, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agegrp"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pop"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"death"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agegrp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[^0-9</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.]"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, agegrp)),</span>
<span id="cb3-11">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sex=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(sex)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(areacode,year,sex,agegrp)</span></code></pre></div>
</div>
<p>下面的程序把随访资料和寿命表数据按照登记处的行政区划和名称保存成excel，虽然for显式循环运行效率有点低，但是对于几十个登记处的数据来说，运行速度还可以。如果数据量大的时候可以考虑使用lapply来批量导出。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (areas <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> registrys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>areacode){</span>
<span id="cb4-2">  fb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(areacode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>areas)</span>
<span id="cb4-3">  lt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lifetable <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(areacode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>areas)</span>
<span id="cb4-4">  county <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> registrys[registrys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>areacode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>areas,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"county"</span>)]</span>
<span id="cb4-5">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FB=</span>fb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">LT=</span>lt)</span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.xlsx</span>(res,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"report/"</span>,areas,county,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".xlsx"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colNames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb4-7">}</span></code></pre></div>
</div>
<p>以上程序运行的结果见图 图&nbsp;1 。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-export" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-export-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.chenq.site/qsight/2023-05-23-import-all/files.jpg" class="img-fluid figure-img" width="879">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-export-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;1: 导出excel结果
</figcaption>
</figure>
</div>
</div>
</div>


</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>数据处理</category>
  <category>R</category>
  <category>肿瘤登记</category>
  <guid>https://www.chenq.site/qsight/2023-05-23-import-all/</guid>
  <pubDate>Tue, 23 May 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-05-23-import-all/files.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>基于”periodR”包利用现时生存分析法计算人群癌症5年相对生存率</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2023-04-09-relativesurvival/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>癌症5年生存率是评估癌症诊疗水平的一个重要指标，本篇博文介绍了如何利用R语言"periodR"包基于人群肿瘤登记数据计算人群癌症5年相对生存率。</p>
  </div>
</div><p></p>



<blockquote class="blockquote">
<p>人群癌症5年生存率是评估包括癌症筛查、诊断、治疗以及管理等癌症综合防治效果的关键指标，是制定和优化癌症防控政策和措施的重要参考数据，它与一个地区的基础医疗水平、诊断设备的可及性等多种因素相关<span class="citation" data-cites="李卓颖2021">(1)</span>。 本篇博文将介绍如何利用人群肿瘤登记数据进行估计人群癌症5年相对生存率。</p>
</blockquote>
<section id="基本概念" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="基本概念"><span class="header-section-number">1</span> 基本概念</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
什么是5年生存率
</div>
</div>
<div class="callout-body-container callout-body">
<p>通俗的讲，5年生存率是就是诊断癌症后，生存期满5年的病人所占的比例。</p>
</div>
</div>
<section id="相对生存率" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="相对生存率"><span class="header-section-number">1.1</span> 相对生存率</h3>
<p>根据死因竞争风险分析理论，癌症病人的死亡危险分别来自两个相互独立的方面:病人所患疾病(癌症)和除此之外的其它方面。后者指不同性别、年龄、种族和年代的人群本身所存在的基础死亡危险。它们分别可由研究人群的<strong>观察生存率</strong>和相应的一般人群的<strong>期望生存率</strong>来反映。</p>
<p><strong>相对生存率</strong>定义为研究人群的<strong>观察生存率</strong>与假定其为一般人群时的<strong>期望生存率</strong>之比,校正了诸如性别、年龄、种族和年代等因素对病人生存情况的影响。因而用<strong>相对生存率</strong>作为地区或人群间生存率水平的比较指标,比观察生存率能更好地说明问题。</p>
<p><strong>观察生存率</strong>反映的是研究人群的总的死亡危险,而<strong>相对生存率</strong>反映的是肿瘤的超额死亡危险。如果相对生存率越接近于 100%,则表明研究人群的预后越好,反之越差。所以它既可以象观察生存率一样用于描述研究人群的生存水平或预后优劣,也可以作为观察生存率的标化指标。</p>
</section>
<section id="感兴趣时期" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="感兴趣时期"><span class="header-section-number">1.2</span> 感兴趣时期</h3>
<p>我们在分析癌症生存率之前，首先要确定一段时间范围作为<em>“感兴趣时期”</em>，本篇博文的分析将把<em>“2017-2019年”</em>作为感兴趣时期，我们要计算这个时期癌症病例的5年生存率，最真实准确的方法是将<em>2017-2019年</em>的确诊的癌症病例分别随访至<em>2022-2024年</em>，然后计算活满5年的人数所占的比例。在当前的时间（2023年），很显然无法得到全部癌症病例的5年随访数据来计算真实生存率，我们就需要采用其他方法进行估算。</p>
</section>
<section id="完全数据" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="完全数据"><span class="header-section-number">1.3</span> 完全数据</h3>
<p>在癌症病例的随访过程中，能够明确观察记录到病例的生存时间，或者发生终点事件的具体时间，这样的数据为完全数据。生存时间是指从规定的起始观察事件到发生特定的终点事件之间的经历的时间跨度。在人群肿瘤登记数据的生存分析中，起始事件一般为明确诊断为癌症，而终止事件一般为因癌症死亡。</p>
</section>
<section id="不完全数据" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="不完全数据"><span class="header-section-number">1.4</span> 不完全数据</h3>
<p>与完全数据相反，研究结束时，研究对象发生了研究设定的终点事件之外的其他事件，从而导致无法明确记录从起始观察到发生终点事件之间的生存时间，这类数据称之为不完全数据。</p>
<p>在人群肿瘤登记数据中，在癌症病例随访过程的截止不是由”癌症死亡”引起的，而是由其他原因引起。</p>
<p>不完全数据分为：删失数据和截尾数据。</p>
<p>不完全数据的主要原因有：</p>
<ul>
<li>失访： 失去联系</li>
<li>退出： 死于非研究因素或非处理因素而退出研究。对于人群肿瘤登记数据来说，如果癌症患者死于癌症以外的其他原因，如意外、交通事故等，也是退出。</li>
<li>终止： 因为已经到研究设定的<strong>随访截止日期</strong>而终止随访观察，但是研究对象仍然存活。</li>
</ul>
</section>
<section id="删失和截尾" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="删失和截尾"><span class="header-section-number">1.5</span> 删失和截尾</h3>
<p><strong>删失的分类</strong></p>
<ul>
<li><em>左删失：</em>研究对象在某一时刻开始接受观察，但是在该时间点之前，研究所感兴趣的事件已经发生，无法明确具体时间。</li>
<li><em>右删失：</em>在进行随访观察中，研究对象观察的起始时间已知，但终点事件发生的时间未知，无法获取具体的生存时间，只知道生存时间大于观察时间。</li>
</ul>
<p>截尾是所有样本的综合特性，指的是观察的总体是有偏的，只有当事件的失效时间出现在观测区间内，我们才能知道这个事件及其观测数据的存在。</p>
<ul>
<li>左截尾（left truncation）：只能观测到一个时间点之后发生的失效事件。左截尾时间点之前发生的失效事件不知情/不关心（如样本来自退休中心，都是&gt;60岁的老人）。</li>
<li>右截尾（right truncation）：只能观测到一个时间点之前发生的失效事件。右截尾时间点之后发生的失效事件不知情/不关心</li>
</ul>
</section>
</section>
<section id="现时生存分析方法介绍" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="现时生存分析方法介绍"><span class="header-section-number">2</span> 现时生存分析方法介绍</h2>
<section id="不同生存率估计方法比较" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="不同生存率估计方法比较"><span class="header-section-number">2.1</span> 不同生存率估计方法比较</h3>
<p><strong>相对生存率</strong>的估计方法有<em>队列法</em>（cohort method）、<em>完全法</em>（complete method）、<em>现时生存分析法</em>（period survival analysis）、<em>混合法</em>（hybrid method）和<em>预测法</em>（projection method），不同的生存率估计方法纳入的确诊病例和随访时间有所不同，具体不同可以见下图<span class="citation" data-cites="张华2014">(2)</span>。</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-04-09-relativesurvival/followup.jpg" class="img-fluid figure-img" width="756"></p>
</figure>
</div>
</div>
</div>
<p>以上不同的方法具有不同的优缺点，传统的队列法和完全法由于纳入的病例中均包含了感兴趣时期之前确诊的病例，因此不能反映最新最及时的生存情况。</p>
</section>
<section id="现时生存分析" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="现时生存分析"><span class="header-section-number">2.2</span> 现时生存分析</h3>
<p>现时生存分析由德国流行病学家 Hermann Brenner于1996年首先提出，至2002年逐渐发展成熟<span class="citation" data-cites="brenner2002 brenner2004 holleczek2013b 李卓颖2021">(1,3–5)</span>。</p>
<p>现时生存分析（period survival analysis）纳入的研究对象分为两部分，一部分是感兴趣时期新确诊的所有病例，另一部分是感兴趣时期之前确诊而且在感兴趣时期仍然存活的病例。本研究的感兴趣时期设定为<em>2017-2019年</em>，那研究对象就需要纳入2017-2019年期间所有新确诊癌症病例以及2017-2019年之前确诊并在2017-2019年期间仍存活的癌症病例<span class="citation" data-cites="jansen2013">(6)</span>。</p>
<p>现时生存分析在感兴趣时期纳入了新确诊癌症病例数据和随访数据，因此该方法更接近真实生存率。</p>
</section>
<section id="现时生存分析的估计精度" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="现时生存分析的估计精度"><span class="header-section-number">2.3</span> 现时生存分析的估计精度</h3>
<p>由于现时生存分析方法纳入的病例数相对于<em>完全法</em>来说要少，因此，该方法估计生存率的精确度和稳健度比其他方法偏低，估计生存率的方差也偏大一些，因此，我们在利用该方法估计生存率的时候应注意把握估计精确度和时效性之间的平衡。</p>
<p>但是对于省级人群肿瘤登记数据来说，数据样本量较大，生存率估计的精度能够得到保证，因此，评估的时效性成为优先考虑的问题，现时生存分析成为评估人群癌症生存率的优先选项<span class="citation" data-cites="张华2014 张华2016">(2,7)</span>。</p>
</section>
</section>
<section id="统计软件包的安装" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="统计软件包的安装"><span class="header-section-number">3</span> 统计软件包的安装</h2>
<p>本篇博文介绍利用现时法统计模型估计癌症5年生存率，这种方法能够提高生存率估计的时效性。我们将使用Brenner等编写的R包”periodR”进行相对生存率的估计，你可以<a href="https://krebsregister.saarland.de/daten-auswertungen-veroeffentlichungen/software/periodr-english/">在这里下载R包</a>，并安装使用<span class="citation" data-cites="holleczek2009 holleczek2013b">(5,8)</span>。</p>
<p>点开链接之后，可以根据自己使用的操作系统和R语言版本选择相应的安装包。</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-04-09-relativesurvival/periodR.jpg" class="img-fluid figure-img" width="692"></p>
</figure>
</div>
</div>
</div>
<p>下载之后，我们可以看到一个名为<strong>periodR_1.0-6.tar.gz</strong>的压缩包，使用下面的R语言安装所下载的R包。</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'periodR_1.0-6.tar.gz'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repos=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>)</span></code></pre></div>
</section>
<section id="数据准备" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="数据准备"><span class="header-section-number">4</span> 数据准备</h2>
<section id="数据来源" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="数据来源"><span class="header-section-number">4.1</span> 数据来源</h3>
<p>本篇博文拟分析河南省肿瘤登记处覆盖地区的癌症患者5年相对生存率，数据来源分为两部分，第一部分为肿瘤登记地区癌症患者生存信息用于计算观察生存率，另一部分来源于各肿瘤登记处上报的<strong>寿命表数据</strong>用于计算一般人群的期望生存率。</p>
</section>
<section id="肿瘤登记处的筛选" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="肿瘤登记处的筛选"><span class="header-section-number">4.2</span> 肿瘤登记处的筛选</h3>
<p>我们要使用河南省肿瘤登记数据估计河南省癌症5年相对生存率，首先要做的是选择使用哪些登记处的数据进行生存分析，河南省肿瘤登记已经覆盖全省人口的90%以上，但是数据质量差异很大。</p>
<p>为了使生存分析的结果能够真实反映河南省癌症人群的真实生存情况，我们选择纳入分析的登记处必须满足下面的条件，即其2014年肿瘤登记数据被纳入《河南省肿瘤登记年报》，这样纳入的癌症病例能够基本反映登记地区的癌症病人总体的发病、死亡及生存情况。</p>
<p>提前加载数据分析相关的R包</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(haven)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(Hmisc)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(canregtools)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(periodR)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(flextable)</span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(kableExtra)</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gtsummary)</span></code></pre></div>
<p>筛选入选河南省肿瘤登记年报的登记处数据。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## 从code字典里筛选出2014年年报纳入的登记处</span></span>
<span id="cb3-2">registrys <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdb.get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code.mdb"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tables =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"registry"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(report2014<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(areacode,city,county)</span>
<span id="cb3-5">areacodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> registrys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>areacode</span>
<span id="cb3-6"></span>
<span id="cb3-7">registrys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>areacode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(registrys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>areacode)</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## 读取肿瘤登记数据</span></span>
<span id="cb3-10">canreg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sas</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tumorinfo.sas7bdat.zip"</span>)</span>
<span id="cb3-11">canreg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#把入选2014年年报的登记处筛选出来</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> areacodes)</span></code></pre></div>
</details>
</div>
</section>
<section id="按照现时生存分析筛选病例" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="按照现时生存分析筛选病例"><span class="header-section-number">4.3</span> 按照现时生存分析筛选病例</h3>
<p>考虑到我们设定的”感兴趣时期”为2017-2019年，按照<strong>现时生存分析</strong>方法纳入病例的原则，我们需要纳入2017-2019年期间新诊断的所有癌症患者以及在这个时期之前诊断且在2017-2019年期间内仍存活的癌症病例<span class="citation" data-cites="ellison2006">(9)</span>。</p>
<p>按照上面的筛选标准，继续对上一步输出的数据进行范围筛查。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1">canreg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(inciden),</span>
<span id="cb4-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dm =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(inciden),</span>
<span id="cb4-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dyear =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(deathda)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>((dy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> dy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>(dy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(dyear)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>dyear<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)),dy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="限制生存分析的癌种范围" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="限制生存分析的癌种范围"><span class="header-section-number">4.4</span> 限制生存分析的癌种范围</h3>
<p>我们选择分析的癌种范围与《国家肿瘤登记年报》报告的癌种范围一致，即所有恶性肿瘤和中枢神经系统良性肿瘤。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## 把数据限制在上报C00-C98,D32-33,D42-43,D45-47范围之内</span></span>
<span id="cb5-2">analysis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> canreg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">autoicd10=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toupper</span>(autoicd10),</span>
<span id="cb5-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(autoicd10,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">icd_number =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[^0-9</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.]"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, autoicd10))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>((type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(icd_number,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">98.9</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb5-7">        (type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(icd_number,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.9</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb5-8">        (type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(icd_number,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">43.9</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb5-9">        (type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(icd_number,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">47.9</span>))) </span></code></pre></div>
</details>
</div>
</section>
<section id="对删失数据进行处理" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="对删失数据进行处理"><span class="header-section-number">4.5</span> 对删失数据进行处理</h3>
<p>本研究的随访截止日期设定为2019年12月31日，我们按照这个截止日期进行结尾数据的手工处理。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1">analysis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diagage =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trunc</span>((birthda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%--%</span> inciden) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">years</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb6-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">icdd=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_icd10</span>(autoicd10),</span>
<span id="cb6-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">follow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb6-5">           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> deathda,</span>
<span id="cb6-6">           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019-12-31"</span>),</span>
<span id="cb6-7">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019-12-31"</span>)),</span>
<span id="cb6-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vitstat =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb6-9">           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb6-10">           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> dy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb6-11">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(deathda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb6-12">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fm =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(follow),</span>
<span id="cb6-13">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(follow))</span></code></pre></div>
</details>
</div>
</section>
<section id="对待分析的分组变量进行处理" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="对待分析的分组变量进行处理"><span class="header-section-number">4.6</span> 对待分析的分组变量进行处理</h3>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1">analysis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area_type =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410302"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410303"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410304"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410305"</span>,</span>
<span id="cb7-4">                                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410602"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410603"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410611"</span>,</span>
<span id="cb7-5">                                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411102"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411103"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411104"</span>,</span>
<span id="cb7-6">                                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411202"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411303"</span>),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Urban"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rural"</span>),</span>
<span id="cb7-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agegrp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(diagage, </span>
<span id="cb7-8">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>),</span>
<span id="cb7-9">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-14 岁"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15-39 岁"</span>,</span>
<span id="cb7-10">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40-64 岁"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"65-84 岁"</span>,</span>
<span id="cb7-11">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;84 岁"</span>),</span>
<span id="cb7-12">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">right =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb7-13">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agegrp2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">findInterval</span>(diagage,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>)),</span>
<span id="cb7-14">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">period =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb7-15">           dy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2012</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010-2013"</span>,</span>
<span id="cb7-16">           dy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2014-2016"</span>,</span>
<span id="cb7-17">           dy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-2019"</span>)</span>
<span id="cb7-18">         ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(sex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>icdd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"子宫体"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"子宫颈"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"乳房"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"卵巢"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(sex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>icdd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"前列腺"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"睾丸"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">areacode2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb7-22">    areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410302"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410303"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410304"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410305"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410300"</span>,</span>
<span id="cb7-23">    areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410602"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410603"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410611"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410600"</span>,</span>
<span id="cb7-24">    areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411102"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411103"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411104"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411100"</span>,</span>
<span id="cb7-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> areacode )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">basi2=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(inciden<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>deathda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(deathda),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,basi)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(areacode2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410300"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, state))</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="质量控制" class="level2 page-columns page-full" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="质量控制"><span class="header-section-number">5</span> 质量控制</h2>
<p>在进行5年相对生存率的计算之前，我们需要先评估一下各个登记处的随访的质量情况，包括DCO数据的比例、失访的情况、最终纳入分析数据的病理诊断比例等来对数据质量进行评估。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1">submit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(areacode2)</span>
<span id="cb8-2">dco <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(basi2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(areacode2)</span>
<span id="cb8-5"></span>
<span id="cb8-6">status <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>basi2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(state <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(areacode2) </span>
<span id="cb8-9"></span>
<span id="cb8-10">final <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> analysis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>basi2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>((state <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>)))</span>
<span id="cb8-13"></span>
<span id="cb8-14">selected <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> final <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(areacode2)</span>
<span id="cb8-15"></span>
<span id="cb8-16">mv <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> final <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(basi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(areacode2)</span>
<span id="cb8-17">mp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> final <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(reco <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(areacode2)</span>
<span id="cb8-18">result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> submit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(dco,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"areacode2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(status,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"areacode2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(selected,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"areacode2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(mv,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"areacode2"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(mp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"areacode2"</span>)) </span>
<span id="cb8-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(result) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>( <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"areacode"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"submit"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dco"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"missfol"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"analysis"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mv"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mp"</span>)</span>
<span id="cb8-25"></span>
<span id="cb8-26">result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace_na</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">missfol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mp=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb8-28">result1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(submit,dco,missfol,analysis,mv,mp),sum)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">areacode=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"合计"</span>)</span>
<span id="cb8-31"></span>
<span id="cb8-32">result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(result,result1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dco_p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(dco<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>submit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-34">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">missfol_p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(missfol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>submit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-35">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mv_p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(mv<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>analysis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-36">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mp_p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(mp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>analysis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb8-37">urban <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410300"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410600"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411100"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411202"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411303"</span>)</span></code></pre></div>
</details>
</div>
<p>把上面计算的结果绘制成可以展现的表格，从下面 表&nbsp;1 中可以看出入选登记处的数据质量情况，包括DCO、失访情况、以及最终纳入分析的病例数、多原发比例、以病理诊断比例等。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1">t1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(dco,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,dco_p,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%)"</span>),</span>
<span id="cb9-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(missfol,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,missfol_p,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%)"</span>),</span>
<span id="cb9-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(mp,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,mp_p,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%)"</span>),</span>
<span id="cb9-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">d=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(mv,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,mv_p,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%)"</span>),</span>
<span id="cb9-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> urban,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"城市"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"农村"</span>),</span>
<span id="cb9-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"合计"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>,type)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(registrys,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"areacode"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">county=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb9-10">    areacode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410300"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"洛阳市"</span>,</span>
<span id="cb9-11">    areacode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410600"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"鹤壁市"</span>,</span>
<span id="cb9-12">    areacode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411100"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"漯河市"</span>,</span>
<span id="cb9-13">    areacode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"合计"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"合计"</span>,</span>
<span id="cb9-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> county</span>
<span id="cb9-15">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(county,type,submit,a,b,analysis,c,d) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"登记处"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"类型"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"病例数"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DCO,n(%)"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"失访,n(%)"</span>,</span>
<span id="cb9-18">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"病例数"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"多原发,n(%)"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"病理诊断,n(%)"</span>),</span>
<span id="cb9-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_classic</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full_width =</span> T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">html_font =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cambria"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_header_above</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"剔除"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"纳入分析"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb9-23">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bold =</span> T,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border_left =</span> T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_spec</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bold=</span>T,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">italic=</span>T) </span></code></pre></div>
</details>
</div>
<div class="cell page-columns page-full">
<div id="tbl-t1" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-t1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;1: 纳入分析肿瘤登记处随访质量情况
</figcaption>
<div aria-describedby="tbl-t1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="cell-output-display column-page">
<table class="table lightable-classic do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; empty-cells: hide;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
剔除
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
纳入分析
</div></th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">登记处</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">类型</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">病例数</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">DCO,n(%)</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">失访,n(%)</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">病例数</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">多原发,n(%)</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">病理诊断,n(%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">洛阳市</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">23750</td>
<td style="text-align: center;">1079(4.5%)</td>
<td style="text-align: center;">1993(8.4%)</td>
<td style="text-align: center;">20678</td>
<td style="text-align: center;">182(0.9%)</td>
<td style="text-align: center;">15901(76.9%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">孟津县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">9688</td>
<td style="text-align: center;">337(3.5%)</td>
<td style="text-align: center;">311(3.2%)</td>
<td style="text-align: center;">9040</td>
<td style="text-align: center;">23(0.3%)</td>
<td style="text-align: center;">6168(68.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">新安县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">8815</td>
<td style="text-align: center;">170(1.9%)</td>
<td style="text-align: center;">67(0.8%)</td>
<td style="text-align: center;">8578</td>
<td style="text-align: center;">15(0.2%)</td>
<td style="text-align: center;">5587(65.1%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">栾川县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">5766</td>
<td style="text-align: center;">206(3.6%)</td>
<td style="text-align: center;">257(4.5%)</td>
<td style="text-align: center;">5303</td>
<td style="text-align: center;">8(0.2%)</td>
<td style="text-align: center;">3969(74.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">嵩县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">10091</td>
<td style="text-align: center;">219(2.2%)</td>
<td style="text-align: center;">56(0.6%)</td>
<td style="text-align: center;">9816</td>
<td style="text-align: center;">7(0.1%)</td>
<td style="text-align: center;">7092(72.2%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">汝阳县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">7771</td>
<td style="text-align: center;">275(3.5%)</td>
<td style="text-align: center;">6(0.1%)</td>
<td style="text-align: center;">7490</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">5786(77.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">宜阳县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">11723</td>
<td style="text-align: center;">206(1.8%)</td>
<td style="text-align: center;">115(1%)</td>
<td style="text-align: center;">11402</td>
<td style="text-align: center;">19(0.2%)</td>
<td style="text-align: center;">8147(71.5%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">偃师市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">11615</td>
<td style="text-align: center;">211(1.8%)</td>
<td style="text-align: center;">157(1.4%)</td>
<td style="text-align: center;">11247</td>
<td style="text-align: center;">213(1.9%)</td>
<td style="text-align: center;">8350(74.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">鲁山县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">16226</td>
<td style="text-align: center;">439(2.7%)</td>
<td style="text-align: center;">17(0.1%)</td>
<td style="text-align: center;">15770</td>
<td style="text-align: center;">212(1.3%)</td>
<td style="text-align: center;">12528(79.4%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">林州市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">25727</td>
<td style="text-align: center;">259(1%)</td>
<td style="text-align: center;">1(0%)</td>
<td style="text-align: center;">25467</td>
<td style="text-align: center;">475(1.9%)</td>
<td style="text-align: center;">20861(81.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">鹤壁市</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">11707</td>
<td style="text-align: center;">251(2.1%)</td>
<td style="text-align: center;">267(2.3%)</td>
<td style="text-align: center;">11189</td>
<td style="text-align: center;">119(1.1%)</td>
<td style="text-align: center;">7706(68.9%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">辉县市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">16596</td>
<td style="text-align: center;">90(0.5%)</td>
<td style="text-align: center;">792(4.8%)</td>
<td style="text-align: center;">15714</td>
<td style="text-align: center;">24(0.2%)</td>
<td style="text-align: center;">11220(71.4%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">禹州市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">18484</td>
<td style="text-align: center;">654(3.5%)</td>
<td style="text-align: center;">23(0.1%)</td>
<td style="text-align: center;">17807</td>
<td style="text-align: center;">18(0.1%)</td>
<td style="text-align: center;">13155(73.9%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">漯河市</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">23074</td>
<td style="text-align: center;">905(3.9%)</td>
<td style="text-align: center;">558(2.4%)</td>
<td style="text-align: center;">21611</td>
<td style="text-align: center;">46(0.2%)</td>
<td style="text-align: center;">15431(71.4%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">三门峡市湖滨区</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">5945</td>
<td style="text-align: center;">73(1.2%)</td>
<td style="text-align: center;">224(3.8%)</td>
<td style="text-align: center;">5648</td>
<td style="text-align: center;">5(0.1%)</td>
<td style="text-align: center;">4498(79.6%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">南阳市卧龙区</td>
<td style="text-align: center;">城市</td>
<td style="text-align: center;">15196</td>
<td style="text-align: center;">1575(10.4%)</td>
<td style="text-align: center;">66(0.4%)</td>
<td style="text-align: center;">13555</td>
<td style="text-align: center;">66(0.5%)</td>
<td style="text-align: center;">9895(73%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">方城县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">16024</td>
<td style="text-align: center;">423(2.6%)</td>
<td style="text-align: center;">70(0.4%)</td>
<td style="text-align: center;">15531</td>
<td style="text-align: center;">41(0.3%)</td>
<td style="text-align: center;">11534(74.3%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">内乡县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">12722</td>
<td style="text-align: center;">155(1.2%)</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">12567</td>
<td style="text-align: center;">84(0.7%)</td>
<td style="text-align: center;">9372(74.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">睢县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">14534</td>
<td style="text-align: center;">98(0.7%)</td>
<td style="text-align: center;">510(3.5%)</td>
<td style="text-align: center;">13926</td>
<td style="text-align: center;">22(0.2%)</td>
<td style="text-align: center;">9818(70.5%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">虞城县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">15607</td>
<td style="text-align: center;">106(0.7%)</td>
<td style="text-align: center;">3(0%)</td>
<td style="text-align: center;">15498</td>
<td style="text-align: center;">42(0.3%)</td>
<td style="text-align: center;">11036(71.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">罗山县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">13046</td>
<td style="text-align: center;">161(1.2%)</td>
<td style="text-align: center;">5(0%)</td>
<td style="text-align: center;">12880</td>
<td style="text-align: center;">191(1.5%)</td>
<td style="text-align: center;">8716(67.7%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">沈丘县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">22220</td>
<td style="text-align: center;">628(2.8%)</td>
<td style="text-align: center;">139(0.6%)</td>
<td style="text-align: center;">21453</td>
<td style="text-align: center;">12(0.1%)</td>
<td style="text-align: center;">14877(69.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">郸城县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">23826</td>
<td style="text-align: center;">597(2.5%)</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">23229</td>
<td style="text-align: center;">0(0%)</td>
<td style="text-align: center;">16073(69.2%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">西平县</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">14952</td>
<td style="text-align: center;">361(2.4%)</td>
<td style="text-align: center;">134(0.9%)</td>
<td style="text-align: center;">14457</td>
<td style="text-align: center;">41(0.3%)</td>
<td style="text-align: center;">10808(74.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">济源市</td>
<td style="text-align: center;">农村</td>
<td style="text-align: center;">13396</td>
<td style="text-align: center;">423(3.2%)</td>
<td style="text-align: center;">593(4.4%)</td>
<td style="text-align: center;">12380</td>
<td style="text-align: center;">13(0.1%)</td>
<td style="text-align: center;">8716(70.4%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">合计</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">368501</td>
<td style="text-align: center;">9901(2.7%)</td>
<td style="text-align: center;">6364(1.7%)</td>
<td style="text-align: center;">352236</td>
<td style="text-align: center;">1878(0.5%)</td>
<td style="text-align: center;">257244(73%)</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
</section>
<section id="计算一般人群期望生存概率" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="计算一般人群期望生存概率"><span class="header-section-number">6</span> 计算一般人群期望生存概率</h2>
<p>普通人群期望生存概率是计算癌症相对生存率的基础，我们可以通过肿瘤登记处上报的分性别、年龄组的全因死亡数来计算简略寿命表，然后通过一些方法把简略寿命表扩展为完全寿命表。</p>
<p>下面我们介绍如何使用stata软件计算简略寿命表，并把简略寿命表扩充为完全寿命表的过程。（图&nbsp;1）</p>
<div class="cell" data-eval="true" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-lifetable" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lifetable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-lifetable">flowchart TD
 A[(全死因数据)] --&gt; B[分性别年龄组全因死亡数]
 B --&gt; C[编制简略寿命表]
 C --&gt; D[寿命表的质量控制]
 D --&gt; E[平滑方法]
 E --&gt; F[完全寿命表]
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lifetable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;1: 简略寿命表扩充完全寿命表
</figcaption>
</figure>
</div>
</div>
</div>
<section id="统计整理全死因数据" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="统计整理全死因数据"><span class="header-section-number">6.1</span> 统计整理全死因数据</h3>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1">lifetable <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sas</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"population.sas7bdat.zip"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_all</span>(tolower) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mutate(areacode = substr(addcode,1,6)) %&gt;% </span></span>
<span id="cb10-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter(areacode =="410302",type==4,year==2013)</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">areacode =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(addcode,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),</span>
<span id="cb10-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area_type =</span></span>
<span id="cb10-7">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410302"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410303"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410304"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410305"</span>,</span>
<span id="cb10-8">                                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410602"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410603"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410611"</span>,</span>
<span id="cb10-9">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411102"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411103"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411104"</span>,</span>
<span id="cb10-10">                                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411202"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"411303"</span>),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Urban"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rural"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> areacodes, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(areacode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410602"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410603"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410611"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"410303"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(areacode,area_type,year,sex,type,p0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>p85) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> p0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>p85, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agegrp"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pop"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"death"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agegrp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[^0-9</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.]"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, agegrp)),</span>
<span id="cb10-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sex=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(sex))  </span></code></pre></div>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## 按照地区分类计算各年龄生存概率</span></span>
<span id="cb11-2">area_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lifetable <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(death),<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(pop)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(area_type,sex, year, agegrp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">deaths=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(death),</span>
<span id="cb11-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(pop),</span>
<span id="cb11-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> deaths<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(area_type,sex,year,agegrp,pop,deaths,rate) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agegroup2=</span>agegrp,</span>
<span id="cb11-11">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code=</span>area_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb11-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(area_type,year,sex,agegrp)</span>
<span id="cb11-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_dta</span>(area_type,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pop.dta"</span>)</span></code></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
    sex  year agegrp    pop deaths  rate agegroup2 code 
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;
1     1  2014      0 118519    596 5.03          0 Henan
2     1  2014      1 593146    304 0.513         1 Henan
3     1  2014      5 743825    181 0.243         5 Henan
4     1  2014     10 694528    177 0.255        10 Henan
5     1  2014     15 692646    290 0.419        15 Henan
6     1  2014     20 829811    537 0.647        20 Henan</code></pre>
</div>
</div>
</section>
<section id="stata数据准备" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="stata数据准备"><span class="header-section-number">6.2</span> stata数据准备</h3>
<p>我们在扩展简略寿命表的过程中使用了ej-hm的方法，这个方法需要用到ej系数和ej-hm方法的do程序，大家可以点击下面的按钮下载使用。</p>
<p><button class="btn btn-info downloadthis  " id="dnldts34420"><i class="bi bi-database-fill-down"></i> 下载ej系数 </button></p>
<p><button class="btn btn-info downloadthis  " id="dnldts53242"><i class="bi bi-database-fill-down"></i> 下载ej-hm.do </button></p>
</section>
<section id="计算简略寿命表" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="计算简略寿命表"><span class="header-section-number">6.3</span> 计算简略寿命表</h3>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb13-1">cd <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/qc0824/manuscripts/period-survival"</span></span>
<span id="cb13-2">************step 2 简略寿命表准备</span>
<span id="cb13-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> pop.dta,<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb13-4">browse</span>
<span id="cb13-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> n=5 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//生成组距</span></span>
<span id="cb13-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> n=1 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> agegroup2==0</span>
<span id="cb13-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> n=4 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> agegroup2==1</span>
<span id="cb13-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> n=15 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> agegroup2==85</span>
<span id="cb13-9"></span>
<span id="cb13-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tab</span> n</span>
<span id="cb13-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> mx= deaths/pop <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 计算年龄组死亡率</span></span>
<span id="cb13-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> qx=1-<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(-n*mx) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 计算年龄组死亡概率</span></span>
<span id="cb13-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> ageblock1=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(),block(19)</span>
<span id="cb13-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> ageblock1: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> ageblock2=<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span></span>
<span id="cb13-15"></span>
<span id="cb13-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> lx=.</span>
<span id="cb13-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> lx=100000 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> agegroup2==0</span>
<span id="cb13-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> dx=.</span>
<span id="cb13-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> dx=qx*lx </span>
<span id="cb13-20"></span>
<span id="cb13-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">foreach</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">of</span> numlist 2/19 {</span>
<span id="cb13-22">   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> code <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> sex ageblock1: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> lx=lx[<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span>-1]-dx[<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span>-1] <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>  ageblock2==<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`n'</span></span>
<span id="cb13-23">   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> dx=qx[<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span>]*lx[<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span>] <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ageblock2==<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`n'</span></span>
<span id="cb13-24">    } <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 计算尚存活人数lx，和死亡人数dx</span></span>
<span id="cb13-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> Lx=n*(2*lx-dx)/2    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//计算个年龄组生存人年数</span></span>
<span id="cb13-26"></span>
<span id="cb13-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gsort</span> code <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> sex -ageblock2 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 利用sum函数从上往下累计的原理，将年龄组倒序排列，反向累加</span></span>
<span id="cb13-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> ageblock1: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> Tx=<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sum</span>(Lx) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 计算生存总人年数</span></span>
<span id="cb13-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gsort</span> code <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> sex ageblock2</span>
<span id="cb13-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> ex=Tx/lx <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 计算期望寿命=生存总人年数/年龄组尚存活人数</span></span></code></pre></div>
</section>
<section id="寿命表的质量审核" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="寿命表的质量审核"><span class="header-section-number">6.4</span> 寿命表的质量审核</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">twoway</span>(connected ex <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> agegroup2==0),<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">by</span>(code sex) xla(2014(2)2020) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// #根据期望寿命判断寿命表的数据质量（修改分析年份）</span></span></code></pre></div>
</section>
<section id="扩充完全寿命表结构" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="扩充完全寿命表结构"><span class="header-section-number">6.5</span> 扩充完全寿命表结构</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb15-1">*******************step3 将19个年龄组expand为0到99岁完整年龄寿命表结构</span>
<span id="cb15-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">drop</span> ageblock1 ageblock2 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 删除年龄区组中间变量</span></span>
<span id="cb15-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> num=<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 生成序号</span></span>
<span id="cb15-4">expand=n   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 根据n的数量扩充数据库</span></span>
<span id="cb15-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> num <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 根据序号排序</span></span>
<span id="cb15-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> code <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> sex : <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> age=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(),f(0) t(99) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 生成0-99岁单岁组</span></span>
<span id="cb15-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">bysort</span> code <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> sex num :<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">egen</span> block=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(),f(1) t()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 为19个年组内扩充的单岁组排序</span></span>
<span id="cb15-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">order</span> age,after(sex) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 年龄变量移位至sex后面</span></span>
<span id="cb15-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">foreach</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">of</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">varlist</span> mx-ex {</span>
<span id="cb15-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">`var'</span>=. <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> block~=1</span>
<span id="cb15-11">    } <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 清除扩充出的单岁组的对应的死亡率mx，死亡概率qx，尚存活人数lx，死亡人数dx，生存人年数Lx，生存总人年数Tx，平均期望寿命ex</span></span>
<span id="cb15-12">    </span>
<span id="cb15-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> lt0-99,<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span></code></pre></div>
</section>
<section id="合并ej推算系数" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="合并ej推算系数"><span class="header-section-number">6.6</span> 合并EJ推算系数</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb16-1">************step 4 EJ推算系数合并</span>
<span id="cb16-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> ej系数,<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb16-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> age</span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> ej系数,<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span>
<span id="cb16-5"></span>
<span id="cb16-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> lt0-99,<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">clear</span></span>
<span id="cb16-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> age</span>
<span id="cb16-8"></span>
<span id="cb16-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">merge</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span>:1 age <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">using</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ej系数"</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 注意查看合并结果和note文件</span></span></code></pre></div>
</section>
<section id="利用ej-hm方法建模估计完全寿命表" class="level3" data-number="6.7">
<h3 data-number="6.7" class="anchored" data-anchor-id="利用ej-hm方法建模估计完全寿命表"><span class="header-section-number">6.7</span> 利用EJ-hm方法建模估计完全寿命表</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb17-1">************step 5 EJ建模估算</span>
<span id="cb17-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ren</span> (code pop deaths)(site population deaths) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 重新命名变量与EJ-hm.do内保持一致</span></span>
<span id="cb17-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">describe</span></span>
<span id="cb17-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> site <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> sex age</span>
<span id="cb17-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> lx=lx/100000 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//必须将lx转化，除以100000，否则结果出错</span></span>
<span id="cb17-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EJ-hm.do"</span></span>
<span id="cb17-7">* Generate <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fitted</span> mortality rate from 0 to 98 years</span>
<span id="cb17-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span> site sex <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span> age </span>
<span id="cb17-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">gen</span> fitmx=-<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ln</span>(fitlx[<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span>+1]/fitlx) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> age!=99 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 根据qx=1-exp(-n*mx)公式反向推导而来，即px=exp(-mx)</span></span>
<span id="cb17-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span> fitmx=-<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ln</span>(fitlx/fitlx[<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">_n</span>-1]) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> age==99 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 99岁组fitmx单独计算,等于98岁组的死亡率（疑问？）</span></span>
<span id="cb17-11">* Save results</span>
<span id="cb17-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">save</span> complete_lifetable_js, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">replace</span></span></code></pre></div>
</section>
</section>
<section id="利用periodr包计算相对生存率" class="level2 page-columns page-full" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="利用periodr包计算相对生存率"><span class="header-section-number">7</span> 利用periodR包计算相对生存率</h2>
<section id="periodr基本语法" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="periodr基本语法"><span class="header-section-number">7.1</span> periodR基本语法</h3>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">period</span>(data, k, surv.m, surv.f, perbeg, perend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EdereII"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agedist=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span></code></pre></div>
<p>程序参数如下：</p>
<blockquote class="blockquote">
<ul>
<li>data：生存数据</li>
<li>k：随访时间</li>
<li>surv.m：0-99岁条件一年生存概率（男性）</li>
<li>surv.f：0-99岁条件一年生存概率（女性）</li>
<li>perbeg：纳入分析的起始年份</li>
<li>perend：纳入分析的终止年份</li>
<li>method：相对生存率的计算方法</li>
<li>agedist: 标准年龄构成</li>
</ul>
</blockquote>
<p>生存数据所须的一些强制性变量</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
periodR生存分析的强制性变量
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>sex: 1-男性，2-女性</li>
<li>dm: 诊断时间月份(数值：1-12)</li>
<li>dy: 诊断时间年份(数值：2002)</li>
<li>diagage: 诊断时年龄(数值：66)</li>
<li>fm: 随访终止时间月份(数值：1-12)</li>
<li>fy: 随访终止时间年份(数值：2019)</li>
<li>vitstat: 随访终止时生存状态(1：存活，2：死亡)</li>
</ul>
</div>
</div>
</section>
<section id="sec-macro" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="sec-macro"><span class="header-section-number">7.2</span> 构建批量生存分析函数</h3>
<p>period函数对不同数据子集进行生存分析时，需要在data参数中制定不同的数据子集，如果子集很多的时候，数据分析起来就会很麻烦，比如对不同部位癌种进行生存分析，所以，我们可以在period函数的基础上，编制一个批量生存分析的函数，来方面我们的计算过程。</p>
<p>下面这个函数在period的基础上进行了一些整合，可以批量分析不同亚组的生存分析，并把主要结果整理成数据集。</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1">tperiod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data,cat) {</span>
<span id="cb19-2">  cats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(data[[cat]])</span>
<span id="cb19-3">  ress <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb19-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (x <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> cats) {</span>
<span id="cb19-5">    std.pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">icss_choose</span>(x)</span>
<span id="cb19-6">    ress_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">period</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(data,data[[cat]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>x), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, surv.m, surv.f, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)</span>
<span id="cb19-7">    res_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">period</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(data,data[[cat]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>x), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, surv.m, surv.f, </span>
<span id="cb19-8">                   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agedist =</span> std.pop)</span>
<span id="cb19-9">    res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cate=</span>x,</span>
<span id="cb19-10">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(ress_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb19-11">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cse=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(ress_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb19-12">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(res_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb19-13">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(res_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb19-14">    ress <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(ress,res)</span>
<span id="cb19-15">  }</span>
<span id="cb19-16">  total_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">period</span>(data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, surv.m, surv.f, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)</span>
<span id="cb19-17">  total <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">period</span>(data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, surv.m, surv.f, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agedist =</span> icss1)</span>
<span id="cb19-18">  total <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cate=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"合计"</span>,</span>
<span id="cb19-19">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(total_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb19-20">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cse=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(total_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb19-21">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb19-22">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rel.surv.stderr[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb19-23">  ress <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(ress,total) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(cate)</span>
<span id="cb19-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(ress)</span>
<span id="cb19-25">}</span></code></pre></div>
</section>
<section id="年龄标化生存率的计算" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="年龄标化生存率的计算"><span class="header-section-number">7.3</span> 年龄标化生存率的计算</h3>
<p>在进行生存率的年龄标化时，WHO推荐了三个标准年龄构成，不同的癌种在进行年龄标化时应该选择不同的标准年龄构成。我把这个过程跟上面的函数整合到一起，可以实现根据不同癌症选择不同的标准年龄构成，这样就不用手动选择标准年龄结构了<span class="citation" data-cites="corazziari2004a">(10)</span>。</p>
<section id="标准年龄构成" class="level4" data-number="7.3.1">
<h4 data-number="7.3.1" class="anchored" data-anchor-id="标准年龄构成"><span class="header-section-number">7.3.1</span> 标准年龄构成</h4>
<p>标准年龄构成分为两种，一种是每5岁一组的年龄构成(表&nbsp;2)；另外一种是20岁一组的年龄构成(表&nbsp;3)。</p>
<div class="cell">
<div id="tbl-std1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-std1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;2: 5岁年龄组的标准年龄构成
</figcaption>
<div aria-describedby="tbl-std1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">年龄组</th>
<th style="text-align: center;">ICSS1</th>
<th style="text-align: center;">ICSS2</th>
<th style="text-align: center;">ICSS3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">15-19 岁</td>
<td style="text-align: center;">164</td>
<td style="text-align: center;">1128</td>
<td style="text-align: center;">6938</td>
</tr>
<tr class="even">
<td style="text-align: center;">20-24 岁</td>
<td style="text-align: center;">215</td>
<td style="text-align: center;">2011</td>
<td style="text-align: center;">11183</td>
</tr>
<tr class="odd">
<td style="text-align: center;">25-29 岁</td>
<td style="text-align: center;">416</td>
<td style="text-align: center;">3745</td>
<td style="text-align: center;">12964</td>
</tr>
<tr class="even">
<td style="text-align: center;">30-34 岁</td>
<td style="text-align: center;">842</td>
<td style="text-align: center;">5755</td>
<td style="text-align: center;">11630</td>
</tr>
<tr class="odd">
<td style="text-align: center;">35-39 岁</td>
<td style="text-align: center;">1874</td>
<td style="text-align: center;">7538</td>
<td style="text-align: center;">9635</td>
</tr>
<tr class="even">
<td style="text-align: center;">40-44 岁</td>
<td style="text-align: center;">3489</td>
<td style="text-align: center;">7823</td>
<td style="text-align: center;">7650</td>
</tr>
<tr class="odd">
<td style="text-align: center;">45-49 岁</td>
<td style="text-align: center;">4906</td>
<td style="text-align: center;">8283</td>
<td style="text-align: center;">5324</td>
</tr>
<tr class="even">
<td style="text-align: center;">50-54 岁</td>
<td style="text-align: center;">7094</td>
<td style="text-align: center;">8717</td>
<td style="text-align: center;">4676</td>
</tr>
<tr class="odd">
<td style="text-align: center;">55-59 岁</td>
<td style="text-align: center;">9641</td>
<td style="text-align: center;">9894</td>
<td style="text-align: center;">5224</td>
</tr>
<tr class="even">
<td style="text-align: center;">60-64 岁</td>
<td style="text-align: center;">13359</td>
<td style="text-align: center;">11106</td>
<td style="text-align: center;">4776</td>
</tr>
<tr class="odd">
<td style="text-align: center;">65-69 岁</td>
<td style="text-align: center;">14234</td>
<td style="text-align: center;">10992</td>
<td style="text-align: center;">5067</td>
</tr>
<tr class="even">
<td style="text-align: center;">70-74 岁</td>
<td style="text-align: center;">14766</td>
<td style="text-align: center;">9008</td>
<td style="text-align: center;">4933</td>
</tr>
<tr class="odd">
<td style="text-align: center;">75-79 岁</td>
<td style="text-align: center;">14131</td>
<td style="text-align: center;">7254</td>
<td style="text-align: center;">5179</td>
</tr>
<tr class="even">
<td style="text-align: center;">80-84 岁</td>
<td style="text-align: center;">9347</td>
<td style="text-align: center;">4116</td>
<td style="text-align: center;">3247</td>
</tr>
<tr class="odd">
<td style="text-align: center;">85+ 岁</td>
<td style="text-align: center;">5522</td>
<td style="text-align: center;">2630</td>
<td style="text-align: center;">1574</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="tbl-std2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-std2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;3: 20岁年龄组的标准年龄构成
</figcaption>
<div aria-describedby="tbl-std2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">年龄组</th>
<th style="text-align: center;">ICSS1</th>
<th style="text-align: center;">ICSS2</th>
<th style="text-align: center;">ICSS3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">15-44岁</td>
<td style="text-align: center;">7000</td>
<td style="text-align: center;">28000</td>
<td style="text-align: center;">60000</td>
</tr>
<tr class="even">
<td style="text-align: center;">45-54岁</td>
<td style="text-align: center;">12000</td>
<td style="text-align: center;">17000</td>
<td style="text-align: center;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">55-64岁</td>
<td style="text-align: center;">23000</td>
<td style="text-align: center;">21000</td>
<td style="text-align: center;">10000</td>
</tr>
<tr class="even">
<td style="text-align: center;">65-74岁</td>
<td style="text-align: center;">29000</td>
<td style="text-align: center;">20000</td>
<td style="text-align: center;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">75+岁</td>
<td style="text-align: center;">29000</td>
<td style="text-align: center;">14000</td>
<td style="text-align: center;">10000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="不同癌种对应的标准人口构成" class="level4" data-number="7.3.2">
<h4 data-number="7.3.2" class="anchored" data-anchor-id="不同癌种对应的标准人口构成"><span class="header-section-number">7.3.2</span> 不同癌种对应的标准人口构成</h4>
<p>不同的癌种对应了不同的标准人口构成，(表&nbsp;4)列出了不同的癌种的想对应的癌种，在计算所有癌种合计的标化生存率时，应选择ICSS1。</p>
<p>我们在计算不同癌种的标化相对生存率时可以参考(表&nbsp;4)选择标准人口构成。</p>
<div class="cell">
<div id="tbl-icss" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-icss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;4: 不同癌种对应的标准人口构成<span class="citation" data-cites="corazziari2004a">(10)</span>
</figcaption>
<div aria-describedby="tbl-icss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 98%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">ICSS</th>
<th style="text-align: left;">癌症部位</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">ICSS1</td>
<td style="text-align: left;">Lip, tongue, salivary glands, oral cavity, oropharynx, hypopharynx, head &amp; neck, oesophagus, stomach, small intestine, colon, rectum, liver, biliary tract, pancreas, nasal cavities, larynx, lung, pleura, breast, corpus uteri, ovary, vagina &amp; vulva, penis, bladder, kidney, choroid melanoma, non-Hodgkin lymphomas, multiple myeloma, chronic lymphatic leukaemia, acute myeloid leukaemia, chronic myeloid leukaemia, leukaemia, all cancers, prostate</td>
</tr>
<tr class="even">
<td style="text-align: center;">ICSS2</td>
<td style="text-align: left;">Nasopharynx, soft tissues, melanoma, cervix uteri, brain, thyroid gland, bone</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ICSS3</td>
<td style="text-align: left;">Testis, Hodgkins disease, acute lymphatic leukaemia</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="标准人口选择r程序" class="level4" data-number="7.3.3">
<h4 data-number="7.3.3" class="anchored" data-anchor-id="标准人口选择r程序"><span class="header-section-number">7.3.3</span> 标准人口选择R程序</h4>
<p>我们在计算标化率时选择的标准人口是(表&nbsp;3)对应的标准人口，同时也写了R程序自动选择不同癌种对应的标准人口，并把程序嵌入到(小节&nbsp;7.2)对应的R函数中，这样就可以使用程序批量输出标化相对生存率的计算结果。</p>
<p>程序如下：</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#生成生存分析标准人口结构</span></span>
<span id="cb20-2">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>)</span>
<span id="cb20-3">icss1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(cancer.pop[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],s)</span>
<span id="cb20-4">s<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span>
<span id="cb20-5">icss2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(icss1[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],s)</span>
<span id="cb20-6">s<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb20-7">icss3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(icss1[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],s)</span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#根据癌种不同选择不同的标准人口结构</span></span>
<span id="cb20-9">icss_choose <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb20-10">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"鼻咽"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"皮肤黑色素瘤"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"子宫颈"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"脑"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"甲状腺"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"骨"</span>)) {</span>
<span id="cb20-11">    std.pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> icss2</span>
<span id="cb20-12">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"睾丸"</span>)) {</span>
<span id="cb20-13">    std.pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> icss3 </span>
<span id="cb20-14">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> { </span>
<span id="cb20-15">    std.pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> icss1 </span>
<span id="cb20-16">  }</span>
<span id="cb20-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(std.pop)</span>
<span id="cb20-18">}</span></code></pre></div>
</section>
</section>
<section id="sec-rs" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="sec-rs"><span class="header-section-number">7.4</span> 计数分性别不同部位的5年相对生存率</h3>
<p>首先，截取需要用的数据子集，然后利用tperiod函数计算不同癌种的5年相对生存率</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##合计成人5年生存率</span></span>
<span id="cb21-2">total <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ana <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(diagage<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>) </span>
<span id="cb21-3">ress_total <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tperiod</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>total,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cat=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icdd"</span>)</span></code></pre></div>
<p>计算男性成人5年相对生存率</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##男性成人5年生存率</span></span>
<span id="cb22-2">male <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ana <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(sex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>,diagage<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb22-3">ress_male <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tperiod</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>male,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cat=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icdd"</span>)</span></code></pre></div>
<p>计算女性成人5年相对生存率</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##女性成人5年生存率</span></span>
<span id="cb23-2">female <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ana <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(sex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>,diagage<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb23-3">ress_female <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tperiod</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>female,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cat=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icdd"</span>)</span></code></pre></div>
</section>
<section id="组间相对生存率的统计学检验" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="组间相对生存率的统计学检验"><span class="header-section-number">7.5</span> 组间相对生存率的统计学检验</h3>
<p>periodR能够输出估计的相对生存率和标准差，其实有这两个参数可以直接推出95%可信区间，但是为了能够更直观的两组间相对生存率点估计值的统计学差异，可以对两组的相对生存率进行统计学检验。</p>
<p>我们采用Z检验比较组间5年相对生存率的统计学差异（式&nbsp;1），其中<img src="https://latex.codecogs.com/png.latex?P_1">表示组1的相对生存率，<img src="https://latex.codecogs.com/png.latex?P_2">表示组2的相对生存率，<img src="https://latex.codecogs.com/png.latex?s.e.(P_1)">表示<img src="https://latex.codecogs.com/png.latex?P_1">的标准误，<img src="https://latex.codecogs.com/png.latex?s.e.(P_2)">表示<img src="https://latex.codecogs.com/png.latex?P_2">的标准误癌，如果Z&gt;1.96，则<em>P</em>&lt;0.05；如果Z&gt;2.56，则<em>P</em>&lt;0.01。<span class="citation" data-cites="xiangyongbing1999a">(<strong>xiangyongbing1999a?</strong>)</span></p>
<p><span id="eq-z"><img src="https://latex.codecogs.com/png.latex?%0AZ=%5Cfrac%7B%7CP_1-P_2%7C%7D%7B%5Csqrt%7Bs.e.(P_1)%5E2+s.e.(P_2)%5E2%7D%7D%0A%5Ctag%7B1%7D"></span></p>
</section>
<section id="结果表格整理" class="level3 page-columns page-full" data-number="7.6">
<h3 data-number="7.6" class="anchored" data-anchor-id="结果表格整理"><span class="header-section-number">7.6</span> 结果表格整理</h3>
<p>(小节&nbsp;7.4)已经计算出了不同癌种、不同性别癌症人群的5年相对生存率，这一部分，我们将根据计算结果以及(式&nbsp;1)计算男性和女性之间估计5年相对生存率的统计学差异。</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NA.print =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>)</span>
<span id="cb24-2">ress_site <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ress_total <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(ress_male,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cate"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(ress_female,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cate"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rs.x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(rs.y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(se.y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>se<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb24-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(z<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.96</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;0.05"</span>,</span>
<span id="cb24-8">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(z<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.56</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;0.05"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;0.01"</span>))) </span></code></pre></div>
<p>最后，我们利用kableExtra包把所有的结果输出到表格。</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1">  ress_site <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ress_site <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(crs.x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,cse.x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>),</span>
<span id="cb25-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(rs.x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,se.x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>),</span>
<span id="cb25-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(crs.y,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,cse.y,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>),</span>
<span id="cb25-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">d=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(rs.y,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,se.y,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>),</span>
<span id="cb25-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">e=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(crs,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,cse,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>),</span>
<span id="cb25-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">f=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(rs,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>,se,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cate,a,b,c,d,e,f,z,p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>f, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(. <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NA(NA)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, .))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"部位"</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CRS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ARS"</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_classic</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full_width =</span> T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">html_font =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cambria"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_header_above</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"合计"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"男性"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"女性"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb25-13">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bold =</span> T,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border_left =</span> T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb25-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_spec</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bold=</span>T,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">italic=</span>T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">footnote</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">general =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"结果以5年相对生存率(标准误)的形式展示. CRS: 5年相对生存率. ARS: 年龄调整5年相对生存率."</span>,</span>
<span id="cb25-16">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">general_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"注:"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">footnote_as_chunk =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">escape =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<div class="cell page-columns page-full">
<div id="tbl-t2" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-t2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;5: 15岁以上不同性别、不同部位癌症患者5年相对生存率
</figcaption>
<div aria-describedby="tbl-t2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="cell-output-display column-page">
<table class="lightable-classic do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; empty-cells: hide;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
合计
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
男性
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
女性
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; empty-cells: hide;"></th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">部位</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">CRS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">ARS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">CRS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">ARS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">CRS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">ARS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">Z</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold; font-style: italic; font-family: monospace;">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">甲状腺</td>
<td style="text-align: center;">91.8(0.6)</td>
<td style="text-align: center;">86.4(1.2)</td>
<td style="text-align: center;">87.8(1.6)</td>
<td style="text-align: center;">83.4(2.3)</td>
<td style="text-align: center;">92.9(0.6)</td>
<td style="text-align: center;">87.3(1.4)</td>
<td style="text-align: center;">1.45</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">睾丸</td>
<td style="text-align: center;">72.8(5.4)</td>
<td style="text-align: center;">74.4(4.9)</td>
<td style="text-align: center;">72.8(5.4)</td>
<td style="text-align: center;">74.4(4.9)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">乳房</td>
<td style="text-align: center;">79.7(0.4)</td>
<td style="text-align: center;">73.1(1)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">79.7(0.4)</td>
<td style="text-align: center;">73.1(1)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">子宫颈</td>
<td style="text-align: center;">72.4(0.7)</td>
<td style="text-align: center;">68.3(0.8)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">72.4(0.7)</td>
<td style="text-align: center;">68.3(0.8)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">皮肤黑色素瘤</td>
<td style="text-align: center;">68.4(4.5)</td>
<td style="text-align: center;">67.6(4.5)</td>
<td style="text-align: center;">64.9(6.3)</td>
<td style="text-align: center;">63.7(6.2)</td>
<td style="text-align: center;">72.4(6.3)</td>
<td style="text-align: center;">72.2(6)</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">膀胱</td>
<td style="text-align: center;">66.1(1.4)</td>
<td style="text-align: center;">66.2(1.4)</td>
<td style="text-align: center;">68.5(1.7)</td>
<td style="text-align: center;">68.7(1.6)</td>
<td style="text-align: center;">58.5(2.7)</td>
<td style="text-align: center;">58.7(2.6)</td>
<td style="text-align: center;">3.28</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">子宫体</td>
<td style="text-align: center;">79.5(0.8)</td>
<td style="text-align: center;">64.2(1.8)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">79.5(0.8)</td>
<td style="text-align: center;">64.2(1.8)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">口腔</td>
<td style="text-align: center;">63.4(1.5)</td>
<td style="text-align: center;">60.2(1.7)</td>
<td style="text-align: center;">58.2(2)</td>
<td style="text-align: center;">55.3(2.3)</td>
<td style="text-align: center;">70.3(2.1)</td>
<td style="text-align: center;">66.7(2.6)</td>
<td style="text-align: center;">3.28</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">肾</td>
<td style="text-align: center;">64.8(1.4)</td>
<td style="text-align: center;">60.2(1.7)</td>
<td style="text-align: center;">61.1(1.9)</td>
<td style="text-align: center;">56.5(2.3)</td>
<td style="text-align: center;">70.2(2)</td>
<td style="text-align: center;">66(2.5)</td>
<td style="text-align: center;">2.80</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">鼻咽</td>
<td style="text-align: center;">59.2(2.3)</td>
<td style="text-align: center;">59.2(2.3)</td>
<td style="text-align: center;">57.5(2.8)</td>
<td style="text-align: center;">57.5(3)</td>
<td style="text-align: center;">62.2(3.7)</td>
<td style="text-align: center;">62.7(3.7)</td>
<td style="text-align: center;">1.09</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">结直肠</td>
<td style="text-align: center;">58.5(0.6)</td>
<td style="text-align: center;">56.9(0.6)</td>
<td style="text-align: center;">58.5(0.8)</td>
<td style="text-align: center;">57(0.9)</td>
<td style="text-align: center;">58.5(0.8)</td>
<td style="text-align: center;">56.8(0.9)</td>
<td style="text-align: center;">0.16</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">其他</td>
<td style="text-align: center;">58.3(0.8)</td>
<td style="text-align: center;">55.1(0.9)</td>
<td style="text-align: center;">53.9(1.1)</td>
<td style="text-align: center;">51.7(1.3)</td>
<td style="text-align: center;">62.7(1.1)</td>
<td style="text-align: center;">58.2(1.3)</td>
<td style="text-align: center;">3.54</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">前列腺</td>
<td style="text-align: center;">58.7(2.1)</td>
<td style="text-align: center;">55.1(2.7)</td>
<td style="text-align: center;">58.7(2.1)</td>
<td style="text-align: center;">55.1(2.7)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">骨</td>
<td style="text-align: center;">50.5(1.6)</td>
<td style="text-align: center;">51.4(1.5)</td>
<td style="text-align: center;">49.3(2.2)</td>
<td style="text-align: center;">50.1(2.1)</td>
<td style="text-align: center;">51.9(2.4)</td>
<td style="text-align: center;">53.1(2.3)</td>
<td style="text-align: center;">0.96</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">其他胸腔器官</td>
<td style="text-align: center;">54.4(2.8)</td>
<td style="text-align: center;">51.1(3.3)</td>
<td style="text-align: center;">48.5(3.7)</td>
<td style="text-align: center;">42.6(4.1)</td>
<td style="text-align: center;">61.7(4.1)</td>
<td style="text-align: center;">62.8(4.7)</td>
<td style="text-align: center;">3.24</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">喉</td>
<td style="text-align: center;">52.4(2.2)</td>
<td style="text-align: center;">49.8(2.4)</td>
<td style="text-align: center;">53.7(2.5)</td>
<td style="text-align: center;">50.5(2.6)</td>
<td style="text-align: center;">46.2(5.4)</td>
<td style="text-align: center;">42.4(5.6)</td>
<td style="text-align: center;">1.31</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">卵巢</td>
<td style="text-align: center;">57.7(1.3)</td>
<td style="text-align: center;">47.5(1.8)</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">--</td>
<td style="text-align: center;">57.7(1.3)</td>
<td style="text-align: center;">47.5(1.8)</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">脑</td>
<td style="text-align: center;">45.7(0.9)</td>
<td style="text-align: center;">45.8(0.9)</td>
<td style="text-align: center;">38(1.2)</td>
<td style="text-align: center;">38.3(1.2)</td>
<td style="text-align: center;">53.1(1.2)</td>
<td style="text-align: center;">53.2(1.2)</td>
<td style="text-align: center;">8.78</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">淋巴瘤</td>
<td style="text-align: center;">47.2(1.2)</td>
<td style="text-align: center;">43.1(1.4)</td>
<td style="text-align: center;">47.1(1.7)</td>
<td style="text-align: center;">43.1(1.9)</td>
<td style="text-align: center;">47.4(1.8)</td>
<td style="text-align: center;">43.1(1.9)</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">白血病</td>
<td style="text-align: center;">44.4(1.1)</td>
<td style="text-align: center;">41.6(1.3)</td>
<td style="text-align: center;">43.4(1.4)</td>
<td style="text-align: center;">42.3(1.8)</td>
<td style="text-align: center;">45.7(1.6)</td>
<td style="text-align: center;">40.5(2)</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">合计</td>
<td style="text-align: center;">44.2(0.1)</td>
<td style="text-align: center;">40.7(0.2)</td>
<td style="text-align: center;">35.2(0.2)</td>
<td style="text-align: center;">34.4(0.2)</td>
<td style="text-align: center;">54(0.2)</td>
<td style="text-align: center;">47.1(0.2)</td>
<td style="text-align: center;">44.90</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">食管</td>
<td style="text-align: center;">36.7(0.4)</td>
<td style="text-align: center;">36.9(0.4)</td>
<td style="text-align: center;">35.9(0.5)</td>
<td style="text-align: center;">35.6(0.5)</td>
<td style="text-align: center;">37.9(0.6)</td>
<td style="text-align: center;">39(0.6)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">胃</td>
<td style="text-align: center;">34.3(0.4)</td>
<td style="text-align: center;">33.5(0.4)</td>
<td style="text-align: center;">34.2(0.4)</td>
<td style="text-align: center;">33.2(0.5)</td>
<td style="text-align: center;">34.7(0.7)</td>
<td style="text-align: center;">34.4(0.7)</td>
<td style="text-align: center;">1.39</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">胆囊</td>
<td style="text-align: center;">27.5(1.1)</td>
<td style="text-align: center;">28(1.2)</td>
<td style="text-align: center;">25.4(1.7)</td>
<td style="text-align: center;">25.6(1.7)</td>
<td style="text-align: center;">29(1.5)</td>
<td style="text-align: center;">29.6(1.6)</td>
<td style="text-align: center;">1.71</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">肺</td>
<td style="text-align: center;">24.1(0.3)</td>
<td style="text-align: center;">24.3(0.3)</td>
<td style="text-align: center;">22.2(0.4)</td>
<td style="text-align: center;">22.5(0.4)</td>
<td style="text-align: center;">28.1(0.6)</td>
<td style="text-align: center;">27.8(0.6)</td>
<td style="text-align: center;">7.35</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">胰腺</td>
<td style="text-align: center;">20.8(0.9)</td>
<td style="text-align: center;">20.5(0.9)</td>
<td style="text-align: center;">18.7(1.2)</td>
<td style="text-align: center;">18.1(1.2)</td>
<td style="text-align: center;">23.4(1.5)</td>
<td style="text-align: center;">23.2(1.5)</td>
<td style="text-align: center;">2.65</td>
<td style="text-align: center;">&lt;0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">肝</td>
<td style="text-align: center;">19.9(0.4)</td>
<td style="text-align: center;">19.1(0.4)</td>
<td style="text-align: center;">19.9(0.5)</td>
<td style="text-align: center;">19.1(0.5)</td>
<td style="text-align: center;">20(0.7)</td>
<td style="text-align: center;">19.7(0.7)</td>
<td style="text-align: center;">0.70</td>
<td style="text-align: center;">&gt;0.05</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: center; padding: 0;"><span style="font-style: italic;">注:</span> <sup></sup> 结果以5年相对生存率(标准误)的形式展示. CRS: 5年相对生存率. ARS: 年龄调整5年相对生存率.</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="参考文献" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="参考文献">参考文献</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-李卓颖2021" class="csl-entry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">李卓颖, 蒋宇飞, 谭玉婷, 等. <span>现时法统计模型在全人群肿瘤登记生存分析中的应用</span>. <em>复旦学报(医学版)</em>. 2021年;48(3): 376-382+397+383-387. </div>
</div>
<div id="ref-张华2014" class="csl-entry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">张华, 曹志刚, 柳光宇, 等. <span>队列法、完全法和现时生存分析方法在乳腺癌随访研究中的应用</span>. <em>肿瘤</em>. 2014年;34(6): 550–556. </div>
</div>
<div id="ref-brenner2002" class="csl-entry">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Brenner H, Söderman B, Hakulinen T. Use of Period Analysis for Providing More Up-to-Date Estimates of Long-Term Survival Rates: Empirical Evaluation among 370 000 Cancer Patients in <span>Finland</span>. <em>International Journal of Epidemiology</em>. 2002年;31(2): 456–462. <a href="https://doi.org/10.1093/ije/31.2.456">https://doi.org/10.1093/ije/31.2.456.</a></div>
</div>
<div id="ref-brenner2004" class="csl-entry">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Brenner H, Gefeller O, Hakulinen T. Period Analysis for <span>《up-to-Date》</span> Cancer Survival Data. <em>European Journal of Cancer</em>. 2004年;40(3): 326–335. <a href="https://doi.org/10.1016/j.ejca.2003.10.013">https://doi.org/10.1016/j.ejca.2003.10.013.</a></div>
</div>
<div id="ref-holleczek2013b" class="csl-entry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Holleczek B, Brenner H. Model Based Period Analysis of Absolute and Relative Survival with <span>R</span>: Data Preparation, Model Fitting and Derivation of Survival Estimates. <em>Comput Methods Programs Biomed</em>. 2013年;110(2): 192–202. <a href="https://doi.org/10.1016/j.cmpb.2012.10.004">https://doi.org/10.1016/j.cmpb.2012.10.004.</a></div>
</div>
<div id="ref-jansen2013" class="csl-entry">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Jansen L, Hakulinen T, Brenner H. Study Populations for Period Analyses of Cancer Survival. <em>Br J Cancer</em>. 2013年;108(3): 699–707. <a href="https://doi.org/10.1038/bjc.2013.14">https://doi.org/10.1038/bjc.2013.14.</a></div>
</div>
<div id="ref-张华2016" class="csl-entry">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">张华, 曹志刚, 莫淼, 等. <span>肿瘤监测数据的生存分析方法比较</span>. <em>中国卫生统计</em>. 2016年;33(5): 908–913. </div>
</div>
<div id="ref-holleczek2009" class="csl-entry">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Holleczek B, Gondos A, Brenner H. <span>periodR</span> - an <span>R</span> Package to Calculate Long-Term Cancer Survival Estimates Using Period Analysis. <em>Methods Inf Med</em>. 2009年;48(2): 123–128. <a href="https://doi.org/10.3414/ME0563">https://doi.org/10.3414/ME0563.</a></div>
</div>
<div id="ref-ellison2006" class="csl-entry">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Ellison LF. An <span>Empirical Evaluation</span> of <span>Period Survival Analysis Using Data</span> from the <span>Canadian Cancer Registry</span>. <em>Annals of Epidemiology</em>. 2006年;16(3): 191–196. <a href="https://doi.org/10.1016/j.annepidem.2005.02.017">https://doi.org/10.1016/j.annepidem.2005.02.017.</a></div>
</div>
<div id="ref-corazziari2004a" class="csl-entry">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Corazziari I, Quinn M, Capocaccia R. Standard Cancer Patient Population for Age Standardising Survival Ratios. <em>European Journal of Cancer</em>. 2004年;40(15): 2307–2316. <a href="https://doi.org/10.1016/j.ejca.2004.07.002">https://doi.org/10.1016/j.ejca.2004.07.002.</a></div>
</div>
</div>


</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>肿瘤登记</category>
  <category>数据分析</category>
  <category>R</category>
  <guid>https://www.chenq.site/qsight/2023-04-09-relativesurvival/</guid>
  <pubDate>Sun, 09 Apr 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-04-09-relativesurvival/periodR.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Quarto支持多格式同时输出</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2023-04-04-quartomultiformat/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>Quarto自1.3以后的版本中将支持网页输出中包含其他输出格式（PDF、MS Word等）的链接，这对于多种格式的内容分享很重要。</p>
  </div>
</div><p></p>



<section id="功能介绍" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="功能介绍"><span class="header-section-number">1</span> 功能介绍</h2>
<p>Quarto自1.3版本之后，quartoHTML页面（独立或网站中）可以支持自动包含元数据中指定 的其他输出格式的链接。例如，如果在quarto文档中指定下面的元数据：</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
元数据设置
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">---</span>
<span id="cb1-2">title: "Quarto支持多格式同时输出"</span>
<span id="cb1-3">subtitle: "多种输出格式，网页中自动加入其他格式链接"</span>
<span id="cb1-4">description: |</span>
<span id="cb1-5">  Quarto自1.3以后的版本中将支持网页输出中包含其他输出格式（PDF、MS Word等）的链接，这对于多种格式的内容分享很重要。</span>
<span id="cb1-6">categories:</span>
<span id="cb1-7">  - quarto</span>
<span id="cb1-8">  - 个人网站</span>
<span id="cb1-9">date: 2023-04-04</span>
<span id="cb1-10">date-modified: last-modified</span>
<span id="cb1-11">draft: false</span>
<span id="cb1-12">toc: true</span>
<span id="cb1-13">mainfont: "Hiragino Sans GB"</span>
<span id="cb1-14">format:</span>
<span id="cb1-15">  html: default</span>
<span id="cb1-16">  docx: default</span>
<span id="cb1-17">  pdf:</span>
<span id="cb1-18">    documentclass: scrartcl</span>
<span id="cb1-19">---</span></code></pre></div>
</div>
</div>
</div>
<p>在网页的输出结果中会包含一个链接指向指定的除HTML以外的其他格式输出结果，这个链接会放在网页的右边栏中，放在边栏目录内容下面。</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-04-04-quartomultiformat/formats.jpg" class="img-fluid figure-img" width="793"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="指定显示链接的格式" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="指定显示链接的格式"><span class="header-section-number">2</span> 指定显示链接的格式</h2>
<p>显示<strong>链接到其他格式</strong>是默认的，但是我们可以通过在YAML里设置<strong>format-links</strong>来控制它是否显示，甚至可以指定哪种具体的格式可以显示出来。</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">format:</span>
<span id="cb2-2">  html: default</span>
<span id="cb2-3">  docx: default</span>
<span id="cb2-4">  pdf:</span>
<span id="cb2-5">    documentclass: scrartcl</span>
<span id="cb2-6">format-links: [docx]</span></code></pre></div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-04-04-quartomultiformat/formats2.jpg" class="img-fluid figure-img" width="980"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="隐藏所有链接" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="隐藏所有链接"><span class="header-section-number">3</span> 隐藏所有链接</h2>
<p>如果我们只想输出多种格式，但是不想在右侧边栏中显示他们的链接，可以通过下面的设定来实现。</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fomat-links</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span></code></pre></div>
</section>
<section id="在项目水平上控制显示格式" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="在项目水平上控制显示格式"><span class="header-section-number">4</span> 在项目水平上控制显示格式</h2>
<p>在一个Quarto项目中，为了控制其中一个文件夹内所有quarto文档的显示格式，我们可以在这个文件夹的根目录下的_metadata.yml文件中设置format或format-links选项，如果该文件夹中没有_metadata.yml文件，我们可以新建一个该名称的文件。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
_metadata.yml
</div>
</div>
<div class="callout-body-container callout-body">
<pre><code>format:
  html:
    toc: true
  docx: default
  pdf: default</code></pre>
</div>
</div>
<p>如果你想在整个Quarto项目中设置统一的显示格式，那么我们就可以在Quarto项目的根目录下的_quarto.yml文件中设置format和format-links选项，从而在项目水平上设置输出格式以及链接的格式内容。如果你选择在_quarto.yml文件中设置输出格式，那么也意味着这个Quarto项目内的所有quarto文档均输出你所指定的格式。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
_quarto.yml
</div>
</div>
<div class="callout-body-container callout-body">
<pre><code>format:
  html:
    toc: true
  docx: default
  pdf: default</code></pre>
</div>
</div>
</section>
<section id="预览版本的quarto" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="预览版本的quarto"><span class="header-section-number">5</span> 预览版本的Quarto</h2>
<p>预览版本的Quarto可以在下面的链接中进行下载使用<a href="https://quarto.org/docs/download/">https://quarto.org/docs/download/</a>，这个链接中也列出了最新版本Quarto的一些新的特性，如果你想试试最新Quarto支持的功能，可以尝试下载使用哈。</p>


</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>quarto</category>
  <category>个人网站</category>
  <guid>https://www.chenq.site/qsight/2023-04-04-quartomultiformat/</guid>
  <pubDate>Tue, 04 Apr 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-04-04-quartomultiformat/formats.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>提高Rstudio和Quarto使用效率的一些方法和配置</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>本篇博文介绍了我们使用Rstudio进行数据分析或使用Quarto撰写报告时提高效率的一些方法和配置，通过这些配置可以大大提高我们工作的便捷性和效率，俗话说“磨刀不误砍柴工”，开始数据分析之前，先把工具“Rstudio,R”配置好，肯定事半功倍！</p>
  </div>
</div><p></p>



<section id="提高quarto效率的常见配置" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="提高quarto效率的常见配置"><span class="header-section-number">1</span> 提高Quarto效率的常见配置</h2>
<p>Quarto是基于Pandoc的开源科技出版系统，我们可以利用Quarto把常规文本以及基于不同语言的数据分析过程（R、Python等）混合格式转化为静态网页、PDF、WORD文档、网站以及其他更多的格式。我也写过一篇博文介绍了<a href="https://www.chenq.site/qsight/2023-3-25-quarto-writing/">如何利用Quarto提高科技论文效率</a>，今天在这个段落介绍一下提高Quarto撰写效率的方法。</p>
<section id="利用snippets自动插入divs和spans" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="利用snippets自动插入divs和spans"><span class="header-section-number">1.1</span> 利用snippets自动插入Divs和Spans</h3>
<p>Quarto支持利用Divs和Spans来给特定的内容增加一些属性。比如，我们可以给一段话增加边框，语句如下：</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">::: {.border}</span>
<span id="cb1-2">这是具有边框样式的一段话。</span>
<span id="cb1-3">:::</span></code></pre></div>
<p>具体显示效果如下：</p>
<div class="border">
<p>这是具有边框样式的一段话。</p>
</div>
<p>我们也可以使用一些内置的callout样式，语法如下：</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">::: {.callout-warning}</span>
<span id="cb2-2">这是一段warning类型callout段落。</span>
<span id="cb2-3">:::</span></code></pre></div>
<p>具体显示效果如下：</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
警告
</div>
</div>
<div class="callout-body-container callout-body">
<p>这是一段warning类型callout段落的显示效果。</p>
</div>
</div>
<p>但是我们在实际使用的时候，每次录入3个”:“开头，然后紧接着是”{}“内表明具体的属性名称，最后以3个”:“结尾，这么多的字符输入很浪费时间，但是我们可以通过在Rstudio里设置snippets片段的方式来提高输入效率，snippets是自动插入代码比较好的一种方式，使我们能够比较快地在quarto文档里插入相应的代码片段。</p>
<p>下面是一些quarto文本中常用的一些snippet片段，我们可以在Rstudio里通过依次点击Tools &gt; Global Options &gt; Code &gt; Edit Code Snippets，在出现的界面中选择Markdown选项卡，然后把下面的代码片段插入到最后。</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1">snippet fragment</span>
<span id="cb3-2">    [${1:text}]{.${2:type}}</span>
<span id="cb3-3">    </span>
<span id="cb3-4">snippet aside</span>
<span id="cb3-5">    [${1:text}]{.aside}</span>
<span id="cb3-6">    </span>
<span id="cb3-7">snippet fence</span>
<span id="cb3-8">    :::{.${1:type}}</span>
<span id="cb3-9">        ${2:body}</span>
<span id="cb3-10">    :::</span>
<span id="cb3-11"></span>
<span id="cb3-12">snippet panel</span>
<span id="cb3-13">    ::: {.panel-tabset}</span>
<span id="cb3-14">        ${1:body}</span>
<span id="cb3-15">    :::</span>
<span id="cb3-16">    </span>
<span id="cb3-17">snippet column</span>
<span id="cb3-18">    :::: {.columns}</span>
<span id="cb3-19">    ::: {.column width="50%"}</span>
<span id="cb3-20">    Left column</span>
<span id="cb3-21">    :::</span>
<span id="cb3-22"></span>
<span id="cb3-23">    ::: {.column width="50%"}</span>
<span id="cb3-24">    Right column</span>
<span id="cb3-25">    :::</span>
<span id="cb3-26">    ::::</span></code></pre></div>
<p>我们在在使用的时候，在Quarto文档里输入snippet名称，然后按Shift+Tab键就可以按照设定的片段录入代码了。比如，我们可以将将内容进行分栏，可以录入column，然后按Shift+Tab键，然后相应的代码块会自动填充。</p>
</section>
<section id="善于使用echo-fenced选项" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="善于使用echo-fenced选项"><span class="header-section-number">1.2</span> 善于使用echo: fenced选项</h3>
<p>Quarto支持插入代码块从而实现一些相应的功能，而我们在利用Quarto进行写作时，有时需要把代码显示出来，从而让其他人知道相应的部分的内容的原始代码是什么样的，而在代码块的echo选项设定为fenced之后，可以把包括选项部分的设置一块显示出来。</p>
<p>在没有这是 echo: fenced时，代码块的显示是下面这样的。</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_stylling</span>()</span></code></pre></div>
<p>设置echo: fenced之后，代码块的显示是这样的：</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| label: tbl-t1</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-cap: "不同地区恶性肿瘤5年相对生存率"</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-location: top</span></span>
<span id="cb5-4"></span>
<span id="cb5-5">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_stylling</span>()</span></code></pre></div>
</section>
<section id="利用shortcode方便地插入内容" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="利用shortcode方便地插入内容"><span class="header-section-number">1.3</span> 利用shortcode方便地插入内容</h3>
<p>通常我们可以在quarto文档中添加HTML内容，比如通过添加视频内容等，shortcode可以使我们很方便地插入我们想插入的内容。Quarto原生支持一些shortcode，比如运行下面的代码。</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1">这篇博客的标题是`提高Rstudio和Quarto使用效率的一些方法和配置`。</span></code></pre></div>
<p>显示的内容如下：</p>
<p>这篇博客的标题是提高Rstudio和Quarto使用效率的一些方法和配置。</p>
</section>
<section id="在不同文档间重复利用内容" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="在不同文档间重复利用内容"><span class="header-section-number">1.4</span> 在不同文档间重复利用内容</h3>
<p><code>{{&lt; include &gt;}}</code>是一个quarto的shortcode使我们能够重复利用不同quarto文档的内容，而不用复制和粘贴。在你想插入内容的地方，添加shortcode <code>{{&lt; include &gt;}}</code> include后面放入想添加的文档名称，记得在名称前添加下划线。</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1">{{&lt; incldue _content.qmd &gt;}}</span></code></pre></div>
<p>也可以按照一定的条件纳入内容，比如，只在渲染为特定格式时显示内容，用.content-visible 或者 .content-hidden</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1">::: {.content-visible when-format="html"}</span>
<span id="cb8-2">这部分文字只在渲染为HTML时显示</span>
<span id="cb8-3">:::</span></code></pre></div>
</section>
</section>
<section id="善于使用快捷键" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="善于使用快捷键"><span class="header-section-number">2</span> 善于使用快捷键</h2>
<p>我们在使用Rstudio在进行统计分析时，有些使用频率非常高的操作，比如添加或者取消注释、赋值号、管道操作符、运行当前行代码、运行有所代码，从代码界面切换到Console界面，切换到Terminal界面等等，如果记住一些键盘快捷键将会大大提高操作效率，就不用在写着代码的时候到桌面上找鼠标了。下面的表格中列出了我比较常用的键盘快捷键，我们在使用的时候可以参考借鉴。</p>
<p>我们在数据分析的过程中也要保持良好的习惯，比如记得<strong>添加代码注释</strong>，通过添加注释可以使我们的代码具有更高的可读性，使代码更易于维护，帮助我们更好的理解代码的含义。</p>
<table class="caption-top table">
<caption>不同操作系统Rstudio常用快捷键</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 31%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>编号</th>
<th>操作</th>
<th>MAC OS</th>
<th>Linux 或者Windows</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>添加或者取消代码注释</td>
<td>Command + Shift + C</td>
<td>Control + Shift + C</td>
</tr>
<tr class="even">
<td>2</td>
<td>插入赋值号 &lt;-</td>
<td>Option + -</td>
<td>Alt + -</td>
</tr>
<tr class="odd">
<td>3</td>
<td>插入管道操作符 %&gt;%</td>
<td>Command + Shift + M</td>
<td>Ctrl + Shift + M</td>
</tr>
<tr class="even">
<td>4</td>
<td>运行目前行代码</td>
<td>Command + Enter</td>
<td>Control + Enter</td>
</tr>
<tr class="odd">
<td>5</td>
<td>运行所有代码</td>
<td>Command + A + Enter</td>
<td>Control + A + Enter</td>
</tr>
<tr class="even">
<td>6</td>
<td>查看Rstudio快捷键</td>
<td>Option + Shift + K</td>
<td>Alt + Shift + K</td>
</tr>
<tr class="odd">
<td>7</td>
<td>切换到代码编辑界面</td>
<td>Ctrl + 1</td>
<td>Ctrl + 1</td>
</tr>
<tr class="even">
<td>8</td>
<td>切换到Console界面</td>
<td>Ctrl + 2</td>
<td>Ctrl + 2</td>
</tr>
<tr class="odd">
<td>9</td>
<td>切换到Terminal界面</td>
<td>Option + Shift + M</td>
<td>Alt + Shift + M</td>
</tr>
<tr class="even">
<td>10</td>
<td>quarto文档插入代码块</td>
<td>Option + Comman + I</td>
<td></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
记住快捷键的小技巧
</div>
</div>
<div class="callout-body-container callout-body">
<p>一下子记住所有的快捷键肯定是有困难的，但是，我们在日常使用的时候一定要想着使用快捷键，这样即使使用的当时没有记住，但是我们通过每次的查询和使用，不出几天肯定都能熟练的记住了。</p>
</div>
</div>
</section>
<section id="不要保存工作环境变量" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="不要保存工作环境变量"><span class="header-section-number">3</span> 不要保存工作环境变量</h2>
<p>尽量不要保存Rstudio工作环境，如果您创建了值得保存的 R 对象，请将生成该对象的 R 代码保存到一个 R 脚本文件中。保存 R 脚本，但不要保存对象生成时的环境或工作空间。</p>
<p>为防止 RStudio 保存您的工作空间，请打开”首选项 &gt; 通用”并取消选择将 .RData 在启动时恢复到工作空间的选项。请确保指定您永不想保存工作空间，如下所示：</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/global.jpg" class="img-fluid figure-img" width="527"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="用项目projects组织管理工作" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="用项目projects组织管理工作"><span class="header-section-number">4</span> 用项目(Projects)组织管理工作</h2>
<p>如果我们使用Rstudio进行数据分析时，一定要有<strong>项目</strong>的概念，当我们处理多个分析时，时常需要在多个分析之间来回切换，使用了项目的概念之后，我们各个分析会更有组织性。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rstudio项目
</div>
</div>
<div class="callout-body-container callout-body">
<p>RStudio Project是一个以特定目录作为根目录的工作环境，其中包含R代码、数据、图片、说明文件、结果输出等多个文件。这个根目录还包括一个用于管理项目的.Rproj文件。</p>
</div>
</div>
<p>通过创建RStudio Project，您可以将所有相关文件组织在一个目录中，使得在进行多个分析或项目时更加方便、清晰和高效。此外，RStudio Project还提供了许多其他有用的功能，例如：</p>
<ul>
<li>能够在项目之间快速切换，而无需重新打开各个文件</li>
<li>为每个项目分配单独的工作空间，从而避免命名空间冲突</li>
<li>将项目文件和支持文件打包，便于与他人共享和合作</li>
<li>可以使用renv等工具来管理项目依赖项，以确保在不同计算机上运行项目时的一致性。</li>
</ul>
<p>通过导航到 RStudio 中的”文件”选项卡并选择”新建项目”来创建新项目。您可以选择在新目录或现有目录中创建新项目。</p>
<p>但是，如果您想实现无缝协作，可能需要将软件包管理引入工作流程。幸运的是，RStudio 提供了一个有用的软件包管理工具 renv，现在与 RStudio Projects 兼容。</p>
</section>
<section id="利用renv管理r包的版本" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="利用renv管理r包的版本"><span class="header-section-number">5</span> 利用renv管理R包的版本</h2>
<p>因为R语言的开源使用，越来越多的数据科学家使用R语言来进行了数据分析和数据管理，近年来有大量的R包被上传到CRAN上，这大大方便了我们使用R语言进行数据分析，同时也加大了我们R包管理的难度。</p>
<p>使用renv来管理R包版本是一种有效的方式，以确保在不同计算机上运行R代码时的一致性和可重复性。以下是使用renv管理R包版本的步骤：</p>
<ol type="1">
<li><p>在RStudio中打开您的项目，并在终端中安装renv包。可以使用以下命令：install.packages(“renv”)</p></li>
<li><p>在RStudio的控制台或终端中，输入以下命令，以初始化renv项目：renv::init()</p></li>
<li><p>在项目的根目录中创建一个名为”renv.lock”的文件，该文件用于跟踪项目的包依赖项。可以使用以下命令创建该文件：renv::snapshot()</p></li>
<li><p>在R代码中使用renv来管理R包版本。例如，使用以下命令安装特定版本的tidyverse包：renv::install(“tidyverse@1.3.1”)</p></li>
<li><p>在renv项目中更新或添加新的R包时，使用以下命令将这些更改保存到”renv.lock”文件中：renv::snapshot()</p></li>
<li><p>当您要在另一个计算机上运行该项目时，只需将整个项目目录复制到该计算机上，并使用以下命令恢复项目的环境：renv::restore()</p></li>
</ol>
<p>通过使用renv管理R包版本，您可以确保您的项目在不同计算机上具有相同的R包版本，从而使得您的分析结果更加可靠和可重复。<i class="fa-solid fa-thumbs-up" aria-label="thumbs-up"></i></p>
</section>
<section id="配置r和rstudio启动文件" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="配置r和rstudio启动文件"><span class="header-section-number">6</span> 配置R和Rstudio启动文件</h2>
<p>在启动Rstudio和R时，软件会自动寻找几个文件，这些文件分别为.Rprofile, .Renviron, Rprofile.site, Renviron.site, rsession.conf 和 repos.conf，可以通过这些文件设置一些选项和环境变量。这一部分将介绍如何在R启动时设置特定选项。</p>
<p>下面一个表格总结了如何在启动时控制R选项和环境变量。</p>
<table class="caption-top table">
<caption>R启动文件列表</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Id</th>
<th>文件</th>
<th>需要权限</th>
<th>级别</th>
<th>限制</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>.Rprofile</td>
<td>用户或管理员</td>
<td>用户或项目</td>
<td>没有，运行R代码</td>
</tr>
<tr class="even">
<td>2</td>
<td>.Renviron</td>
<td>用户或管理员</td>
<td>用户或项目</td>
<td>只能设置环境变量</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Rprofile.site</td>
<td>管理员</td>
<td>R版本</td>
<td>没有，运行R代码</td>
</tr>
<tr class="even">
<td>4</td>
<td>Renviron.site</td>
<td>管理员</td>
<td>R版本</td>
<td>只能设置环境变量</td>
</tr>
<tr class="odd">
<td>5</td>
<td>rsession.conf</td>
<td>管理员</td>
<td>服务器</td>
<td>只能配置Rstudio设置，只能设置一个存储库</td>
</tr>
<tr class="even">
<td>6</td>
<td><code>repos.conf</code></td>
<td>管理员</td>
<td>服务器</td>
<td>只能设置存储库</td>
</tr>
</tbody>
</table>
<section id="rprofile" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="rprofile"><span class="header-section-number">6.1</span> .Rprofile</h3>
<p>.Rprofile文件是用户可控的文件，用于设置选项和环境变量。.Rprofile文件可以是用户级别或项目级别。用户级别的.Rprofile文件位于用户主目录的根目录中，项目级别的.Rprofile文件位于项目目录的根目录中。</p>
<p>R只会使用一个.Rprofile文件。因此，如果您既有一个特定于项目的.Rprofile文件，又有一个用户.Rprofile文件需要使用，则必须在项目级.Rprofile的顶部显式调用用户级.Rprofile，使用source(“~/.Rprofile”)。</p>
<p>.Rprofile文件作为常规的R代码进行调用，因此设置环境变量必须在Sys.setenv(key = “value”)调用内完成。</p>
<p>编辑.Rprofile文件的一种简单方法是在R会话中使用usethis::edit_r_profile()函数。您可以指定要编辑的用户或项目级.Rprofile。</p>
</section>
<section id="renviron" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="renviron"><span class="header-section-number">6.2</span> .Renviron</h3>
<p>.Renviron是一个可由用户控制的文件，可用于创建环境变量。这对于避免在R脚本中包含凭据（如API密钥）特别有用。该文件采用键值格式编写，因此环境变量的创建格式为：</p>
<p>Key1=value1 Key2=value2 ... 然后，在R会话中使用Sys.getenv(“Key1”)将返回”value1”。</p>
<p>与.Rprofile文件一样，.Renviron文件可以是用户级别或项目级别。如果有项目级别的.Renviron文件，则不会加载用户级别的文件。usethis包中包含一个帮助函数，可以使用usethis::edit_r_environ()从R会话中编辑.Renviron文件。</p>
</section>
<section id="rprofile.site-和renviron.site" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="rprofile.site-和renviron.site"><span class="header-section-number">6.3</span> Rprofile.site 和Renviron.site</h3>
<p>.Rprofile和.Renviron文件都有服务器范围内的等效文件。Rprofile.site和Renviron.site（没有前导点）文件由RStudio Workbench或RStudio Server上的管理员管理，并且特定于特定版本的R。这些文件的最常见设置涉及对软件包存储库的访问。例如，通常使用共享基线软件包管理策略是从Rprofile.site中完成的。</p>
<p>用户可以使用其个人.Rprofile文件覆盖这些文件中的设置。</p>
<p>这些文件针对每个版本的R进行设置，应位于R_HOME / etc /中。您可以通过在该版本的R会话中运行命令R.home（component =“home”）来找到R_HOME。因此，例如，如果您发现R_HOME是/opt/R/3.6.2/lib/R，则R 3.6.2的Rprofile.site将位于/opt/R/3.6.2/lib/R/etc/Rprofile.site中。</p>
</section>
<section id="rsession.conf和repos.conf" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="rsession.conf和repos.conf"><span class="header-section-number">6.4</span> rsession.conf和repos.conf</h3>
<p>RStudio Workbench和RStudio Server允许服务器管理员通过rsession.conf和repos.conf文件配置特定的服务器范围内的R包存储库。rsession.conf中只能配置一个存储库。如果需要多个存储库，应该使用repos.conf。</p>


</section>
</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>quarto</category>
  <category>rstudio</category>
  <category>R语言</category>
  <guid>https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/</guid>
  <pubDate>Fri, 31 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-03-31-rstudioefficiency/shortcuts.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>论文写作效率神器：Quarto出版系统</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2023-3-25-quarto-writing/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>这篇博文介绍我使用quarto进行论文写作的一些技巧和经验，它们在无形中提高了我论文写作的效率，使论文的数据统计结果具有可能重复性，如果你还没听说过quarto，耐心的读完这篇博文，我相信会给你带来帮助。</p>
  </div>
</div><p></p>



<section id="传统论文写作中的常见问题" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="传统论文写作中的常见问题"><span class="header-section-number">1</span> 传统论文写作中的常见问题</h2>
<p>我相信除了不需要进行统计分析的综述类文章类型之外，大部分论文类型的论文写作流程是下面 图&nbsp;1 这个样子的：</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-1">flowchart TD
  A[(数据清洗)] --&gt; B(统计分析)
  B --&gt; C{结果初步评估}
  C --&gt; B
  C --&gt; D(统计制表)
  D --&gt; E[论文撰写]
  E -- 发现不合理结果 --&gt; B
  E --&gt; F[论文投稿]
  F --&gt; G[专家意见]
  G -- 建议重新统计 --&gt; B
  G -- 不需要重新统计 --&gt; E
  G --&gt; H[发表见刊]
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;1: 论文写作流程
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
什么是传统科技论文写作？
</div>
</div>
<div class="callout-body-container callout-body">
<p>我想你在进行科技论文写作的过程中，数据分析和结果展现是割裂的过程，需要在不同的文字编辑软件里手动调整格式(比如参考文献的标注和更新、图表的交叉引用和更新、段落格式的设定等)，那么我觉这些都属于传统科技论文的写作。</p>
</div>
</div>
<p>在执行上面流程的过程中可能在论文写作及发表过程中出现很多问题，我们在各个环节都可能发现我们论文结果中存在或这或那的问题，这个是非常正常的，也是一个必然的过程，我们需要在这个过程中不断打磨数据的统计结果，使之更有说服力，更能真实展现研究的主要结果。</p>
<p>但是如果<em>需要重新进行统计分析</em>的问题在论文撰写的时候被发现或者在专家审稿的时候被发现，那意味着后面统计制表、论文撰写中相关的数据均需要更新，如果你还是在word里以复制粘贴的方式从统计软件里往word进行结果输出的话，可以想像，这个过程必定的非常痛苦的。</p>
<ul>
<li>需要付出大量时间进行复制粘贴这样没有意义的事</li>
<li>重复操作的过程中可能会出现偶尔的数据错误</li>
</ul>
</section>
<section id="quarto开源科学技术出版系统介绍" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="quarto开源科学技术出版系统介绍"><span class="header-section-number">2</span> Quarto开源科学技术出版系统介绍</h2>
<p><a href="https://quarto.org">Quarto</a>可以解决上面出现的问题，能把数据分析的过程融合进论文写作的过程中来，以<a href="https://www.markdown.xyz/basic-syntax/"><em>markdown</em></a>的格式进行文字编辑和创作，通过插入<a href="https://quarto.org/docs/reference/cells/cells-knitr.html"><em>代码段</em></a>的形式进行统计分析相关的输出，同时它可以实现参考文献的插入和应用、图表的交叉引用；在报告输出方面，它可以输出成PDF、WORD、PPT、HTML、ePub等多种格式，可以用来制作网页、书籍、科技论文、幻灯片等内容。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quarto
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://quarto.org">Quarto</a>是一个基于Pandoc的开源科学和技术出版系统，是下一代的R markdown，它以.qmd为文件后缀，quarto把内容通过knitr转化为markdown，再通过Pandoc转化为各种指定的格式。</p>
<p><img src="https://quarto.org/docs/get-started/hello/images/rstudio-qmd-how-it-works.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="quarto的主要特点" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="quarto的主要特点"><span class="header-section-number">3</span> Quarto的主要特点</h2>
<ul>
<li>它主要用来生成不同格式的报告</li>
<li>能把R、Python、Julia和Observable等代码与文本报告整合起来，生成基于不同代码运行结果的动态报告</li>
<li>它基于markdown和pandoc进行内容的转换</li>
<li>它使用.qmd文件后缀，相对于Rmd在进行内容创作生成不同格式输出时具有统一的语法</li>
<li>它可以不依赖上面所说的软件独立运行，当你的内容创作不涉及的上面的软件时，那你只需要单独安装Quarto环境即可</li>
<li>可以与不同的代码编辑软件结合使用，<a href="https://quarto.org/docs/get-started/">Rstudio、Terminal、Vscode</a>等</li>
</ul>
</section>
<section id="quarto安装" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="quarto安装"><span class="header-section-number">4</span> Quarto安装</h2>
<p>如果你使用Rstudio的话，<a href="https://posit.co/download/rstudio-desktop/">下载最新的版本</a>，该版本内置有quarto。</p>
<p>如果你需要在R 代码进行文档渲染的话，可以安装R quarto包</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarto"</span>)</span>
<span id="cb1-2">quarto<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_render</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hello.qmd"</span>)</span></code></pre></div>
<p>如果你需要在Vscode或者终端中使用quarto的话，可以参考<a href="https://quarto.org/docs/get-started/">不同运行环境quarto的安装与配置</a>，进行相应的配置，本篇博客将使用Rstudio进行相应的操作和介绍。</p>
</section>
<section id="新建quarto文件" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="新建quarto文件"><span class="header-section-number">5</span> 新建quarto文件</h2>
<p>在Rstudio里，点击 <em>File</em> –&gt; New Files –&gt; Quarto Document 新建一个quarto文件，该文件以.qmd为文件后缀</p>
<p><img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/newfile.jpg" class="aside img-fluid"></p>
</section>
<section id="quarto语法介绍" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="quarto语法介绍"><span class="header-section-number">6</span> Quarto语法介绍</h2>
<section id="yaml-信息设置" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="yaml-信息设置"><span class="header-section-number">6.1</span> YAML 信息设置</h3>
<p>Quarto通过yaml设置一些变量信息，比如作者、日期、标题等，YAML以”---“单独一行开头，然后以”---“单独一行结尾，中间可以设置一些变量信息。</p>
<p>变量设定格式：</p>
<p>变量名: 变量值</p>
<p>输出格式也在YAML里面设置，设定输出格式的变量名为：format，变量值为：html、pdf、word等。</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">author</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 陈琼</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 2022-03-28</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">categories</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 论文</span></span>
<span id="cb2-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 生存分析</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">keywords</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 河南省</span></span>
<span id="cb2-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 恶性肿瘤</span></span>
<span id="cb2-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 现时生存分析</span></span>
<span id="cb2-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 相对生存率</span></span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> default</span></span>
<span id="cb2-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">docx</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> default</span></span>
<span id="cb2-16"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
</section>
<section id="代码块" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="代码块"><span class="header-section-number">6.2</span> 代码块</h3>
<p>quarto文档中可以插入代码块，在代码块中可以进行编写相应语言的代码，进行统计分析或结果展现。目前quarto支持的代码块包括R语言、Python等，下面的R语言代码块，利用gtsummary包制作了论文中常用的表1，结果可见 表&nbsp;1 。</p>
<div class="cell" data-tbl-cap-location="top">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| label: tbl-table1</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-cap-location: top</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-cap: "接受不同药物治疗人群基本特征分析"</span></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| warning: false</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| message: false</span></span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gtsummary)</span>
<span id="cb3-9"></span>
<span id="cb3-10">trial <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(age, grade, response, trt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl_summary</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span>trt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_p</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_overall</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bold_labels</span>() </span>
<span id="cb3-16"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div id="tbl-table1" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="top">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;1: 接受不同药物治疗人群基本特征分析
</figcaption>
<div aria-describedby="tbl-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="rlfilfcxfe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rlfilfcxfe table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rlfilfcxfe thead, #rlfilfcxfe tbody, #rlfilfcxfe tfoot, #rlfilfcxfe tr, #rlfilfcxfe td, #rlfilfcxfe th {
  border-style: none;
}

#rlfilfcxfe p {
  margin: 0;
  padding: 0;
}

#rlfilfcxfe .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rlfilfcxfe .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rlfilfcxfe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rlfilfcxfe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rlfilfcxfe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rlfilfcxfe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlfilfcxfe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rlfilfcxfe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rlfilfcxfe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rlfilfcxfe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rlfilfcxfe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rlfilfcxfe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rlfilfcxfe .gt_spanner_row {
  border-bottom-style: hidden;
}

#rlfilfcxfe .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rlfilfcxfe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rlfilfcxfe .gt_from_md > :first-child {
  margin-top: 0;
}

#rlfilfcxfe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rlfilfcxfe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rlfilfcxfe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rlfilfcxfe .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rlfilfcxfe .gt_row_group_first td {
  border-top-width: 2px;
}

#rlfilfcxfe .gt_row_group_first th {
  border-top-width: 2px;
}

#rlfilfcxfe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlfilfcxfe .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rlfilfcxfe .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rlfilfcxfe .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlfilfcxfe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlfilfcxfe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rlfilfcxfe .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rlfilfcxfe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rlfilfcxfe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlfilfcxfe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rlfilfcxfe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlfilfcxfe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rlfilfcxfe .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlfilfcxfe .gt_left {
  text-align: left;
}

#rlfilfcxfe .gt_center {
  text-align: center;
}

#rlfilfcxfe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rlfilfcxfe .gt_font_normal {
  font-weight: normal;
}

#rlfilfcxfe .gt_font_bold {
  font-weight: bold;
}

#rlfilfcxfe .gt_font_italic {
  font-style: italic;
}

#rlfilfcxfe .gt_super {
  font-size: 65%;
}

#rlfilfcxfe .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rlfilfcxfe .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rlfilfcxfe .gt_indent_1 {
  text-indent: 5px;
}

#rlfilfcxfe .gt_indent_2 {
  text-indent: 10px;
}

#rlfilfcxfe .gt_indent_3 {
  text-indent: 15px;
}

#rlfilfcxfe .gt_indent_4 {
  text-indent: 20px;
}

#rlfilfcxfe .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="<strong>Characteristic</strong>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="<strong>N</strong>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>N</strong></th>
<th id="<strong>Overall</strong>, N = 200<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Overall</strong>, N = 200<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>Drug A</strong>, N = 98<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Drug A</strong>, N = 98<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>Drug B</strong>, N = 102<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Drug B</strong>, N = 102<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>p-value</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>2</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Age</td>
<td class="gt_row gt_center" headers="n">189</td>
<td class="gt_row gt_center" headers="stat_0">47 (38, 57)</td>
<td class="gt_row gt_center" headers="stat_1">46 (37, 59)</td>
<td class="gt_row gt_center" headers="stat_2">48 (39, 56)</td>
<td class="gt_row gt_center" headers="p.value">0.7</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="n"><br>
</td>
<td class="gt_row gt_center" headers="stat_0">11</td>
<td class="gt_row gt_center" headers="stat_1">7</td>
<td class="gt_row gt_center" headers="stat_2">4</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Grade</td>
<td class="gt_row gt_center" headers="n">200</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;I</td>
<td class="gt_row gt_center" headers="n"><br>
</td>
<td class="gt_row gt_center" headers="stat_0">68 (34%)</td>
<td class="gt_row gt_center" headers="stat_1">35 (36%)</td>
<td class="gt_row gt_center" headers="stat_2">33 (32%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;II</td>
<td class="gt_row gt_center" headers="n"><br>
</td>
<td class="gt_row gt_center" headers="stat_0">68 (34%)</td>
<td class="gt_row gt_center" headers="stat_1">32 (33%)</td>
<td class="gt_row gt_center" headers="stat_2">36 (35%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;III</td>
<td class="gt_row gt_center" headers="n"><br>
</td>
<td class="gt_row gt_center" headers="stat_0">64 (32%)</td>
<td class="gt_row gt_center" headers="stat_1">31 (32%)</td>
<td class="gt_row gt_center" headers="stat_2">33 (32%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Tumor Response</td>
<td class="gt_row gt_center" headers="n">193</td>
<td class="gt_row gt_center" headers="stat_0">61 (32%)</td>
<td class="gt_row gt_center" headers="stat_1">28 (29%)</td>
<td class="gt_row gt_center" headers="stat_2">33 (34%)</td>
<td class="gt_row gt_center" headers="p.value">0.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="n"><br>
</td>
<td class="gt_row gt_center" headers="stat_0">7</td>
<td class="gt_row gt_center" headers="stat_1">3</td>
<td class="gt_row gt_center" headers="stat_2">4</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> Median (IQR); n (%)</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span> Wilcoxon rank sum test; Pearson’s Chi-squared test</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="markdown文本" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="markdown文本"><span class="header-section-number">6.3</span> Markdown文本</h3>
<p>Rstudio提供两种模式进行文本编辑，一种是source模式，quarto参考使用markdown的基本语法，比如一级标题使用”#“，二级标题使用”##“等，具体可见<a href="https://www.markdown.xyz/basic-syntax/">markdown基本语法</a>。另一种是Visual模式，可见模式下，你不用学习许多markdown的基本语法，可以使用菜单或者快捷键进行添加标题、加粗文本、添加表格、添加图片等操作。</p>
<p>在Rstudio打开的qmd文档中，左上角可以选择source或者visual模式。</p>
<p><em>Source模式下是这样的</em> <img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/source.jpg" class="img-fluid"></p>
<p><em>Visual模式下是这样的</em> <img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/visual.jpg" class="img-fluid"></p>
</section>
</section>
<section id="输出word格式" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="输出word格式"><span class="header-section-number">7</span> 输出Word格式</h2>
<p>虽然quarto支持的输出格式很多，比如html格式、pdf格式以及word格式，你现在所浏览的网页就是用quarto来生成的。</p>
<p>回到我们今天讲的主题是“<em>科技论文的写作效率</em>”，我们撰写完成论文初稿后是需要进入投稿流程的，目前不同期刊所接受的投稿格式还是以word为多，下面就展开来讲一下quarto如何输出word格式。</p>
<section id="利用word模板文件" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="利用word模板文件"><span class="header-section-number">7.1</span> 利用word模板文件</h3>
<p>在quarto文档的YAML部分，通过format设置为输出word格式，还可以设置word模板文件，输出结果会按照word模板的格式对各个部分进行设置。</p>
<p>YAML设置部分代码如下：</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb4-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">docx</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  #reference-doc制定word模板文件</span></span>
<span id="cb4-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reference-doc</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> chinese.docx</span></span>
<span id="cb4-7"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
</section>
<section id="图表交叉引用的相关设置" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="图表交叉引用的相关设置"><span class="header-section-number">7.2</span> 图表交叉引用的相关设置</h3>
<p>通过crossref设置交叉引用图表的格式，fig-title设置的是图标题前显示字符，tbl-title设置表格标题前的显示字符，title-delim设置图表序号和显示字符之间的连接符号。</p>
<p>tbl-frefix设置在文本中引用时的显示格式：如表1、表2，图1、图2</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossref</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fig-title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 图     </span></span>
<span id="cb5-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl-title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 表     </span></span>
<span id="cb5-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title-delim</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> —  </span></span>
<span id="cb5-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl-prefix</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 表</span></span>
<span id="cb5-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fig-prefix</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 图</span></span>
<span id="cb5-9"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
</section>
<section id="设置参考文献引用格式" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="设置参考文献引用格式"><span class="header-section-number">7.3</span> 设置参考文献引用格式</h3>
<p>参考文献的引用时论文写作时候的一个大问题，我们在使用quarto进行科技论文写作的时候，需要在YAML里进行两个设置才能进行参考文献的引用和格式的设置。</p>
<ul>
<li>通过 bibliography: 指定bibtex格式文献的存放位置</li>
<li>通过csl: 指定参考文献的引用格式</li>
</ul>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"河南省肿瘤登记地区恶性肿瘤2017-2019年期间5年相对生存率"</span></span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bibliography</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> survival17-19.bib</span></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">csl</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/qc0824/zotero/styles/chinese-gb7714-2005-numeric.csl"</span></span>
<span id="cb6-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
<p>在文本编辑时，通过[“<span class="citation" data-cites="refid">@refid</span>”]的形式进行参考文献的文内引用，如果同一位置引用多篇文献，[“<span class="citation" data-cites="refid1">@refid1</span>;<span class="citation" data-cites="refid2">@refid2</span>”]，可以在文献之间添加”;“。</p>
</section>
<section id="设置作者列表和单位信息" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="设置作者列表和单位信息"><span class="header-section-number">7.4</span> 设置作者列表和单位信息</h3>
<p>在论文投稿时，需要在标题下方列出各位作者的信息，包括姓名，作者单位，通讯作者等，姓名上标标注作者的单位信息。</p>
<p>quarto里可以通过安装一个<strong>authors-block</strong>插件来实现。</p>
<section id="安装方法" class="level5" data-number="7.4.0.1">
<h5 data-number="7.4.0.1" class="anchored" data-anchor-id="安装方法"><span class="header-section-number">7.4.0.1</span> 安装方法</h5>
<p>在qmd文档所在的quarto项目之下，在terminal运行如下命令：</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1">quarto add kapsner/authors-block</span></code></pre></div>
</section>
<section id="authors-block使用方法" class="level5" data-number="7.4.0.2">
<h5 data-number="7.4.0.2" class="anchored" data-anchor-id="authors-block使用方法"><span class="header-section-number">7.4.0.2</span> authors-block使用方法</h5>
<p>安装好authos-block插件之后，需要在YAML里设置相应的元数据，具体如下。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
authors-block设置方法
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource quarto number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1">---</span>
<span id="cb8-2">title: "河南省恶性肿瘤2017-2019年5年相对生存率"</span>
<span id="cb8-3">authors:</span>
<span id="cb8-4">  - name: 陈琼</span>
<span id="cb8-5">    affiliations:</span>
<span id="cb8-6">      - ref: zlyy</span>
<span id="cb8-7">    email: chenqiong@hnccr.org.cn</span>
<span id="cb8-8">  - name: 张明霞</span>
<span id="cb8-9">    affiliations:</span>
<span id="cb8-10">      - ref: lzu</span>
<span id="cb8-11">  - name: 郭兰伟</span>
<span id="cb8-12">    affiliaitons:</span>
<span id="cb8-13">      - ref: zlyy</span>
<span id="cb8-14">  - name: 刘纯亚</span>
<span id="cb8-15">    affiliations:</span>
<span id="cb8-16">      - ref: zlyy</span>
<span id="cb8-17">  - name: 刘茵</span>
<span id="cb8-18">    affiliations:</span>
<span id="cb8-19">      - ref: zlyy</span>
<span id="cb8-20">  - name: 徐慧芳</span>
<span id="cb8-21">    affiliations:</span>
<span id="cb8-22">      - ref: zlyy</span>
<span id="cb8-23">  - name: 王潇杨</span>
<span id="cb8-24">    affiliations:</span>
<span id="cb8-25">      - ref: zlyy</span>
<span id="cb8-26">  - name: 刘曙正</span>
<span id="cb8-27">    affiliations:</span>
<span id="cb8-28">      - ref: zlyy</span>
<span id="cb8-29">  - name: 张韶凯</span>
<span id="cb8-30">    affiliations:</span>
<span id="cb8-31">      - ref: zlyy</span>
<span id="cb8-32">    coresponding: true</span>
<span id="cb8-33">affiliations:</span>
<span id="cb8-34">  - id: zlyy</span>
<span id="cb8-35">    name: 郑州大学附属肿瘤医院(河南省肿瘤医院)，疾病预防控制科</span>
<span id="cb8-36">  - id: lzu</span>
<span id="cb8-37">    name: 兰州大学公共卫生学院</span>
<span id="cb8-38">filters:</span>
<span id="cb8-39">  - authors-block</span>
<span id="cb8-40">---</span></code></pre></div>
</div>
</div>
</div>
<p><img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/authors-block.jpg" class="img-fluid"></p>
</section>
</section>
</section>
<section id="渲染输出格式" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="渲染输出格式"><span class="header-section-number">8</span> 渲染输出格式</h2>
<p><img src="https://www.chenq.site/qsight/2023-3-25-quarto-writing/render.jpg" class="img-fluid"></p>
<p>在完成以上步骤之后，只需要点击上图标注的render按钮即可，然后一篇word格式的，随时可以进行投稿论文初稿就完成了。</p>
<p>如果你在撰写讨论部分的时候，发现统计的某个指标可能存在异常，那么我们只需要在相应的代码块里更新相应的统计代码，更新完成之后，再次点击render，那么你的统计表格就会跟着更新，再次生成基于新结果的论文初稿。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
什么是render？
</div>
</div>
<div class="callout-body-container callout-body">
<p>其实就是quarto运行的过程，通过kintr包把qmd转化为普通的markdown，在通过pandoc转化为word格式的过程。</p>
</div>
</div>
<p>如果你看完以上内容，有没有想试一试Quarto系统的冲动？本篇博客只是介绍了Quarto应用于论文写作方面，它还有其他很多的应用方式，比如做幻灯、写书稿等等，如果你还有一些闲暇时间，不妨来试试！</p>


</section>

<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>quarto</category>
  <category>论文写作</category>
  <guid>https://www.chenq.site/qsight/2023-3-25-quarto-writing/</guid>
  <pubDate>Sat, 25 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-3-25-quarto-writing/writing.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>肿瘤临床预后影响因素分析应该注意哪些因素?</title>
  <dc:creator>陈琼 </dc:creator>
  <link>https://www.chenq.site/qsight/2023-03-21-肿瘤临床预后影响因素分析应该注意哪些因素/</link>
  <description><![CDATA[ 



<div>
  <div class="def">
    <p>今天我审读了一篇肿瘤临床预后影响因素分析的投稿论文，也想起了以前看过的几篇临床肿瘤预后影响因素的文章，我发现他们在进行数据分析的时候存在某些共同的问题，今天在这里和大家分享一下我的一些观点，希望能对肿瘤预后分析的朋友有所帮助。</p>
  </div>
</div><p></p>



<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
肿瘤预后影响因素分析，下面这些问题你考虑过吗？
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>怎样才能确定因素是否为预后独立影响因素？</li>
<li>如何筛选潜在的混杂因素？</li>
<li>如何判断模型拟合效果？</li>
<li>需要使用哪个统计模型？</li>
<li>结果数据该如何展现？</li>
</ul>
</div>
</div>
</div>
<p>今天我所审读的这篇论文题目是“淋巴瘤临床流行病学特点及利妥昔单抗和BTK抑制剂应用对预后影响”的文章，由于该文章正处于投稿阶段，不能把文章展示出来，但是这篇文章存在的一些问题是目前肿瘤预后分析时一些常见的问题，也是一些共性的问题，今天在这里分享一下我的一些观点和看法，如果刚好你也在进行相关的研究或者数据分析，不妨停下来看一看，说不定对你有所帮助。</p>
<p>临床上肿瘤预后影响因素分析的文章有很多，大多为分析治疗因素对预后的影响，预后的指标多为总体生存和无进展生存。我看过一些临床的论文，得出的最后结论提示某某因素是某癌症预后的<strong>独立</strong>影响因素，那你有没有想过什么是独立的预后影响因素？达到什么样的条件才能成为独立的预后影响因素？</p>
<p>我们先把这个问题放到一边，先从临床的角度想一想，癌症的预后可能与哪些因素有关系？除了治疗因素之外，癌症诊断时的临床分期、病理类型、患者的基础状态以及其他的一些流行病学因素可能均与癌症的预后有关系，这些因素可能在一定程度上影响着患者的总体生存（OS）或者无进展生存（PFS），但是它们对预后影响的效应可能大小不一。</p>
<p>当我们把焦点聚焦到某一个因素上时，比如治疗因素时，我们想通过收集的数据分析一下治疗因素对预后影响的效应大小，那么我们就需要把其他可能影响因素效应排除在外，即把治疗因素以外因素的效应调整之后，才能显示出来治疗因素对预后影响的真实效应。</p>
<p>那从流行病学的角度来讲的话，上面所说的过程就是<strong>去除混杂因素</strong>的过程，简单的说，所研究因素之外，可能对研究结局产生影响的因素就是混杂因素。那在实际数据分析的过程中，怎么判断哪些因素是混杂因素需要调整，而哪些因素不是混杂因素而不需要调整呢？</p>
<p>我觉得可以从两个方面来判断，首先是从专业方面，我们可以通过阅读文献来了解目前证据所支持的所研究结局的影响因素有哪些？这些可能都是<strong>潜在</strong>的混杂因素。我们知道了这些因素之后，在数据收集阶段应该尽可能的把这些因素收集上来，以备后面的分析来用；第二个方面，就是利用自己研究所收集的数据来探索分析，通常按照<em>研究因素分层</em>来看其他不同的因素在不同层间是否分布均衡，如果不均衡的话，那么就需要这些层间不均衡分布的因素，也列入潜在的混杂因素清单，需要纳入调整模型进行校正。</p>
<p>那我们再从统计的角度来说，临床上常用的预后影响因素分析的统计学方法为Cox比例风险回归模型。这个阶段已经数据分析的最后阶段了，我们把所研究因素（治疗方法）作为自变量，把潜在的混杂因素作为协变量，把结局因素（生存状态，生存时间）作为因变量纳入Cox比例风险回归模型进行模型的拟合。调整了协变量的影响之后，研究因素与结局之间的关系，通常用HR来表示，才是真正的研究因素对研究结局的效应大小。</p>
<p>当然在这一步骤里，有人会问：“所有这些潜在的混杂因素最终都要放入模型吗，有没有一些潜在的混杂因素会剔除出模型？”</p>
<p>答案是会的，有一些潜在混杂因素会剔除出模型，主要还是要看模型拟合的情况。如果研究样本量不大，而潜在的混杂因素又很多的时候，我们就需要评估纳入哪些变量以使模型的拟合效果更好(<img src="https://latex.codecogs.com/png.latex?R%5E2">)。或者通过把这个变量纳入和剔除模型前后对研究因素对结局变量效应值的影响大小来判断，如果变化超过10%，那么我们可以考虑纳入模型，反之则剔除出模型。</p>
<p>现在再回到前面第二段的问题，什么样的因素才是癌症预后独立的影响因素呢？</p>
<p>如果你认真看完了上面的几段，我想答案应该显而易见了，所谓癌症预后的独立影响因素应该是排除了研究因素与研究结局之间除了研究因素以外的所有干扰因素之后，研究因素仍然对结局有影响，那么我们可以成为这个研究因素是结局的独立影响因素。</p>
<p>以上的过程是我所理解的肿瘤临床预后影响因素分析的大概过程，这个过程虽然听起来挺简单的，但是总会有各种各样的问题出现。比如统计方法的使用是否合适、该展示的数据没有展示出来等等。</p>
<p>数据分析完成之后，我们就需要以论文或者报告的形式把分析的结果展示出来。我们都知道任何一项研究都不可能做到非常完美，但是我们所能做的就是尽可能得调整混杂因素，去伪存真，展示真实的结局。</p>
<p>在论文撰写的时候，我们要向读者展示出来，所有可能影响结果的地方，我都已经考虑了，而且进行了调整，而有些内容确实没有办法做，我们可以把它列入研究存在的不足和限制方面。如果能做到这一点，我相信你的论文应该是一篇质量很高的论文，还愁发表吗？</p>
<p>这就是我对临床肿瘤预后分析的一点理解，如果你有不同的见解请告诉我，将不胜感激！</p>



<section class="author-card">
  <div class="avatar-container">
    <img src="https://www.chenq.site/qsight/author.png" alt="陈琼博士" class="author-avatar">
  </div>
  <div class="author-info">
    <h3 class="anchored">陈 琼</h3>
    <a class="badge badge-red"> <i class="bi bi-award"> </i> 博士 </a>
    <a class="badge badge-blue"> <i class="bi bi-bar-chart"> </i> 副主任医师 </a>
    <p class="bio">他从事肿瘤登记与人群流行病学研究，编写肿瘤登记年报，并开发和维护个人网站。他撰写博文，分享数据分析方法、可视化技巧和自动化报告解决方案，同时学习 R 语言，开发 R 包，不断探索高效的数据处理与展示方式。 🚀</p>
    <div class="social-links">
      <a href="https://github.com/gigu003" target="_blank">
        <i class="bi bi-github"></i>
      </a>
      <a href="mailto:chenq08@126.com" target="_blank">
        <i class="bi bi-envelope"></i>
      </a>
      <a href="https://scholar.google.com/citations?hl=zh-CN&amp;user=KKgW5AwAAAAJ&amp;view_op=list_works&amp;authuser=1&amp;sortby=pubdate" target="_blank">
        <i class="bi bi-google"></i>
      </a>
    </div>
  </div>
</section>

 ]]></description>
  <category>数据分析</category>
  <guid>https://www.chenq.site/qsight/2023-03-21-肿瘤临床预后影响因素分析应该注意哪些因素/</guid>
  <pubDate>Tue, 21 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.chenq.site/qsight/2023-03-21-肿瘤临床预后影响因素分析应该注意哪些因素/preview.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
