{
  "hash": "1c61a2118063eab1523b1052c7ac4c65",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: R语言ggplot2包和gganimate包绘制动态追逐条形图(chasing barchart)\nauthor: ' 陈琼'\ndate: '2022-05-04'\nslug: chasing-barchart\nlink: https://chenq.site/tech/2022-chasing-barchart/\ncategories:\n  - R\n  - 科研作图\ntags:\n  - 科研作图\nsoft: R\nkeywords:\n  - R语言\n  - 动态条形图\n  - 追逐条形图\n  - chasing bar chart\n  - Trending Animated Bar Charts\n  - ggplot2\n  - gganimate\nimage: \"pp.gif\"\n---\n\n最近动态条形图或者称之为追逐条形图在社交媒体上比较火，最常见的是世界各个国家的GDP排名随着时间（以年为单位）变化的情况，通过它可以明显的看到中国的GDP排名从前10名开外逐渐上升到全球第二名的位置。热爱数据可视化的小伙伴们也在想着如何制作这样酷炫的图呢？今天这篇文章的目的就是介绍如何利用R语言绘制这样的动态条形图。\n\n## 用到哪些R包？\n\n- ggplot2\n- gganimate\n\nggplot2包和gganimate包是两个主要用到的包，但是我们在数据整理过程中还用到了tidyverse、janitor和scales包。\n\n## 数据准备\n作者在互联网上收集了从1980年以来全球前10位国家的GDP数据，[数据，点击下载](gdp.csv)以CSV的形式保存。\n\n我们把数据读入到R环境中，总共有4个变量，year年份、country国家、continent大洲、gdp，下面看下数据的结构，这个数据已经是ggplot2绘图所需要的*长数据*格式，所以不需要进行特别的转换了。\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n#读入gdp数据\ndata <- read.csv(\"gdp.csv\")\n#显示头6条数据\nhead(data)\n\ndata1<-data%>%\n  group_by(year)%>%\n  arrange(year,desc(gdp))%>%\n  mutate(ranking=row_number())%>%\n  filter(ranking<=10)\n```\n:::\n\n## 绘制动态条形图\n\n绘制动态条形图实际需要两个部分，\n\n- 利用ggplot2绘制历年的静态图\n- 利用gganimate包把静态图动起来\n\n前面我们已经准备好了绘图的数据，那么我们就先绘制动态条形图每个画面的静态图。我们准备基于GDP的排名展示位于全球前10位的国家，我们需要绘制每年的排名情况。\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nplot <- data1 %>%\n  ggplot() +\n  geom_col(aes(ranking,gdp,fill=continent)) +\n  geom_text(aes(ranking,gdp,label=paste(round(gdp/1000000000000,2),\"万亿\")), hjust=-0.1) +\n  geom_text(aes(ranking,y=0,label=country), hjust=1.1) + \n  geom_text(aes(x=10, y=max(gdp) , label = as.factor(year)), vjust = 0.2, alpha = 0.5,  col = \"gray\", size = 20) +\n  scale_y_continuous(label=function(x) paste(round(x/1000000000000,2),\"万亿\"))+\n  coord_flip(clip = \"off\", expand = FALSE) + scale_x_reverse() +\n  theme_minimal() + \n  theme(\n    panel.grid = element_blank(), \n    legend.position = \"top\",\n    legend.title=element_blank(),\n    axis.ticks.y = element_blank(),\n    axis.title.y = element_blank(),\n    axis.text.y = element_blank(),\n    plot.margin = margin(1, 4, 1, 3, \"cm\"),\n    text = element_text(family='Kai')\n  ) \n```\n:::\n\n\n上面的代码绘制了动态条形图的每一个画面，也就是每一年的全球GDP排名前10的国家的条形图。当然你也可以对上面的代码进行更改，从而使图更加美观。而进行动态化的关键步骤是使用gganimate包的transition_states()功能，下面的代码使绘制的图按照year这个变量动态变化。\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gganimate)\nplot2<-plot+transition_states(year, state_length = 0, transition_length = 2) +\n  labs(title = '全球不同国家近40年GDP排名变化情况(前10位)',  \n       caption  = \"GDP in Billions USD | Data Source: World Bank Data\")+\n  enter_fade() +\n  exit_fade() + \n  ease_aes('quadratic-in-out') \n\nanimate(plot2, width = 800, height = 500, fps = 25, duration = 15, rewind = FALSE)\nanim_save(\"pp.gif\")\n```\n:::\n\n![追逐条形图](pp.gif)\n\n## 小结\n我们已经成功的绘制了全球gdp前10的国家在过去40年里动态变化的过程，而只要按照我们前面的准备的数据格式整理自己的数据，那么也很容易地能套用这个代码，从而实现自己的动态条形图。\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}